(function(){"use strict";var t={776:function(t,e,i){var s=i(963),a=i(252),n=i(577),o=i(392);const r=(0,a.Uk)("Introduction"),h=(0,a.Uk)("Instrumental Interaction Overview"),l=(0,a.Uk)("Human-Computer Partnerships Overview"),c=(0,a.Uk)("Playground"),d=(0,a.Uk)("About"),g={id:"menu_button"};function p(t,e,i,s,p,u){const f=(0,a.up)("router-link"),M=(0,a.up)("router-view");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("nav",{id:"main_menu",style:(0,n.j5)(p.style)},[(0,a.Wm)(f,{to:"/"},{default:(0,a.w5)((()=>[r])),_:1}),(0,a.Wm)(f,{to:"/instrumentalinteractiontable"},{default:(0,a.w5)((()=>[h])),_:1}),(0,a.Wm)(f,{to:"/hc-partnerships-table"},{default:(0,a.w5)((()=>[l])),_:1}),(0,a.Wm)(f,{to:"/playground"},{default:(0,a.w5)((()=>[c])),_:1}),(0,a.Wm)(f,{to:"/about"},{default:(0,a.w5)((()=>[d])),_:1})],4),(0,a.Wm)(M),(0,a._)("div",g,[(0,a._)("img",{id:"button_image",width:"80",src:o,onClick:e[0]||(e[0]=(...t)=>u.closeMenu&&u.closeMenu(...t))})])],64)}var u={data(){return{style:{"--height":"35px"}}},methods:{openMenu(){},closeMenu(){console.log(document.getElementById("button_image").src),'{"--height":"35px"}'!=JSON.stringify(this.style)?(this.style={"--height":"35px"},document.getElementById("button_image").src=i(392)):(this.style={"--height":"0px"},document.getElementById("button_image").src=i(983))}}},f=i(744);const M=(0,f.Z)(u,[["render",p]]);var x=M,y=i(119);const P={class:"instrumentalInteractionTable",style:{display:"table"}},m={style:{display:"table-cell"}},I=(0,a._)("tr",null,[(0,a._)("th"),(0,a._)("th",null,"Reification"),(0,a._)("th",null,"Polymorphism"),(0,a._)("th",null,"Reuse")],-1),_=(0,a._)("th",null,"Instrument (Input)",-1),D={id:"reificationdemo"},T=(0,a._)("p",{class:"caption"},"Use Stickyline to align the shapes",-1),S={id:"polymorphismdemo"},w=(0,a._)("p",{class:"caption"},"Use Stickyline to align shapes, text, and even pictures",-1),b={id:"reusedemo"},X=(0,a._)("p",{class:"caption"},"Reuse Stickyline to align another group of objects (right-click,copy and paste)",-1),C=(0,a._)("th",null,"Substrate (Output)",-1),v={id:"reificationSubstrateDemo"},k=(0,a._)("p",{class:"caption"},"Use Stickyline to move the aligned objects together",-1),Y={id:"polymorphismSubstrateDemo"},N=(0,a._)("p",{class:"caption"},"Stickyline preserves both alignment and distribution",-1),B={id:"reuseSubstrateDemo"},O=(0,a._)("p",{class:"caption"},"Reuse Stickyline to duplicate the aligned objects (right-click,copy and paste)",-1),G={id:"narationBox",style:{display:"table-cell"}};function A(t,e,i,s,n,o){const r=(0,a.up)("ReificationDemo"),h=(0,a.up)("PolymorphismDemo"),l=(0,a.up)("ReuseDemo"),c=(0,a.up)("ReificationSubstrateDemo"),d=(0,a.up)("PolymorphismSubstrateDemo"),g=(0,a.up)("ReuseSubstrateDemo"),p=(0,a.up)("NarativeBox");return(0,a.wg)(),(0,a.iD)("div",P,[(0,a._)("div",m,[(0,a._)("table",null,[I,(0,a._)("tr",null,[_,(0,a._)("td",null,[(0,a._)("div",D,[(0,a.Wm)(r,{height:t.height,width:t.width,onExplain:o.addExplanation},null,8,["height","width","onExplain"])]),T]),(0,a._)("td",null,[(0,a._)("div",S,[(0,a.Wm)(h,{height:t.height,width:t.width,onExplain:o.addExplanation},null,8,["height","width","onExplain"])]),w]),(0,a._)("td",null,[(0,a._)("div",b,[(0,a.Wm)(l,{height:t.height,width:t.width,onExplain:o.addExplanation},null,8,["height","width","onExplain"])]),X])]),(0,a._)("tr",null,[C,(0,a._)("td",null,[(0,a._)("div",v,[(0,a.Wm)(c,{height:t.height,width:t.width,onExplain:o.addExplanation},null,8,["height","width","onExplain"])]),k]),(0,a._)("td",null,[(0,a._)("div",Y,[(0,a.Wm)(d,{height:t.height,width:t.width,onExplain:o.addExplanation},null,8,["height","width","onExplain"])]),N]),(0,a._)("td",null,[(0,a._)("div",B,[(0,a.Wm)(g,{height:t.height,width:t.width,onExplain:o.addExplanation},null,8,["height","width","onExplain"])]),O])])])]),(0,a._)("div",G,[(0,a.Wm)(p,{class:"narativeBox","texts-for-naration":n.naration},null,8,["texts-for-naration"])])])}function L(t,e,i,s,n,o){const r=(0,a.up)("v-rect"),h=(0,a.up)("v-circle"),l=(0,a.up)("v-image"),c=(0,a.up)("v-regular-polygon"),d=(0,a.up)("v-line"),g=(0,a.up)("v-group"),p=(0,a.up)("v-transformer"),u=(0,a.up)("v-layer"),f=(0,a.up)("v-stage");return(0,a.wg)(),(0,a.iD)("div",{onClick:e[0]||(e[0]=(...e)=>t.HideContextMenu&&t.HideContextMenu(...e)),id:"playground",onMousedown:e[1]||(e[1]=t=>o.updateNaration(this.groups[0]))},[(0,a.Wm)(f,{ref:"stage",id:"stage",config:n.stageSize,onDragmove:o.update,onMousedown:o.handleTransformation,onTouchstart:o.handleTransformation,onFusion:o.makeGroup,onContextMenu:t.DisplayContextMenu},{default:(0,a.w5)((()=>[(0,a.Wm)(u,{ref:"layer"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.groups,(t=>((0,a.wg)(),(0,a.j4)(g,{ref_for:!0,ref:"groups",key:t.id,config:t},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Rect"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(r,{key:e.id,config:e,onTransformend:o.updateTransformedShape,onDragend:e=>o.updatePosInGrp(e,t.id),onDragmove:o.CheckIfNeedToDetach,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Circle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(h,{key:e.id,config:e,onTransformend:o.updateTransformedShape,onDragend:e=>o.updatePosInGrp(e,t.id),onDragmove:o.CheckIfNeedToDetach,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Image"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(l,{key:e.id,config:e,onTransformend:o.updateTransformedShape,onDragend:e=>o.updatePosInGrp(e,t.id),onDragmove:o.CheckIfNeedToDetach,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Triangle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(c,{key:e.id,config:e,onTransformend:o.updateTransformedShape,onDragend:e=>o.updatePosInGrp(e,t.id),onDragmove:o.CheckIfNeedToDetach,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(),(0,a.j4)(d,{key:t.line.id,config:t.line,onTransformend:o.updateTransformedShape,onDragmove:e=>o.updateGrp(e,t.id),onMouseout:o.unshowSelectedShape,onMouseenter:o.showSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseout","onMouseenter"])),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.line.positionPoints,(t=>((0,a.wg)(),(0,a.j4)(h,{key:t.id,config:t,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onMouseenter","onMouseout"])))),128))])),_:2},1032,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.shapes.filter((t=>"Rect"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(r,{key:t.id,config:t,onTransformend:o.updateTransformedShape,onDragmove:o.updatePos,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.shapes.filter((t=>"Circle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(h,{key:t.id,config:t,onTransformend:o.updateTransformedShape,onDragmove:o.updatePos,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.shapes.filter((t=>"Triangle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(c,{key:t.id,config:t,onTransformend:o.updateTransformedShape,onDragmove:o.updatePos,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.transformers,(t=>((0,a.wg)(),(0,a.j4)(p,{key:t.id,config:t},null,8,["config"])))),128)),((0,a.wg)(),(0,a.j4)(h,{key:n.center.id,config:n.center,onDragend:o.ChangeCenter,onClick:t.DisplayCenterMenu},null,8,["config","onDragend","onClick"]))])),_:1},512)])),_:1},8,["config","onDragmove","onMousedown","onTouchstart","onFusion","onContextMenu"])],32)}const F=function(t){let e=this.getStage().width(),i=this.getStage().height(),s=10;return t.x>e-s&&t.y>i-s?{x:e-s,y:i-s}:t.x>e-s&&t.y<s?{x:e-s,y:s}:t.y>i-s&&t.x<s?{x:s,y:i-s}:t.x<s&&t.y<s?{x:s,y:s}:t.x<s?{x:s,y:t.y}:t.y<s?{x:t.x,y:s}:t.x>e-s?{x:e-s,y:t.y}:t.y>i-s?{x:t.x,y:i-s}:{x:t.x,y:t.y}};var R={props:{width:{type:Number,default:window.innerWidth},height:{type:Number,default:window.innerHeight}},components:{},data(){return{stageSize:{width:this.width,height:this.height},lengthToCapture:10,lengthToDetach:15,editedText:null,eraseMode:0,selectedShapeAlignment:"",needMenu:"initial",isALineSelected:!1,isAGroupedShapeSelected:!1,isStageOnlySelected:!1,keepDistanceButtonText:"Liberate Distribution",max_id_figures:6,groups:[{name:"group",className:"Group",id:"6",x:0,y:0,offsetX:0,offsetY:0,rotation:0,draggable:!1,shapes_g:[],aShapeHasBeenDetach:0,line:{x:150,y:250,points:[0,0,0,0,250,0],positionPoints:[],strokeWidth:10,rotation:0,tension:0,closed:!0,draggable:!0,scaleX:1,scaleY:1,opacity:.5,offset:{x:125,y:0},name:"ligne",className:"Line",stroke:"red",id:"6",keepDistribution:!1,freeDistances:[],occupiedDistances:[],keepDistanceButtonText:"Liberate Distribution",defaultAlignment:"Bottom",dragBoundFunc:F}}],transformers:[{id:"lineTransformer",enabledAnchors:[],rotateEnabled:!1,borderEnabled:!1,flipEnabled:!1,nodes:[]},{id:"shapeTransformer",nodes:[]}],shapes:[{rotation:0,id:"2",x:150,y:210,width:70,height:70,scaleX:1,scaleY:1,strokeWidth:0,stroke:"black",fill:"green",name:"rect2",draggable:!0,className:"Rect",isGrouped:0,dragBoundFunc:F,offsetX:35,offsetY:70,personalRotation:0,centerPosition:"Bottom"},{rotation:0,x:50,y:100,scaleX:1,scaleY:1,offsetX:0,offsetY:40,radius:40,fill:"orange",strokeWidth:0,stroke:"black",draggable:!0,isGrouped:0,className:"Circle",personalRotation:0,id:"3",dragBoundFunc:F,centerPosition:"Bottom"},{rotation:0,id:"8",x:250,y:100,sides:3,radius:45,width:90,height:90,scaleX:1,scaleY:1,strokeWidth:0,stroke:"black",fill:"purple",name:"triangle1",draggable:!0,className:"Triangle",isGrouped:0,dragBoundFunc:F,offsetX:0,offsetY:22.5,personalRotation:0,centerPosition:"Bottom"}],center:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:4,fill:"black",opacity:1,draggable:!0,isGrouped:0,className:"Circle",id:"center",dragBoundFunc:F},positionPoint:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint",distance_to_line_center:void 0},selectedShapeId:""}},mounted(){let t=this.$refs.stage.getStage().getChildren()[0].getChildren().filter((t=>"Text"==t.attrs.className));for(let e=0;e<t.length;e++)t[e].attrs.length_x=t[e].width(),t[e].attrs.length_y=t[e].height(),t[e].offsetX(t[e].attrs.length_x/2)},created(){this.max_id_figures=this.shapes.length+this.groups.length},methods:{switchEraseMode(){0==this.eraseMode?(this.eraseMode=1,document.getElementById("playground").style.cursor="url("+i(843)+"),default",this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer")):(this.eraseMode=0,document.getElementById("playground").style.cursor="default")},checkIfShapesOnLine(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;let a=0;while(a<s.length)this.isCoordinateOnLine(s[a].x,s[a].y,i.id)?a+=1:(console.log("a shape is not on a line"),s[a].dragBoundFunc=F,s[a].isGrouped=0,i.positionPoints.splice(a,1),this.shapes.push(s[a]),i.freeDistances.push(i.occupiedDistances[a]),i.occupiedDistances.splice(a,1),s.splice(a,1),this.updateNaration(e))},isCoordinateOnLine(t,e,i){const s=this.groups.find((t=>t.id===i)),a=s.line;let n=!0,o=a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),r=a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),h=a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),l=a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),c=(o-h)/(l-r),d=a.y-c*a.x;return n=Math.abs(r-l)>1?Math.abs(c*t+d-e)>1:Math.abs(t-a.x)>1,!(n||(a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0||!n&&Math.sqrt((a.x-t)**2+(a.y-e)**2)>a.points[4]*a.scaleX/2)},updateGrp(t,e){const i=this.groups.find((t=>t.id===e)),s=i.line;i.offsetX=s.offsetX,i.offsetY=s.offsetY,s.x=t.target.x(),s.y=t.target.y(),this.center.x=s.x,this.center.y=s.y,this.updateAllPosInGrp(s.id),this.checkIfShapesOnLine(s.id)},updateAllPosInGrp(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;for(let n=0;n<s.length;n++)i.keepDistribution,s[n].x=i.x+i.occupiedDistances[n]*Math.cos(i.rotation*(Math.PI/180)),s[n].y=i.y+i.occupiedDistances[n]*Math.sin(i.rotation*(Math.PI/180)),s[n].distance_to_line_center=i.occupiedDistances[n],s[n].rotation=s[n].personalRotation+i.rotation,i.positionPoints[n].x=s[n].x,i.positionPoints[n].y=s[n].y,i.positionPoints[n].distance_to_line_center=s[n].distance_to_line_center;let a=s.length;while(a<i.positionPoints.length)i.keepDistribution?i.positionPoints.splice(a,1):(i.positionPoints[a].x=i.x+i.freeDistances[a-s.length]*Math.cos(i.rotation*(Math.PI/180)),i.positionPoints[a].y=i.y+i.freeDistances[a-s.length]*Math.sin(i.rotation*(Math.PI/180)),i.positionPoints[a].distance_to_line_center=i.freeDistances[a-s.length],a++)},isOutsideTheLine(t,e){let i=e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180)),s=e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180)),a=e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180)),n=e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180)),o=(i-a)/(n-s),r=e.y-o*e.x,h=!1;return h=Math.abs(s-n)>=1?Math.abs(o*t.x+r-t.y)<1:Math.abs(t.x-e.x)<1,!h||(e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=0&&e.rotation*(Math.PI/180)>-Math.PI/2||(e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=0&&e.rotation*(Math.PI/180)>-Math.PI/2||(e.y+.5*e.points[4]*e.scaleX*Math.sin(Math.PI+e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(Math.PI+e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=-Math.PI/2&&e.rotation*(Math.PI/180)>-Math.PI||(e.x+.5*e.points[4]*e.scaleX*Math.cos(Math.PI+e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(Math.PI+e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=-Math.PI/2&&e.rotation*(Math.PI/180)>-Math.PI||(e.y+.5*e.points[4]*e.scaleX*Math.sin(Math.PI-e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(Math.PI-e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=Math.PI&&e.rotation*(Math.PI/180)>Math.PI/2||(e.x+.5*e.points[4]*e.scaleX*Math.cos(Math.PI-e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(Math.PI-e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=Math.PI&&e.rotation*(Math.PI/180)>Math.PI/2||(e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=Math.PI/2&&e.rotation*(Math.PI/180)>=0||(e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=Math.PI/2&&e.rotation*(Math.PI/180)>=0},update(){const t=this.shapes;let e=!1;for(let i=0;i<t.length;i++){let s=t[i].x,a=t[i].y;for(let n=0;n<this.groups.length;n++){let o=this.groups[n].line,r=o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),h=o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),l=o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),c=o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),d=(r-l)/(c-h),g=o.y-d*o.x;e=Math.abs(h-c)>1?Math.abs(d*s+g-a)<=this.lengthToCapture:Math.abs(s-o.x)<=this.lengthToCapture,(e&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=0&&o.rotation*(Math.PI/180)>-Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=-Math.PI/2&&o.rotation*(Math.PI/180)>=-Math.PI||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI&&o.rotation*(Math.PI/180)>Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI/2&&o.rotation*(Math.PI/180)>=0)&&(t[i].isGrouped=1,this.makeGroup(o.id))}}},CheckIfNeedToDetach(t){let e=this.groups.find((e=>e.id===t.target.getParent().attrs.id)),i=e.shapes_g.find((e=>e.id==t.target.id())),s=Math.sqrt((t.target.getStage().getPointerPosition().y-t.target.y())**2+(t.target.getStage().getPointerPosition().x-t.target.x())**2);"Rect"==t.target.className?s-=t.target.attrs.height*t.target.attrs.scaleY:"Circle"==t.target.className?s-=2*t.target.attrs.radius*t.target.attrs.scaleY:"Text"==t.target.className?s-=t.target.attrs.length_y*t.target.attrs.scaleY:("Image"==t.target.className||"Triangle"==t.target.attrs.className)&&(s-=t.target.height()*t.target.scaleY()),s>50&&(this.groups.find((e=>e.id===t.target.getParent().attrs.id)).aShapeHasBeenDetach=1,this.DetachShape(i,t.target.getStage().getPointerPosition().x,t.target.getStage().getPointerPosition().y))},GiveSignOfDistance(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(a)<=this.lengthToCapture&&-90==e.rotation?-Math.sign(n):Math.abs(a)<=this.lengthToCapture&&90==e.rotation?Math.sign(n):Math.sign(a),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},GiveSignOfDistanceBtwCenterAndShape(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(n)<=this.lengthToCapture&&-90==e.rotation?Math.sign(a):Math.abs(n)<=this.lengthToCapture&&90==e.rotation?-Math.sign(a):Math.sign(n),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},makeGroup(t){this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer");const e=this.groups.find((e=>e.id===t)),i=e.line,s=this.shapes;i.freeDistances.sort(this.isSmaller),s.sort(this.isBeforeRegardingX);for(let a=0;a<s.length;a++)if(1==s[a].isGrouped){const n=Object.assign({},this.positionPoint);let o=s[a].x-i.x,r=s[a].y-i.y;s[a].personalRotation=0,s[a].distance_to_line_center=this.GiveSignOfDistance(s[a],i)*Math.sqrt(o**2+r**2),Math.abs(s[a].distance_to_line_center)>=i.points[4]*i.scaleX/2&&(s[a].distance_to_line_center=Math.sign(s[a].distance_to_line_center)*i.points[4]*i.scaleX/2),this.ChangeCenterRegardingCommand(s[a].id,e.line.defaultAlignment),this.updateDragFunc(s[a],i),e.shapes_g.push(s[a]),e.line.occupiedDistances.push(s[a].distance_to_line_center),n.id="positionPoint"+e.id+e.line.positionPoints.length,e.line.positionPoints.push(n),console.log("A new shape has been added with a distance"+s[a].distance_to_line_center),this.updateOccupiedDistance(i.id),this.updateAllPosInGrp(t),this.updateNaration(e),s.splice(a,1)}this.center.x=i.x,this.center.y=i.y},updateOccupiedDistance(t){const e=this.groups.find((e=>e.id===t));if(this.sortByDistToLineCenter(e),e.line.keepDistribution){let t=e.line.points[4],i=e.shapes_g.length,s=t/(i-1)*e.line.scaleX;if(i%2==0){for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[t-1]=-(i/2-1-t+1)*s-s/2;for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[i/2+t]=t*s+s/2;e.line.occupiedDistances[i/2-1]=-s/2,e.line.occupiedDistances[i/2]=s/2}else{for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[t-1]=-s*((i-1)/2-t+1);for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[(i-1)/2+t]=s*t;e.line.occupiedDistances[(i-1)/2]=0}for(let a=0;a<e.shapes_g.length;a++)e.shapes_g[a].distance_to_line_center=e.line.occupiedDistances[a]}else e.line.occupiedDistances.sort(this.isSmaller)},isSmaller(t,e){return t<e?-1:1},isBeforeRegardingX(t,e){return t.x<e.x?-1:1},updateOccDist(t,e){let i=this.isNearest(t.line,e);if(i.isFree){e.distance_to_line_center=t.line.freeDistances[i.indice],t.line.freeDistances.splice(i.indice,1),this.sortByDistToLineCenter(t);for(let e=0;e<t.shapes_g.length;e++)t.line.occupiedDistances.length==e?t.line.occupiedDistances.push(t.shapes_g[e].distance_to_line_center):t.line.occupiedDistances[e]=t.shapes_g[e].distance_to_line_center}else t.shapes_g.find((t=>t.id==e.id)).distance_to_line_center=t.line.occupiedDistances[i.indice],t.line.occupiedDistances.splice(i.indice,1),this.updateOccDist(t,t.shapes_g[i.indice])},isNearest(t,e){let i,s=t.x+t.freeDistances[0]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[0]*Math.sin(t.rotation*(Math.PI/180)),n=Math.sqrt((s-e.x)**2+(a-e.y)**2),o=0;for(let r=1;r<t.freeDistances.length;r++)s=t.x+t.freeDistances[r]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[r]*Math.sin(t.rotation*(Math.PI/180)),i=Math.sqrt((s-e.x)**2+(a-e.y)**2),i<n&&(n=i,o=r);return o},sortByDistToLineCenter(t){if(t.line.keepDistribution)for(let e=0;e<t.shapes_g.length;e++){let i=t.shapes_g[e].x-t.line.x,s=t.shapes_g[e].y-t.line.y;t.shapes_g[e].distance_to_line_center=this.GiveSignOfDistance(t.shapes_g[e],t.line)*Math.sqrt(i**2+s**2)}for(let e=1;e<t.shapes_g.length;e++){let i=t.shapes_g[e],s=e;while(s>0&&t.shapes_g[s-1].distance_to_line_center>i.distance_to_line_center)t.shapes_g[s]=t.shapes_g[s-1],s-=1;t.shapes_g[s]=i}},sortAnyShapesByDistToLineCenter(t,e){for(let i=0;i<t.length;i++){let s=t[i].x-e.x,a=t[i].y-e.y;t.distance_to_line_center=this.GiveSignOfDistance(t,e)*Math.sqrt(s**2+a**2)}for(let i=1;i<t.length;i++){let e=t[i],s=i;while(s>0&&t[s-1].distance_to_line_center>e.distance_to_line_center)t[s]=t[s-1],s-=1;t[s]=e}},updateDragFunc(t,e){let i=e.rotation*(Math.PI/180);i<=0&&i>=-Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.y-e.y)*Math.cos(i),y:e.y-(t.y-e.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.x-e.x)*Math.cos(i),y:e.y-(t.x-e.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.y-e.y)*Math.cos(i),y:e.y+(t.y-e.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}})},updatePos(t){const e=this.shapes.find((e=>e.id===t.target.id()));e.x=t.target.x(),e.y=t.target.y(),this.center.x=t.target.x(),this.center.y=t.target.y();let i={x:e.x,y:e.y};t.target.position(i),t.target.getLayer().batchDraw()},updatePosInGrp(t,e){let i,s,a;const n=this.groups.find((t=>t.id===e));if(1==n.aShapeHasBeenDetach)return void(n.aShapeHasBeenDetach=0);const o=n.line,r=n.shapes_g.find((e=>e.id===t.target.id())),h=n.shapes_g;if(1==r.needToBeDetach&&(r.needToBeDetach=0,this.DetachShape(r),this.updateAllPosInGrp(t.target.getParent().attrs.id)),o.keepDistribution){if(this.isCoordinateOnLine(t.target.x(),t.target.y(),o.id)){i=r.x-t.target.x(),s=r.y-t.target.y();let e=n.line.points[4],a=n.shapes_g.length,l=e/(a-1)*n.line.scaleX,c=Math.sqrt(i**2+s**2);c>=l?(r.x=t.target.x(),r.y=t.target.y(),this.updateOccupiedDistance(o.id),r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation,this.updateAllPosInGrp(o.id)):(r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation)}else r.x=t.target.x(),r.y=t.target.y();o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center}else o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,r.x=t.target.x(),r.y=t.target.y(),0==Math.sin(o.rotation*(Math.PI/180))?a=r.x-o.x:(a=0!=Math.sign(r.x-o.x)?Math.sign(-r.rotation)*Math.sign(r.x-o.x)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2):Math.sign(-r.rotation)*Math.sign(r.y-o.y)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2),(r.rotation*(Math.PI/180)<=-Math.PI/2||r.rotation*(Math.PI/180)<=Math.PI/2&&r.rotation*(Math.PI/180)>=0)&&(a=-a)),o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center;let l={x:r.x,y:r.y};if(this.center.x=r.x,this.center.y=r.y,t.target.position(l),t.target.getLayer().batchDraw(),this.isCoordinateOnLine(r.x,r.y,o.id))o.keepDistribution?n.line.occupiedDistances[h.indexOf(r)]=r.distance_to_line_center:n.line.occupiedDistances[h.indexOf(r)]=a,o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center;else{r.dragBoundFunc=F,r.isGrouped=0,this.shapes.push(r);for(let t=0;t<h.length;t++)h[t].id==r.id&&(o.freeDistances.push(o.occupiedDistances[t]),o.occupiedDistances.splice(t,1),o.positionPoints.splice(t,1),h.splice(t,1),console.log("a shape has been removed from the line"))}o.keepDistribution&&this.updateOccupiedDistance(o.id),this.updateAllPosInGrp(o.id)},updateTransformedShape(t){let e,i;if("Line"==t.target.className)i=this.groups.find((t=>t.id===this.selectedShapeId)).line;else if(e=this.findShape(this.selectedShapeId),i=e.shape_data,void 0==i)return;let s=i.x,a=i.y;i.x=t.target.x(),i.y=t.target.y(),i.rotation=t.target.rotation();let n=i.scaleX;if(i.scaleX=t.target.scaleX(),i.scaleY=t.target.scaleY(),"Line"==t.target.className){const e=this.groups.find((t=>t.id===i.id));if(i.keepDistribution){for(let t=0;t<i.occupiedDistances.length;t++)i.occupiedDistances[t]=i.occupiedDistances[t]/n*i.scaleX;this.update(),this.updateGrp(t,this.selectedShapeId),this.checkIfShapesOnLine(this.selectedShapeId)}else{if(n!=i.scaleX){for(let t=0;t<e.shapes_g.length;t++){let n=e.shapes_g[t].x-i.x,o=e.shapes_g[t].y-i.y;0==Math.sign(e.line.occupiedDistances[t])?e.line.occupiedDistances[t]=this.GiveSignOfDistance(e.shapes_g[t],i)*Math.sqrt(n**2+o**2):e.line.occupiedDistances[t]=Math.sign(e.line.occupiedDistances[t])*Math.sqrt(n**2+o**2),Math.sign(e.shapes_g[t].x-s)!=Math.sign(n)&&0!=Math.sign(e.shapes_g[t].x-s)&&90!=e.line.rotation&&-90!=e.line.rotation&&(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t]),Math.sign(e.shapes_g[t].y-a)==Math.sign(o)||0==Math.sign(e.shapes_g[t].y-a)||90!=e.line.rotation&&-90!=e.line.rotation||(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t])}for(let t=0;t<i.freeDistances.length;t++){let e=s-i.x,n=a-i.y,o=Math.sqrt(e**2+n**2);i.rotation<-90||i.rotation>90?i.freeDistances[t]=i.freeDistances[t]-Math.sign(s-i.x)*o:90==i.rotation||-90==i.rotation?i.freeDistances[t]=i.freeDistances[t]-n:i.freeDistances[t]=i.freeDistances[t]+Math.sign(s-i.x)*o}}this.update(),this.updateGrp(t,this.selectedShapeId),this.checkIfShapesOnLine(this.selectedShapeId)}for(let t=0;t<e.shapes_g.length;t++)this.updateDragFunc(e.shapes_g[t],i)}else"-1"!=e.grp_id?(this.updateAllPosInGrp(e.grp_id),this.updateOccupiedDistance(e.grp_id),t.target.x(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).x),t.target.y(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).y),this.groups.find((t=>t.id===e.grp_id)).shapes_g.find((e=>e.id===t.target.id())).personalRotation=t.target.rotation()-t.target.getParent().attrs.line.rotation,this.updateAllPosInGrp(e.grp_id),this.checkIfShapesOnLine(e.grp_id),this.updateDragFuncOfCenter()):(this.update(),this.updateDragFuncOfCenter());this.center.x=t.target.attrs.x,this.center.y=t.target.attrs.y},handleTransformation(t){if(void 0==t.evt)return;if(1==this.eraseMode)return void this.eraserAction(t);if(t.target===t.target.getStage())return this.selectedShapeId="NoId",this.eraseNodefromTransformer("lineTransformer"),this.eraseNodefromTransformer("shapeTransformer"),void(this.center.opacity=0);const e="Transformer"===t.target.getParent().className;if(e)return;const i=t.target.id();let s,a=this.findShape(i).shape_data;"center"!=t.target.attrs.id&&("Line"==t.target.className?(s="lineTransformer",a=this.groups.find((t=>t.id===i)).line,this.center.draggable=!1,this.selectedShapeAlignment=a.defaultAlignment,this.eraseNodefromTransformer("shapeTransformer")):(s="shapeTransformer",this.center.draggable=!0,this.selectedShapeAlignment=a.centerPosition,this.eraseNodefromTransformer("lineTransformer")),void 0!=a?(this.selectedShapeId=i,this.center.opacity=1,this.updateTransformer(s)):this.selectedShapeId="NoId",this.updateDragFuncOfCenter())},eraseNodefromTransformer(t){let e=this.$refs.stage.getStage();const i=e.find("#"+t)[0];i.nodes([])},updateTransformer(t){let e=this.$refs.stage.getStage();const i=e.find("#"+t)[0];let s;if("lineTransformer"==t)s=e.children[0].getChildren().filter((t=>"Group"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0].getChildren().filter((t=>"Line"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];else{s=e.children[0].getChildren().filter((t=>"Group"!=t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];let t=!0;void 0==s&&(t=!1);let i=0;while(!t)i<this.groups.length?(s=e.children[0].getChildren().filter((t=>"Group"==t.attrs.className))[i].getChildren().find((t=>t.attrs.id==this.selectedShapeId&&"Line"!=t.attrs.className)),t=void 0!=s,i++):t=!0}s!==i.node()&&(void 0!=s?i.nodes([s]):i.nodes([]),this.center.x=s.attrs.x,this.center.y=s.attrs.y)},ChangeCenter(t){let e,i,s=this.findShape(this.selectedShapeId),a=s.shape_data,n=this.GiveSignOfDistanceBtwCenterAndShape(t.target.attrs,a)*Math.sqrt((t.target.y()-a.y)**2+(t.target.x()-a.x)**2)+a.offsetY*a.scaleY,o=a.offsetY;void 0==a?a=this.groups.find((t=>t.id==this.selectedShapeId)).line:("Rect"==a.className?(e=a.height*a.scaleY/3,i=a.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.width/2,a.offsetY=a.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.width/2,a.offsetY=a.height,a.centerPosition="Bottom"):(a.offsetX=a.width/2,a.offsetY=0,a.centerPosition="Top")):"Circle"==a.className?(n+=a.radius*a.scaleY,e=a.radius*a.scaleY*2/3,i=a.radius*a.scaleY*4/3,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0,a.centerPosition="Middle"):n>i?(a.offsetX=0,a.offsetY=a.radius,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")):"Image"==a.className?(e=a.image.height*a.scaleY/3,i=a.image.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height,a.centerPosition="Bottom"):(a.offsetX=a.image.width/2,a.offsetY=0,a.centerPosition="Top")):"Text"==a.className?(e=a.length_y*a.scaleY/3,i=a.length_y*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y,a.centerPosition="Bottom"):(a.offsetX=a.length_x/2,a.offsetY=0,a.centerPosition="Top")):"Triangle"==a.className&&(n+=a.radius*a.scaleY,e=a.radius*a.scaleY/2,i=a.radius*a.scaleY*5/4,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0):n>i?(a.offsetX=0,a.offsetY=a.radius/2,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")),a.y=a.y-(o-a.offsetY)*a.scaleY*Math.cos(a.rotation*(Math.PI/180)),a.x=a.x+(o-a.offsetY)*a.scaleY*Math.sin(a.rotation*(Math.PI/180)),this.selectedShapeAlignment=a.centerPosition,"-1"!=s.grp_id&&this.updateAllPosInGrp(s.grp_id),t.target.x(a.x),t.target.y(a.y))},ChangeCenterRegardingCommand(t,e){let i=this.findShape(t),s=i.shape_data,a=s.offsetY;"Rect"==s.className?"Top"==e?(s.offsetY=0,s.offsetX=s.width/2):"Middle"==e?(s.offsetX=s.width/2,s.offsetY=s.height/2):"Bottom"==e&&(s.offsetX=s.width/2,s.offsetY=s.height):"Circle"==s.className?"Top"==e?(s.offsetX=0,s.offsetY=-s.radius):"Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e&&(s.offsetX=0,s.offsetY=s.radius):"Image"==s.className?"Middle"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height/2):"Bottom"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height):"Top"==e&&(s.offsetX=s.image.width/2,s.offsetY=0):"Text"==s.className?"Middle"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y/2):"Bottom"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y):"Top"==e&&(s.offsetX=s.length_x/2,s.offsetY=0):"Triangle"==s.className&&("Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e?(s.offsetX=0,s.offsetY=s.radius/2):"Top"==e&&(s.offsetX=0,s.offsetY=-s.radius)),s.centerPosition=e,s.y=s.y-(a-s.offsetY)*s.scaleY*Math.cos(s.rotation*(Math.PI/180)),s.x=s.x+(a-s.offsetY)*s.scaleY*Math.sin(s.rotation*(Math.PI/180)),"-1"!=i.grp_id&&this.updateAllPosInGrp(i.grp_id)},updateDragFuncOfCenter(){let t=this.findShape(this.selectedShapeId).shape_data,e=this.center,i=t.rotation*(Math.PI/180);i>=-Math.PI/2&&i<=0?i-=Math.PI/180*90:i<-Math.PI/2?(i+=Math.PI/2,i=Math.PI+i):i<=Math.PI&&i>0&&(i-=Math.PI/180*90),i<=0&&i>=-Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.y-t.y)*Math.cos(i),y:t.y-(e.y-t.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.x-t.x)*Math.cos(i),y:t.y-(e.x-t.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.y-t.y)*Math.cos(i),y:t.y+(e.y-t.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}})},MovingCenter(){},findShape(t){let e=this.shapes.find((e=>e.id===t)),i="-1",s=!0;void 0==e&&(s=!1);let a=0;while(!s)a<this.groups.length?(e=this.groups[a].shapes_g.find((e=>e.id===t)),void 0==e?s=!1:(i=this.groups[a].id,s=!0),a++):s=!0;return{shape_data:e,grp_id:i}},DetachShape(t,e,i){const s=this.lengthToCapture+5;let a=this.groups.find((e=>-1!=e.shapes_g.indexOf(t))),n=a.shapes_g.indexOf(t);t.dragBoundFunc=F;let o=a.line.y-.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),r=a.line.x+.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),h=a.line.y+.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),l=a.line.x-.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),c=(h-o)/(r-l),d=t.x*(1/c)+t.y;a.line.rotation<0&&a.line.rotation>-45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-45&&a.line.rotation>-90||a.line.rotation<-90&&a.line.rotation>-135?(t.x=t.x+Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-135&&a.line.rotation>-180||a.line.rotation>135&&a.line.rotation<180?(t.x=t.x-Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>90&&a.line.rotation<=135||a.line.rotation>45&&a.line.rotation<=90?(t.x=t.x-Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>0&&a.line.rotation<=45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):-90==a.line.rotation?t.x=t.x-Math.sign(t.x-e)*s:90==a.line.rotation?t.x=t.x+Math.sign(t.x-e)*s:(180==a.line.rotation||-180==a.line.rotation||0==a.line.rotation)&&(t.y=t.y-Math.sign(t.y-i)*s),t.isGrouped=0,this.shapes.push(t),this.center.x=t.x,this.center.y=t.y,a.line.freeDistances.push(a.line.occupiedDistances[n]),a.line.occupiedDistances.splice(n,1),a.shapes_g.splice(n,1),a.line.positionPoints.splice(n,1),this.updateOccupiedDistance(a.id),this.updateAllPosInGrp(a.id),this.updateNaration(a),this.eraseNodefromTransformer("shapeTransformer")},createNewShape(t){if("Line"==t.attrs.className){this.max_id_figures=this.max_id_figures+1;let e=t.getParent().clone({id:""+this.max_id_figures,name:"group"+this.max_id_figures,shapes_g:[]});e.attrs.line.id=""+this.max_id_figures,e.attrs.line.x=t.getStage().getPointerPosition().x,e.attrs.line.y=t.getStage().getPointerPosition().y,e.attrs.line.draggable=!0,this.groups.push(e.attrs)}else{this.max_id_figures=this.max_id_figures+1;let e=t.clone({id:""+this.max_id_figures,draggable:!0});e.attrs.isGrouped=0,this.shapes.push(e.attrs)}},eraserAction(t){this.Remove(t.target)},unshowSelectedShape(t){"Line"==t.target.attrs.className&&0==this.eraseMode?t.target.opacity(.5):"Line"==t.target.attrs.className&&1==this.eraseMode?1==t.target.attrs.keepDistribution?t.target.stroke("rgb(48,48,48)"):t.target.stroke("blue"):"positionPoint"==t.target.attrs.className&&1==this.eraseMode?1!=t.target.getParent().attrs.line.keepDistribution&&t.target.strokeWidth(0):1==this.eraseMode&&t.target.strokeWidth(0)},showSelectedShape(t){if("Line"==t.target.attrs.className&&0==this.eraseMode)t.target.opacity(1);else if("Line"==t.target.attrs.className&&1==this.eraseMode)t.target.stroke("rgb(200, 59, 218)");else if("positionPoint"==t.target.attrs.className&&1==this.eraseMode){let e=t.target.getParent().attrs.line;-1!=e.freeDistances.indexOf(t.target.attrs.distance_to_line_center)&&1!=e.keepDistribution&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))}else 1==this.eraseMode&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))},editText(t){let e=t.target.getStage().attrs.container.getBoundingClientRect();document.getElementById("input").style.top=e.y+t.target.getAbsolutePosition().y+"px",document.getElementById("input").style.left=e.x+t.target.getAbsolutePosition().x-5*document.getElementById("input").size+"px",document.getElementById("input").style.display="initial",this.editedText=t.target},updateText(t){let e=this.shapes.find((t=>t.id===this.editedText.attrs.id)),i=!0;void 0==e&&(i=!1);let s=0;while(!i)s<this.groups.length?(e=this.groups[s].shapes_g.find((t=>t.id===this.editedText.attrs.id)),i=void 0!=e,s++):i=!0;if(void 0!=e){let i,s,a,n;i=this.editedText.width(),s=this.editedText.height(),e.text=t.target.value,this.editedText.text(t.target.value),a=this.editedText.width()-i,n=this.editedText.height()-s,e.offsetX=e.offsetX+a/2,e.offsetY=e.offsetY+n/2,e.length_x=this.editedText.width(),e.length_y=this.editedText.height(),document.getElementById("input").style.display="none"}},updateNaration(t){let e="<strong></strong><br>";e+="- <mark class='red'> StickyLine </mark><br>",e+="Relation: <i>alignement with</i>:";for(let i=0;i<t.shapes_g.length;i++)e=e+"<br>- "+t.shapes_g[i].className;this.$emit("explain",{origin:"Instrument - Reification<br><mark class='red'> The Stickyline reifies alignment into a persistent, directly-manipulable line. </mark>",text:e})}}};const E=(0,f.Z)(R,[["render",L]]);var H=E;function j(t,e,i,s,n,o){const r=(0,a.up)("v-rect"),h=(0,a.up)("v-circle"),l=(0,a.up)("v-image"),c=(0,a.up)("v-text"),d=(0,a.up)("v-regular-polygon"),g=(0,a.up)("v-line"),p=(0,a.up)("v-group"),u=(0,a.up)("v-transformer"),f=(0,a.up)("v-layer"),M=(0,a.up)("v-stage"),x=(0,a.up)("ContextMenu");return(0,a.wg)(),(0,a.iD)("div",{onClick:e[1]||(e[1]=(...t)=>o.HideContextMenu&&o.HideContextMenu(...t)),id:"ReuseDemo",onFocusin:e[2]||(e[2]=t=>o.initialNaration(this.groups)),onFocusout:e[3]||(e[3]=t=>this.narationHasBeenInitialized=!1),tabindex:"0"},[(0,a.Wm)(M,{ref:"stage",id:"stage",config:n.stageSize,onDragmove:o.update,onMousedown:o.handleTransformation,onTouchstart:o.handleTransformation,onFusion:o.makeGroup,onContextMenu:o.DisplayContextMenu},{default:(0,a.w5)((()=>[(0,a.Wm)(f,{ref:"layer"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.groups,(t=>((0,a.wg)(),(0,a.j4)(p,{ref_for:!0,ref:"groups",key:t.id,config:t},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Rect"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(r,{key:e.id,config:e,onTransformend:o.updateTransformedShape,onDragend:e=>o.updatePosInGrp(e,t.id),onDragmove:o.CheckIfNeedToDetach,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Circle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(h,{key:e.id,config:e,onTransformend:o.updateTransformedShape,onDragend:e=>o.updatePosInGrp(e,t.id),onDragmove:o.CheckIfNeedToDetach,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Image"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(l,{key:e.id,config:e,onTransformend:o.updateTransformedShape,onDragend:e=>o.updatePosInGrp(e,t.id),onDragmove:o.CheckIfNeedToDetach,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Text"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(c,{key:e.id,config:e,onTransformend:o.updateTransformedShape,onDragend:e=>o.updatePosInGrp(e,t.id),onDragmove:o.CheckIfNeedToDetach,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape,onDblclick:o.editText},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout","onDblclick"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Triangle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(d,{key:e.id,config:e,onTransformend:o.updateTransformedShape,onDragend:e=>o.updatePosInGrp(e,t.id),onDragmove:o.CheckIfNeedToDetach,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(),(0,a.j4)(g,{key:t.line.id,config:t.line,onTransformend:o.updateTransformedShape,onDragmove:e=>o.updateGrp(e,t.id),onMouseout:o.unshowSelectedShape,onMouseenter:o.showSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseout","onMouseenter"])),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.line.positionPoints,(t=>((0,a.wg)(),(0,a.j4)(h,{key:t.id,config:t,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onMouseenter","onMouseout"])))),128))])),_:2},1032,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.shapes.filter((t=>"Rect"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(r,{key:t.id,config:t,onTransformend:o.updateTransformedShape,onDragmove:o.updatePos,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.shapes.filter((t=>"Circle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(h,{key:t.id,config:t,onTransformend:o.updateTransformedShape,onDragmove:o.updatePos,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.shapes.filter((t=>"Triangle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(d,{key:t.id,config:t,onTransformend:o.updateTransformedShape,onDragmove:o.updatePos,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.transformers,(t=>((0,a.wg)(),(0,a.j4)(u,{key:t.id,config:t},null,8,["config"])))),128)),((0,a.wg)(),(0,a.j4)(h,{key:n.center.id,config:n.center,onDragend:o.ChangeCenter,onClick:t.DisplayCenterMenu},null,8,["config","onDragend","onClick"]))])),_:1},512)])),_:1},8,["config","onDragmove","onMousedown","onTouchstart","onFusion","onContextMenu"]),(0,a._)("div",{id:"activeReuse",onFocusout:e[0]||(e[0]=(...t)=>o.stopInitialisation&&o.stopInitialisation(...t)),tabindex:"1"},[(0,a.Wm)(x,{"menu-of-stage":n.isStageOnlySelected,"menu-of-line":n.isALineSelected,"menu-of-grouped-shape":n.isAGroupedShapeSelected,"keep-distance-button-text":this.keepDistanceButtonText,"need-switch-distribution-mode-button":!1,"need-copy-all-button":!1,onChangecenterButton:t.ChangeCenterButtonAction,onDetachshapeButton:t.DetachShapeButtonAction,onKeepdistanceButton:t.KeepDistribution,onCopyButton:o.Copy,onCopyAllButton:t.CopyAll,onPastButton:o.Past,onRemoveButton:o.Remove,onRemoveAllButton:o.RemoveAll},null,8,["menu-of-stage","menu-of-line","menu-of-grouped-shape","keep-distance-button-text","onChangecenterButton","onDetachshapeButton","onKeepdistanceButton","onCopyButton","onCopyAllButton","onPastButton","onRemoveButton","onRemoveAllButton"])],32)],32)}const W={id:"menu"};function K(t,e,i,s,o,r){return(0,a.wg)(),(0,a.iD)("div",W,[i.menuOfLine&&i.needSwitchDistributionModeButton?((0,a.wg)(),(0,a.iD)("button",{key:0,id:"KeepDistance",onClick:e[0]||(e[0]=(...t)=>r.GenerateButtonEvent&&r.GenerateButtonEvent(...t))},(0,n.zw)(i.keepDistanceButtonText),1)):(0,a.kq)("",!0),!i.menuOfStage&&i.needCopyButton?((0,a.wg)(),(0,a.iD)("button",{key:1,id:"Copy",onClick:e[1]||(e[1]=(...t)=>r.GenerateButtonEvent&&r.GenerateButtonEvent(...t))},"Copy Stickyline")):(0,a.kq)("",!0),i.menuOfLine&&i.needCopyAllButton?((0,a.wg)(),(0,a.iD)("button",{key:2,id:"CopyAll",onClick:e[2]||(e[2]=(...t)=>r.GenerateButtonEvent&&r.GenerateButtonEvent(...t))},"Copy All")):(0,a.kq)("",!0),i.menuOfStage&&i.needPastButton?((0,a.wg)(),(0,a.iD)("button",{key:3,id:"Past",onClick:e[3]||(e[3]=(...t)=>r.GenerateButtonEvent&&r.GenerateButtonEvent(...t))},"Paste")):(0,a.kq)("",!0)])}var q={props:{ConcernedShape:Object,CopiedShape:Object,pastOneObject:{type:Boolean,default:!0},menuOfStage:{type:Boolean,default:!1},menuOfLine:{type:Boolean,default:!1},menuOfGroupedShape:{type:Boolean,default:!1},needCopyButton:{type:Boolean,default:!0},needPastButton:{type:Boolean,default:!0},needCopyAllButton:{type:Boolean,default:!0},needSwitchDistributionModeButton:{type:Boolean,default:!0},keepDistanceButtonText:{type:String,default:"Keep Distribution"}},data(){return{dM:this.displayMenu,cS:"${this.ConcernedShape.className} ==='Line'"}},methods:{GenerateButtonEvent(t){"ChangeCenter"==t.target.id&&this.$emit("changecenter-button",this.ConcernedShape),"DetachShape"==t.target.id&&this.$emit("detachshape-button",this.ConcernedShape),"KeepDistance"==t.target.id&&this.$emit("keepdistance-button",this.ConcernedShape),"Copy"==t.target.id&&this.$emit("copy-button",this.ConcernedShape),"CopyAll"==t.target.id&&this.$emit("copy-all-button",this.ConcernedShape),"Past"==t.target.id&&this.$emit("past-button",this.CopiedShape),"Remove"==t.target.id&&this.$emit("remove-button",this.ConcernedShape),"RemoveAll"==t.target.id&&this.$emit("remove-all-button",this.ConcernedShape)}}};const z=(0,f.Z)(q,[["render",K],["__scopeId","data-v-07ec8de3"]]);var $=z;const Z=function(t){let e=this.getStage().width(),i=this.getStage().height(),s=10;return t.x>e-s&&t.y>i-s?{x:e-s,y:i-s}:t.x>e-s&&t.y<s?{x:e-s,y:s}:t.y>i-s&&t.x<s?{x:s,y:i-s}:t.x<s&&t.y<s?{x:s,y:s}:t.x<s?{x:s,y:t.y}:t.y<s?{x:t.x,y:s}:t.x>e-s?{x:e-s,y:t.y}:t.y>i-s?{x:t.x,y:i-s}:{x:t.x,y:t.y}};var U={props:{width:{type:Number,default:window.innerWidth},height:{type:Number,default:window.innerHeight}},components:{ContextMenu:$},data(){return{stageSize:{width:this.width,height:this.height},narationHasBeenInitialized:!1,lengthToCapture:10,lengthToDetach:15,editedText:null,eraseMode:0,selectedShapeAlignment:"",needMenu:"initial",isALineSelected:!1,isAGroupedShapeSelected:!1,isStageOnlySelected:!1,keepDistanceButtonText:"Liberate Distribution",max_id_figures:6,groups:[{name:"group",className:"Group",id:"1",x:0,y:0,offsetX:0,offsetY:0,rotation:0,draggable:!1,shapes_g:[{rotation:0,x:20,y:320,scaleX:1,scaleY:1,offsetX:0,offsetY:40,radius:40,fill:"orange",strokeWidth:0,stroke:"black",draggable:!0,isGrouped:1,className:"Circle",personalRotation:0,id:"2",dragBoundFunc:Z,centerPosition:"Bottom"},{rotation:0,x:110,y:320,scaleX:1,scaleY:1,offsetX:0,offsetY:40,radius:40,fill:"orange",strokeWidth:0,stroke:"black",draggable:!0,isGrouped:1,className:"Circle",personalRotation:0,id:"3",dragBoundFunc:Z,centerPosition:"Bottom"},{rotation:0,x:200,y:320,scaleX:1,scaleY:1,offsetX:0,offsetY:40,radius:40,fill:"orange",strokeWidth:0,stroke:"black",draggable:!0,isGrouped:1,className:"Circle",personalRotation:0,id:"4",dragBoundFunc:Z,centerPosition:"Bottom"}],aShapeHasBeenDetach:0,line:{x:150,y:250,points:[0,0,0,0,250,0],positionPoints:[{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint1",distance_to_line_center:void 0},{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint2",distance_to_line_center:void 0},{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint3",distance_to_line_center:void 0}],strokeWidth:10,rotation:0,tension:0,closed:!0,draggable:!0,scaleX:1,scaleY:1,opacity:.5,offset:{x:125,y:0},name:"ligne",className:"Line",stroke:"blue",id:"1",keepDistribution:!1,freeDistances:[],occupiedDistances:[-95,-25,80],keepDistanceButtonText:"Liberate Distribution",defaultAlignment:"Bottom",dragBoundFunc:Z}}],transformers:[{id:"lineTransformer",enabledAnchors:[],rotateEnabled:!1,borderEnabled:!1,flipEnabled:!1,nodes:[]},{id:"shapeTransformer",nodes:[]}],shapes:[{rotation:0,id:"5",x:150,y:120,sides:3,radius:45,width:90,height:90,scaleX:1,scaleY:1,strokeWidth:0,stroke:"black",fill:"purple",name:"triangle1",draggable:!0,className:"Triangle",isGrouped:0,dragBoundFunc:Z,offsetX:0,offsetY:22.5,personalRotation:0,centerPosition:"Bottom"},{rotation:0,id:"6",x:50,y:70,sides:3,radius:45,width:90,height:90,scaleX:1,scaleY:1,strokeWidth:0,stroke:"black",fill:"purple",name:"triangle1",draggable:!0,className:"Triangle",isGrouped:0,dragBoundFunc:Z,offsetX:0,offsetY:22.5,personalRotation:0,centerPosition:"Bottom"},{rotation:0,id:"7",x:250,y:100,sides:3,radius:45,width:90,height:90,scaleX:1,scaleY:1,strokeWidth:0,stroke:"black",fill:"purple",name:"triangle1",draggable:!0,className:"Triangle",isGrouped:0,dragBoundFunc:Z,offsetX:0,offsetY:22.5,personalRotation:0,centerPosition:"Bottom"}],center:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:4,fill:"black",opacity:1,draggable:!0,isGrouped:0,className:"Circle",id:"center",dragBoundFunc:Z},positionPoint:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint",distance_to_line_center:void 0},selectedShapeId:""}},mounted(){let t=this.$refs.stage.getStage().getChildren()[0].getChildren().filter((t=>"Text"==t.attrs.className));for(let a=0;a<t.length;a++)t[a].attrs.length_x=t[a].width(),t[a].attrs.length_y=t[a].height(),t[a].offsetX(t[a].attrs.length_x/2);let e=this.groups[0],i=e.line,s=e.shapes_g;for(let a=0;a<s.length;a++)this.updateDragFunc(s[a],i),this.updateAllPosInGrp(e.id)},created(){this.max_id_figures=this.shapes.length+this.groups.length;for(let t=0;t<this.groups.length;t++)this.max_id_figures=this.max_id_figures+this.groups[t].shapes_g.length},methods:{switchEraseMode(){0==this.eraseMode?(this.eraseMode=1,document.getElementById("playground").style.cursor="url("+i(843)+"),default",this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer")):(this.eraseMode=0,document.getElementById("playground").style.cursor="default")},checkIfShapesOnLine(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;let a=0;while(a<s.length)this.isCoordinateOnLine(s[a].x,s[a].y,i.id)?a+=1:(console.log("a shape is not on a line"),s[a].dragBoundFunc=Z,s[a].isGrouped=0,i.keepDistribution&&i.positionPoints.slice(a,1),this.shapes.push(s[a]),i.freeDistances.push(i.occupiedDistances[a]),i.occupiedDistances.splice(a,1),s.splice(a,1),this.updateNaration(e))},isCoordinateOnLine(t,e,i){const s=this.groups.find((t=>t.id===i)),a=s.line;let n=!0,o=a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),r=a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),h=a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),l=a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),c=(o-h)/(l-r),d=a.y-c*a.x;return n=Math.abs(r-l)>1?Math.abs(c*t+d-e)>1:Math.abs(t-a.x)>1,!(n||(a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0||!n&&Math.sqrt((a.x-t)**2+(a.y-e)**2)>a.points[4]*a.scaleX/2)},updateGrp(t,e){const i=this.groups.find((t=>t.id===e)),s=i.line;i.offsetX=s.offsetX,i.offsetY=s.offsetY,s.x=t.target.x(),s.y=t.target.y(),this.center.x=s.x,this.center.y=s.y,this.updateAllPosInGrp(s.id),this.checkIfShapesOnLine(s.id)},updateAllPosInGrp(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;for(let n=0;n<s.length;n++)i.keepDistribution,s[n].x=i.x+i.occupiedDistances[n]*Math.cos(i.rotation*(Math.PI/180)),s[n].y=i.y+i.occupiedDistances[n]*Math.sin(i.rotation*(Math.PI/180)),s[n].distance_to_line_center=i.occupiedDistances[n],s[n].rotation=s[n].personalRotation+i.rotation,i.positionPoints[n].x=s[n].x,i.positionPoints[n].y=s[n].y,i.positionPoints[n].distance_to_line_center=s[n].distance_to_line_center;let a=s.length;while(a<i.positionPoints.length)i.keepDistribution?i.positionPoints.splice(a,1):(i.positionPoints[a].x=i.x+i.freeDistances[a-s.length]*Math.cos(i.rotation*(Math.PI/180)),i.positionPoints[a].y=i.y+i.freeDistances[a-s.length]*Math.sin(i.rotation*(Math.PI/180)),i.positionPoints[a].distance_to_line_center=i.freeDistances[a-s.length],a++)},isOutsideTheLine(t,e){let i=e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180)),s=e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180)),a=e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180)),n=e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180)),o=(i-a)/(n-s),r=e.y-o*e.x,h=!1;return h=Math.abs(s-n)>=1?Math.abs(o*t.x+r-t.y)<1:Math.abs(t.x-e.x)<1,!h||(e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=0&&e.rotation*(Math.PI/180)>-Math.PI/2||(e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=0&&e.rotation*(Math.PI/180)>-Math.PI/2||(e.y+.5*e.points[4]*e.scaleX*Math.sin(Math.PI+e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(Math.PI+e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=-Math.PI/2&&e.rotation*(Math.PI/180)>-Math.PI||(e.x+.5*e.points[4]*e.scaleX*Math.cos(Math.PI+e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(Math.PI+e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=-Math.PI/2&&e.rotation*(Math.PI/180)>-Math.PI||(e.y+.5*e.points[4]*e.scaleX*Math.sin(Math.PI-e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(Math.PI-e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=Math.PI&&e.rotation*(Math.PI/180)>Math.PI/2||(e.x+.5*e.points[4]*e.scaleX*Math.cos(Math.PI-e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(Math.PI-e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=Math.PI&&e.rotation*(Math.PI/180)>Math.PI/2||(e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=Math.PI/2&&e.rotation*(Math.PI/180)>=0||(e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=Math.PI/2&&e.rotation*(Math.PI/180)>=0},update(){const t=this.shapes;let e=!1;for(let i=0;i<t.length;i++){let s=t[i].x,a=t[i].y;for(let n=0;n<this.groups.length;n++){let o=this.groups[n].line,r=o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),h=o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),l=o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),c=o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),d=(r-l)/(c-h),g=o.y-d*o.x;e=Math.abs(h-c)>1?Math.abs(d*s+g-a)<=this.lengthToCapture:Math.abs(s-o.x)<=this.lengthToCapture,(e&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=0&&o.rotation*(Math.PI/180)>-Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=-Math.PI/2&&o.rotation*(Math.PI/180)>=-Math.PI||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI&&o.rotation*(Math.PI/180)>Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI/2&&o.rotation*(Math.PI/180)>=0)&&(t[i].isGrouped=1,this.makeGroup(o.id))}}},CheckIfNeedToDetach(t){let e=this.groups.find((e=>e.id===t.target.getParent().attrs.id)),i=e.shapes_g.find((e=>e.id==t.target.id())),s=Math.sqrt((t.target.getStage().getPointerPosition().y-t.target.y())**2+(t.target.getStage().getPointerPosition().x-t.target.x())**2);"Rect"==t.target.className?s-=t.target.attrs.height*t.target.attrs.scaleY:"Circle"==t.target.className?s-=2*t.target.attrs.radius*t.target.attrs.scaleY:"Text"==t.target.className?s-=t.target.attrs.length_y*t.target.attrs.scaleY:("Image"==t.target.className||"Triangle"==t.target.attrs.className)&&(s-=t.target.height()*t.target.scaleY()),s>50&&(this.groups.find((e=>e.id===t.target.getParent().attrs.id)).aShapeHasBeenDetach=1,this.DetachShape(i,t.target.getStage().getPointerPosition().x,t.target.getStage().getPointerPosition().y))},GiveSignOfDistance(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(a)<=this.lengthToCapture&&-90==e.rotation?-Math.sign(n):Math.abs(a)<=this.lengthToCapture&&90==e.rotation?Math.sign(n):Math.sign(a),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},GiveSignOfDistanceBtwCenterAndShape(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(n)<=this.lengthToCapture&&-90==e.rotation?Math.sign(a):Math.abs(n)<=this.lengthToCapture&&90==e.rotation?-Math.sign(a):Math.sign(n),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},makeGroup(t){this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer");const e=this.groups.find((e=>e.id===t)),i=e.line,s=this.shapes;i.freeDistances.sort(this.isSmaller),s.sort(this.isBeforeRegardingX);for(let a=0;a<s.length;a++)if(1==s[a].isGrouped){const n=Object.assign({},this.positionPoint);let o=s[a].x-i.x,r=s[a].y-i.y;if(s[a].personalRotation=0,s[a].distance_to_line_center=this.GiveSignOfDistance(s[a],i)*Math.sqrt(o**2+r**2),Math.abs(s[a].distance_to_line_center)>=i.points[4]*i.scaleX/2&&(s[a].distance_to_line_center=Math.sign(s[a].distance_to_line_center)*i.points[4]*i.scaleX/2),this.ChangeCenterRegardingCommand(s[a].id,e.line.defaultAlignment),!i.keepDistribution&&i.freeDistances.length>0){let t=this.isNearest(i,s[a]);this.updateDragFunc(s[a],i),e.shapes_g.push(s[a]),e.line.occupiedDistances.push(e.line.freeDistances[t]),e.line.freeDistances.splice(t,1)}else this.updateDragFunc(s[a],i),e.shapes_g.push(s[a]),console.log("no 'free distance' anymore"),e.line.occupiedDistances.push(s[a].distance_to_line_center),n.id="positionPoint"+e.id+e.line.positionPoints.length,e.line.positionPoints.push(n);console.log("A new shape has been added with a distance"+s[a].distance_to_line_center),this.updateOccupiedDistance(i.id),this.updateAllPosInGrp(t),s.splice(a,1)}this.updateNaration(e),this.center.x=i.x,this.center.y=i.y},updateOccupiedDistance(t){const e=this.groups.find((e=>e.id===t));if(this.sortByDistToLineCenter(e),e.line.keepDistribution){let t=e.line.points[4],i=e.shapes_g.length,s=t/(i-1)*e.line.scaleX;if(i%2==0){for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[t-1]=-(i/2-1-t+1)*s-s/2;for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[i/2+t]=t*s+s/2;e.line.occupiedDistances[i/2-1]=-s/2,e.line.occupiedDistances[i/2]=s/2}else{for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[t-1]=-s*((i-1)/2-t+1);for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[(i-1)/2+t]=s*t;e.line.occupiedDistances[(i-1)/2]=0}for(let a=0;a<e.shapes_g.length;a++)e.shapes_g[a].distance_to_line_center=e.line.occupiedDistances[a]}else e.line.occupiedDistances.sort(this.isSmaller)},isSmaller(t,e){return t<e?-1:1},isBeforeRegardingX(t,e){return t.x<e.x?-1:1},updateOccDist(t,e){let i=this.isNearest(t.line,e);if(i.isFree){e.distance_to_line_center=t.line.freeDistances[i.indice],t.line.freeDistances.splice(i.indice,1),this.sortByDistToLineCenter(t);for(let e=0;e<t.shapes_g.length;e++)t.line.occupiedDistances.length==e?t.line.occupiedDistances.push(t.shapes_g[e].distance_to_line_center):t.line.occupiedDistances[e]=t.shapes_g[e].distance_to_line_center}else t.shapes_g.find((t=>t.id==e.id)).distance_to_line_center=t.line.occupiedDistances[i.indice],t.line.occupiedDistances.splice(i.indice,1),this.updateOccDist(t,t.shapes_g[i.indice])},isNearest(t,e){let i,s=t.x+t.freeDistances[0]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[0]*Math.sin(t.rotation*(Math.PI/180)),n=Math.sqrt((s-e.x)**2+(a-e.y)**2),o=0;for(let r=1;r<t.freeDistances.length;r++)s=t.x+t.freeDistances[r]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[r]*Math.sin(t.rotation*(Math.PI/180)),i=Math.sqrt((s-e.x)**2+(a-e.y)**2),i<n&&(n=i,o=r);return o},sortByDistToLineCenter(t){if(t.line.keepDistribution)for(let e=0;e<t.shapes_g.length;e++){let i=t.shapes_g[e].x-t.line.x,s=t.shapes_g[e].y-t.line.y;t.shapes_g[e].distance_to_line_center=this.GiveSignOfDistance(t.shapes_g[e],t.line)*Math.sqrt(i**2+s**2)}for(let e=1;e<t.shapes_g.length;e++){let i=t.shapes_g[e],s=e;while(s>0&&t.shapes_g[s-1].distance_to_line_center>i.distance_to_line_center)t.shapes_g[s]=t.shapes_g[s-1],s-=1;t.shapes_g[s]=i}},sortAnyShapesByDistToLineCenter(t,e){for(let i=0;i<t.length;i++){let s=t[i].x-e.x,a=t[i].y-e.y;t.distance_to_line_center=this.GiveSignOfDistance(t,e)*Math.sqrt(s**2+a**2)}for(let i=1;i<t.length;i++){let e=t[i],s=i;while(s>0&&t[s-1].distance_to_line_center>e.distance_to_line_center)t[s]=t[s-1],s-=1;t[s]=e}},updateDragFunc(t,e){let i=e.rotation*(Math.PI/180);i<=0&&i>=-Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.y-e.y)*Math.cos(i),y:e.y-(t.y-e.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.x-e.x)*Math.cos(i),y:e.y-(t.x-e.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.y-e.y)*Math.cos(i),y:e.y+(t.y-e.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}})},updatePos(t){const e=this.shapes.find((e=>e.id===t.target.id()));e.x=t.target.x(),e.y=t.target.y(),this.center.x=t.target.x(),this.center.y=t.target.y();let i={x:e.x,y:e.y};t.target.position(i),t.target.getLayer().batchDraw()},updatePosInGrp(t,e){let i,s,a;const n=this.groups.find((t=>t.id===e));if(1==n.aShapeHasBeenDetach)return void(n.aShapeHasBeenDetach=0);const o=n.line,r=n.shapes_g.find((e=>e.id===t.target.id())),h=n.shapes_g;if(1==r.needToBeDetach&&(r.needToBeDetach=0,this.DetachShape(r),this.updateAllPosInGrp(t.target.getParent().attrs.id)),o.keepDistribution){if(this.isCoordinateOnLine(t.target.x(),t.target.y(),o.id)){i=r.x-t.target.x(),s=r.y-t.target.y();let e=n.line.points[4],a=n.shapes_g.length,l=e/(a-1)*n.line.scaleX,c=Math.sqrt(i**2+s**2);c>=l?(r.x=t.target.x(),r.y=t.target.y(),this.updateOccupiedDistance(o.id),r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation,this.updateAllPosInGrp(o.id)):(r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation)}else r.x=t.target.x(),r.y=t.target.y();o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center}else o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,r.x=t.target.x(),r.y=t.target.y(),0==Math.sin(o.rotation*(Math.PI/180))?a=r.x-o.x:(a=0!=Math.sign(r.x-o.x)?Math.sign(-r.rotation)*Math.sign(r.x-o.x)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2):Math.sign(-r.rotation)*Math.sign(r.y-o.y)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2),(r.rotation*(Math.PI/180)<=-Math.PI/2||r.rotation*(Math.PI/180)<=Math.PI/2&&r.rotation*(Math.PI/180)>=0)&&(a=-a)),o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center;let l={x:r.x,y:r.y};if(this.center.x=r.x,this.center.y=r.y,t.target.position(l),t.target.getLayer().batchDraw(),this.isCoordinateOnLine(r.x,r.y,o.id))o.keepDistribution?n.line.occupiedDistances[h.indexOf(r)]=r.distance_to_line_center:n.line.occupiedDistances[h.indexOf(r)]=a,o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center;else{r.dragBoundFunc=Z,r.isGrouped=0,this.shapes.push(r);for(let t=0;t<h.length;t++)h[t].id==r.id&&(o.freeDistances.push(o.occupiedDistances[t]),o.occupiedDistances.splice(t,1),h.splice(t,1),console.log("a shape has been removed from the line"))}o.keepDistribution&&this.updateOccupiedDistance(o.id),this.updateAllPosInGrp(o.id),this.updateNaration(n)},updateTransformedShape(t){let e,i;if("Line"==t.target.className)i=this.groups.find((t=>t.id===this.selectedShapeId)).line;else if(e=this.findShape(this.selectedShapeId),i=e.shape_data,void 0==i)return;let s=i.x,a=i.y;i.x=t.target.x(),i.y=t.target.y(),i.rotation=t.target.rotation();let n=i.scaleX;if(i.scaleX=t.target.scaleX(),i.scaleY=t.target.scaleY(),"Line"==t.target.className){const e=this.groups.find((t=>t.id===i.id));if(i.keepDistribution){for(let t=0;t<i.occupiedDistances.length;t++)i.occupiedDistances[t]=i.occupiedDistances[t]/n*i.scaleX;this.update(),this.updateGrp(t,this.selectedShapeId),this.checkIfShapesOnLine(this.selectedShapeId)}else{if(n!=i.scaleX){for(let t=0;t<e.shapes_g.length;t++){let n=e.shapes_g[t].x-i.x,o=e.shapes_g[t].y-i.y;0==Math.sign(e.line.occupiedDistances[t])?e.line.occupiedDistances[t]=this.GiveSignOfDistance(e.shapes_g[t],i)*Math.sqrt(n**2+o**2):e.line.occupiedDistances[t]=Math.sign(e.line.occupiedDistances[t])*Math.sqrt(n**2+o**2),Math.sign(e.shapes_g[t].x-s)!=Math.sign(n)&&0!=Math.sign(e.shapes_g[t].x-s)&&90!=e.line.rotation&&-90!=e.line.rotation&&(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t]),Math.sign(e.shapes_g[t].y-a)==Math.sign(o)||0==Math.sign(e.shapes_g[t].y-a)||90!=e.line.rotation&&-90!=e.line.rotation||(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t])}for(let t=0;t<i.freeDistances.length;t++){let e=s-i.x,n=a-i.y,o=Math.sqrt(e**2+n**2);i.rotation<-90||i.rotation>90?i.freeDistances[t]=i.freeDistances[t]-Math.sign(s-i.x)*o:90==i.rotation||-90==i.rotation?i.freeDistances[t]=i.freeDistances[t]-n:i.freeDistances[t]=i.freeDistances[t]+Math.sign(s-i.x)*o}}this.update(),this.updateGrp(t,this.selectedShapeId),this.checkIfShapesOnLine(this.selectedShapeId)}for(let t=0;t<e.shapes_g.length;t++)this.updateDragFunc(e.shapes_g[t],i)}else"-1"!=e.grp_id?(this.updateAllPosInGrp(e.grp_id),this.updateOccupiedDistance(e.grp_id),t.target.x(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).x),t.target.y(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).y),this.groups.find((t=>t.id===e.grp_id)).shapes_g.find((e=>e.id===t.target.id())).personalRotation=t.target.rotation()-t.target.getParent().attrs.line.rotation,this.updateAllPosInGrp(e.grp_id),this.checkIfShapesOnLine(e.grp_id),this.updateDragFuncOfCenter()):(this.update(),this.updateDragFuncOfCenter());this.center.x=t.target.attrs.x,this.center.y=t.target.attrs.y},handleTransformation(t){if(void 0==t.evt)return;if(1==this.eraseMode)return void this.eraserAction(t);if(t.target===t.target.getStage())return this.selectedShapeId="NoId",this.eraseNodefromTransformer("lineTransformer"),this.eraseNodefromTransformer("shapeTransformer"),void(this.center.opacity=0);const e="Transformer"===t.target.getParent().className;if(e)return;const i=t.target.id();let s,a=this.findShape(i).shape_data;"center"!=t.target.attrs.id&&("Line"==t.target.className?(s="lineTransformer",a=this.groups.find((t=>t.id===i)).line,this.center.draggable=!1,this.selectedShapeAlignment=a.defaultAlignment,this.eraseNodefromTransformer("shapeTransformer")):(s="shapeTransformer",this.center.draggable=!0,this.selectedShapeAlignment=a.centerPosition,this.eraseNodefromTransformer("lineTransformer")),void 0!=a?(this.selectedShapeId=i,this.center.opacity=1,this.updateTransformer(s)):this.selectedShapeId="NoId",this.updateDragFuncOfCenter())},eraseNodefromTransformer(t){let e=this.$refs.stage.getStage();const i=e.find("#"+t)[0];i.nodes([])},updateTransformer(t){let e=this.$refs.stage.getStage();const i=e.find("#"+t)[0];let s;if("lineTransformer"==t)s=e.children[0].getChildren().filter((t=>"Group"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0].getChildren().filter((t=>"Line"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];else{s=e.children[0].getChildren().filter((t=>"Group"!=t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];let t=!0;void 0==s&&(t=!1);let i=0;while(!t)i<this.groups.length?(s=e.children[0].getChildren().filter((t=>"Group"==t.attrs.className))[i].getChildren().find((t=>t.attrs.id==this.selectedShapeId&&"Line"!=t.attrs.className)),t=void 0!=s,i++):t=!0}s!==i.node()&&(void 0!=s?i.nodes([s]):i.nodes([]),this.center.x=s.attrs.x,this.center.y=s.attrs.y)},DisplayContextMenu(t){t.evt.preventDefault(),void 0!=t.target.className&&"center"!=t.target.attrs.id&&(this.isStageOnlySelected=!1,$.data().dM="initial",this.$emit("needmenu"),this.needMenu=!0,$.props.ConcernedShape=t.target,"Line"==t.target.attrs.className?(this.isALineSelected=!0,this.isAGroupedShapeSelected=!0,this.keepDistanceButtonText=t.target.attrs.keepDistanceButtonText):"Group"==t.target.getParent().attrs.className?this.isAGroupedShapeSelected=!0:(this.isALineSelected=!1,this.isAGroupedShapeSelected=!1),document.getElementById("activeReuse").style.display="initial",document.getElementById("activeReuse").style.top=document.getElementById("reusedemo").getBoundingClientRect().top+document.documentElement.scrollTop+t.target.getStage().getPointerPosition().y+"px",document.getElementById("activeReuse").style.left=document.getElementById("reusedemo").getBoundingClientRect().left+document.documentElement.scrollLeft+t.target.getStage().getPointerPosition().x+"px"),t.target===t.target.getStage()&&(this.needMenu=!0,this.isALineSelected=!1,this.isAGroupedShapeSelected=!1,this.isStageOnlySelected=!0,document.getElementById("activeReuse").style.display="initial",document.getElementById("activeReuse").style.top=document.getElementById("reusedemo").getBoundingClientRect().top+document.documentElement.scrollTop+t.target.getStage().getPointerPosition().y+"px",document.getElementById("activeReuse").style.left=document.getElementById("reusedemo").getBoundingClientRect().left+document.documentElement.scrollLeft+t.target.getStage().getPointerPosition().x+"px")},HideContextMenu(){this.needMenu=!1,document.getElementById("activeReuse").style.display="none"},ChangeCenter(t){let e,i,s=this.findShape(this.selectedShapeId),a=s.shape_data,n=this.GiveSignOfDistanceBtwCenterAndShape(t.target.attrs,a)*Math.sqrt((t.target.y()-a.y)**2+(t.target.x()-a.x)**2)+a.offsetY*a.scaleY,o=a.offsetY;void 0==a?a=this.groups.find((t=>t.id==this.selectedShapeId)).line:("Rect"==a.className?(e=a.height*a.scaleY/3,i=a.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.width/2,a.offsetY=a.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.width/2,a.offsetY=a.height,a.centerPosition="Bottom"):(a.offsetX=a.width/2,a.offsetY=0,a.centerPosition="Top")):"Circle"==a.className?(n+=a.radius*a.scaleY,e=a.radius*a.scaleY*2/3,i=a.radius*a.scaleY*4/3,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0,a.centerPosition="Middle"):n>i?(a.offsetX=0,a.offsetY=a.radius,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")):"Image"==a.className?(e=a.image.height*a.scaleY/3,i=a.image.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height,a.centerPosition="Bottom"):(a.offsetX=a.image.width/2,a.offsetY=0,a.centerPosition="Top")):"Text"==a.className?(e=a.length_y*a.scaleY/3,i=a.length_y*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y,a.centerPosition="Bottom"):(a.offsetX=a.length_x/2,a.offsetY=0,a.centerPosition="Top")):"Triangle"==a.className&&(n+=a.radius*a.scaleY,e=a.radius*a.scaleY/2,i=a.radius*a.scaleY*5/4,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0):n>i?(a.offsetX=0,a.offsetY=a.radius/2,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")),a.y=a.y-(o-a.offsetY)*a.scaleY*Math.cos(a.rotation*(Math.PI/180)),a.x=a.x+(o-a.offsetY)*a.scaleY*Math.sin(a.rotation*(Math.PI/180)),this.selectedShapeAlignment=a.centerPosition,"-1"!=s.grp_id&&this.updateAllPosInGrp(s.grp_id),t.target.x(a.x),t.target.y(a.y))},ChangeCenterRegardingCommand(t,e){let i=this.findShape(t),s=i.shape_data,a=s.offsetY;"Rect"==s.className?"Top"==e?(s.offsetY=0,s.offsetX=s.width/2):"Middle"==e?(s.offsetX=s.width/2,s.offsetY=s.height/2):"Bottom"==e&&(s.offsetX=s.width/2,s.offsetY=s.height):"Circle"==s.className?"Top"==e?(s.offsetX=0,s.offsetY=-s.radius):"Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e&&(s.offsetX=0,s.offsetY=s.radius):"Image"==s.className?"Middle"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height/2):"Bottom"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height):"Top"==e&&(s.offsetX=s.image.width/2,s.offsetY=0):"Text"==s.className?"Middle"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y/2):"Bottom"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y):"Top"==e&&(s.offsetX=s.length_x/2,s.offsetY=0):"Triangle"==s.className&&("Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e?(s.offsetX=0,s.offsetY=s.radius/2):"Top"==e&&(s.offsetX=0,s.offsetY=-s.radius)),s.centerPosition=e,s.y=s.y-(a-s.offsetY)*s.scaleY*Math.cos(s.rotation*(Math.PI/180)),s.x=s.x+(a-s.offsetY)*s.scaleY*Math.sin(s.rotation*(Math.PI/180)),"-1"!=i.grp_id&&this.updateAllPosInGrp(i.grp_id)},updateDragFuncOfCenter(){let t=this.findShape(this.selectedShapeId).shape_data,e=this.center,i=t.rotation*(Math.PI/180);i>=-Math.PI/2&&i<=0?i-=Math.PI/180*90:i<-Math.PI/2?(i+=Math.PI/2,i=Math.PI+i):i<=Math.PI&&i>0&&(i-=Math.PI/180*90),i<=0&&i>=-Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.y-t.y)*Math.cos(i),y:t.y-(e.y-t.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.x-t.x)*Math.cos(i),y:t.y-(e.x-t.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.y-t.y)*Math.cos(i),y:t.y+(e.y-t.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}})},MovingCenter(){},Copy(){$.props.CopiedShape=$.props.ConcernedShape,$.props.pastOneObject=!0},Past(){if(void 0==$.props.CopiedShape.attrs)return;let t=$.props.CopiedShape.clone({id:""+this.max_id_figures}),e=this.groups.length;if("Line"==$.props.CopiedShape.attrs.className){if(this.max_id_figures=this.max_id_figures+1,$.props.pastOneObject){t=$.props.CopiedShape.getParent().clone({id:""+this.max_id_figures,name:"group"+this.max_id_figures,shapes_g:[]}),t.attrs.line.id=""+this.max_id_figures,t.attrs.line.x=$.props.ConcernedShape.getStage().getPointerPosition().x,t.attrs.line.y=$.props.ConcernedShape.getStage().getPointerPosition().y;for(let e=0;e<t.attrs.line.occupiedDistances.length;e++)t.attrs.line.freeDistances.push(t.attrs.line.occupiedDistances[e]);if(t.attrs.line.occupiedDistances=[],1!=t.attrs.line.keepDistribution){let e=Object.assign([],t.attrs.line.positionPoints),i=e.length;t.attrs.line.positionPoints=[];for(let s=0;s<i.valueOf();s++){let i=$.props.CopiedShape.getParent().getChildren().find((t=>t.attrs.id===e[s].id)).clone({id:"positionPoint"+t.attrs.line.id+s});t.attrs.line.positionPoints.push(i.attrs)}}this.groups.push(t.attrs)}else{t=$.props.CopiedShape.getParent().clone({id:""+this.max_id_figures,name:"group"+this.max_id_figures,shapes_g:[]}),t.attrs.line.id=""+this.max_id_figures,t.attrs.line.x=$.props.ConcernedShape.getStage().getPointerPosition().x,t.attrs.line.y=$.props.ConcernedShape.getStage().getPointerPosition().y;let i=Object.assign([],t.attrs.line.positionPoints),s=i.length;t.attrs.line.positionPoints=[];for(let e=0;e<s.valueOf();e++){let s=$.props.CopiedShape.getParent().getChildren().find((t=>t.attrs.id===i[e].id)).clone({id:"positionPoint"+t.attrs.line.id+e});t.attrs.line.positionPoints.push(s.attrs)}this.groups.push(t.attrs);let a=this.groups[this.groups.indexOf(this.groups.find((t=>t.id==$.props.CopiedShape.getParent().attrs.id)))].shapes_g,n=a.length;for(let t=0;t<n;t++){this.max_id_figures=this.max_id_figures+1;let i=$.props.CopiedShape.getParent().getChildren().find((e=>e.attrs.id===a[t].id)).clone({id:""+this.max_id_figures});this.groups[e].shapes_g.push(i.attrs),this.updateDragFunc(this.groups[e].shapes_g[this.groups[e].shapes_g.length-1],this.groups[e].line)}this.updateAllPosInGrp(t.attrs.id)}this.updateNaration(this.groups[this.groups.length-1]),this.updateAllPosInGrp(t.attrs.id)}else this.max_id_figures=this.max_id_figures+1,t=$.props.CopiedShape.clone({id:""+this.max_id_figures,x:$.props.ConcernedShape.getStage().getPointerPosition().x,y:$.props.ConcernedShape.getStage().getPointerPosition().y}),t.attrs.dragBoundFunc=function(t){return{x:t.x,y:t.y}},t.attrs.isGrouped=0,this.shapes.push(t.attrs)},Remove(t){if("Line"==t.attrs.className){let e=this.groups.find((e=>e.id===t.attrs.id));const i=e.shapes_g.length;for(let t=0;t<i;t++)e.shapes_g[t].dragBoundFunc=Z,e.shapes_g[t].isGrouped=0,this.shapes.push(e.shapes_g[t]);this.eraseNodefromTransformer("lineTransformer"),this.groups.splice(this.groups.indexOf(e),1),t.getParent().destroy(),void 0!=this.groups[0]?(this.center.x=this.groups[0].line.x,this.center.y=this.groups[0].line.y):void 0!=this.shapes[0]&&(this.center.x=this.shapes[0].x,this.center.y=this.shapes[0].y),this.center.opacity=0}else if("positionPoint"==t.attrs.className){let e=t.getParent().attrs.line,i=e.positionPoints.find((e=>e.id===t.attrs.id)),s=e.freeDistances.indexOf(t.attrs.distance_to_line_center);1!=e.keepDistribution&&-1!=s&&(e.freeDistances.splice(s,1),e.positionPoints.splice(e.positionPoints.indexOf(i),1))}else{let e=this.findShape(t.attrs.id),i=e.shape_data,s=e.grp_id;if(void 0!=i){if("-1"!=s){let t=this.groups.find((t=>t.id===s));t.line.freeDistances.push(t.line.occupiedDistances[t.shapes_g.indexOf(i)]),t.line.occupiedDistances.splice(t.shapes_g.indexOf(i),1),t.shapes_g.splice(t.shapes_g.indexOf(i),1),this.updateOccupiedDistance(t.id),this.updateAllPosInGrp(t.id)}else this.eraseNodefromTransformer("shapeTransformer"),this.shapes.splice(this.shapes.indexOf(i),1),void 0!=this.groups[0]?(this.center.x=this.groups[0].line.x,this.center.y=this.groups[0].line.y):void 0!=this.shapes[0]&&(this.center.x=this.shapes[0].x,this.center.y=this.shapes[0].y),this.center.opacity=0;t.destroy()}}},RemoveAll(){let t=$.props.ConcernedShape;if("Line"==t.className){let e=this.groups.find((e=>e.id===t.attrs.id));while(0!=e.shapes_g.length)e.shapes_g[0].dragBoundFunc=Z,e.shapes_g.splice(0,1);this.eraseNodefromTransformer("lineTransformer"),this.groups.splice(this.groups.indexOf(e),1),t.getParent().destroy(),void 0!=this.groups[0]?(this.center.x=this.groups[0].line.x,this.center.y=this.groups[0].line.y):void 0!=this.shapes[0]&&(this.center.x=this.shapes[0].x,this.center.y=this.shapes[0].y)}},findShape(t){let e=this.shapes.find((e=>e.id===t)),i="-1",s=!0;void 0==e&&(s=!1);let a=0;while(!s)a<this.groups.length?(e=this.groups[a].shapes_g.find((e=>e.id===t)),void 0==e?s=!1:(i=this.groups[a].id,s=!0),a++):s=!0;return{shape_data:e,grp_id:i}},DetachShape(t,e,i){const s=this.lengthToCapture+5;let a=this.groups.find((e=>-1!=e.shapes_g.indexOf(t))),n=a.shapes_g.indexOf(t);t.dragBoundFunc=Z;let o=a.line.y-.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),r=a.line.x+.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),h=a.line.y+.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),l=a.line.x-.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),c=(h-o)/(r-l),d=t.x*(1/c)+t.y;a.line.rotation<0&&a.line.rotation>-45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-45&&a.line.rotation>-90||a.line.rotation<-90&&a.line.rotation>-135?(t.x=t.x+Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-135&&a.line.rotation>-180||a.line.rotation>135&&a.line.rotation<180?(t.x=t.x-Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>90&&a.line.rotation<=135||a.line.rotation>45&&a.line.rotation<=90?(t.x=t.x-Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>0&&a.line.rotation<=45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):-90==a.line.rotation?t.x=t.x-Math.sign(t.x-e)*s:90==a.line.rotation?t.x=t.x+Math.sign(t.x-e)*s:(180==a.line.rotation||-180==a.line.rotation||0==a.line.rotation)&&(t.y=t.y-Math.sign(t.y-i)*s),t.isGrouped=0,this.shapes.push(t),this.center.x=t.x,this.center.y=t.y,a.line.freeDistances.push(a.line.occupiedDistances[n]),a.line.occupiedDistances.splice(n,1),a.shapes_g.splice(n,1),a.line.keepDistribution&&a.line.positionPoints.splice(n,1),this.updateOccupiedDistance(a.id),this.updateAllPosInGrp(a.id),this.updateNaration(a),this.eraseNodefromTransformer("shapeTransformer")},createNewShape(t){if("Line"==t.attrs.className){this.max_id_figures=this.max_id_figures+1;let e=t.getParent().clone({id:""+this.max_id_figures,name:"group"+this.max_id_figures,shapes_g:[]});e.attrs.line.id=""+this.max_id_figures,e.attrs.line.x=t.getStage().getPointerPosition().x,e.attrs.line.y=t.getStage().getPointerPosition().y,e.attrs.line.draggable=!0,this.groups.push(e.attrs)}else{this.max_id_figures=this.max_id_figures+1;let e=t.clone({id:""+this.max_id_figures,draggable:!0});e.attrs.isGrouped=0,this.shapes.push(e.attrs)}},eraserAction(t){this.Remove(t.target)},unshowSelectedShape(t){"Line"==t.target.attrs.className&&0==this.eraseMode?t.target.opacity(.5):"Line"==t.target.attrs.className&&1==this.eraseMode?1==t.target.attrs.keepDistribution?t.target.stroke("rgb(48,48,48)"):t.target.stroke("blue"):"positionPoint"==t.target.attrs.className&&1==this.eraseMode?1!=t.target.getParent().attrs.line.keepDistribution&&t.target.strokeWidth(0):1==this.eraseMode&&t.target.strokeWidth(0)},showSelectedShape(t){if("Line"==t.target.attrs.className&&0==this.eraseMode)t.target.opacity(1);else if("Line"==t.target.attrs.className&&1==this.eraseMode)t.target.stroke("rgb(200, 59, 218)");else if("positionPoint"==t.target.attrs.className&&1==this.eraseMode){let e=t.target.getParent().attrs.line;-1!=e.freeDistances.indexOf(t.target.attrs.distance_to_line_center)&&1!=e.keepDistribution&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))}else 1==this.eraseMode&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))},editText(t){let e=t.target.getStage().attrs.container.getBoundingClientRect();document.getElementById("input").style.top=e.y+t.target.getAbsolutePosition().y+"px",document.getElementById("input").style.left=e.x+t.target.getAbsolutePosition().x-5*document.getElementById("input").size+"px",document.getElementById("input").style.display="initial",this.editedText=t.target},updateText(t){let e=this.shapes.find((t=>t.id===this.editedText.attrs.id)),i=!0;void 0==e&&(i=!1);let s=0;while(!i)s<this.groups.length?(e=this.groups[s].shapes_g.find((t=>t.id===this.editedText.attrs.id)),i=void 0!=e,s++):i=!0;if(void 0!=e){let i,s,a,n;i=this.editedText.width(),s=this.editedText.height(),e.text=t.target.value,this.editedText.text(t.target.value),a=this.editedText.width()-i,n=this.editedText.height()-s,e.offsetX=e.offsetX+a/2,e.offsetY=e.offsetY+n/2,e.length_x=this.editedText.width(),e.length_y=this.editedText.height(),document.getElementById("input").style.display="none"}},updateNaration(t){let e="<strong>Substrate with id="+t.id+":</strong><br>";e=1==t.line.id?e+"- <mark class='blue'> StickyLine with id="+t.line.id+"</mark><br>":e+"- <mark class='blue'> copied StickyLine with id="+t.line.id+"</mark><br>",e+="Relation: <i>alignement and distance with</i>:";for(let i=0;i<t.shapes_g.length;i++)e=e+"<br>- "+t.shapes_g[i].className+" with id="+t.shapes_g[i].id;e+="<br>Distance kept in memory:";for(let i=0;i<t.line.occupiedDistances.length;i++)e=e+t.line.occupiedDistances[i].toFixed(1)+",";e+="<mark class='green'>";for(let i=0;i<t.line.freeDistances.length-1;i++)e=e+t.line.freeDistances[i].toFixed(1)+",";t.line.freeDistances.length>0&&(e+=t.line.freeDistances[t.line.freeDistances.length-1].toFixed(1)),e+="</mark>",this.$emit("explain",{origin:"Instrument - Reuse<br><mark class='blue'> The Stickyline preserving alignment and distances can be reused to apply to other objects. </mark>",text:e})},initialNaration(t){if(!this.narationHasBeenInitialized){let e,i="";for(let s=0;s<t.length-1;s++){e=t[s],1==e.line.id?(i=i+"<strong>Substrate with id="+e.id+":</strong><br>",i=i+"- <mark class='blue'> StickyLine with id="+e.line.id+"</mark><br>"):(i=i+"<strong>Substrate with id="+e.id+":</strong><br>",i=i+"- <mark class='blue'> copied StickyLine with id="+e.line.id+"</mark><br>"),i+="Relation: <i>alignement and distance with</i>:";for(let t=0;t<e.shapes_g.length;t++)i=i+"<br>- "+e.shapes_g[t].className+" with id="+e.shapes_g[t].id;i+="<br>Distance kept in memory:";for(let t=0;t<e.line.occupiedDistances.length;t++)i=i+e.line.occupiedDistances[t].toFixed(1)+",";i+="<mark class='green'>";for(let t=0;t<e.line.freeDistances.length-1;t++)i=i+e.line.freeDistances[t].toFixed(1)+",";e.line.freeDistances.length>0&&(i+=e.line.freeDistances[e.line.freeDistances.length-1].toFixed(1)),i+="</mark>",i+="<br>***<br>"}e=t[t.length-1],1==e.line.id?(i=i+"<strong>Substrate with id="+e.id+":</strong><br>",i=i+"- <mark class='blue'> StickyLine with id="+e.line.id+"</mark><br>"):(i=i+"<strong>Substrate with id="+e.id+":</strong><br>",i=i+"- <mark class='blue'> copied StickyLine with id="+e.line.id+"</mark><br>"),i+="Relation: <i>alignement and distance with</i>:";for(let t=0;t<e.shapes_g.length;t++)i=i+"<br>- "+e.shapes_g[t].className+" with id="+e.shapes_g[t].id;i+="<br>Distance kept in memory:";for(let t=0;t<e.line.occupiedDistances.length;t++)i=i+e.line.occupiedDistances[t].toFixed(1)+",";i+="<mark class='green'>";for(let t=0;t<e.line.freeDistances.length-1;t++)i=i+e.line.freeDistances[t].toFixed(1)+",";e.line.freeDistances.length>0&&(i+=e.line.freeDistances[e.line.freeDistances.length-1].toFixed(1)),i+="</mark>",this.narationHasBeenInitialized=!0,this.$emit("explain",{origin:"Instrument - Reuse<br><mark class='blue'> The Stickyline preserving alignment and distances can be reused to apply to other objects. </mark>",text:i})}},stopInitialisation(t){t.stopPropagation()}}};const Q=(0,f.Z)(U,[["render",j]]);var V=Q;function J(t,e,i,n,o,r){const h=(0,a.up)("v-rect"),l=(0,a.up)("v-circle"),c=(0,a.up)("v-image"),d=(0,a.up)("v-text"),g=(0,a.up)("v-regular-polygon"),p=(0,a.up)("v-line"),u=(0,a.up)("v-group"),f=(0,a.up)("v-transformer"),M=(0,a.up)("v-layer"),x=(0,a.up)("v-stage");return(0,a.wg)(),(0,a.iD)("div",{onClick:e[1]||(e[1]=(...e)=>t.HideContextMenu&&t.HideContextMenu(...e)),id:"playground",onMousedown:e[2]||(e[2]=t=>r.updateNaration(this.groups[0]))},[(0,a.Wm)(x,{ref:"stage",id:"stage",config:o.stageSize,onDragmove:r.update,onMousedown:r.handleTransformation,onTouchstart:r.handleTransformation,onFusion:r.makeGroup,onContextMenu:t.DisplayContextMenu},{default:(0,a.w5)((()=>[(0,a.Wm)(M,{ref:"layer"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.groups,(t=>((0,a.wg)(),(0,a.j4)(u,{ref_for:!0,ref:"groups",key:t.id,config:t},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Rect"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(h,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Circle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(l,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Image"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(c,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Text"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(d,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape,onDblclick:r.editText},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout","onDblclick"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Triangle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(g,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(),(0,a.j4)(p,{key:t.line.id,config:t.line,onTransformend:r.updateTransformedShape,onDragmove:e=>r.updateGrp(e,t.id),onMouseout:r.unshowSelectedShape,onMouseenter:r.showSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseout","onMouseenter"])),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.line.positionPoints,(t=>((0,a.wg)(),(0,a.j4)(l,{key:t.id,config:t,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onMouseenter","onMouseout"])))),128))])),_:2},1032,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Rect"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(h,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Circle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(l,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Image"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(c,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Text"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(d,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape,onDblclick:r.editText},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout","onDblclick"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Triangle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(g,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.transformers,(t=>((0,a.wg)(),(0,a.j4)(f,{key:t.id,config:t},null,8,["config"])))),128)),((0,a.wg)(),(0,a.j4)(l,{key:o.center.id,config:o.center,onDragend:r.ChangeCenter,onClick:t.DisplayCenterMenu},null,8,["config","onDragend","onClick"]))])),_:1},512)])),_:1},8,["config","onDragmove","onMousedown","onTouchstart","onFusion","onContextMenu"]),(0,a._)("input",{type:"text",id:"input1",size:"10",value:"the logo",onKeyup:e[0]||(e[0]=(0,s.D2)(((...t)=>r.updateText&&r.updateText(...t)),["enter"]))},null,32)],32)}const tt=function(t){let e=this.getStage().width(),i=this.getStage().height(),s=10;return t.x>e-s&&t.y>i-s?{x:e-s,y:i-s}:t.x>e-s&&t.y<s?{x:e-s,y:s}:t.y>i-s&&t.x<s?{x:s,y:i-s}:t.x<s&&t.y<s?{x:s,y:s}:t.x<s?{x:s,y:t.y}:t.y<s?{x:t.x,y:s}:t.x>e-s?{x:e-s,y:t.y}:t.y>i-s?{x:t.x,y:i-s}:{x:t.x,y:t.y}};var et={props:{width:{type:Number,default:window.innerWidth},height:{type:Number,default:window.innerHeight}},components:{},data(){return{stageSize:{width:this.width,height:this.height},lengthToCapture:10,lengthToDetach:15,editedText:null,eraseMode:0,selectedShapeAlignment:"",needMenu:"initial",isALineSelected:!1,isAGroupedShapeSelected:!1,isStageOnlySelected:!1,keepDistanceButtonText:"Liberate Distribution",max_id_figures:6,groups:[{name:"group",className:"Group",id:"6",x:0,y:0,offsetX:0,offsetY:0,rotation:0,draggable:!1,shapes_g:[],aShapeHasBeenDetach:0,line:{x:150,y:250,points:[0,0,0,0,250,0],positionPoints:[],strokeWidth:10,rotation:0,tension:0,closed:!0,draggable:!0,scaleX:1,scaleY:1,opacity:.5,offset:{x:125,y:0},name:"ligne",className:"Line",stroke:"red",id:"6",keepDistribution:!1,freeDistances:[],occupiedDistances:[],keepDistanceButtonText:"Liberate Distribution",defaultAlignment:"Bottom",dragBoundFunc:tt}}],transformers:[{id:"lineTransformer",enabledAnchors:[],rotateEnabled:!1,borderEnabled:!1,flipEnabled:!1,nodes:[]},{id:"shapeTransformer",nodes:[]}],shapes:[{text:"the logo",rotation:0,x:150,y:190,scaleX:1,scaleY:1,offsetY:0,offsetX:36,length_x:72,length_y:30,draggable:!0,isGrouped:0,className:"Text",fontSize:30,fontFamily:"Calibri",personalRotation:0,id:"4",dragBoundFunc:tt,centerPosition:"Top"},{rotation:0,x:50,y:100,scaleX:.66,scaleY:.66,offsetY:0,offsetX:0,image:null,draggable:!0,isGrouped:0,className:"Image",fontSize:30,personalRotation:0,id:"5",dragBoundFunc:tt,centerPosition:"Bottom"},{rotation:0,id:"8",x:250,y:100,sides:3,radius:45,width:90,height:90,scaleX:1,scaleY:1,strokeWidth:0,stroke:"black",fill:"purple",name:"triangle1",draggable:!0,className:"Triangle",isGrouped:0,dragBoundFunc:tt,offsetX:0,offsetY:22.5,personalRotation:0,centerPosition:"Bottom"}],center:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:4,fill:"black",opacity:1,draggable:!0,isGrouped:0,className:"Circle",id:"center",dragBoundFunc:tt},positionPoint:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint",distance_to_line_center:void 0},selectedShapeId:""}},mounted(){let t=this.$refs.stage.getStage().getChildren()[0].getChildren().filter((t=>"Text"==t.attrs.className));for(let e=0;e<t.length;e++)t[e].attrs.length_x=t[e].width(),t[e].attrs.length_y=t[e].height(),t[e].offsetX(t[e].attrs.length_x/2),t[e].offsetY(t[e].height())},created(){this.max_id_figures=this.shapes.length+this.groups.length;const t=new window.Image;t.src=i(471),t.height=150,t.width=150,t.onload=()=>{this.shapes.find((t=>"Image"===t.className)).image=t,this.shapes.find((t=>"Image"===t.className)).offsetX=t.width/2,this.shapes.find((t=>"Image"===t.className)).offsetY=t.height}},methods:{switchEraseMode(){0==this.eraseMode?(this.eraseMode=1,document.getElementById("playground").style.cursor="url("+i(843)+"),default",this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer")):(this.eraseMode=0,document.getElementById("playground").style.cursor="default")},checkIfShapesOnLine(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;let a=0;while(a<s.length)this.isCoordinateOnLine(s[a].x,s[a].y,i.id)?a+=1:(console.log("a shape is not on a line"),s[a].dragBoundFunc=tt,s[a].isGrouped=0,i.positionPoints.splice(a,1),this.shapes.push(s[a]),i.freeDistances.push(i.occupiedDistances[a]),i.occupiedDistances.splice(a,1),s.splice(a,1),this.updateNaration(e))},isCoordinateOnLine(t,e,i){const s=this.groups.find((t=>t.id===i)),a=s.line;let n=!0,o=a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),r=a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),h=a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),l=a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),c=(o-h)/(l-r),d=a.y-c*a.x;return n=Math.abs(r-l)>1?Math.abs(c*t+d-e)>1:Math.abs(t-a.x)>1,!(n||(a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0||!n&&Math.sqrt((a.x-t)**2+(a.y-e)**2)>a.points[4]*a.scaleX/2)},updateGrp(t,e){const i=this.groups.find((t=>t.id===e)),s=i.line;i.offsetX=s.offsetX,i.offsetY=s.offsetY,s.x=t.target.x(),s.y=t.target.y(),this.center.x=s.x,this.center.y=s.y,this.updateAllPosInGrp(s.id),this.checkIfShapesOnLine(s.id)},updateAllPosInGrp(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;for(let n=0;n<s.length;n++)i.keepDistribution,s[n].x=i.x+i.occupiedDistances[n]*Math.cos(i.rotation*(Math.PI/180)),s[n].y=i.y+i.occupiedDistances[n]*Math.sin(i.rotation*(Math.PI/180)),s[n].distance_to_line_center=i.occupiedDistances[n],s[n].rotation=s[n].personalRotation+i.rotation,i.positionPoints[n].x=s[n].x,i.positionPoints[n].y=s[n].y,i.positionPoints[n].distance_to_line_center=s[n].distance_to_line_center;let a=s.length;while(a<i.positionPoints.length)i.keepDistribution?i.positionPoints.splice(a,1):(i.positionPoints[a].x=i.x+i.freeDistances[a-s.length]*Math.cos(i.rotation*(Math.PI/180)),i.positionPoints[a].y=i.y+i.freeDistances[a-s.length]*Math.sin(i.rotation*(Math.PI/180)),i.positionPoints[a].distance_to_line_center=i.freeDistances[a-s.length],a++)},isOutsideTheLine(t,e){let i=e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180)),s=e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180)),a=e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180)),n=e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180)),o=(i-a)/(n-s),r=e.y-o*e.x,h=!1;return h=Math.abs(s-n)>=1?Math.abs(o*t.x+r-t.y)<1:Math.abs(t.x-e.x)<1,!h||(e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=0&&e.rotation*(Math.PI/180)>-Math.PI/2||(e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=0&&e.rotation*(Math.PI/180)>-Math.PI/2||(e.y+.5*e.points[4]*e.scaleX*Math.sin(Math.PI+e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(Math.PI+e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=-Math.PI/2&&e.rotation*(Math.PI/180)>-Math.PI||(e.x+.5*e.points[4]*e.scaleX*Math.cos(Math.PI+e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(Math.PI+e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=-Math.PI/2&&e.rotation*(Math.PI/180)>-Math.PI||(e.y+.5*e.points[4]*e.scaleX*Math.sin(Math.PI-e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(Math.PI-e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=Math.PI&&e.rotation*(Math.PI/180)>Math.PI/2||(e.x+.5*e.points[4]*e.scaleX*Math.cos(Math.PI-e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(Math.PI-e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=Math.PI&&e.rotation*(Math.PI/180)>Math.PI/2||(e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=Math.PI/2&&e.rotation*(Math.PI/180)>=0||(e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=Math.PI/2&&e.rotation*(Math.PI/180)>=0},update(){const t=this.shapes;let e=!1;for(let i=0;i<t.length;i++){let s=t[i].x,a=t[i].y;for(let n=0;n<this.groups.length;n++){let o=this.groups[n].line,r=o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),h=o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),l=o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),c=o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),d=(r-l)/(c-h),g=o.y-d*o.x;e=Math.abs(h-c)>1?Math.abs(d*s+g-a)<=this.lengthToCapture:Math.abs(s-o.x)<=this.lengthToCapture,(e&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=0&&o.rotation*(Math.PI/180)>-Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=-Math.PI/2&&o.rotation*(Math.PI/180)>=-Math.PI||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI&&o.rotation*(Math.PI/180)>Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI/2&&o.rotation*(Math.PI/180)>=0)&&(t[i].isGrouped=1,this.makeGroup(o.id))}}},CheckIfNeedToDetach(t){let e=this.groups.find((e=>e.id===t.target.getParent().attrs.id)),i=e.shapes_g.find((e=>e.id==t.target.id())),s=Math.sqrt((t.target.getStage().getPointerPosition().y-t.target.y())**2+(t.target.getStage().getPointerPosition().x-t.target.x())**2);"Rect"==t.target.className?s-=t.target.attrs.height*t.target.attrs.scaleY:"Circle"==t.target.className?s-=2*t.target.attrs.radius*t.target.attrs.scaleY:"Text"==t.target.className?s-=t.target.attrs.length_y*t.target.attrs.scaleY:("Image"==t.target.className||"Triangle"==t.target.attrs.className)&&(s-=t.target.height()*t.target.scaleY()),s>50&&(this.groups.find((e=>e.id===t.target.getParent().attrs.id)).aShapeHasBeenDetach=1,this.DetachShape(i,t.target.getStage().getPointerPosition().x,t.target.getStage().getPointerPosition().y))},GiveSignOfDistance(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(a)<=this.lengthToCapture&&-90==e.rotation?-Math.sign(n):Math.abs(a)<=this.lengthToCapture&&90==e.rotation?Math.sign(n):Math.sign(a),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},GiveSignOfDistanceBtwCenterAndShape(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(n)<=this.lengthToCapture&&-90==e.rotation?Math.sign(a):Math.abs(n)<=this.lengthToCapture&&90==e.rotation?-Math.sign(a):Math.sign(n),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},makeGroup(t){this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer");const e=this.groups.find((e=>e.id===t)),i=e.line,s=this.shapes;i.freeDistances.sort(this.isSmaller),s.sort(this.isBeforeRegardingX);for(let a=0;a<s.length;a++)if(1==s[a].isGrouped){const n=Object.assign({},this.positionPoint);let o=s[a].x-i.x,r=s[a].y-i.y;s[a].personalRotation=0,s[a].distance_to_line_center=this.GiveSignOfDistance(s[a],i)*Math.sqrt(o**2+r**2),Math.abs(s[a].distance_to_line_center)>=i.points[4]*i.scaleX/2&&(s[a].distance_to_line_center=Math.sign(s[a].distance_to_line_center)*i.points[4]*i.scaleX/2),this.ChangeCenterRegardingCommand(s[a].id,e.line.defaultAlignment),this.updateDragFunc(s[a],i),e.shapes_g.push(s[a]),console.log("no 'free distance' anymore"),e.line.occupiedDistances.push(s[a].distance_to_line_center),n.id="positionPoint"+e.id+e.line.positionPoints.length,e.line.positionPoints.push(n),console.log("A new shape has been added with a distance"+s[a].distance_to_line_center),this.updateOccupiedDistance(i.id),this.updateAllPosInGrp(t),this.updateNaration(e),s.splice(a,1)}this.center.x=i.x,this.center.y=i.y},updateOccupiedDistance(t){const e=this.groups.find((e=>e.id===t));if(this.sortByDistToLineCenter(e),e.line.keepDistribution){let t=e.line.points[4],i=e.shapes_g.length,s=t/(i-1)*e.line.scaleX;if(i%2==0){for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[t-1]=-(i/2-1-t+1)*s-s/2;for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[i/2+t]=t*s+s/2;e.line.occupiedDistances[i/2-1]=-s/2,e.line.occupiedDistances[i/2]=s/2}else{for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[t-1]=-s*((i-1)/2-t+1);for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[(i-1)/2+t]=s*t;e.line.occupiedDistances[(i-1)/2]=0}for(let a=0;a<e.shapes_g.length;a++)e.shapes_g[a].distance_to_line_center=e.line.occupiedDistances[a]}else e.line.occupiedDistances.sort(this.isSmaller)},isSmaller(t,e){return t<e?-1:1},isBeforeRegardingX(t,e){return t.x<e.x?-1:1},updateOccDist(t,e){let i=this.isNearest(t.line,e);if(i.isFree){e.distance_to_line_center=t.line.freeDistances[i.indice],t.line.freeDistances.splice(i.indice,1),this.sortByDistToLineCenter(t);for(let e=0;e<t.shapes_g.length;e++)t.line.occupiedDistances.length==e?t.line.occupiedDistances.push(t.shapes_g[e].distance_to_line_center):t.line.occupiedDistances[e]=t.shapes_g[e].distance_to_line_center}else t.shapes_g.find((t=>t.id==e.id)).distance_to_line_center=t.line.occupiedDistances[i.indice],t.line.occupiedDistances.splice(i.indice,1),this.updateOccDist(t,t.shapes_g[i.indice])},isNearest(t,e){let i,s=t.x+t.freeDistances[0]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[0]*Math.sin(t.rotation*(Math.PI/180)),n=Math.sqrt((s-e.x)**2+(a-e.y)**2),o=0;for(let r=1;r<t.freeDistances.length;r++)s=t.x+t.freeDistances[r]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[r]*Math.sin(t.rotation*(Math.PI/180)),i=Math.sqrt((s-e.x)**2+(a-e.y)**2),i<n&&(n=i,o=r);return o},sortByDistToLineCenter(t){if(t.line.keepDistribution)for(let e=0;e<t.shapes_g.length;e++){let i=t.shapes_g[e].x-t.line.x,s=t.shapes_g[e].y-t.line.y;t.shapes_g[e].distance_to_line_center=this.GiveSignOfDistance(t.shapes_g[e],t.line)*Math.sqrt(i**2+s**2)}for(let e=1;e<t.shapes_g.length;e++){let i=t.shapes_g[e],s=e;while(s>0&&t.shapes_g[s-1].distance_to_line_center>i.distance_to_line_center)t.shapes_g[s]=t.shapes_g[s-1],s-=1;t.shapes_g[s]=i}},sortAnyShapesByDistToLineCenter(t,e){for(let i=0;i<t.length;i++){let s=t[i].x-e.x,a=t[i].y-e.y;t.distance_to_line_center=this.GiveSignOfDistance(t,e)*Math.sqrt(s**2+a**2)}for(let i=1;i<t.length;i++){let e=t[i],s=i;while(s>0&&t[s-1].distance_to_line_center>e.distance_to_line_center)t[s]=t[s-1],s-=1;t[s]=e}},updateDragFunc(t,e){let i=e.rotation*(Math.PI/180);i<=0&&i>=-Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.y-e.y)*Math.cos(i),y:e.y-(t.y-e.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.x-e.x)*Math.cos(i),y:e.y-(t.x-e.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.y-e.y)*Math.cos(i),y:e.y+(t.y-e.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}})},updatePos(t){const e=this.shapes.find((e=>e.id===t.target.id()));e.x=t.target.x(),e.y=t.target.y(),this.center.x=t.target.x(),this.center.y=t.target.y();let i={x:e.x,y:e.y};t.target.position(i),t.target.getLayer().batchDraw()},updatePosInGrp(t,e){let i,s,a;const n=this.groups.find((t=>t.id===e));if(1==n.aShapeHasBeenDetach)return void(n.aShapeHasBeenDetach=0);const o=n.line,r=n.shapes_g.find((e=>e.id===t.target.id())),h=n.shapes_g;if(1==r.needToBeDetach&&(r.needToBeDetach=0,this.DetachShape(r),this.updateAllPosInGrp(t.target.getParent().attrs.id)),o.keepDistribution){if(this.isCoordinateOnLine(t.target.x(),t.target.y(),o.id)){i=r.x-t.target.x(),s=r.y-t.target.y();let e=n.line.points[4],a=n.shapes_g.length,l=e/(a-1)*n.line.scaleX,c=Math.sqrt(i**2+s**2);c>=l?(r.x=t.target.x(),r.y=t.target.y(),this.updateOccupiedDistance(o.id),r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation,this.updateAllPosInGrp(o.id)):(r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation)}else r.x=t.target.x(),r.y=t.target.y();o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center}else o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,r.x=t.target.x(),r.y=t.target.y(),0==Math.sin(o.rotation*(Math.PI/180))?a=r.x-o.x:(a=0!=Math.sign(r.x-o.x)?Math.sign(-r.rotation)*Math.sign(r.x-o.x)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2):Math.sign(-r.rotation)*Math.sign(r.y-o.y)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2),(r.rotation*(Math.PI/180)<=-Math.PI/2||r.rotation*(Math.PI/180)<=Math.PI/2&&r.rotation*(Math.PI/180)>=0)&&(a=-a)),o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center;let l={x:r.x,y:r.y};if(this.center.x=r.x,this.center.y=r.y,t.target.position(l),t.target.getLayer().batchDraw(),this.isCoordinateOnLine(r.x,r.y,o.id))o.keepDistribution?n.line.occupiedDistances[h.indexOf(r)]=r.distance_to_line_center:n.line.occupiedDistances[h.indexOf(r)]=a,o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center;else{r.dragBoundFunc=tt,r.isGrouped=0,this.shapes.push(r);for(let t=0;t<h.length;t++)h[t].id==r.id&&(o.freeDistances.push(o.occupiedDistances[t]),o.occupiedDistances.splice(t,1),o.positionPoints.splice(t,1),h.splice(t,1),console.log("a shape has been removed from the line"))}o.keepDistribution&&this.updateOccupiedDistance(o.id),this.updateAllPosInGrp(o.id)},updateTransformedShape(t){let e,i;if("Line"==t.target.className)i=this.groups.find((t=>t.id===this.selectedShapeId)).line;else if(e=this.findShape(this.selectedShapeId),i=e.shape_data,void 0==i)return;let s=i.x,a=i.y;i.x=t.target.x(),i.y=t.target.y(),i.rotation=t.target.rotation();let n=i.scaleX;if(i.scaleX=t.target.scaleX(),i.scaleY=t.target.scaleY(),"Line"==t.target.className){const e=this.groups.find((t=>t.id===i.id));if(i.keepDistribution){for(let t=0;t<i.occupiedDistances.length;t++)i.occupiedDistances[t]=i.occupiedDistances[t]/n*i.scaleX;this.update(),this.updateGrp(t,this.selectedShapeId),this.checkIfShapesOnLine(this.selectedShapeId)}else{if(n!=i.scaleX){for(let t=0;t<e.shapes_g.length;t++){let n=e.shapes_g[t].x-i.x,o=e.shapes_g[t].y-i.y;0==Math.sign(e.line.occupiedDistances[t])?e.line.occupiedDistances[t]=this.GiveSignOfDistance(e.shapes_g[t],i)*Math.sqrt(n**2+o**2):e.line.occupiedDistances[t]=Math.sign(e.line.occupiedDistances[t])*Math.sqrt(n**2+o**2),Math.sign(e.shapes_g[t].x-s)!=Math.sign(n)&&0!=Math.sign(e.shapes_g[t].x-s)&&90!=e.line.rotation&&-90!=e.line.rotation&&(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t]),Math.sign(e.shapes_g[t].y-a)==Math.sign(o)||0==Math.sign(e.shapes_g[t].y-a)||90!=e.line.rotation&&-90!=e.line.rotation||(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t])}for(let t=0;t<i.freeDistances.length;t++){let e=s-i.x,n=a-i.y,o=Math.sqrt(e**2+n**2);i.rotation<-90||i.rotation>90?i.freeDistances[t]=i.freeDistances[t]-Math.sign(s-i.x)*o:90==i.rotation||-90==i.rotation?i.freeDistances[t]=i.freeDistances[t]-n:i.freeDistances[t]=i.freeDistances[t]+Math.sign(s-i.x)*o}}this.update(),this.updateGrp(t,this.selectedShapeId),this.checkIfShapesOnLine(this.selectedShapeId)}for(let t=0;t<e.shapes_g.length;t++)this.updateDragFunc(e.shapes_g[t],i)}else"-1"!=e.grp_id?(this.updateAllPosInGrp(e.grp_id),this.updateOccupiedDistance(e.grp_id),t.target.x(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).x),t.target.y(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).y),this.groups.find((t=>t.id===e.grp_id)).shapes_g.find((e=>e.id===t.target.id())).personalRotation=t.target.rotation()-t.target.getParent().attrs.line.rotation,this.updateAllPosInGrp(e.grp_id),this.checkIfShapesOnLine(e.grp_id),this.updateDragFuncOfCenter()):(this.update(),this.updateDragFuncOfCenter());this.center.x=t.target.attrs.x,this.center.y=t.target.attrs.y},handleTransformation(t){if(void 0==t.evt)return;if(1==this.eraseMode)return void this.eraserAction(t);if(t.target===t.target.getStage())return this.selectedShapeId="NoId",this.eraseNodefromTransformer("lineTransformer"),this.eraseNodefromTransformer("shapeTransformer"),void(this.center.opacity=0);const e="Transformer"===t.target.getParent().className;if(e)return;const i=t.target.id();let s,a=this.findShape(i).shape_data;"center"!=t.target.attrs.id&&("Line"==t.target.className?(s="lineTransformer",a=this.groups.find((t=>t.id===i)).line,this.center.draggable=!1,this.selectedShapeAlignment=a.defaultAlignment,this.eraseNodefromTransformer("shapeTransformer")):(s="shapeTransformer",this.center.draggable=!0,this.selectedShapeAlignment=a.centerPosition,this.eraseNodefromTransformer("lineTransformer")),void 0!=a?(this.selectedShapeId=i,this.center.opacity=1,this.updateTransformer(s)):this.selectedShapeId="NoId",this.updateDragFuncOfCenter())},eraseNodefromTransformer(t){let e=this.$refs.stage.getStage();const i=e.find("#"+t)[0];i.nodes([])},updateTransformer(t){let e=this.$refs.stage.getStage();const i=e.find("#"+t)[0];let s;if("lineTransformer"==t)s=e.children[0].getChildren().filter((t=>"Group"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0].getChildren().filter((t=>"Line"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];else{s=e.children[0].getChildren().filter((t=>"Group"!=t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];let t=!0;void 0==s&&(t=!1);let i=0;while(!t)i<this.groups.length?(s=e.children[0].getChildren().filter((t=>"Group"==t.attrs.className))[i].getChildren().find((t=>t.attrs.id==this.selectedShapeId&&"Line"!=t.attrs.className)),t=void 0!=s,i++):t=!0}s!==i.node()&&(void 0!=s?i.nodes([s]):i.nodes([]),this.center.x=s.attrs.x,this.center.y=s.attrs.y)},ChangeCenter(t){let e,i,s=this.findShape(this.selectedShapeId),a=s.shape_data,n=this.GiveSignOfDistanceBtwCenterAndShape(t.target.attrs,a)*Math.sqrt((t.target.y()-a.y)**2+(t.target.x()-a.x)**2)+a.offsetY*a.scaleY,o=a.offsetY;void 0==a?a=this.groups.find((t=>t.id==this.selectedShapeId)).line:("Rect"==a.className?(e=a.height*a.scaleY/3,i=a.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.width/2,a.offsetY=a.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.width/2,a.offsetY=a.height,a.centerPosition="Bottom"):(a.offsetX=a.width/2,a.offsetY=0,a.centerPosition="Top")):"Circle"==a.className?(n+=a.radius*a.scaleY,e=a.radius*a.scaleY*2/3,i=a.radius*a.scaleY*4/3,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0,a.centerPosition="Middle"):n>i?(a.offsetX=0,a.offsetY=a.radius,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")):"Image"==a.className?(e=a.image.height*a.scaleY/3,i=a.image.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height,a.centerPosition="Bottom"):(a.offsetX=a.image.width/2,a.offsetY=0,a.centerPosition="Top")):"Text"==a.className?(e=a.length_y*a.scaleY/3,i=a.length_y*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y,a.centerPosition="Bottom"):(a.offsetX=a.length_x/2,a.offsetY=0,a.centerPosition="Top")):"Triangle"==a.className&&(n+=a.radius*a.scaleY,e=a.radius*a.scaleY/2,i=a.radius*a.scaleY*5/4,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0):n>i?(a.offsetX=0,a.offsetY=a.radius/2,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")),a.y=a.y-(o-a.offsetY)*a.scaleY*Math.cos(a.rotation*(Math.PI/180)),a.x=a.x+(o-a.offsetY)*a.scaleY*Math.sin(a.rotation*(Math.PI/180)),this.selectedShapeAlignment=a.centerPosition,"-1"!=s.grp_id&&this.updateAllPosInGrp(s.grp_id),t.target.x(a.x),t.target.y(a.y))},ChangeCenterRegardingCommand(t,e){let i=this.findShape(t),s=i.shape_data,a=s.offsetY;"Rect"==s.className?"Top"==e?(s.offsetY=0,s.offsetX=s.width/2):"Middle"==e?(s.offsetX=s.width/2,s.offsetY=s.height/2):"Bottom"==e&&(s.offsetX=s.width/2,s.offsetY=s.height):"Circle"==s.className?"Top"==e?(s.offsetX=0,s.offsetY=-s.radius):"Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e&&(s.offsetX=0,s.offsetY=s.radius):"Image"==s.className?"Middle"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height/2):"Bottom"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height):"Top"==e&&(s.offsetX=s.image.width/2,s.offsetY=0):"Text"==s.className?"Middle"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y/2):"Bottom"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y):"Top"==e&&(s.offsetX=s.length_x/2,s.offsetY=0):"Triangle"==s.className&&("Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e?(s.offsetX=0,s.offsetY=s.radius/2):"Top"==e&&(s.offsetX=0,s.offsetY=-s.radius)),s.centerPosition=e,s.y=s.y-(a-s.offsetY)*s.scaleY*Math.cos(s.rotation*(Math.PI/180)),s.x=s.x+(a-s.offsetY)*s.scaleY*Math.sin(s.rotation*(Math.PI/180)),"-1"!=i.grp_id&&this.updateAllPosInGrp(i.grp_id)},updateDragFuncOfCenter(){let t=this.findShape(this.selectedShapeId).shape_data,e=this.center,i=t.rotation*(Math.PI/180);i>=-Math.PI/2&&i<=0?i-=Math.PI/180*90:i<-Math.PI/2?(i+=Math.PI/2,i=Math.PI+i):i<=Math.PI&&i>0&&(i-=Math.PI/180*90),i<=0&&i>=-Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.y-t.y)*Math.cos(i),y:t.y-(e.y-t.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.x-t.x)*Math.cos(i),y:t.y-(e.x-t.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.y-t.y)*Math.cos(i),y:t.y+(e.y-t.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}})},MovingCenter(){},findShape(t){let e=this.shapes.find((e=>e.id===t)),i="-1",s=!0;void 0==e&&(s=!1);let a=0;while(!s)a<this.groups.length?(e=this.groups[a].shapes_g.find((e=>e.id===t)),void 0==e?s=!1:(i=this.groups[a].id,s=!0),a++):s=!0;return{shape_data:e,grp_id:i}},DetachShape(t,e,i){const s=this.lengthToCapture+5;let a=this.groups.find((e=>-1!=e.shapes_g.indexOf(t))),n=a.shapes_g.indexOf(t);t.dragBoundFunc=tt;let o=a.line.y-.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),r=a.line.x+.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),h=a.line.y+.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),l=a.line.x-.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),c=(h-o)/(r-l),d=t.x*(1/c)+t.y;a.line.rotation<0&&a.line.rotation>-45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-45&&a.line.rotation>-90||a.line.rotation<-90&&a.line.rotation>-135?(t.x=t.x+Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-135&&a.line.rotation>-180||a.line.rotation>135&&a.line.rotation<180?(t.x=t.x-Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>90&&a.line.rotation<=135||a.line.rotation>45&&a.line.rotation<=90?(t.x=t.x-Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>0&&a.line.rotation<=45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):-90==a.line.rotation?t.x=t.x-Math.sign(t.x-e)*s:90==a.line.rotation?t.x=t.x+Math.sign(t.x-e)*s:(180==a.line.rotation||-180==a.line.rotation||0==a.line.rotation)&&(t.y=t.y-Math.sign(t.y-i)*s),t.isGrouped=0,this.shapes.push(t),this.center.x=t.x,this.center.y=t.y,a.line.freeDistances.push(a.line.occupiedDistances[n]),a.line.occupiedDistances.splice(n,1),a.shapes_g.splice(n,1),a.line.positionPoints.splice(n,1),this.updateOccupiedDistance(a.id),this.updateAllPosInGrp(a.id),this.updateNaration(a),this.eraseNodefromTransformer("shapeTransformer")},createNewShape(t){if("Line"==t.attrs.className){this.max_id_figures=this.max_id_figures+1;let e=t.getParent().clone({id:""+this.max_id_figures,name:"group"+this.max_id_figures,shapes_g:[]});e.attrs.line.id=""+this.max_id_figures,e.attrs.line.x=t.getStage().getPointerPosition().x,e.attrs.line.y=t.getStage().getPointerPosition().y,e.attrs.line.draggable=!0,this.groups.push(e.attrs)}else{this.max_id_figures=this.max_id_figures+1;let e=t.clone({id:""+this.max_id_figures,draggable:!0});e.attrs.isGrouped=0,this.shapes.push(e.attrs)}},eraserAction(t){this.Remove(t.target)},unshowSelectedShape(t){"Line"==t.target.attrs.className&&0==this.eraseMode?t.target.opacity(.5):"Line"==t.target.attrs.className&&1==this.eraseMode?1==t.target.attrs.keepDistribution?t.target.stroke("rgb(48,48,48)"):t.target.stroke("blue"):"positionPoint"==t.target.attrs.className&&1==this.eraseMode?1!=t.target.getParent().attrs.line.keepDistribution&&t.target.strokeWidth(0):1==this.eraseMode&&t.target.strokeWidth(0)},showSelectedShape(t){if("Line"==t.target.attrs.className&&0==this.eraseMode)t.target.opacity(1);else if("Line"==t.target.attrs.className&&1==this.eraseMode)t.target.stroke("rgb(200, 59, 218)");else if("positionPoint"==t.target.attrs.className&&1==this.eraseMode){let e=t.target.getParent().attrs.line;-1!=e.freeDistances.indexOf(t.target.attrs.distance_to_line_center)&&1!=e.keepDistribution&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))}else 1==this.eraseMode&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))},editText(t){let e=t.target.getStage().attrs.container.getBoundingClientRect();document.getElementById("input1").style.top=e.y+t.target.getAbsolutePosition().y-2.5*document.getElementById("input1").size+"px",document.getElementById("input1").style.left=e.x+t.target.getAbsolutePosition().x-5*document.getElementById("input1").size+"px",document.getElementById("input1").style.display="initial",this.editedText=t.target},updateText(t){let e=this.shapes.find((t=>t.id===this.editedText.attrs.id)),i=!0;void 0==e&&(i=!1);let s=0;while(!i)s<this.groups.length?(e=this.groups[s].shapes_g.find((t=>t.id===this.editedText.attrs.id)),i=void 0!=e,s++):i=!0;if(void 0!=e){let i,s,a,n;i=this.editedText.width(),s=this.editedText.height(),e.text=t.target.value,this.editedText.text(t.target.value),a=this.editedText.width()-i,n=this.editedText.height()-s,e.offsetX=e.offsetX+a/2,e.offsetY=e.offsetY+n/2,e.length_x=this.editedText.width(),e.length_y=this.editedText.height(),document.getElementById("input1").style.display="none"}},updateNaration(t){let e="<strong></strong><br>";e+="- <mark class='red'> StickyLine</mark><br>",e+="Relation: <i>alignement with</i>:";for(let i=0;i<t.shapes_g.length;i++)e=e+"<br>- "+t.shapes_g[i].className;this.$emit("explain",{origin:"Instrument - Polymorphism<br> <mark class='red'> The Stickyline applies alignment to various objects. </mark>",text:e})}}};const it=(0,f.Z)(et,[["render",J]]);var st=it;function at(t,e,i,n,o,r){const h=(0,a.up)("v-rect"),l=(0,a.up)("v-circle"),c=(0,a.up)("v-image"),d=(0,a.up)("v-text"),g=(0,a.up)("v-regular-polygon"),p=(0,a.up)("v-line"),u=(0,a.up)("v-group"),f=(0,a.up)("v-transformer"),M=(0,a.up)("v-layer"),x=(0,a.up)("v-stage");return(0,a.wg)(),(0,a.iD)("div",{onClick:e[1]||(e[1]=(...e)=>t.HideContextMenu&&t.HideContextMenu(...e)),id:"playground",onMousedown:e[2]||(e[2]=t=>r.updateNaration(this.groups[0]))},[(0,a.Wm)(x,{ref:"stage",id:"stage",config:o.stageSize,onDragmove:r.update,onMousedown:r.handleTransformation,onTouchstart:r.handleTransformation,onFusion:r.makeGroup,onContextMenu:t.DisplayContextMenu},{default:(0,a.w5)((()=>[(0,a.Wm)(M,{ref:"layer"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.groups,(t=>((0,a.wg)(),(0,a.j4)(u,{ref_for:!0,ref:"groups",key:t.id,config:t},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Rect"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(h,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Circle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(l,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Image"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(c,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Text"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(d,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape,onDblclick:r.editText},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout","onDblclick"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Triangle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(g,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(),(0,a.j4)(p,{key:t.line.id,config:t.line,onTransformend:r.updateTransformedShape,onDragmove:e=>r.updateGrp(e,t.id),onMouseout:r.unshowSelectedShape,onMouseenter:r.showSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseout","onMouseenter"])),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.line.positionPoints,(t=>((0,a.wg)(),(0,a.j4)(l,{key:t.id,config:t,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onMouseenter","onMouseout"])))),128))])),_:2},1032,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Rect"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(h,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Circle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(l,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Image"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(c,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Text"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(d,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape,onDblclick:r.editText},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout","onDblclick"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Triangle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(g,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.transformers,(t=>((0,a.wg)(),(0,a.j4)(f,{key:t.id,config:t},null,8,["config"])))),128)),((0,a.wg)(),(0,a.j4)(l,{key:o.center.id,config:o.center,onDragend:r.ChangeCenter,onClick:t.DisplayCenterMenu},null,8,["config","onDragend","onClick"]))])),_:1},512)])),_:1},8,["config","onDragmove","onMousedown","onTouchstart","onFusion","onContextMenu"]),(0,a._)("input",{type:"text",id:"input2",size:"10",value:"the logo",onKeyup:e[0]||(e[0]=(0,s.D2)(((...t)=>r.updateText&&r.updateText(...t)),["enter"]))},null,32)],32)}const nt=function(t){let e=this.getStage().width(),i=this.getStage().height(),s=10;return t.x>e-s&&t.y>i-s?{x:e-s,y:i-s}:t.x>e-s&&t.y<s?{x:e-s,y:s}:t.y>i-s&&t.x<s?{x:s,y:i-s}:t.x<s&&t.y<s?{x:s,y:s}:t.x<s?{x:s,y:t.y}:t.y<s?{x:t.x,y:s}:t.x>e-s?{x:e-s,y:t.y}:t.y>i-s?{x:t.x,y:i-s}:{x:t.x,y:t.y}};var ot={props:{width:{type:Number,default:window.innerWidth},height:{type:Number,default:window.innerHeight}},components:{},data(){return{stageSize:{width:this.width,height:this.height},lengthToCapture:10,lengthToDetach:15,editedText:null,eraseMode:0,selectedShapeAlignment:"",needMenu:"initial",isALineSelected:!1,isAGroupedShapeSelected:!1,isStageOnlySelected:!1,keepDistanceButtonText:"Liberate Distribution",max_id_figures:6,groups:[{name:"group",className:"Group",id:"6",x:0,y:0,offsetX:0,offsetY:0,rotation:0,draggable:!1,shapes_g:[],aShapeHasBeenDetach:0,line:{x:150,y:250,points:[0,0,0,0,200,0],positionPoints:[],strokeWidth:10,rotation:0,tension:0,closed:!0,draggable:!0,scaleX:1,scaleY:1,opacity:.5,offset:{x:100,y:0},name:"ligne",className:"Line",stroke:"rgb(48,48,48)",id:"6",keepDistribution:!0,freeDistances:[],occupiedDistances:[],keepDistanceButtonText:"Liberate Distribution",defaultAlignment:"Bottom",dragBoundFunc:nt}}],transformers:[{id:"lineTransformer",enabledAnchors:["middle-left","middle-right"],rotateEnabled:!1,flipEnabled:!1,nodes:[]},{id:"shapeTransformer",nodes:[]}],shapes:[{text:"the logo",rotation:0,x:150,y:190,scaleX:1,scaleY:1,offsetY:0,offsetX:36,length_x:72,length_y:30,draggable:!0,isGrouped:0,className:"Text",fontSize:30,fontFamily:"Calibri",personalRotation:0,id:"4",dragBoundFunc:nt,centerPosition:"Top"},{rotation:0,x:50,y:100,scaleX:.66,scaleY:.66,offsetY:0,offsetX:0,image:null,draggable:!0,isGrouped:0,className:"Image",fontSize:30,personalRotation:0,id:"5",dragBoundFunc:nt,centerPosition:"Bottom"},{rotation:0,id:"8",x:250,y:100,sides:3,radius:45,width:90,height:90,scaleX:1,scaleY:1,strokeWidth:0,stroke:"black",fill:"purple",name:"triangle1",draggable:!0,className:"Triangle",isGrouped:0,dragBoundFunc:nt,offsetX:0,offsetY:22.5,personalRotation:0,centerPosition:"Bottom"}],center:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:4,fill:"black",opacity:1,draggable:!0,isGrouped:0,className:"Circle",id:"center",dragBoundFunc:nt},positionPoint:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint",distance_to_line_center:void 0},selectedShapeId:""}},mounted(){let t=this.$refs.stage.getStage().getChildren()[0].getChildren().filter((t=>"Text"==t.attrs.className));for(let e=0;e<t.length;e++)t[e].attrs.length_x=t[e].width(),t[e].attrs.length_y=t[e].height(),t[e].offsetX(t[e].attrs.length_x/2),t[e].offsetY(t[e].height())},created(){this.max_id_figures=this.shapes.length+this.groups.length;const t=new window.Image;t.src=i(471),t.height=150,t.width=150,t.onload=()=>{this.shapes.find((t=>"Image"===t.className)).image=t,this.shapes.find((t=>"Image"===t.className)).offsetX=t.width/2,this.shapes.find((t=>"Image"===t.className)).offsetY=t.height}},methods:{switchEraseMode(){0==this.eraseMode?(this.eraseMode=1,document.getElementById("playground").style.cursor="url("+i(843)+"),default",this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer")):(this.eraseMode=0,document.getElementById("playground").style.cursor="default")},checkIfShapesOnLine(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;let a=0;while(a<s.length)this.isCoordinateOnLine(s[a].x,s[a].y,i.id)?a+=1:(console.log("a shape is not on a line"),s[a].dragBoundFunc=nt,s[a].isGrouped=0,i.keepDistribution&&i.positionPoints.slice(a,1),this.shapes.push(s[a]),i.freeDistances.push(i.occupiedDistances[a]),i.occupiedDistances.splice(a,1),s.splice(a,1),this.updateNaration(e))},isCoordinateOnLine(t,e,i){const s=this.groups.find((t=>t.id===i)),a=s.line;let n=!0,o=a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),r=a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),h=a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),l=a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),c=(o-h)/(l-r),d=a.y-c*a.x;return n=Math.abs(r-l)>1?Math.abs(c*t+d-e)>1:Math.abs(t-a.x)>1,!(n||(a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0||!n&&Math.sqrt((a.x-t)**2+(a.y-e)**2)>a.points[4]*a.scaleX/2)},updateGrp(t,e){const i=this.groups.find((t=>t.id===e)),s=i.line;i.offsetX=s.offsetX,i.offsetY=s.offsetY,s.x=t.target.x(),s.y=t.target.y(),this.center.x=s.x,this.center.y=s.y,this.updateAllPosInGrp(s.id),this.checkIfShapesOnLine(s.id)},updateAllPosInGrp(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;for(let n=0;n<s.length;n++)i.keepDistribution,s[n].x=i.x+i.occupiedDistances[n]*Math.cos(i.rotation*(Math.PI/180)),s[n].y=i.y+i.occupiedDistances[n]*Math.sin(i.rotation*(Math.PI/180)),s[n].distance_to_line_center=i.occupiedDistances[n],s[n].rotation=s[n].personalRotation+i.rotation,i.positionPoints[n].x=s[n].x,i.positionPoints[n].y=s[n].y,i.positionPoints[n].distance_to_line_center=s[n].distance_to_line_center;let a=s.length;while(a<i.positionPoints.length)i.keepDistribution?i.positionPoints.splice(a,1):(i.positionPoints[a].x=i.x+i.freeDistances[a-s.length]*Math.cos(i.rotation*(Math.PI/180)),i.positionPoints[a].y=i.y+i.freeDistances[a-s.length]*Math.sin(i.rotation*(Math.PI/180)),i.positionPoints[a].distance_to_line_center=i.freeDistances[a-s.length],a++)},isOutsideTheLine(t,e){let i=e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180)),s=e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180)),a=e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180)),n=e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180)),o=(i-a)/(n-s),r=e.y-o*e.x,h=!1;return h=Math.abs(s-n)>=1?Math.abs(o*t.x+r-t.y)<1:Math.abs(t.x-e.x)<1,!h||(e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=0&&e.rotation*(Math.PI/180)>-Math.PI/2||(e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=0&&e.rotation*(Math.PI/180)>-Math.PI/2||(e.y+.5*e.points[4]*e.scaleX*Math.sin(Math.PI+e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(Math.PI+e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=-Math.PI/2&&e.rotation*(Math.PI/180)>-Math.PI||(e.x+.5*e.points[4]*e.scaleX*Math.cos(Math.PI+e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(Math.PI+e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=-Math.PI/2&&e.rotation*(Math.PI/180)>-Math.PI||(e.y+.5*e.points[4]*e.scaleX*Math.sin(Math.PI-e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(Math.PI-e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=Math.PI&&e.rotation*(Math.PI/180)>Math.PI/2||(e.x+.5*e.points[4]*e.scaleX*Math.cos(Math.PI-e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(Math.PI-e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=Math.PI&&e.rotation*(Math.PI/180)>Math.PI/2||(e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=Math.PI/2&&e.rotation*(Math.PI/180)>=0||(e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=Math.PI/2&&e.rotation*(Math.PI/180)>=0},update(){const t=this.shapes;let e=!1;for(let i=0;i<t.length;i++){let s=t[i].x,a=t[i].y;for(let n=0;n<this.groups.length;n++){let o=this.groups[n].line,r=o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),h=o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),l=o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),c=o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),d=(r-l)/(c-h),g=o.y-d*o.x;e=Math.abs(h-c)>1?Math.abs(d*s+g-a)<=this.lengthToCapture:Math.abs(s-o.x)<=this.lengthToCapture,(e&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=0&&o.rotation*(Math.PI/180)>-Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=-Math.PI/2&&o.rotation*(Math.PI/180)>=-Math.PI||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI&&o.rotation*(Math.PI/180)>Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI/2&&o.rotation*(Math.PI/180)>=0)&&(t[i].isGrouped=1,this.makeGroup(o.id))}}},CheckIfNeedToDetach(t){let e=this.groups.find((e=>e.id===t.target.getParent().attrs.id)),i=e.shapes_g.find((e=>e.id==t.target.id())),s=Math.sqrt((t.target.getStage().getPointerPosition().y-t.target.y())**2+(t.target.getStage().getPointerPosition().x-t.target.x())**2);"Rect"==t.target.className?s-=t.target.attrs.height*t.target.attrs.scaleY:"Circle"==t.target.className?s-=2*t.target.attrs.radius*t.target.attrs.scaleY:"Text"==t.target.className?s-=t.target.attrs.length_y*t.target.attrs.scaleY:("Image"==t.target.className||"Triangle"==t.target.attrs.className)&&(s-=t.target.height()*t.target.scaleY()),s>50&&(this.groups.find((e=>e.id===t.target.getParent().attrs.id)).aShapeHasBeenDetach=1,this.DetachShape(i,t.target.getStage().getPointerPosition().x,t.target.getStage().getPointerPosition().y))},GiveSignOfDistance(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(a)<=this.lengthToCapture&&-90==e.rotation?-Math.sign(n):Math.abs(a)<=this.lengthToCapture&&90==e.rotation?Math.sign(n):Math.sign(a),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},GiveSignOfDistanceBtwCenterAndShape(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(n)<=this.lengthToCapture&&-90==e.rotation?Math.sign(a):Math.abs(n)<=this.lengthToCapture&&90==e.rotation?-Math.sign(a):Math.sign(n),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},makeGroup(t){this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer");const e=this.groups.find((e=>e.id===t)),i=e.line,s=this.shapes;i.freeDistances.sort(this.isSmaller),s.sort(this.isBeforeRegardingX);for(let a=0;a<s.length;a++)if(1==s[a].isGrouped){const n=Object.assign({},this.positionPoint);let o=s[a].x-i.x,r=s[a].y-i.y;s[a].personalRotation=0,s[a].distance_to_line_center=this.GiveSignOfDistance(s[a],i)*Math.sqrt(o**2+r**2),Math.abs(s[a].distance_to_line_center)>=i.points[4]*i.scaleX/2&&(s[a].distance_to_line_center=Math.sign(s[a].distance_to_line_center)*i.points[4]*i.scaleX/2),this.ChangeCenterRegardingCommand(s[a].id,e.line.defaultAlignment),this.updateDragFunc(s[a],i),e.shapes_g.push(s[a]),console.log("no 'free distance' anymore"),e.line.occupiedDistances.push(s[a].distance_to_line_center),n.id="positionPoint"+e.id+e.line.positionPoints.length,e.line.positionPoints.push(n),console.log("A new shape has been added with a distance"+s[a].distance_to_line_center),this.updateOccupiedDistance(i.id),this.updateAllPosInGrp(t),s.splice(a,1),this.updateNaration(e)}this.center.x=i.x,this.center.y=i.y},updateOccupiedDistance(t){const e=this.groups.find((e=>e.id===t));if(this.sortByDistToLineCenter(e),e.line.keepDistribution){let t=e.line.points[4],i=e.shapes_g.length,s=t/(i-1)*e.line.scaleX;if(i%2==0){for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[t-1]=-(i/2-1-t+1)*s-s/2;for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[i/2+t]=t*s+s/2;e.line.occupiedDistances[i/2-1]=-s/2,e.line.occupiedDistances[i/2]=s/2}else{for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[t-1]=-s*((i-1)/2-t+1);for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[(i-1)/2+t]=s*t;e.line.occupiedDistances[(i-1)/2]=0}for(let a=0;a<e.shapes_g.length;a++)e.shapes_g[a].distance_to_line_center=e.line.occupiedDistances[a]}else e.line.occupiedDistances.sort(this.isSmaller)},isSmaller(t,e){return t<e?-1:1},isBeforeRegardingX(t,e){return t.x<e.x?-1:1},updateOccDist(t,e){let i=this.isNearest(t.line,e);if(i.isFree){e.distance_to_line_center=t.line.freeDistances[i.indice],t.line.freeDistances.splice(i.indice,1),this.sortByDistToLineCenter(t);for(let e=0;e<t.shapes_g.length;e++)t.line.occupiedDistances.length==e?t.line.occupiedDistances.push(t.shapes_g[e].distance_to_line_center):t.line.occupiedDistances[e]=t.shapes_g[e].distance_to_line_center}else t.shapes_g.find((t=>t.id==e.id)).distance_to_line_center=t.line.occupiedDistances[i.indice],t.line.occupiedDistances.splice(i.indice,1),this.updateOccDist(t,t.shapes_g[i.indice])},isNearest(t,e){let i,s=t.x+t.freeDistances[0]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[0]*Math.sin(t.rotation*(Math.PI/180)),n=Math.sqrt((s-e.x)**2+(a-e.y)**2),o=0;for(let r=1;r<t.freeDistances.length;r++)s=t.x+t.freeDistances[r]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[r]*Math.sin(t.rotation*(Math.PI/180)),i=Math.sqrt((s-e.x)**2+(a-e.y)**2),i<n&&(n=i,o=r);return o},sortByDistToLineCenter(t){if(t.line.keepDistribution)for(let e=0;e<t.shapes_g.length;e++){let i=t.shapes_g[e].x-t.line.x,s=t.shapes_g[e].y-t.line.y;t.shapes_g[e].distance_to_line_center=this.GiveSignOfDistance(t.shapes_g[e],t.line)*Math.sqrt(i**2+s**2)}for(let e=1;e<t.shapes_g.length;e++){let i=t.shapes_g[e],s=e;while(s>0&&t.shapes_g[s-1].distance_to_line_center>i.distance_to_line_center)t.shapes_g[s]=t.shapes_g[s-1],s-=1;t.shapes_g[s]=i}},sortAnyShapesByDistToLineCenter(t,e){for(let i=0;i<t.length;i++){let s=t[i].x-e.x,a=t[i].y-e.y;t.distance_to_line_center=this.GiveSignOfDistance(t,e)*Math.sqrt(s**2+a**2)}for(let i=1;i<t.length;i++){let e=t[i],s=i;while(s>0&&t[s-1].distance_to_line_center>e.distance_to_line_center)t[s]=t[s-1],s-=1;t[s]=e}},updateDragFunc(t,e){let i=e.rotation*(Math.PI/180);i<=0&&i>=-Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.y-e.y)*Math.cos(i),y:e.y-(t.y-e.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.x-e.x)*Math.cos(i),y:e.y-(t.x-e.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.y-e.y)*Math.cos(i),y:e.y+(t.y-e.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}})},updatePos(t){const e=this.shapes.find((e=>e.id===t.target.id()));e.x=t.target.x(),e.y=t.target.y(),this.center.x=t.target.x(),this.center.y=t.target.y();let i={x:e.x,y:e.y};t.target.position(i),t.target.getLayer().batchDraw()},updatePosInGrp(t,e){let i,s,a;const n=this.groups.find((t=>t.id===e));if(1==n.aShapeHasBeenDetach)return void(n.aShapeHasBeenDetach=0);const o=n.line,r=n.shapes_g.find((e=>e.id===t.target.id())),h=n.shapes_g;if(1==r.needToBeDetach&&(r.needToBeDetach=0,this.DetachShape(r),this.updateAllPosInGrp(t.target.getParent().attrs.id)),o.keepDistribution){if(this.isCoordinateOnLine(t.target.x(),t.target.y(),o.id)){i=r.x-t.target.x(),s=r.y-t.target.y();let e=n.line.points[4],a=n.shapes_g.length,l=e/(a-1)*n.line.scaleX,c=Math.sqrt(i**2+s**2);c>=l?(r.x=t.target.x(),r.y=t.target.y(),this.updateOccupiedDistance(o.id),r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation,this.updateAllPosInGrp(o.id)):(r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation)}else r.x=t.target.x(),r.y=t.target.y();o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center}else o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,r.x=t.target.x(),r.y=t.target.y(),0==Math.sin(o.rotation*(Math.PI/180))?a=r.x-o.x:(a=0!=Math.sign(r.x-o.x)?Math.sign(-r.rotation)*Math.sign(r.x-o.x)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2):Math.sign(-r.rotation)*Math.sign(r.y-o.y)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2),(r.rotation*(Math.PI/180)<=-Math.PI/2||r.rotation*(Math.PI/180)<=Math.PI/2&&r.rotation*(Math.PI/180)>=0)&&(a=-a)),o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center;let l={x:r.x,y:r.y};if(this.center.x=r.x,this.center.y=r.y,t.target.position(l),t.target.getLayer().batchDraw(),this.isCoordinateOnLine(r.x,r.y,o.id))o.keepDistribution?n.line.occupiedDistances[h.indexOf(r)]=r.distance_to_line_center:n.line.occupiedDistances[h.indexOf(r)]=a,o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center;else{r.dragBoundFunc=nt,r.isGrouped=0,this.shapes.push(r);for(let t=0;t<h.length;t++)h[t].id==r.id&&(o.freeDistances.push(o.occupiedDistances[t]),o.occupiedDistances.splice(t,1),h.splice(t,1),console.log("a shape has been removed from the line"))}o.keepDistribution&&this.updateOccupiedDistance(o.id),this.updateAllPosInGrp(o.id)},updateTransformedShape(t){let e,i;if("Line"==t.target.className)i=this.groups.find((t=>t.id===this.selectedShapeId)).line;else if(e=this.findShape(this.selectedShapeId),i=e.shape_data,void 0==i)return;let s=i.x,a=i.y;i.x=t.target.x(),i.y=t.target.y(),i.rotation=t.target.rotation();let n=i.scaleX;if(i.scaleX=t.target.scaleX(),i.scaleY=t.target.scaleY(),"Line"==t.target.className){const e=this.groups.find((t=>t.id===i.id));if(i.keepDistribution){for(let t=0;t<i.occupiedDistances.length;t++)i.occupiedDistances[t]=i.occupiedDistances[t]/n*i.scaleX;this.update(),this.updateGrp(t,this.selectedShapeId),this.checkIfShapesOnLine(this.selectedShapeId)}else{if(n!=i.scaleX){for(let t=0;t<e.shapes_g.length;t++){let n=e.shapes_g[t].x-i.x,o=e.shapes_g[t].y-i.y;0==Math.sign(e.line.occupiedDistances[t])?e.line.occupiedDistances[t]=this.GiveSignOfDistance(e.shapes_g[t],i)*Math.sqrt(n**2+o**2):e.line.occupiedDistances[t]=Math.sign(e.line.occupiedDistances[t])*Math.sqrt(n**2+o**2),Math.sign(e.shapes_g[t].x-s)!=Math.sign(n)&&0!=Math.sign(e.shapes_g[t].x-s)&&90!=e.line.rotation&&-90!=e.line.rotation&&(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t]),Math.sign(e.shapes_g[t].y-a)==Math.sign(o)||0==Math.sign(e.shapes_g[t].y-a)||90!=e.line.rotation&&-90!=e.line.rotation||(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t])}for(let t=0;t<i.freeDistances.length;t++){let e=s-i.x,n=a-i.y,o=Math.sqrt(e**2+n**2);i.rotation<-90||i.rotation>90?i.freeDistances[t]=i.freeDistances[t]-Math.sign(s-i.x)*o:90==i.rotation||-90==i.rotation?i.freeDistances[t]=i.freeDistances[t]-n:i.freeDistances[t]=i.freeDistances[t]+Math.sign(s-i.x)*o}}this.update(),this.updateGrp(t,this.selectedShapeId),this.checkIfShapesOnLine(this.selectedShapeId)}for(let t=0;t<e.shapes_g.length;t++)this.updateDragFunc(e.shapes_g[t],i)}else"-1"!=e.grp_id?(this.updateAllPosInGrp(e.grp_id),this.updateOccupiedDistance(e.grp_id),t.target.x(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).x),t.target.y(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).y),this.groups.find((t=>t.id===e.grp_id)).shapes_g.find((e=>e.id===t.target.id())).personalRotation=t.target.rotation()-t.target.getParent().attrs.line.rotation,this.updateAllPosInGrp(e.grp_id),this.checkIfShapesOnLine(e.grp_id),this.updateDragFuncOfCenter()):(this.update(),this.updateDragFuncOfCenter());this.center.x=t.target.attrs.x,this.center.y=t.target.attrs.y},handleTransformation(t){if(void 0==t.evt)return;if(1==this.eraseMode)return void this.eraserAction(t);if(t.target===t.target.getStage())return this.selectedShapeId="NoId",this.eraseNodefromTransformer("lineTransformer"),this.eraseNodefromTransformer("shapeTransformer"),void(this.center.opacity=0);const e="Transformer"===t.target.getParent().className;if(e)return;const i=t.target.id();let s,a=this.findShape(i).shape_data;"center"!=t.target.attrs.id&&("Line"==t.target.className?(s="lineTransformer",a=this.groups.find((t=>t.id===i)).line,this.center.draggable=!1,this.selectedShapeAlignment=a.defaultAlignment,this.eraseNodefromTransformer("shapeTransformer")):(s="shapeTransformer",this.center.draggable=!0,this.selectedShapeAlignment=a.centerPosition,this.eraseNodefromTransformer("lineTransformer")),void 0!=a?(this.selectedShapeId=i,this.center.opacity=1,this.updateTransformer(s)):this.selectedShapeId="NoId",this.updateDragFuncOfCenter())},eraseNodefromTransformer(t){let e=this.$refs.stage.getStage();const i=e.find("#"+t)[0];i.nodes([])},updateTransformer(t){let e=this.$refs.stage.getStage();const i=e.find("#"+t)[0];let s;if("lineTransformer"==t)s=e.children[0].getChildren().filter((t=>"Group"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0].getChildren().filter((t=>"Line"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];else{s=e.children[0].getChildren().filter((t=>"Group"!=t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];let t=!0;void 0==s&&(t=!1);let i=0;while(!t)i<this.groups.length?(s=e.children[0].getChildren().filter((t=>"Group"==t.attrs.className))[i].getChildren().find((t=>t.attrs.id==this.selectedShapeId&&"Line"!=t.attrs.className)),t=void 0!=s,i++):t=!0}s!==i.node()&&(void 0!=s?i.nodes([s]):i.nodes([]),this.center.x=s.attrs.x,this.center.y=s.attrs.y)},ChangeCenter(t){let e,i,s=this.findShape(this.selectedShapeId),a=s.shape_data,n=this.GiveSignOfDistanceBtwCenterAndShape(t.target.attrs,a)*Math.sqrt((t.target.y()-a.y)**2+(t.target.x()-a.x)**2)+a.offsetY*a.scaleY,o=a.offsetY;void 0==a?a=this.groups.find((t=>t.id==this.selectedShapeId)).line:("Rect"==a.className?(e=a.height*a.scaleY/3,i=a.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.width/2,a.offsetY=a.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.width/2,a.offsetY=a.height,a.centerPosition="Bottom"):(a.offsetX=a.width/2,a.offsetY=0,a.centerPosition="Top")):"Circle"==a.className?(n+=a.radius*a.scaleY,e=a.radius*a.scaleY*2/3,i=a.radius*a.scaleY*4/3,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0,a.centerPosition="Middle"):n>i?(a.offsetX=0,a.offsetY=a.radius,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")):"Image"==a.className?(e=a.image.height*a.scaleY/3,i=a.image.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height,a.centerPosition="Bottom"):(a.offsetX=a.image.width/2,a.offsetY=0,a.centerPosition="Top")):"Text"==a.className?(e=a.length_y*a.scaleY/3,i=a.length_y*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y,a.centerPosition="Bottom"):(a.offsetX=a.length_x/2,a.offsetY=0,a.centerPosition="Top")):"Triangle"==a.className&&(n+=a.radius*a.scaleY,e=a.radius*a.scaleY/2,i=a.radius*a.scaleY*5/4,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0):n>i?(a.offsetX=0,a.offsetY=a.radius/2,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")),a.y=a.y-(o-a.offsetY)*a.scaleY*Math.cos(a.rotation*(Math.PI/180)),a.x=a.x+(o-a.offsetY)*a.scaleY*Math.sin(a.rotation*(Math.PI/180)),this.selectedShapeAlignment=a.centerPosition,"-1"!=s.grp_id&&this.updateAllPosInGrp(s.grp_id),t.target.x(a.x),t.target.y(a.y))},ChangeCenterRegardingCommand(t,e){let i=this.findShape(t),s=i.shape_data,a=s.offsetY;"Rect"==s.className?"Top"==e?(s.offsetY=0,s.offsetX=s.width/2):"Middle"==e?(s.offsetX=s.width/2,s.offsetY=s.height/2):"Bottom"==e&&(s.offsetX=s.width/2,s.offsetY=s.height):"Circle"==s.className?"Top"==e?(s.offsetX=0,s.offsetY=-s.radius):"Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e&&(s.offsetX=0,s.offsetY=s.radius):"Image"==s.className?"Middle"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height/2):"Bottom"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height):"Top"==e&&(s.offsetX=s.image.width/2,s.offsetY=0):"Text"==s.className?"Middle"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y/2):"Bottom"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y):"Top"==e&&(s.offsetX=s.length_x/2,s.offsetY=0):"Triangle"==s.className&&("Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e?(s.offsetX=0,s.offsetY=s.radius/2):"Top"==e&&(s.offsetX=0,s.offsetY=-s.radius)),s.centerPosition=e,s.y=s.y-(a-s.offsetY)*s.scaleY*Math.cos(s.rotation*(Math.PI/180)),s.x=s.x+(a-s.offsetY)*s.scaleY*Math.sin(s.rotation*(Math.PI/180)),"-1"!=i.grp_id&&this.updateAllPosInGrp(i.grp_id)},updateDragFuncOfCenter(){let t=this.findShape(this.selectedShapeId).shape_data,e=this.center,i=t.rotation*(Math.PI/180);i>=-Math.PI/2&&i<=0?i-=Math.PI/180*90:i<-Math.PI/2?(i+=Math.PI/2,i=Math.PI+i):i<=Math.PI&&i>0&&(i-=Math.PI/180*90),i<=0&&i>=-Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.y-t.y)*Math.cos(i),y:t.y-(e.y-t.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.x-t.x)*Math.cos(i),y:t.y-(e.x-t.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.y-t.y)*Math.cos(i),y:t.y+(e.y-t.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}})},MovingCenter(){},findShape(t){let e=this.shapes.find((e=>e.id===t)),i="-1",s=!0;void 0==e&&(s=!1);let a=0;while(!s)a<this.groups.length?(e=this.groups[a].shapes_g.find((e=>e.id===t)),void 0==e?s=!1:(i=this.groups[a].id,s=!0),a++):s=!0;return{shape_data:e,grp_id:i}},DetachShape(t,e,i){const s=this.lengthToCapture+5;let a=this.groups.find((e=>-1!=e.shapes_g.indexOf(t))),n=a.shapes_g.indexOf(t);t.dragBoundFunc=nt;let o=a.line.y-.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),r=a.line.x+.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),h=a.line.y+.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),l=a.line.x-.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),c=(h-o)/(r-l),d=t.x*(1/c)+t.y;a.line.rotation<0&&a.line.rotation>-45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-45&&a.line.rotation>-90||a.line.rotation<-90&&a.line.rotation>-135?(t.x=t.x+Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-135&&a.line.rotation>-180||a.line.rotation>135&&a.line.rotation<180?(t.x=t.x-Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>90&&a.line.rotation<=135||a.line.rotation>45&&a.line.rotation<=90?(t.x=t.x-Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>0&&a.line.rotation<=45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):-90==a.line.rotation?t.x=t.x-Math.sign(t.x-e)*s:90==a.line.rotation?t.x=t.x+Math.sign(t.x-e)*s:(180==a.line.rotation||-180==a.line.rotation||0==a.line.rotation)&&(t.y=t.y-Math.sign(t.y-i)*s),t.isGrouped=0,this.shapes.push(t),this.center.x=t.x,this.center.y=t.y,a.line.freeDistances.push(a.line.occupiedDistances[n]),a.line.occupiedDistances.splice(n,1),a.shapes_g.splice(n,1),a.line.positionPoints.splice(n,1),this.updateOccupiedDistance(a.id),this.updateAllPosInGrp(a.id),this.updateNaration(a),this.eraseNodefromTransformer("shapeTransformer")},createNewShape(t){if("Line"==t.attrs.className){this.max_id_figures=this.max_id_figures+1;let e=t.getParent().clone({id:""+this.max_id_figures,name:"group"+this.max_id_figures,shapes_g:[]});e.attrs.line.id=""+this.max_id_figures,e.attrs.line.x=t.getStage().getPointerPosition().x,e.attrs.line.y=t.getStage().getPointerPosition().y,e.attrs.line.draggable=!0,this.groups.push(e.attrs)}else{this.max_id_figures=this.max_id_figures+1;let e=t.clone({id:""+this.max_id_figures,draggable:!0});e.attrs.isGrouped=0,this.shapes.push(e.attrs)}},eraserAction(t){this.Remove(t.target)},unshowSelectedShape(t){"Line"==t.target.attrs.className&&0==this.eraseMode?t.target.opacity(.5):"Line"==t.target.attrs.className&&1==this.eraseMode?1==t.target.attrs.keepDistribution?t.target.stroke("rgb(48,48,48)"):t.target.stroke("blue"):"positionPoint"==t.target.attrs.className&&1==this.eraseMode?1!=t.target.getParent().attrs.line.keepDistribution&&t.target.strokeWidth(0):1==this.eraseMode&&t.target.strokeWidth(0)},showSelectedShape(t){if("Line"==t.target.attrs.className&&0==this.eraseMode)t.target.opacity(1);else if("Line"==t.target.attrs.className&&1==this.eraseMode)t.target.stroke("rgb(200, 59, 218)");else if("positionPoint"==t.target.attrs.className&&1==this.eraseMode){let e=t.target.getParent().attrs.line;-1!=e.freeDistances.indexOf(t.target.attrs.distance_to_line_center)&&1!=e.keepDistribution&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))}else 1==this.eraseMode&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))},editText(t){let e=t.target.getStage().attrs.container.getBoundingClientRect();document.getElementById("input2").style.top=e.y+t.target.getAbsolutePosition().y-2.5*document.getElementById("input1").size+"px",document.getElementById("input2").style.left=e.x+t.target.getAbsolutePosition().x-5*document.getElementById("input2").size+"px",document.getElementById("input2").style.display="initial",this.editedText=t.target},updateText(t){let e=this.shapes.find((t=>t.id===this.editedText.attrs.id)),i=!0;void 0==e&&(i=!1);let s=0;while(!i)s<this.groups.length?(e=this.groups[s].shapes_g.find((t=>t.id===this.editedText.attrs.id)),i=void 0!=e,s++):i=!0;if(void 0!=e){let i,s,a,n;i=this.editedText.width(),s=this.editedText.height(),e.text=t.target.value,this.editedText.text(t.target.value),a=this.editedText.width()-i,n=this.editedText.height()-s,e.offsetX=e.offsetX+a/2,e.offsetY=e.offsetY+n/2,e.length_x=this.editedText.width(),e.length_y=this.editedText.height(),document.getElementById("input2").style.display="none"}},updateNaration(t){let e="<strong>Substrate:</strong><br>";e+="- <mark class='grey'> StickyLine </mark><br>",e+="Relation: <i>alignement and distribution with</i>:";for(let i=0;i<t.shapes_g.length;i++)e=e+"<br>- "+t.shapes_g[i].className;this.$emit("explain",{origin:"Substrate - Polymorphism<br><mark class='grey'> The Stickyline preserves various relationships. </mark>",text:e})}}};const rt=(0,f.Z)(ot,[["render",at]]);var ht=rt;function lt(t,e,i,s,n,o){const r=(0,a.up)("v-rect"),h=(0,a.up)("v-circle"),l=(0,a.up)("v-image"),c=(0,a.up)("v-text"),d=(0,a.up)("v-regular-polygon"),g=(0,a.up)("v-line"),p=(0,a.up)("v-group"),u=(0,a.up)("v-transformer"),f=(0,a.up)("v-layer"),M=(0,a.up)("v-stage"),x=(0,a.up)("ContextMenu");return(0,a.wg)(),(0,a.iD)("div",{onClick:e[1]||(e[1]=(...t)=>o.HideContextMenu&&o.HideContextMenu(...t)),id:"ReuseSubstrateDemo",onFocus:e[2]||(e[2]=t=>o.initialNaration(this.groups)),onFocusout:e[3]||(e[3]=t=>this.narationHasBeenInitialized=!1),tabindex:"0"},[(0,a.Wm)(M,{ref:"stage",id:"stage",config:n.stageSize,onDragmove:o.update,onMousedown:o.handleTransformation,onTouchstart:o.handleTransformation,onFusion:o.makeGroup,onContextMenu:o.DisplayContextMenu},{default:(0,a.w5)((()=>[(0,a.Wm)(f,{ref:"layer"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.groups,(t=>((0,a.wg)(),(0,a.j4)(p,{ref_for:!0,ref:"groups",key:t.id,config:t},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Rect"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(r,{key:e.id,config:e,onTransformend:o.updateTransformedShape,onDragend:e=>o.updatePosInGrp(e,t.id),onDragmove:o.CheckIfNeedToDetach,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Circle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(h,{key:e.id,config:e,onTransformend:o.updateTransformedShape,onDragend:e=>o.updatePosInGrp(e,t.id),onDragmove:o.CheckIfNeedToDetach,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Image"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(l,{key:e.id,config:e,onTransformend:o.updateTransformedShape,onDragend:e=>o.updatePosInGrp(e,t.id),onDragmove:o.CheckIfNeedToDetach,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Text"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(c,{key:e.id,config:e,onTransformend:o.updateTransformedShape,onDragend:e=>o.updatePosInGrp(e,t.id),onDragmove:o.CheckIfNeedToDetach,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape,onDblclick:o.editText},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout","onDblclick"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Triangle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(d,{key:e.id,config:e,onTransformend:o.updateTransformedShape,onDragend:e=>o.updatePosInGrp(e,t.id),onDragmove:o.CheckIfNeedToDetach,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(),(0,a.j4)(g,{key:t.line.id,config:t.line,onTransformend:o.updateTransformedShape,onDragmove:e=>o.updateGrp(e,t.id),onMouseout:o.unshowSelectedShape,onMouseenter:o.showSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseout","onMouseenter"])),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.line.positionPoints,(t=>((0,a.wg)(),(0,a.j4)(h,{key:t.id,config:t,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onMouseenter","onMouseout"])))),128))])),_:2},1032,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.shapes.filter((t=>"Rect"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(r,{key:t.id,config:t,onTransformend:o.updateTransformedShape,onDragmove:o.updatePos,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.shapes.filter((t=>"Circle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(h,{key:t.id,config:t,onTransformend:o.updateTransformedShape,onDragmove:o.updatePos,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.shapes.filter((t=>"Triangle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(d,{key:t.id,config:t,onTransformend:o.updateTransformedShape,onDragmove:o.updatePos,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.transformers,(t=>((0,a.wg)(),(0,a.j4)(u,{key:t.id,config:t},null,8,["config"])))),128)),((0,a.wg)(),(0,a.j4)(h,{key:n.center.id,config:n.center,onDragend:o.ChangeCenter,onClick:t.DisplayCenterMenu},null,8,["config","onDragend","onClick"]))])),_:1},512)])),_:1},8,["config","onDragmove","onMousedown","onTouchstart","onFusion","onContextMenu"]),(0,a._)("div",{id:"activeReuseSubstrate",onFocusout:e[0]||(e[0]=(...t)=>o.stopInitialisation&&o.stopInitialisation(...t)),tabindex:"1"},[(0,a.Wm)(x,{"menu-of-stage":n.isStageOnlySelected,"menu-of-line":n.isALineSelected,"menu-of-grouped-shape":n.isAGroupedShapeSelected,"keep-distance-button-text":this.keepDistanceButtonText,"need-copy-button":!1,"need-switch-distribution-mode-button":!1,onChangecenterButton:t.ChangeCenterButtonAction,onDetachshapeButton:t.DetachShapeButtonAction,onKeepdistanceButton:t.KeepDistribution,onCopyButton:o.Copy,onCopyAllButton:o.CopyAll,onPastButton:o.Past,onRemoveButton:o.Remove,onRemoveAllButton:o.RemoveAll},null,8,["menu-of-stage","menu-of-line","menu-of-grouped-shape","keep-distance-button-text","onChangecenterButton","onDetachshapeButton","onKeepdistanceButton","onCopyButton","onCopyAllButton","onPastButton","onRemoveButton","onRemoveAllButton"])],32)],32)}const ct=function(t){let e=this.getStage().width(),i=this.getStage().height(),s=10;return t.x>e-s&&t.y>i-s?{x:e-s,y:i-s}:t.x>e-s&&t.y<s?{x:e-s,y:s}:t.y>i-s&&t.x<s?{x:s,y:i-s}:t.x<s&&t.y<s?{x:s,y:s}:t.x<s?{x:s,y:t.y}:t.y<s?{x:t.x,y:s}:t.x>e-s?{x:e-s,y:t.y}:t.y>i-s?{x:t.x,y:i-s}:{x:t.x,y:t.y}};var dt={props:{width:{type:Number,default:window.innerWidth},height:{type:Number,default:window.innerHeight}},components:{ContextMenu:$},data(){return{stageSize:{width:this.width,height:this.height},narationHasBeenInitialized:!1,lengthToCapture:10,lengthToDetach:15,editedText:null,eraseMode:0,selectedShapeAlignment:"",needMenu:"initial",isALineSelected:!1,isAGroupedShapeSelected:!1,isStageOnlySelected:!1,keepDistanceButtonText:"Liberate Distribution",max_id_figures:6,groups:[{name:"group",className:"Group",id:"1",x:0,y:0,offsetX:0,offsetY:0,rotation:0,draggable:!1,shapes_g:[{rotation:0,x:30,y:320,scaleX:1,scaleY:1,offsetX:0,offsetY:40,radius:40,fill:"orange",strokeWidth:0,stroke:"black",draggable:!0,isGrouped:1,className:"Circle",personalRotation:0,id:"2",dragBoundFunc:ct,centerPosition:"Bottom"},{rotation:0,x:110,y:320,scaleX:1,scaleY:1,offsetX:0,offsetY:40,radius:40,fill:"orange",strokeWidth:0,stroke:"black",draggable:!0,isGrouped:1,className:"Circle",personalRotation:0,id:"3",dragBoundFunc:ct,centerPosition:"Bottom"},{rotation:0,x:200,y:320,scaleX:1,scaleY:1,offsetX:0,offsetY:40,radius:40,fill:"orange",strokeWidth:0,stroke:"black",draggable:!0,isGrouped:1,className:"Circle",personalRotation:0,id:"4",dragBoundFunc:ct,centerPosition:"Bottom"}],aShapeHasBeenDetach:0,line:{x:150,y:250,points:[0,0,0,0,250,0],positionPoints:[{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint1",distance_to_line_center:void 0},{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint2",distance_to_line_center:void 0},{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint3",distance_to_line_center:void 0}],strokeWidth:10,rotation:0,tension:0,closed:!0,draggable:!0,scaleX:1,scaleY:1,opacity:.5,offset:{x:125,y:0},name:"ligne",className:"Line",stroke:"blue",id:"1",keepDistribution:!1,freeDistances:[],occupiedDistances:[-95,-15,105],keepDistanceButtonText:"Liberate Distribution",defaultAlignment:"Bottom",dragBoundFunc:ct}}],transformers:[{id:"lineTransformer",enabledAnchors:[],rotateEnabled:!1,borderEnabled:!1,flipEnabled:!1,nodes:[]},{id:"shapeTransformer",nodes:[]}],shapes:[],center:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:4,fill:"black",opacity:1,draggable:!0,isGrouped:0,className:"Circle",id:"center",dragBoundFunc:ct},positionPoint:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint",distance_to_line_center:void 0},selectedShapeId:""}},mounted(){let t=this.$refs.stage.getStage().getChildren()[0].getChildren().filter((t=>"Text"==t.attrs.className));for(let a=0;a<t.length;a++)t[a].attrs.length_x=t[a].width(),t[a].attrs.length_y=t[a].height(),t[a].offsetX(t[a].attrs.length_x/2);let e=this.groups[0],i=e.line,s=e.shapes_g;for(let a=0;a<s.length;a++)this.updateDragFunc(s[a],i),this.updateAllPosInGrp(e.id)},created(){this.max_id_figures=this.shapes.length+this.groups.length;for(let t=0;t<this.groups.length;t++)this.max_id_figures=this.max_id_figures+this.groups[t].shapes_g.length},methods:{switchEraseMode(){0==this.eraseMode?(this.eraseMode=1,document.getElementById("playground").style.cursor="url("+i(843)+"),default",this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer")):(this.eraseMode=0,document.getElementById("playground").style.cursor="default")},checkIfShapesOnLine(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;let a=0;while(a<s.length)this.isCoordinateOnLine(s[a].x,s[a].y,i.id)?a+=1:(console.log("a shape is not on a line"),s[a].dragBoundFunc=ct,s[a].isGrouped=0,i.keepDistribution&&i.positionPoints.slice(a,1),this.shapes.push(s[a]),i.freeDistances.push(i.occupiedDistances[a]),i.occupiedDistances.splice(a,1),s.splice(a,1),this.updateNaration(e))},isCoordinateOnLine(t,e,i){const s=this.groups.find((t=>t.id===i)),a=s.line;let n=!0,o=a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),r=a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),h=a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),l=a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),c=(o-h)/(l-r),d=a.y-c*a.x;return n=Math.abs(r-l)>1?Math.abs(c*t+d-e)>1:Math.abs(t-a.x)>1,!(n||(a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0||!n&&Math.sqrt((a.x-t)**2+(a.y-e)**2)>a.points[4]*a.scaleX/2)},updateGrp(t,e){const i=this.groups.find((t=>t.id===e)),s=i.line;i.offsetX=s.offsetX,i.offsetY=s.offsetY,s.x=t.target.x(),s.y=t.target.y(),this.center.x=s.x,this.center.y=s.y,this.updateAllPosInGrp(s.id),this.checkIfShapesOnLine(s.id)},updateAllPosInGrp(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;for(let n=0;n<s.length;n++)i.keepDistribution,s[n].x=i.x+i.occupiedDistances[n]*Math.cos(i.rotation*(Math.PI/180)),s[n].y=i.y+i.occupiedDistances[n]*Math.sin(i.rotation*(Math.PI/180)),s[n].distance_to_line_center=i.occupiedDistances[n],s[n].rotation=s[n].personalRotation+i.rotation,i.positionPoints[n].x=s[n].x,i.positionPoints[n].y=s[n].y,i.positionPoints[n].distance_to_line_center=s[n].distance_to_line_center;let a=s.length;while(a<i.positionPoints.length)i.keepDistribution?i.positionPoints.splice(a,1):(i.positionPoints[a].x=i.x+i.freeDistances[a-s.length]*Math.cos(i.rotation*(Math.PI/180)),i.positionPoints[a].y=i.y+i.freeDistances[a-s.length]*Math.sin(i.rotation*(Math.PI/180)),i.positionPoints[a].distance_to_line_center=i.freeDistances[a-s.length],a++)},isOutsideTheLine(t,e){let i=e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180)),s=e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180)),a=e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180)),n=e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180)),o=(i-a)/(n-s),r=e.y-o*e.x,h=!1;return h=Math.abs(s-n)>=1?Math.abs(o*t.x+r-t.y)<1:Math.abs(t.x-e.x)<1,!h||(e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=0&&e.rotation*(Math.PI/180)>-Math.PI/2||(e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=0&&e.rotation*(Math.PI/180)>-Math.PI/2||(e.y+.5*e.points[4]*e.scaleX*Math.sin(Math.PI+e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(Math.PI+e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=-Math.PI/2&&e.rotation*(Math.PI/180)>-Math.PI||(e.x+.5*e.points[4]*e.scaleX*Math.cos(Math.PI+e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(Math.PI+e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=-Math.PI/2&&e.rotation*(Math.PI/180)>-Math.PI||(e.y+.5*e.points[4]*e.scaleX*Math.sin(Math.PI-e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(Math.PI-e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=Math.PI&&e.rotation*(Math.PI/180)>Math.PI/2||(e.x+.5*e.points[4]*e.scaleX*Math.cos(Math.PI-e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(Math.PI-e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=Math.PI&&e.rotation*(Math.PI/180)>Math.PI/2||(e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=Math.PI/2&&e.rotation*(Math.PI/180)>=0||(e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=Math.PI/2&&e.rotation*(Math.PI/180)>=0},update(){const t=this.shapes;let e=!1;for(let i=0;i<t.length;i++){let s=t[i].x,a=t[i].y;for(let n=0;n<this.groups.length;n++){let o=this.groups[n].line,r=o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),h=o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),l=o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),c=o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),d=(r-l)/(c-h),g=o.y-d*o.x;e=Math.abs(h-c)>1?Math.abs(d*s+g-a)<=this.lengthToCapture:Math.abs(s-o.x)<=this.lengthToCapture,(e&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=0&&o.rotation*(Math.PI/180)>-Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=-Math.PI/2&&o.rotation*(Math.PI/180)>=-Math.PI||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI&&o.rotation*(Math.PI/180)>Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI/2&&o.rotation*(Math.PI/180)>=0)&&(t[i].isGrouped=1,this.makeGroup(o.id))}}},CheckIfNeedToDetach(t){let e=this.groups.find((e=>e.id===t.target.getParent().attrs.id)),i=e.shapes_g.find((e=>e.id==t.target.id())),s=Math.sqrt((t.target.getStage().getPointerPosition().y-t.target.y())**2+(t.target.getStage().getPointerPosition().x-t.target.x())**2);"Rect"==t.target.className?s-=t.target.attrs.height*t.target.attrs.scaleY:"Circle"==t.target.className?s-=2*t.target.attrs.radius*t.target.attrs.scaleY:"Text"==t.target.className?s-=t.target.attrs.length_y*t.target.attrs.scaleY:("Image"==t.target.className||"Triangle"==t.target.attrs.className)&&(s-=t.target.height()*t.target.scaleY()),s>50&&(this.groups.find((e=>e.id===t.target.getParent().attrs.id)).aShapeHasBeenDetach=1,this.DetachShape(i,t.target.getStage().getPointerPosition().x,t.target.getStage().getPointerPosition().y))},GiveSignOfDistance(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(a)<=this.lengthToCapture&&-90==e.rotation?-Math.sign(n):Math.abs(a)<=this.lengthToCapture&&90==e.rotation?Math.sign(n):Math.sign(a),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},GiveSignOfDistanceBtwCenterAndShape(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(n)<=this.lengthToCapture&&-90==e.rotation?Math.sign(a):Math.abs(n)<=this.lengthToCapture&&90==e.rotation?-Math.sign(a):Math.sign(n),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},makeGroup(t){this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer");const e=this.groups.find((e=>e.id===t)),i=e.line,s=this.shapes;i.freeDistances.sort(this.isSmaller),s.sort(this.isBeforeRegardingX);for(let a=0;a<s.length;a++)if(1==s[a].isGrouped){const n=Object.assign({},this.positionPoint);let o=s[a].x-i.x,r=s[a].y-i.y;if(s[a].personalRotation=0,s[a].distance_to_line_center=this.GiveSignOfDistance(s[a],i)*Math.sqrt(o**2+r**2),Math.abs(s[a].distance_to_line_center)>=i.points[4]*i.scaleX/2&&(s[a].distance_to_line_center=Math.sign(s[a].distance_to_line_center)*i.points[4]*i.scaleX/2),this.ChangeCenterRegardingCommand(s[a].id,e.line.defaultAlignment),!i.keepDistribution&&i.freeDistances.length>0){let t=this.isNearest(i,s[a]);this.updateDragFunc(s[a],i),e.shapes_g.push(s[a]),e.line.occupiedDistances.push(e.line.freeDistances[t]),e.line.freeDistances.splice(t,1)}else this.updateDragFunc(s[a],i),e.shapes_g.push(s[a]),console.log("no 'free distance' anymore"),e.line.occupiedDistances.push(s[a].distance_to_line_center),n.id="positionPoint"+e.id+e.line.positionPoints.length,e.line.positionPoints.push(n);console.log("A new shape has been added with a distance"+s[a].distance_to_line_center),this.updateOccupiedDistance(i.id),this.updateAllPosInGrp(t),s.splice(a,1),this.updateNaration(e)}this.center.x=i.x,this.center.y=i.y},updateOccupiedDistance(t){const e=this.groups.find((e=>e.id===t));if(this.sortByDistToLineCenter(e),e.line.keepDistribution){let t=e.line.points[4],i=e.shapes_g.length,s=t/(i-1)*e.line.scaleX;if(i%2==0){for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[t-1]=-(i/2-1-t+1)*s-s/2;for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[i/2+t]=t*s+s/2;e.line.occupiedDistances[i/2-1]=-s/2,e.line.occupiedDistances[i/2]=s/2}else{for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[t-1]=-s*((i-1)/2-t+1);for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[(i-1)/2+t]=s*t;e.line.occupiedDistances[(i-1)/2]=0}for(let a=0;a<e.shapes_g.length;a++)e.shapes_g[a].distance_to_line_center=e.line.occupiedDistances[a]}else e.line.occupiedDistances.sort(this.isSmaller)},isSmaller(t,e){return t<e?-1:1},isBeforeRegardingX(t,e){return t.x<e.x?-1:1},updateOccDist(t,e){let i=this.isNearest(t.line,e);if(i.isFree){e.distance_to_line_center=t.line.freeDistances[i.indice],t.line.freeDistances.splice(i.indice,1),this.sortByDistToLineCenter(t);for(let e=0;e<t.shapes_g.length;e++)t.line.occupiedDistances.length==e?t.line.occupiedDistances.push(t.shapes_g[e].distance_to_line_center):t.line.occupiedDistances[e]=t.shapes_g[e].distance_to_line_center}else t.shapes_g.find((t=>t.id==e.id)).distance_to_line_center=t.line.occupiedDistances[i.indice],t.line.occupiedDistances.splice(i.indice,1),this.updateOccDist(t,t.shapes_g[i.indice])},isNearest(t,e){let i,s=t.x+t.freeDistances[0]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[0]*Math.sin(t.rotation*(Math.PI/180)),n=Math.sqrt((s-e.x)**2+(a-e.y)**2),o=0;for(let r=1;r<t.freeDistances.length;r++)s=t.x+t.freeDistances[r]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[r]*Math.sin(t.rotation*(Math.PI/180)),i=Math.sqrt((s-e.x)**2+(a-e.y)**2),i<n&&(n=i,o=r);return o},sortByDistToLineCenter(t){if(t.line.keepDistribution)for(let e=0;e<t.shapes_g.length;e++){let i=t.shapes_g[e].x-t.line.x,s=t.shapes_g[e].y-t.line.y;t.shapes_g[e].distance_to_line_center=this.GiveSignOfDistance(t.shapes_g[e],t.line)*Math.sqrt(i**2+s**2)}for(let e=1;e<t.shapes_g.length;e++){let i=t.shapes_g[e],s=e;while(s>0&&t.shapes_g[s-1].distance_to_line_center>i.distance_to_line_center)t.shapes_g[s]=t.shapes_g[s-1],s-=1;t.shapes_g[s]=i}},sortAnyShapesByDistToLineCenter(t,e){for(let i=0;i<t.length;i++){let s=t[i].x-e.x,a=t[i].y-e.y;t.distance_to_line_center=this.GiveSignOfDistance(t,e)*Math.sqrt(s**2+a**2)}for(let i=1;i<t.length;i++){let e=t[i],s=i;while(s>0&&t[s-1].distance_to_line_center>e.distance_to_line_center)t[s]=t[s-1],s-=1;t[s]=e}},updateDragFunc(t,e){let i=e.rotation*(Math.PI/180);i<=0&&i>=-Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.y-e.y)*Math.cos(i),y:e.y-(t.y-e.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.x-e.x)*Math.cos(i),y:e.y-(t.x-e.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.y-e.y)*Math.cos(i),y:e.y+(t.y-e.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}})},updatePos(t){const e=this.shapes.find((e=>e.id===t.target.id()));e.x=t.target.x(),e.y=t.target.y(),this.center.x=t.target.x(),this.center.y=t.target.y();let i={x:e.x,y:e.y};t.target.position(i),t.target.getLayer().batchDraw()},updatePosInGrp(t,e){let i,s,a;const n=this.groups.find((t=>t.id===e));if(1==n.aShapeHasBeenDetach)return void(n.aShapeHasBeenDetach=0);const o=n.line,r=n.shapes_g.find((e=>e.id===t.target.id())),h=n.shapes_g;if(1==r.needToBeDetach&&(r.needToBeDetach=0,this.DetachShape(r),this.updateAllPosInGrp(t.target.getParent().attrs.id)),o.keepDistribution){if(this.isCoordinateOnLine(t.target.x(),t.target.y(),o.id)){i=r.x-t.target.x(),s=r.y-t.target.y();let e=n.line.points[4],a=n.shapes_g.length,l=e/(a-1)*n.line.scaleX,c=Math.sqrt(i**2+s**2);c>=l?(r.x=t.target.x(),r.y=t.target.y(),this.updateOccupiedDistance(o.id),r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation,this.updateAllPosInGrp(o.id)):(r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation)}else r.x=t.target.x(),r.y=t.target.y();o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center}else o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,r.x=t.target.x(),r.y=t.target.y(),0==Math.sin(o.rotation*(Math.PI/180))?a=r.x-o.x:(a=0!=Math.sign(r.x-o.x)?Math.sign(-r.rotation)*Math.sign(r.x-o.x)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2):Math.sign(-r.rotation)*Math.sign(r.y-o.y)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2),(r.rotation*(Math.PI/180)<=-Math.PI/2||r.rotation*(Math.PI/180)<=Math.PI/2&&r.rotation*(Math.PI/180)>=0)&&(a=-a)),o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center;let l={x:r.x,y:r.y};if(this.center.x=r.x,this.center.y=r.y,t.target.position(l),t.target.getLayer().batchDraw(),this.isCoordinateOnLine(r.x,r.y,o.id))o.keepDistribution?n.line.occupiedDistances[h.indexOf(r)]=r.distance_to_line_center:n.line.occupiedDistances[h.indexOf(r)]=a,o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center,this.updateNaration(n);else{r.dragBoundFunc=ct,r.isGrouped=0,this.shapes.push(r);for(let t=0;t<h.length;t++)h[t].id==r.id&&(o.freeDistances.push(o.occupiedDistances[t]),o.occupiedDistances.splice(t,1),h.splice(t,1),console.log("a shape has been removed from the line"))}o.keepDistribution&&this.updateOccupiedDistance(o.id),this.updateAllPosInGrp(o.id)},updateTransformedShape(t){let e,i;if("Line"==t.target.className)i=this.groups.find((t=>t.id===this.selectedShapeId)).line;else if(e=this.findShape(this.selectedShapeId),i=e.shape_data,void 0==i)return;let s=i.x,a=i.y;i.x=t.target.x(),i.y=t.target.y(),i.rotation=t.target.rotation();let n=i.scaleX;if(i.scaleX=t.target.scaleX(),i.scaleY=t.target.scaleY(),"Line"==t.target.className){const e=this.groups.find((t=>t.id===i.id));if(i.keepDistribution){for(let t=0;t<i.occupiedDistances.length;t++)i.occupiedDistances[t]=i.occupiedDistances[t]/n*i.scaleX;this.update(),this.updateGrp(t,this.selectedShapeId),this.checkIfShapesOnLine(this.selectedShapeId)}else{if(n!=i.scaleX){for(let t=0;t<e.shapes_g.length;t++){let n=e.shapes_g[t].x-i.x,o=e.shapes_g[t].y-i.y;0==Math.sign(e.line.occupiedDistances[t])?e.line.occupiedDistances[t]=this.GiveSignOfDistance(e.shapes_g[t],i)*Math.sqrt(n**2+o**2):e.line.occupiedDistances[t]=Math.sign(e.line.occupiedDistances[t])*Math.sqrt(n**2+o**2),Math.sign(e.shapes_g[t].x-s)!=Math.sign(n)&&0!=Math.sign(e.shapes_g[t].x-s)&&90!=e.line.rotation&&-90!=e.line.rotation&&(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t]),Math.sign(e.shapes_g[t].y-a)==Math.sign(o)||0==Math.sign(e.shapes_g[t].y-a)||90!=e.line.rotation&&-90!=e.line.rotation||(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t])}for(let t=0;t<i.freeDistances.length;t++){let e=s-i.x,n=a-i.y,o=Math.sqrt(e**2+n**2);i.rotation<-90||i.rotation>90?i.freeDistances[t]=i.freeDistances[t]-Math.sign(s-i.x)*o:90==i.rotation||-90==i.rotation?i.freeDistances[t]=i.freeDistances[t]-n:i.freeDistances[t]=i.freeDistances[t]+Math.sign(s-i.x)*o}}this.update(),this.updateGrp(t,this.selectedShapeId),this.checkIfShapesOnLine(this.selectedShapeId)}for(let t=0;t<e.shapes_g.length;t++)this.updateDragFunc(e.shapes_g[t],i)}else"-1"!=e.grp_id?(this.updateAllPosInGrp(e.grp_id),this.updateOccupiedDistance(e.grp_id),t.target.x(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).x),t.target.y(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).y),this.groups.find((t=>t.id===e.grp_id)).shapes_g.find((e=>e.id===t.target.id())).personalRotation=t.target.rotation()-t.target.getParent().attrs.line.rotation,this.updateAllPosInGrp(e.grp_id),this.checkIfShapesOnLine(e.grp_id),this.updateDragFuncOfCenter()):(this.update(),this.updateDragFuncOfCenter());this.center.x=t.target.attrs.x,this.center.y=t.target.attrs.y},handleTransformation(t){if(void 0==t.evt)return;if(1==this.eraseMode)return void this.eraserAction(t);if(t.target===t.target.getStage())return this.selectedShapeId="NoId",this.eraseNodefromTransformer("lineTransformer"),this.eraseNodefromTransformer("shapeTransformer"),void(this.center.opacity=0);const e="Transformer"===t.target.getParent().className;if(e)return;const i=t.target.id();let s,a=this.findShape(i).shape_data;"center"!=t.target.attrs.id&&("Line"==t.target.className?(s="lineTransformer",a=this.groups.find((t=>t.id===i)).line,this.center.draggable=!1,this.selectedShapeAlignment=a.defaultAlignment,this.eraseNodefromTransformer("shapeTransformer")):(s="shapeTransformer",this.center.draggable=!0,this.selectedShapeAlignment=a.centerPosition,this.eraseNodefromTransformer("lineTransformer")),void 0!=a?(this.selectedShapeId=i,this.center.opacity=1,this.updateTransformer(s)):this.selectedShapeId="NoId",this.updateDragFuncOfCenter())},eraseNodefromTransformer(t){let e=this.$refs.stage.getStage();const i=e.find("#"+t)[0];i.nodes([])},updateTransformer(t){let e=this.$refs.stage.getStage();const i=e.find("#"+t)[0];let s;if("lineTransformer"==t)s=e.children[0].getChildren().filter((t=>"Group"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0].getChildren().filter((t=>"Line"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];else{s=e.children[0].getChildren().filter((t=>"Group"!=t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];let t=!0;void 0==s&&(t=!1);let i=0;while(!t)i<this.groups.length?(s=e.children[0].getChildren().filter((t=>"Group"==t.attrs.className))[i].getChildren().find((t=>t.attrs.id==this.selectedShapeId&&"Line"!=t.attrs.className)),t=void 0!=s,i++):t=!0}s!==i.node()&&(void 0!=s?i.nodes([s]):i.nodes([]),this.center.x=s.attrs.x,this.center.y=s.attrs.y)},DisplayContextMenu(t){t.evt.preventDefault(),void 0!=t.target.className&&"center"!=t.target.attrs.id&&(this.isStageOnlySelected=!1,$.data().dM="initial",this.$emit("needmenu"),this.needMenu=!0,$.props.ConcernedShape=t.target,"Line"==t.target.attrs.className?(this.isALineSelected=!0,this.isAGroupedShapeSelected=!0,this.keepDistanceButtonText=t.target.attrs.keepDistanceButtonText):"Group"==t.target.getParent().attrs.className?this.isAGroupedShapeSelected=!0:(this.isALineSelected=!1,this.isAGroupedShapeSelected=!1),document.getElementById("activeReuseSubstrate").style.display="initial",document.getElementById("activeReuseSubstrate").style.top=document.getElementById("reuseSubstrateDemo").getBoundingClientRect().top+document.documentElement.scrollTop+t.target.getStage().getPointerPosition().y+"px",document.getElementById("activeReuseSubstrate").style.left=document.getElementById("reuseSubstrateDemo").getBoundingClientRect().left+document.documentElement.scrollLeft+t.target.getStage().getPointerPosition().x+"px"),t.target===t.target.getStage()&&(this.needMenu=!0,this.isALineSelected=!1,this.isAGroupedShapeSelected=!1,this.isStageOnlySelected=!0,document.getElementById("activeReuseSubstrate").style.display="initial",document.getElementById("activeReuseSubstrate").style.top=document.getElementById("reuseSubstrateDemo").getBoundingClientRect().top+document.documentElement.scrollTop+t.target.getStage().getPointerPosition().y+"px",document.getElementById("activeReuseSubstrate").style.left=document.getElementById("reuseSubstrateDemo").getBoundingClientRect().left+document.documentElement.scrollLeft+t.target.getStage().getPointerPosition().x+"px")},HideContextMenu(){this.needMenu=!1,document.getElementById("activeReuseSubstrate").style.display="none"},ChangeCenter(t){let e,i,s=this.findShape(this.selectedShapeId),a=s.shape_data,n=this.GiveSignOfDistanceBtwCenterAndShape(t.target.attrs,a)*Math.sqrt((t.target.y()-a.y)**2+(t.target.x()-a.x)**2)+a.offsetY*a.scaleY,o=a.offsetY;void 0==a?a=this.groups.find((t=>t.id==this.selectedShapeId)).line:("Rect"==a.className?(e=a.height*a.scaleY/3,i=a.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.width/2,a.offsetY=a.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.width/2,a.offsetY=a.height,a.centerPosition="Bottom"):(a.offsetX=a.width/2,a.offsetY=0,a.centerPosition="Top")):"Circle"==a.className?(n+=a.radius*a.scaleY,e=a.radius*a.scaleY*2/3,i=a.radius*a.scaleY*4/3,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0,a.centerPosition="Middle"):n>i?(a.offsetX=0,a.offsetY=a.radius,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")):"Image"==a.className?(e=a.image.height*a.scaleY/3,i=a.image.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height,a.centerPosition="Bottom"):(a.offsetX=a.image.width/2,a.offsetY=0,a.centerPosition="Top")):"Text"==a.className?(e=a.length_y*a.scaleY/3,i=a.length_y*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y,a.centerPosition="Bottom"):(a.offsetX=a.length_x/2,a.offsetY=0,a.centerPosition="Top")):"Triangle"==a.className&&(n+=a.radius*a.scaleY,e=a.radius*a.scaleY/2,i=a.radius*a.scaleY*5/4,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0):n>i?(a.offsetX=0,a.offsetY=a.radius/2,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")),a.y=a.y-(o-a.offsetY)*a.scaleY*Math.cos(a.rotation*(Math.PI/180)),a.x=a.x+(o-a.offsetY)*a.scaleY*Math.sin(a.rotation*(Math.PI/180)),this.selectedShapeAlignment=a.centerPosition,"-1"!=s.grp_id&&this.updateAllPosInGrp(s.grp_id),t.target.x(a.x),t.target.y(a.y))},ChangeCenterRegardingCommand(t,e){let i=this.findShape(t),s=i.shape_data,a=s.offsetY;"Rect"==s.className?"Top"==e?(s.offsetY=0,s.offsetX=s.width/2):"Middle"==e?(s.offsetX=s.width/2,s.offsetY=s.height/2):"Bottom"==e&&(s.offsetX=s.width/2,s.offsetY=s.height):"Circle"==s.className?"Top"==e?(s.offsetX=0,s.offsetY=-s.radius):"Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e&&(s.offsetX=0,s.offsetY=s.radius):"Image"==s.className?"Middle"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height/2):"Bottom"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height):"Top"==e&&(s.offsetX=s.image.width/2,s.offsetY=0):"Text"==s.className?"Middle"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y/2):"Bottom"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y):"Top"==e&&(s.offsetX=s.length_x/2,s.offsetY=0):"Triangle"==s.className&&("Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e?(s.offsetX=0,s.offsetY=s.radius/2):"Top"==e&&(s.offsetX=0,s.offsetY=-s.radius)),s.centerPosition=e,s.y=s.y-(a-s.offsetY)*s.scaleY*Math.cos(s.rotation*(Math.PI/180)),s.x=s.x+(a-s.offsetY)*s.scaleY*Math.sin(s.rotation*(Math.PI/180)),"-1"!=i.grp_id&&this.updateAllPosInGrp(i.grp_id)},updateDragFuncOfCenter(){let t=this.findShape(this.selectedShapeId).shape_data,e=this.center,i=t.rotation*(Math.PI/180);i>=-Math.PI/2&&i<=0?i-=Math.PI/180*90:i<-Math.PI/2?(i+=Math.PI/2,i=Math.PI+i):i<=Math.PI&&i>0&&(i-=Math.PI/180*90),i<=0&&i>=-Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.y-t.y)*Math.cos(i),y:t.y-(e.y-t.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.x-t.x)*Math.cos(i),y:t.y-(e.x-t.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.y-t.y)*Math.cos(i),y:t.y+(e.y-t.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}})},MovingCenter(){},Copy(){$.props.CopiedShape=$.props.ConcernedShape,$.props.pastOneObject=!0},CopyAll(){$.props.CopiedShape=$.props.ConcernedShape,$.props.pastOneObject=!1},Past(){if(void 0==$.props.CopiedShape.attrs)return;let t=$.props.CopiedShape.clone({id:""+this.max_id_figures}),e=this.groups.length;if("Line"==$.props.CopiedShape.attrs.className){if(this.max_id_figures=this.max_id_figures+1,$.props.pastOneObject){t=$.props.CopiedShape.getParent().clone({id:""+this.max_id_figures,name:"group"+this.max_id_figures,shapes_g:[]}),t.attrs.line.id=""+this.max_id_figures,t.attrs.line.x=$.props.ConcernedShape.getStage().getPointerPosition().x,t.attrs.line.y=$.props.ConcernedShape.getStage().getPointerPosition().y;for(let e=0;e<t.attrs.line.occupiedDistances.length;e++)t.attrs.line.freeDistances.push(t.attrs.line.occupiedDistances[e]);if(t.attrs.line.occupiedDistances=[],1!=t.attrs.line.keepDistribution){let e=Object.assign([],t.attrs.line.positionPoints),i=e.length;t.attrs.line.positionPoints=[];for(let s=0;s<i.valueOf();s++){let i=$.props.CopiedShape.getParent().getChildren().find((t=>t.attrs.id===e[s].id)).clone({id:"positionPoint"+t.attrs.line.id+s});t.attrs.line.positionPoints.push(i.attrs)}}this.groups.push(t.attrs)}else{t=$.props.CopiedShape.getParent().clone({id:""+this.max_id_figures,name:"group"+this.max_id_figures,shapes_g:[]}),t.attrs.line.id=""+this.max_id_figures,t.attrs.line.x=$.props.ConcernedShape.getStage().getPointerPosition().x,t.attrs.line.y=$.props.ConcernedShape.getStage().getPointerPosition().y;let i=Object.assign([],t.attrs.line.positionPoints),s=i.length;t.attrs.line.positionPoints=[];for(let e=0;e<s.valueOf();e++){let s=$.props.CopiedShape.getParent().getChildren().find((t=>t.attrs.id===i[e].id)).clone({id:"positionPoint"+t.attrs.line.id+e});t.attrs.line.positionPoints.push(s.attrs)}this.groups.push(t.attrs);let a=this.groups[this.groups.indexOf(this.groups.find((t=>t.id==$.props.CopiedShape.getParent().attrs.id)))].shapes_g,n=a.length;for(let t=0;t<n;t++){this.max_id_figures=this.max_id_figures+1;let i=$.props.CopiedShape.getParent().getChildren().find((e=>e.attrs.id===a[t].id)).clone({id:""+this.max_id_figures});this.groups[e].shapes_g.push(i.attrs),this.updateDragFunc(this.groups[e].shapes_g[this.groups[e].shapes_g.length-1],this.groups[e].line)}this.updateAllPosInGrp(t.attrs.id)}this.updateNaration(this.groups[this.groups.length-1]),this.updateAllPosInGrp(t.attrs.id)}else this.max_id_figures=this.max_id_figures+1,t=$.props.CopiedShape.clone({id:""+this.max_id_figures,x:$.props.ConcernedShape.getStage().getPointerPosition().x,y:$.props.ConcernedShape.getStage().getPointerPosition().y}),t.attrs.dragBoundFunc=function(t){return{x:t.x,y:t.y}},t.attrs.isGrouped=0,this.shapes.push(t.attrs)},Remove(t){if("Line"==t.attrs.className){let e=this.groups.find((e=>e.id===t.attrs.id));const i=e.shapes_g.length;for(let t=0;t<i;t++)e.shapes_g[t].dragBoundFunc=ct,e.shapes_g[t].isGrouped=0,this.shapes.push(e.shapes_g[t]);this.eraseNodefromTransformer("lineTransformer"),this.groups.splice(this.groups.indexOf(e),1),t.getParent().destroy(),void 0!=this.groups[0]?(this.center.x=this.groups[0].line.x,this.center.y=this.groups[0].line.y):void 0!=this.shapes[0]&&(this.center.x=this.shapes[0].x,this.center.y=this.shapes[0].y),this.center.opacity=0}else if("positionPoint"==t.attrs.className){let e=t.getParent().attrs.line,i=e.positionPoints.find((e=>e.id===t.attrs.id)),s=e.freeDistances.indexOf(t.attrs.distance_to_line_center);1!=e.keepDistribution&&-1!=s&&(e.freeDistances.splice(s,1),e.positionPoints.splice(e.positionPoints.indexOf(i),1))}else{let e=this.findShape(t.attrs.id),i=e.shape_data,s=e.grp_id;if(void 0!=i){if("-1"!=s){let t=this.groups.find((t=>t.id===s));t.line.freeDistances.push(t.line.occupiedDistances[t.shapes_g.indexOf(i)]),t.line.occupiedDistances.splice(t.shapes_g.indexOf(i),1),t.shapes_g.splice(t.shapes_g.indexOf(i),1),this.updateOccupiedDistance(t.id),this.updateAllPosInGrp(t.id)}else this.eraseNodefromTransformer("shapeTransformer"),this.shapes.splice(this.shapes.indexOf(i),1),void 0!=this.groups[0]?(this.center.x=this.groups[0].line.x,this.center.y=this.groups[0].line.y):void 0!=this.shapes[0]&&(this.center.x=this.shapes[0].x,this.center.y=this.shapes[0].y),this.center.opacity=0;t.destroy()}}},RemoveAll(){let t=$.props.ConcernedShape;if("Line"==t.className){let e=this.groups.find((e=>e.id===t.attrs.id));while(0!=e.shapes_g.length)e.shapes_g[0].dragBoundFunc=ct,e.shapes_g.splice(0,1);this.eraseNodefromTransformer("lineTransformer"),this.groups.splice(this.groups.indexOf(e),1),t.getParent().destroy(),void 0!=this.groups[0]?(this.center.x=this.groups[0].line.x,this.center.y=this.groups[0].line.y):void 0!=this.shapes[0]&&(this.center.x=this.shapes[0].x,this.center.y=this.shapes[0].y)}},findShape(t){let e=this.shapes.find((e=>e.id===t)),i="-1",s=!0;void 0==e&&(s=!1);let a=0;while(!s)a<this.groups.length?(e=this.groups[a].shapes_g.find((e=>e.id===t)),void 0==e?s=!1:(i=this.groups[a].id,s=!0),a++):s=!0;return{shape_data:e,grp_id:i}},DetachShape(t,e,i){const s=this.lengthToCapture+5;let a=this.groups.find((e=>-1!=e.shapes_g.indexOf(t))),n=a.shapes_g.indexOf(t);t.dragBoundFunc=ct,console.log(a.shapes_g);let o=a.line.y-.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),r=a.line.x+.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),h=a.line.y+.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),l=a.line.x-.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),c=(h-o)/(r-l),d=t.x*(1/c)+t.y;a.line.rotation<0&&a.line.rotation>-45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-45&&a.line.rotation>-90||a.line.rotation<-90&&a.line.rotation>-135?(t.x=t.x+Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-135&&a.line.rotation>-180||a.line.rotation>135&&a.line.rotation<180?(t.x=t.x-Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>90&&a.line.rotation<=135||a.line.rotation>45&&a.line.rotation<=90?(t.x=t.x-Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>0&&a.line.rotation<=45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):-90==a.line.rotation?t.x=t.x-Math.sign(t.x-e)*s:90==a.line.rotation?t.x=t.x+Math.sign(t.x-e)*s:(180==a.line.rotation||-180==a.line.rotation||0==a.line.rotation)&&(t.y=t.y-Math.sign(t.y-i)*s),t.isGrouped=0,this.shapes.push(t),this.center.x=t.x,this.center.y=t.y,a.line.freeDistances.push(a.line.occupiedDistances[n]),a.line.occupiedDistances.splice(n,1),a.shapes_g.splice(n,1),a.line.keepDistribution&&a.line.positionPoints.splice(n,1),this.updateOccupiedDistance(a.id),this.updateAllPosInGrp(a.id),this.updateNaration(a),this.eraseNodefromTransformer("shapeTransformer")},createNewShape(t){if("Line"==t.attrs.className){this.max_id_figures=this.max_id_figures+1;let e=t.getParent().clone({id:""+this.max_id_figures,name:"group"+this.max_id_figures,shapes_g:[]});e.attrs.line.id=""+this.max_id_figures,e.attrs.line.x=t.getStage().getPointerPosition().x,e.attrs.line.y=t.getStage().getPointerPosition().y,e.attrs.line.draggable=!0,this.groups.push(e.attrs)}else{this.max_id_figures=this.max_id_figures+1;let e=t.clone({id:""+this.max_id_figures,draggable:!0});e.attrs.isGrouped=0,this.shapes.push(e.attrs)}},eraserAction(t){this.Remove(t.target)},unshowSelectedShape(t){"Line"==t.target.attrs.className&&0==this.eraseMode?t.target.opacity(.5):"Line"==t.target.attrs.className&&1==this.eraseMode?1==t.target.attrs.keepDistribution?t.target.stroke("rgb(48,48,48)"):t.target.stroke("blue"):"positionPoint"==t.target.attrs.className&&1==this.eraseMode?1!=t.target.getParent().attrs.line.keepDistribution&&t.target.strokeWidth(0):1==this.eraseMode&&t.target.strokeWidth(0)},showSelectedShape(t){if("Line"==t.target.attrs.className&&0==this.eraseMode)t.target.opacity(1);else if("Line"==t.target.attrs.className&&1==this.eraseMode)t.target.stroke("rgb(200, 59, 218)");else if("positionPoint"==t.target.attrs.className&&1==this.eraseMode){let e=t.target.getParent().attrs.line;-1!=e.freeDistances.indexOf(t.target.attrs.distance_to_line_center)&&1!=e.keepDistribution&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))}else 1==this.eraseMode&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))},editText(t){let e=t.target.getStage().attrs.container.getBoundingClientRect();document.getElementById("input").style.top=e.y+t.target.getAbsolutePosition().y+"px",document.getElementById("input").style.left=e.x+t.target.getAbsolutePosition().x-5*document.getElementById("input").size+"px",document.getElementById("input").style.display="initial",this.editedText=t.target},updateText(t){let e=this.shapes.find((t=>t.id===this.editedText.attrs.id)),i=!0;void 0==e&&(i=!1);let s=0;while(!i)s<this.groups.length?(e=this.groups[s].shapes_g.find((t=>t.id===this.editedText.attrs.id)),i=void 0!=e,s++):i=!0;if(void 0!=e){let i,s,a,n;i=this.editedText.width(),s=this.editedText.height(),e.text=t.target.value,this.editedText.text(t.target.value),a=this.editedText.width()-i,n=this.editedText.height()-s,e.offsetX=e.offsetX+a/2,e.offsetY=e.offsetY+n/2,e.length_x=this.editedText.width(),e.length_y=this.editedText.height(),document.getElementById("input").style.display="none"}},updateNaration(t){let e;1==t.line.id?(e="<strong>Substrate with id="+t.id+":</strong><br>",e=e+"- <mark class='blue'> StickyLine with id="+t.line.id+"</mark><br>"):(e="<strong>Copied substrate with id="+t.id+":</strong><br>",e=e+"- <mark class='blue'> copied StickyLine with id="+t.line.id+"</mark><br>"),e+="Relation: <i>alignement and distance with</i>:";for(let i=0;i<t.shapes_g.length;i++)e=e+"<br>- "+t.shapes_g[i].className+" with id="+t.shapes_g[i].id;e+="<br>Distance kept in memory:";for(let i=0;i<t.line.occupiedDistances.length;i++)e=e+t.line.occupiedDistances[i].toFixed(1)+",";e+="<mark class='green'>";for(let i=0;i<t.line.freeDistances.length-1;i++)e=e+t.line.freeDistances[i].toFixed(1)+",";t.line.freeDistances.length>0&&(e+=t.line.freeDistances[t.line.freeDistances.length-1].toFixed(1)),e+="</mark>",this.$emit("explain",{origin:"Substrate - Reuse<br><mark class='blue'> The substrate consists of the Stickyline and the objects that it applies to, and can be reused together. </mark>",text:e})},initialNaration(t){if(!this.narationHasBeenInitialized){let e,i="";for(let s=0;s<t.length-1;s++){e=t[s],1==e.line.id?(i=i+"<strong>Substrate with id="+e.id+":</strong><br>",i=i+"- <mark class='blue'> StickyLine with id="+e.line.id+"</mark><br>"):(i=i+"<strong>Copied substrate with id="+e.id+":</strong><br>",i=i+"- <mark class='blue'> copied StickyLine with id="+e.line.id+"</mark><br>"),i+="Relation: <i>alignement and distance with</i>:";for(let t=0;t<e.shapes_g.length;t++)i=i+"<br>- "+e.shapes_g[t].className+" with id="+e.shapes_g[t].id;i+="<br>Distance kept in memory:";for(let t=0;t<e.line.occupiedDistances.length;t++)i=i+e.line.occupiedDistances[t].toFixed(1)+",";i+="<mark class='green'>";for(let t=0;t<e.line.freeDistances.length-1;t++)i=i+e.line.freeDistances[t].toFixed(1)+",";e.line.freeDistances.length>0&&(i+=e.line.freeDistances[e.line.freeDistances.length-1].toFixed(1)),i+="</mark>",i+="<br>***<br>"}e=t[t.length-1],1==e.line.id?(i=i+"<strong>Substrate with id="+e.id+":</strong><br>",i=i+"- <mark class='blue'> StickyLine with id="+e.line.id+"</mark><br>"):(i=i+"<strong>Copied substrate with id="+e.id+":</strong><br>",i=i+"- <mark class='blue'> copied StickyLine with id="+e.line.id+"</mark><br>"),i+="Relation: <i>alignement and distance with</i>:";for(let t=0;t<e.shapes_g.length;t++)i=i+"<br>- "+e.shapes_g[t].className+" with id="+e.shapes_g[t].id;i+="<br>Distance kept in memory:";for(let t=0;t<e.line.occupiedDistances.length;t++)i=i+e.line.occupiedDistances[t].toFixed(1)+",";i+="<mark class='green'>";for(let t=0;t<e.line.freeDistances.length-1;t++)i=i+e.line.freeDistances[t].toFixed(1)+",";e.line.freeDistances.length>0&&(i+=e.line.freeDistances[e.line.freeDistances.length-1].toFixed(1)),i+="</mark>",this.narationHasBeenInitialized=!0,this.$emit("explain",{origin:"Substrate - Reuse<br><mark class='blue'> The substrate consists of the Stickyline and the objects that it applies to, and can be reused together. </mark>",text:i}),$.props.CopiedShape=void 0}},stopInitialisation(t){console.log("stop"),this.narationHasBeenInitialized=!0,t.stopPropagation()}}};const gt=(0,f.Z)(dt,[["render",lt]]);var pt=gt;function ut(t,e,i,s,n,o){const r=(0,a.up)("v-rect"),h=(0,a.up)("v-circle"),l=(0,a.up)("v-image"),c=(0,a.up)("v-text"),d=(0,a.up)("v-regular-polygon"),g=(0,a.up)("v-line"),p=(0,a.up)("v-group"),u=(0,a.up)("v-transformer"),f=(0,a.up)("v-layer"),M=(0,a.up)("v-stage");return(0,a.wg)(),(0,a.iD)("div",{onClick:e[0]||(e[0]=(...e)=>t.HideContextMenu&&t.HideContextMenu(...e)),id:"ReificationSubstrateDemo",onMousedown:e[1]||(e[1]=t=>o.updateNaration(this.groups[0]))},[(0,a.Wm)(M,{ref:"stage",id:"stage",config:n.stageSize,onDragmove:o.update,onMousedown:o.handleTransformation,onTouchstart:o.handleTransformation,onFusion:o.makeGroup,onContextMenu:t.DisplayContextMenu},{default:(0,a.w5)((()=>[(0,a.Wm)(f,{ref:"layer"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.groups,(t=>((0,a.wg)(),(0,a.j4)(p,{ref_for:!0,ref:"groups",key:t.id,config:t},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Rect"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(r,{key:e.id,config:e,onTransformend:o.updateTransformedShape,onDragend:e=>o.updatePosInGrp(e,t.id),onDragmove:o.CheckIfNeedToDetach,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Circle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(h,{key:e.id,config:e,onTransformend:o.updateTransformedShape,onDragend:e=>o.updatePosInGrp(e,t.id),onDragmove:o.CheckIfNeedToDetach,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Image"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(l,{key:e.id,config:e,onTransformend:o.updateTransformedShape,onDragend:e=>o.updatePosInGrp(e,t.id),onDragmove:o.CheckIfNeedToDetach,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Text"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(c,{key:e.id,config:e,onTransformend:o.updateTransformedShape,onDragend:e=>o.updatePosInGrp(e,t.id),onDragmove:o.CheckIfNeedToDetach,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape,onDblclick:o.editText},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout","onDblclick"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Triangle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(d,{key:e.id,config:e,onTransformend:o.updateTransformedShape,onDragend:e=>o.updatePosInGrp(e,t.id),onDragmove:o.CheckIfNeedToDetach,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(),(0,a.j4)(g,{key:t.line.id,config:t.line,onTransformend:o.updateTransformedShape,onDragmove:e=>o.updateGrp(e,t.id),onMouseout:o.unshowSelectedShape,onMouseenter:o.showSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseout","onMouseenter"])),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.line.positionPoints,(t=>((0,a.wg)(),(0,a.j4)(h,{key:t.id,config:t,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onMouseenter","onMouseout"])))),128))])),_:2},1032,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.shapes.filter((t=>"Rect"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(r,{key:t.id,config:t,onTransformend:o.updateTransformedShape,onDragmove:o.updatePos,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.shapes.filter((t=>"Circle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(h,{key:t.id,config:t,onTransformend:o.updateTransformedShape,onDragmove:o.updatePos,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.shapes.filter((t=>"Triangle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(d,{key:t.id,config:t,onTransformend:o.updateTransformedShape,onDragmove:o.updatePos,onMouseenter:o.showSelectedShape,onMouseout:o.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.transformers,(t=>((0,a.wg)(),(0,a.j4)(u,{key:t.id,config:t},null,8,["config"])))),128)),((0,a.wg)(),(0,a.j4)(h,{key:n.center.id,config:n.center,onDragend:o.ChangeCenter,onClick:t.DisplayCenterMenu},null,8,["config","onDragend","onClick"]))])),_:1},512)])),_:1},8,["config","onDragmove","onMousedown","onTouchstart","onFusion","onContextMenu"])],32)}const ft=function(t){let e=this.getStage().width(),i=this.getStage().height(),s=10;return t.x>e-s&&t.y>i-s?{x:e-s,y:i-s}:t.x>e-s&&t.y<s?{x:e-s,y:s}:t.y>i-s&&t.x<s?{x:s,y:i-s}:t.x<s&&t.y<s?{x:s,y:s}:t.x<s?{x:s,y:t.y}:t.y<s?{x:t.x,y:s}:t.x>e-s?{x:e-s,y:t.y}:t.y>i-s?{x:t.x,y:i-s}:{x:t.x,y:t.y}};var Mt={props:{width:{type:Number,default:window.innerWidth},height:{type:Number,default:window.innerHeight}},components:{},data(){return{stageSize:{width:this.width,height:this.height},lengthToCapture:10,lengthToDetach:15,editedText:null,eraseMode:0,selectedShapeAlignment:"",needMenu:"initial",isALineSelected:!1,isAGroupedShapeSelected:!1,isStageOnlySelected:!1,keepDistanceButtonText:"Liberate Distribution",max_id_figures:6,groups:[{name:"group",className:"Group",id:"1",x:0,y:0,offsetX:0,offsetY:0,rotation:0,draggable:!1,shapes_g:[{rotation:0,x:30,y:220,scaleX:1,scaleY:1,offsetX:0,offsetY:40,radius:40,fill:"orange",strokeWidth:0,stroke:"black",draggable:!0,isGrouped:1,className:"Circle",personalRotation:0,id:"6",dragBoundFunc:ft,centerPosition:"Bottom"},{rotation:0,id:"8",x:150,y:220,width:70,height:70,scaleX:1,scaleY:1,strokeWidth:0,stroke:"black",fill:"green",name:"rect2",draggable:!0,className:"Rect",isGrouped:0,dragBoundFunc:ft,offsetX:35,offsetY:70,personalRotation:0,centerPosition:"Bottom"},{rotation:0,id:"7",x:250,y:220,sides:3,radius:45,width:90,height:90,scaleX:1,scaleY:1,strokeWidth:0,stroke:"black",fill:"purple",name:"triangle1",draggable:!0,className:"Triangle",isGrouped:0,dragBoundFunc:ft,offsetX:0,offsetY:22.5,personalRotation:0,centerPosition:"Bottom"}],aShapeHasBeenDetach:0,line:{x:150,y:220,points:[0,0,0,0,250,0],positionPoints:[{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint1",distance_to_line_center:void 0},{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint2",distance_to_line_center:void 0},{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint3",distance_to_line_center:void 0}],strokeWidth:10,rotation:0,tension:0,closed:!0,draggable:!0,scaleX:1,scaleY:1,opacity:.5,offset:{x:125,y:0},name:"ligne",className:"Line",stroke:"red",id:"1",keepDistribution:!1,freeDistances:[],occupiedDistances:[-95,-15,100],keepDistanceButtonText:"Liberate Distribution",defaultAlignment:"Bottom",dragBoundFunc:ft}}],transformers:[{id:"lineTransformer",enabledAnchors:[],rotateEnabled:!1,borderEnabled:!1,flipEnabled:!1,nodes:[]},{id:"shapeTransformer",nodes:[]}],shapes:[],center:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:4,fill:"black",opacity:1,draggable:!0,isGrouped:0,className:"Circle",id:"center",dragBoundFunc:ft},positionPoint:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint",distance_to_line_center:void 0},selectedShapeId:""}},mounted(){let t=this.$refs.stage.getStage().getChildren()[0].getChildren().filter((t=>"Text"==t.attrs.className));for(let a=0;a<t.length;a++)t[a].attrs.length_x=t[a].width(),t[a].attrs.length_y=t[a].height(),t[a].offsetX(t[a].attrs.length_x/2);let e=this.groups[0],i=e.line,s=e.shapes_g;for(let a=0;a<s.length;a++)this.updateDragFunc(s[a],i),this.updateAllPosInGrp(e.id)},created(){this.max_id_figures=this.shapes.length+this.groups.length},methods:{switchEraseMode(){0==this.eraseMode?(this.eraseMode=1,document.getElementById("playground").style.cursor="url("+i(843)+"),default",this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer")):(this.eraseMode=0,document.getElementById("playground").style.cursor="default")},checkIfShapesOnLine(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;let a=0;while(a<s.length)this.isCoordinateOnLine(s[a].x,s[a].y,i.id)?a+=1:(console.log("a shape is not on a line"),s[a].dragBoundFunc=ft,s[a].isGrouped=0,i.positionPoints.splice(a,1),this.shapes.push(s[a]),i.freeDistances.push(i.occupiedDistances[a]),i.occupiedDistances.splice(a,1),s.splice(a,1),this.updateNaration(e))},isCoordinateOnLine(t,e,i){const s=this.groups.find((t=>t.id===i)),a=s.line;let n=!0,o=a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),r=a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),h=a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),l=a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),c=(o-h)/(l-r),d=a.y-c*a.x;return n=Math.abs(r-l)>1?Math.abs(c*t+d-e)>1:Math.abs(t-a.x)>1,!(n||(a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0||!n&&Math.sqrt((a.x-t)**2+(a.y-e)**2)>a.points[4]*a.scaleX/2)},updateGrp(t,e){const i=this.groups.find((t=>t.id===e)),s=i.line;i.offsetX=s.offsetX,i.offsetY=s.offsetY,s.x=t.target.x(),s.y=t.target.y(),this.center.x=s.x,this.center.y=s.y,this.updateAllPosInGrp(s.id),this.checkIfShapesOnLine(s.id)},updateAllPosInGrp(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;for(let n=0;n<s.length;n++)i.keepDistribution,s[n].x=i.x+i.occupiedDistances[n]*Math.cos(i.rotation*(Math.PI/180)),s[n].y=i.y+i.occupiedDistances[n]*Math.sin(i.rotation*(Math.PI/180)),s[n].distance_to_line_center=i.occupiedDistances[n],s[n].rotation=s[n].personalRotation+i.rotation,i.positionPoints[n].x=s[n].x,i.positionPoints[n].y=s[n].y,i.positionPoints[n].distance_to_line_center=s[n].distance_to_line_center;let a=s.length;while(a<i.positionPoints.length)i.keepDistribution?i.positionPoints.splice(a,1):(i.positionPoints[a].x=i.x+i.freeDistances[a-s.length]*Math.cos(i.rotation*(Math.PI/180)),i.positionPoints[a].y=i.y+i.freeDistances[a-s.length]*Math.sin(i.rotation*(Math.PI/180)),i.positionPoints[a].distance_to_line_center=i.freeDistances[a-s.length],a++)},isOutsideTheLine(t,e){let i=e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180)),s=e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180)),a=e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180)),n=e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180)),o=(i-a)/(n-s),r=e.y-o*e.x,h=!1;return h=Math.abs(s-n)>=1?Math.abs(o*t.x+r-t.y)<1:Math.abs(t.x-e.x)<1,!h||(e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=0&&e.rotation*(Math.PI/180)>-Math.PI/2||(e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=0&&e.rotation*(Math.PI/180)>-Math.PI/2||(e.y+.5*e.points[4]*e.scaleX*Math.sin(Math.PI+e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(Math.PI+e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=-Math.PI/2&&e.rotation*(Math.PI/180)>-Math.PI||(e.x+.5*e.points[4]*e.scaleX*Math.cos(Math.PI+e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(Math.PI+e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=-Math.PI/2&&e.rotation*(Math.PI/180)>-Math.PI||(e.y+.5*e.points[4]*e.scaleX*Math.sin(Math.PI-e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(Math.PI-e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=Math.PI&&e.rotation*(Math.PI/180)>Math.PI/2||(e.x+.5*e.points[4]*e.scaleX*Math.cos(Math.PI-e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(Math.PI-e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=Math.PI&&e.rotation*(Math.PI/180)>Math.PI/2||(e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=Math.PI/2&&e.rotation*(Math.PI/180)>=0||(e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=Math.PI/2&&e.rotation*(Math.PI/180)>=0},update(){const t=this.shapes;let e=!1;for(let i=0;i<t.length;i++){let s=t[i].x,a=t[i].y;for(let n=0;n<this.groups.length;n++){let o=this.groups[n].line,r=o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),h=o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),l=o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),c=o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),d=(r-l)/(c-h),g=o.y-d*o.x;e=Math.abs(h-c)>1?Math.abs(d*s+g-a)<=this.lengthToCapture:Math.abs(s-o.x)<=this.lengthToCapture,(e&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=0&&o.rotation*(Math.PI/180)>-Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=-Math.PI/2&&o.rotation*(Math.PI/180)>=-Math.PI||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI&&o.rotation*(Math.PI/180)>Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI/2&&o.rotation*(Math.PI/180)>=0)&&(t[i].isGrouped=1,this.makeGroup(o.id))}}},CheckIfNeedToDetach(t){let e=this.groups.find((e=>e.id===t.target.getParent().attrs.id)),i=e.shapes_g.find((e=>e.id==t.target.id())),s=Math.sqrt((t.target.getStage().getPointerPosition().y-t.target.y())**2+(t.target.getStage().getPointerPosition().x-t.target.x())**2);"Rect"==t.target.className?s-=t.target.attrs.height*t.target.attrs.scaleY:"Circle"==t.target.className?s-=2*t.target.attrs.radius*t.target.attrs.scaleY:"Text"==t.target.className?s-=t.target.attrs.length_y*t.target.attrs.scaleY:("Image"==t.target.className||"Triangle"==t.target.attrs.className)&&(s-=t.target.height()*t.target.scaleY()),s>50&&(this.groups.find((e=>e.id===t.target.getParent().attrs.id)).aShapeHasBeenDetach=1,this.DetachShape(i,t.target.getStage().getPointerPosition().x,t.target.getStage().getPointerPosition().y))},GiveSignOfDistance(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(a)<=this.lengthToCapture&&-90==e.rotation?-Math.sign(n):Math.abs(a)<=this.lengthToCapture&&90==e.rotation?Math.sign(n):Math.sign(a),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},GiveSignOfDistanceBtwCenterAndShape(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(n)<=this.lengthToCapture&&-90==e.rotation?Math.sign(a):Math.abs(n)<=this.lengthToCapture&&90==e.rotation?-Math.sign(a):Math.sign(n),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},makeGroup(t){this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer");const e=this.groups.find((e=>e.id===t)),i=e.line,s=this.shapes;i.freeDistances.sort(this.isSmaller),s.sort(this.isBeforeRegardingX);for(let a=0;a<s.length;a++)if(1==s[a].isGrouped){const n=Object.assign({},this.positionPoint);let o=s[a].x-i.x,r=s[a].y-i.y;s[a].personalRotation=0,s[a].distance_to_line_center=this.GiveSignOfDistance(s[a],i)*Math.sqrt(o**2+r**2),Math.abs(s[a].distance_to_line_center)>=i.points[4]*i.scaleX/2&&(s[a].distance_to_line_center=Math.sign(s[a].distance_to_line_center)*i.points[4]*i.scaleX/2),this.ChangeCenterRegardingCommand(s[a].id,e.line.defaultAlignment),this.updateDragFunc(s[a],i),e.shapes_g.push(s[a]),console.log("no 'free distance' anymore"),e.line.occupiedDistances.push(s[a].distance_to_line_center),n.id="positionPoint"+e.id+e.line.positionPoints.length,e.line.positionPoints.push(n),console.log("A new shape has been added with a distance"+s[a].distance_to_line_center),this.updateOccupiedDistance(i.id),this.updateAllPosInGrp(t),s.splice(a,1),this.updateNaration(e)}this.center.x=i.x,this.center.y=i.y},updateOccupiedDistance(t){const e=this.groups.find((e=>e.id===t));if(this.sortByDistToLineCenter(e),e.line.keepDistribution){let t=e.line.points[4],i=e.shapes_g.length,s=t/(i-1)*e.line.scaleX;if(i%2==0){for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[t-1]=-(i/2-1-t+1)*s-s/2;for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[i/2+t]=t*s+s/2;e.line.occupiedDistances[i/2-1]=-s/2,e.line.occupiedDistances[i/2]=s/2}else{for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[t-1]=-s*((i-1)/2-t+1);for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[(i-1)/2+t]=s*t;e.line.occupiedDistances[(i-1)/2]=0}for(let a=0;a<e.shapes_g.length;a++)e.shapes_g[a].distance_to_line_center=e.line.occupiedDistances[a]}else e.line.occupiedDistances.sort(this.isSmaller)},isSmaller(t,e){return t<e?-1:1},isBeforeRegardingX(t,e){return t.x<e.x?-1:1},updateOccDist(t,e){let i=this.isNearest(t.line,e);if(i.isFree){e.distance_to_line_center=t.line.freeDistances[i.indice],t.line.freeDistances.splice(i.indice,1),this.sortByDistToLineCenter(t);for(let e=0;e<t.shapes_g.length;e++)t.line.occupiedDistances.length==e?t.line.occupiedDistances.push(t.shapes_g[e].distance_to_line_center):t.line.occupiedDistances[e]=t.shapes_g[e].distance_to_line_center}else t.shapes_g.find((t=>t.id==e.id)).distance_to_line_center=t.line.occupiedDistances[i.indice],t.line.occupiedDistances.splice(i.indice,1),this.updateOccDist(t,t.shapes_g[i.indice])},isNearest(t,e){let i,s=t.x+t.freeDistances[0]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[0]*Math.sin(t.rotation*(Math.PI/180)),n=Math.sqrt((s-e.x)**2+(a-e.y)**2),o=0;for(let r=1;r<t.freeDistances.length;r++)s=t.x+t.freeDistances[r]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[r]*Math.sin(t.rotation*(Math.PI/180)),i=Math.sqrt((s-e.x)**2+(a-e.y)**2),i<n&&(n=i,o=r);return o},sortByDistToLineCenter(t){if(t.line.keepDistribution)for(let e=0;e<t.shapes_g.length;e++){let i=t.shapes_g[e].x-t.line.x,s=t.shapes_g[e].y-t.line.y;t.shapes_g[e].distance_to_line_center=this.GiveSignOfDistance(t.shapes_g[e],t.line)*Math.sqrt(i**2+s**2)}for(let e=1;e<t.shapes_g.length;e++){let i=t.shapes_g[e],s=e;while(s>0&&t.shapes_g[s-1].distance_to_line_center>i.distance_to_line_center)t.shapes_g[s]=t.shapes_g[s-1],s-=1;t.shapes_g[s]=i}},sortAnyShapesByDistToLineCenter(t,e){for(let i=0;i<t.length;i++){let s=t[i].x-e.x,a=t[i].y-e.y;t.distance_to_line_center=this.GiveSignOfDistance(t,e)*Math.sqrt(s**2+a**2)}for(let i=1;i<t.length;i++){let e=t[i],s=i;while(s>0&&t[s-1].distance_to_line_center>e.distance_to_line_center)t[s]=t[s-1],s-=1;t[s]=e}},updateDragFunc(t,e){let i=e.rotation*(Math.PI/180);i<=0&&i>=-Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.y-e.y)*Math.cos(i),y:e.y-(t.y-e.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.x-e.x)*Math.cos(i),y:e.y-(t.x-e.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.y-e.y)*Math.cos(i),y:e.y+(t.y-e.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}})},updatePos(t){const e=this.shapes.find((e=>e.id===t.target.id()));e.x=t.target.x(),e.y=t.target.y(),this.center.x=t.target.x(),this.center.y=t.target.y();let i={x:e.x,y:e.y};t.target.position(i),t.target.getLayer().batchDraw()},updatePosInGrp(t,e){let i,s,a;const n=this.groups.find((t=>t.id===e));if(1==n.aShapeHasBeenDetach)return void(n.aShapeHasBeenDetach=0);const o=n.line,r=n.shapes_g.find((e=>e.id===t.target.id())),h=n.shapes_g;if(1==r.needToBeDetach&&(r.needToBeDetach=0,this.DetachShape(r),this.updateAllPosInGrp(t.target.getParent().attrs.id)),o.keepDistribution){if(this.isCoordinateOnLine(t.target.x(),t.target.y(),o.id)){i=r.x-t.target.x(),s=r.y-t.target.y();let e=n.line.points[4],a=n.shapes_g.length,l=e/(a-1)*n.line.scaleX,c=Math.sqrt(i**2+s**2);c>=l?(r.x=t.target.x(),r.y=t.target.y(),this.updateOccupiedDistance(o.id),r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation,this.updateAllPosInGrp(o.id)):(r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation)}else r.x=t.target.x(),r.y=t.target.y();o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center}else o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,r.x=t.target.x(),r.y=t.target.y(),0==Math.sin(o.rotation*(Math.PI/180))?a=r.x-o.x:(a=0!=Math.sign(r.x-o.x)?Math.sign(-r.rotation)*Math.sign(r.x-o.x)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2):Math.sign(-r.rotation)*Math.sign(r.y-o.y)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2),(r.rotation*(Math.PI/180)<=-Math.PI/2||r.rotation*(Math.PI/180)<=Math.PI/2&&r.rotation*(Math.PI/180)>=0)&&(a=-a)),o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center;let l={x:r.x,y:r.y};if(this.center.x=r.x,this.center.y=r.y,t.target.position(l),t.target.getLayer().batchDraw(),this.isCoordinateOnLine(r.x,r.y,o.id))o.keepDistribution?n.line.occupiedDistances[h.indexOf(r)]=r.distance_to_line_center:n.line.occupiedDistances[h.indexOf(r)]=a,o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center;else{r.dragBoundFunc=ft,r.isGrouped=0,this.shapes.push(r);for(let t=0;t<h.length;t++)h[t].id==r.id&&(o.freeDistances.push(o.occupiedDistances[t]),o.occupiedDistances.splice(t,1),o.positionPoints.splice(t,1),h.splice(t,1),console.log("a shape has been removed from the line"))}o.keepDistribution&&this.updateOccupiedDistance(o.id),this.updateAllPosInGrp(o.id)},updateTransformedShape(t){let e,i;if("Line"==t.target.className)i=this.groups.find((t=>t.id===this.selectedShapeId)).line;else if(e=this.findShape(this.selectedShapeId),i=e.shape_data,void 0==i)return;let s=i.x,a=i.y;i.x=t.target.x(),i.y=t.target.y(),i.rotation=t.target.rotation();let n=i.scaleX;if(i.scaleX=t.target.scaleX(),i.scaleY=t.target.scaleY(),"Line"==t.target.className){const e=this.groups.find((t=>t.id===i.id));if(i.keepDistribution){for(let t=0;t<i.occupiedDistances.length;t++)i.occupiedDistances[t]=i.occupiedDistances[t]/n*i.scaleX;this.update(),this.updateGrp(t),this.checkIfShapesOnLine(this.selectedShapeId)}else{if(n!=i.scaleX){for(let t=0;t<e.shapes_g.length;t++){let n=e.shapes_g[t].x-i.x,o=e.shapes_g[t].y-i.y;0==Math.sign(e.line.occupiedDistances[t])?e.line.occupiedDistances[t]=this.GiveSignOfDistance(e.shapes_g[t],i)*Math.sqrt(n**2+o**2):e.line.occupiedDistances[t]=Math.sign(e.line.occupiedDistances[t])*Math.sqrt(n**2+o**2),Math.sign(e.shapes_g[t].x-s)!=Math.sign(n)&&0!=Math.sign(e.shapes_g[t].x-s)&&90!=e.line.rotation&&-90!=e.line.rotation&&(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t]),Math.sign(e.shapes_g[t].y-a)==Math.sign(o)||0==Math.sign(e.shapes_g[t].y-a)||90!=e.line.rotation&&-90!=e.line.rotation||(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t])}for(let t=0;t<i.freeDistances.length;t++){let e=s-i.x,n=a-i.y,o=Math.sqrt(e**2+n**2);i.rotation<-90||i.rotation>90?i.freeDistances[t]=i.freeDistances[t]-Math.sign(s-i.x)*o:90==i.rotation||-90==i.rotation?i.freeDistances[t]=i.freeDistances[t]-n:i.freeDistances[t]=i.freeDistances[t]+Math.sign(s-i.x)*o}}this.update(),this.updateGrp(t),this.checkIfShapesOnLine(this.selectedShapeId);let o=0;while(o<i.freeDistances.length)if(i.points[4]*i.scaleX*.5+2<Math.abs(i.freeDistances[o])){let t=i.positionPoints.find((t=>t.distance_to_line_center==i.freeDistances[o])),e=i.positionPoints.indexOf(t);i.positionPoints.splice(e,1),i.freeDistances.splice(o,1)}else o+=1}for(let t=0;t<e.shapes_g.length;t++)this.updateDragFunc(e.shapes_g[t],i);for(let t=0;t<e.line.positionPoints.length;t++)this.updateDragFunc(e.line.positionPoints[t],i)}else"-1"!=e.grp_id?(this.groups.find((t=>t.id===e.grp_id)).shapes_g.find((e=>e.id===t.target.id())).personalRotation=t.target.rotation()-t.target.getParent().attrs.line.rotation,this.updateAllPosInGrp(e.grp_id),this.updateOccupiedDistance(e.grp_id),t.target.x(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).x),t.target.y(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).y),this.checkIfShapesOnLine(e.grp_id),this.updateDragFuncOfCenter()):(this.update(),this.updateDragFuncOfCenter());this.center.x=t.target.attrs.x,this.center.y=t.target.attrs.y},handleTransformation(t){if(void 0==t.evt)return;if(t.target===t.target.getStage())return this.selectedShapeId="NoId",this.eraseNodefromTransformer("lineTransformer"),this.eraseNodefromTransformer("shapeTransformer"),void(this.center.visible=!1);const e="Transformer"===t.target.getParent().className;if(e)return;const i=t.target.id();let s,a=this.findShape(i).shape_data;"center"!=t.target.attrs.id&&"positionPoint"!=t.target.attrs.className&&("Line"==t.target.className?(s="lineTransformer",a=this.groups.find((t=>t.id===i)).line,this.center.draggable=!1,this.selectedShapeAlignment=a.defaultAlignment,this.eraseNodefromTransformer("shapeTransformer")):(s="shapeTransformer",this.center.draggable=!0,this.selectedShapeAlignment=a.centerPosition,this.eraseNodefromTransformer("lineTransformer")),void 0!=a?(this.selectedShapeId=i,this.center.visible=!0,this.updateTransformer(s)):this.selectedShapeId="NoId",this.updateDragFuncOfCenter())},eraseNodefromTransformer(t){let e=this.$refs.stage.getStage();const i=e.find("#"+t)[0];i.nodes([])},updateTransformer(t){let e,i=this.$refs.stage.getStage(),s=i.find("#"+t)[0];if("lineTransformer"==t)e=i.children[0].getChildren().filter((t=>"Group"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0].getChildren().filter((t=>"Line"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];else{e=i.children[0].getChildren().filter((t=>"Group"!=t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];let t=!0;void 0==e&&(t=!1);let s=0;while(!t)s<this.groups.length?(e=i.children[0].getChildren().filter((t=>"Group"==t.attrs.className))[s].getChildren().find((t=>t.attrs.id==this.selectedShapeId&&"Line"!=t.attrs.className)),t=void 0!=e,s++):t=!0}e!==s.node()&&(void 0!=e?s.nodes([e]):s.nodes([]),this.center.x=e.attrs.x,this.center.y=e.attrs.y)},ChangeCenter(t){let e,i,s=this.findShape(this.selectedShapeId),a=s.shape_data,n=this.GiveSignOfDistanceBtwCenterAndShape(t.target.attrs,a)*Math.sqrt((t.target.y()-a.y)**2+(t.target.x()-a.x)**2)+a.offsetY*a.scaleY,o=a.offsetY;void 0==a?a=this.groups.find((t=>t.id==this.selectedShapeId)).line:("Rect"==a.className?(e=a.height*a.scaleY/3,i=a.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.width/2,a.offsetY=a.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.width/2,a.offsetY=a.height,a.centerPosition="Bottom"):(a.offsetX=a.width/2,a.offsetY=0,a.centerPosition="Top")):"Circle"==a.className?(n+=a.radius*a.scaleY,e=a.radius*a.scaleY*2/3,i=a.radius*a.scaleY*4/3,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0,a.centerPosition="Middle"):n>i?(a.offsetX=0,a.offsetY=a.radius,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")):"Image"==a.className?(e=a.image.height*a.scaleY/3,i=a.image.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height,a.centerPosition="Bottom"):(a.offsetX=a.image.width/2,a.offsetY=0,a.centerPosition="Top")):"Text"==a.className?(e=a.length_y*a.scaleY/3,i=a.length_y*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y,a.centerPosition="Bottom"):(a.offsetX=a.length_x/2,a.offsetY=0,a.centerPosition="Top")):"Triangle"==a.className&&(n+=a.radius*a.scaleY,e=a.radius*a.scaleY/2,i=a.radius*a.scaleY*5/4,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0):n>i?(a.offsetX=0,a.offsetY=a.radius/2,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")),a.y=a.y-(o-a.offsetY)*a.scaleY*Math.cos(a.rotation*(Math.PI/180)),a.x=a.x+(o-a.offsetY)*a.scaleY*Math.sin(a.rotation*(Math.PI/180)),this.selectedShapeAlignment=a.centerPosition,"-1"!=s.grp_id&&this.updateAllPosInGrp(s.grp_id),t.target.x(a.x),t.target.y(a.y))},ChangeCenterRegardingCommand(t,e){let i=this.findShape(t),s=i.shape_data,a=s.offsetY;"Rect"==s.className?"Top"==e?(s.offsetY=0,s.offsetX=s.width/2):"Middle"==e?(s.offsetX=s.width/2,s.offsetY=s.height/2):"Bottom"==e&&(s.offsetX=s.width/2,s.offsetY=s.height):"Circle"==s.className?"Top"==e?(s.offsetX=0,s.offsetY=-s.radius):"Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e&&(s.offsetX=0,s.offsetY=s.radius):"Image"==s.className?"Middle"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height/2):"Bottom"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height):"Top"==e&&(s.offsetX=s.image.width/2,s.offsetY=0):"Text"==s.className?"Middle"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y/2):"Bottom"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y):"Top"==e&&(s.offsetX=s.length_x/2,s.offsetY=0):"Triangle"==s.className&&("Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e?(s.offsetX=0,s.offsetY=s.radius/2):"Top"==e&&(s.offsetX=0,s.offsetY=-s.radius)),s.centerPosition=e,s.y=s.y-(a-s.offsetY)*s.scaleY*Math.cos(s.rotation*(Math.PI/180)),s.x=s.x+(a-s.offsetY)*s.scaleY*Math.sin(s.rotation*(Math.PI/180)),"-1"!=i.grp_id&&this.updateAllPosInGrp(i.grp_id)},updateDragFuncOfCenter(){let t=this.findShape(this.selectedShapeId).shape_data,e=this.center,i=t.rotation*(Math.PI/180);i>=-Math.PI/2&&i<=0?i-=Math.PI/180*90:i<-Math.PI/2?(i+=Math.PI/2,i=Math.PI+i):i<=Math.PI&&i>0&&(i-=Math.PI/180*90),i<=0&&i>=-Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.y-t.y)*Math.cos(i),y:t.y-(e.y-t.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.x-t.x)*Math.cos(i),y:t.y-(e.x-t.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.y-t.y)*Math.cos(i),y:t.y+(e.y-t.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}})},MovingCenter(){},findShape(t){let e=this.shapes.find((e=>e.id===t)),i="-1",s=!0;void 0==e&&(s=!1);let a=0;while(!s)a<this.groups.length?(e=this.groups[a].shapes_g.find((e=>e.id===t)),void 0==e?s=!1:(i=this.groups[a].id,s=!0),a++):s=!0;return{shape_data:e,grp_id:i}},DetachShape(t,e,i){const s=this.lengthToCapture+5;let a=this.groups.find((e=>-1!=e.shapes_g.indexOf(t))),n=a.shapes_g.indexOf(t);t.dragBoundFunc=ft;let o=a.line.y-.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),r=a.line.x+.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),h=a.line.y+.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),l=a.line.x-.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),c=(h-o)/(r-l),d=t.x*(1/c)+t.y;a.line.rotation<0&&a.line.rotation>-45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-45&&a.line.rotation>-90||a.line.rotation<-90&&a.line.rotation>-135?(t.x=t.x+Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-135&&a.line.rotation>-180||a.line.rotation>135&&a.line.rotation<180?(t.x=t.x-Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>90&&a.line.rotation<=135||a.line.rotation>45&&a.line.rotation<=90?(t.x=t.x-Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>0&&a.line.rotation<=45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):-90==a.line.rotation?t.x=t.x-Math.sign(t.x-e)*s:90==a.line.rotation?t.x=t.x+Math.sign(t.x-e)*s:(180==a.line.rotation||-180==a.line.rotation||0==a.line.rotation)&&(t.y=t.y-Math.sign(t.y-i)*s),t.isGrouped=0,this.shapes.push(t),this.center.x=t.x,this.center.y=t.y,a.line.freeDistances.push(a.line.occupiedDistances[n]),a.line.occupiedDistances.splice(n,1),a.shapes_g.splice(n,1),a.line.positionPoints.splice(n,1),this.updateOccupiedDistance(a.id),this.updateAllPosInGrp(a.id),this.updateNaration(a),this.eraseNodefromTransformer("shapeTransformer")},createNewShape(t){if("Line"==t.attrs.className){this.max_id_figures=this.max_id_figures+1;let e=t.getParent().clone({id:""+this.max_id_figures,name:"group"+this.max_id_figures,shapes_g:[]});e.attrs.line.id=""+this.max_id_figures,e.attrs.line.x=t.getStage().getPointerPosition().x,e.attrs.line.y=t.getStage().getPointerPosition().y,e.attrs.line.draggable=!0,this.groups.push(e.attrs)}else{this.max_id_figures=this.max_id_figures+1;let e=t.clone({id:""+this.max_id_figures,draggable:!0});e.attrs.isGrouped=0,this.shapes.push(e.attrs)}},eraserAction(t){this.Remove(t.target)},unshowSelectedShape(t){"Line"==t.target.attrs.className&&0==this.eraseMode?t.target.opacity(.5):"Line"==t.target.attrs.className&&1==this.eraseMode?1==t.target.attrs.keepDistribution?t.target.stroke("rgb(48,48,48)"):t.target.stroke("blue"):"positionPoint"==t.target.attrs.className&&1==this.eraseMode?1!=t.target.getParent().attrs.line.keepDistribution&&t.target.strokeWidth(0):1==this.eraseMode&&t.target.strokeWidth(0)},showSelectedShape(t){if("Line"==t.target.attrs.className&&0==this.eraseMode)t.target.opacity(1);else if("Line"==t.target.attrs.className&&1==this.eraseMode)t.target.stroke("rgb(200, 59, 218)");else if("positionPoint"==t.target.attrs.className&&1==this.eraseMode){let e=t.target.getParent().attrs.line;-1!=e.freeDistances.indexOf(t.target.attrs.distance_to_line_center)&&1!=e.keepDistribution&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))}else 1==this.eraseMode&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))},editText(t){let e=t.target.getStage().attrs.container.getBoundingClientRect();document.getElementById("input").style.top=e.y+t.target.getAbsolutePosition().y+"px",document.getElementById("input").style.left=e.x+t.target.getAbsolutePosition().x-5*document.getElementById("input").size+"px",document.getElementById("input").style.display="initial",this.editedText=t.target},updateText(t){let e=this.shapes.find((t=>t.id===this.editedText.attrs.id)),i=!0;void 0==e&&(i=!1);let s=0;while(!i)s<this.groups.length?(e=this.groups[s].shapes_g.find((t=>t.id===this.editedText.attrs.id)),i=void 0!=e,s++):i=!0;if(void 0!=e){let i,s,a,n;i=this.editedText.width(),s=this.editedText.height(),e.text=t.target.value,this.editedText.text(t.target.value),a=this.editedText.width()-i,n=this.editedText.height()-s,e.offsetX=e.offsetX+a/2,e.offsetY=e.offsetY+n/2,e.length_x=this.editedText.width(),e.length_y=this.editedText.height(),document.getElementById("input").style.display="none"}},updateNaration(t){let e="<strong>Substrate :</strong><br>";e+="- <mark class='red'> StickyLine </mark><br>",e+="Relation: <i>alignement with</i>:";for(let i=0;i<t.shapes_g.length;i++)e=e+"<br>- "+t.shapes_g[i].className;this.$emit("explain",{origin:"Substrate - Reification<br><mark class='red'> The Stickyline preserves the relationship of alignment with objects into a substrate. </mark>",text:e})}}};const xt=(0,f.Z)(Mt,[["render",ut]]);var yt=xt;const Pt={id:"box"},mt=["innerHTML"];function It(t,e,i,s,n,o){return(0,a.wg)(),(0,a.iD)("div",Pt,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.sentences,(t=>((0,a.wg)(),(0,a.iD)("p",{id:"narativebox",key:t,innerHTML:t},null,8,mt)))),128))])}var _t={props:["textsForNaration"],data(){return{sentences:this.textsForNaration}}};const Dt=(0,f.Z)(_t,[["render",It]]);var Tt=Dt,St={name:"InstrumentalInteractionTableView",components:{ReificationDemo:H,ReuseDemo:V,PolymorphismDemo:st,PolymorphismSubstrateDemo:ht,ReuseSubstrateDemo:pt,ReificationSubstrateDemo:yt,NarativeBox:Tt},created(){this.width=300,this.height=260},updated(){let t=document.getElementsByClassName("narativeBox")[0];t.scrollTop=t.scrollHeight},data(){return{naration:[],last_origin:"",last_text:""}},methods:{addExplanation(t){let e=t.text;t.origin!=this.last_origin?(this.last_origin=t.origin,this.last_text=e,this.naration.splice(0,this.naration.length),this.naration.push(t.origin+" :<br>"),this.naration.push(e)):e!=this.last_text&&(this.naration.push("***"),this.naration.push(e),this.last_text=e);let i=document.getElementsByClassName("narativeBox")[0];i.scrollTop=i.scrollHeight}}};const wt=(0,f.Z)(St,[["render",A]]);var bt=wt;const Xt={class:"HCPartnershipsTable",style:{display:"table"}},Ct={style:{display:"table-cell"}},vt=(0,a._)("tr",null,[(0,a._)("th"),(0,a._)("th",null,"Discoverability"),(0,a._)("th",null,"Appropriability"),(0,a._)("th",null,"Expressivity")],-1),kt=(0,a._)("th",null,"Instrument (Input)",-1),Yt={id:"discoverabilityDemo"},Nt=(0,a._)("p",{class:"caption"},"Use the eraser and see what can be erased",-1),Bt={id:"appropriabilityDemo"},Ot=(0,a._)("p",{class:"caption"},"Resize the stickyline to catch each shape with only one vertical movement",-1),Gt={id:"expressivityDemo"},At=(0,a._)("p",{class:"caption"},"Tweak Stickyline to align from gravity centers(green dots) rather than geometrical centers(red dots)",-1),Lt=(0,a._)("th",null,"Substrate (Output)",-1),Ft={id:"discoverabilitySubstrateDemo"},Rt=(0,a._)("p",{class:"caption"},"Try to swap object by moving them on the stickyline. An indication will appear.",-1),Et={id:"appropriabilitySubstrateDemo"},Ht=(0,a._)("p",{class:"caption"},"Right click on the line/center to change distribution mode/alignment center. Stretch and rotate the stickyline.",-1),jt={id:"expressivitySubstrateDemo"},Wt=(0,a._)("p",{class:"caption"},"Draw a second Stickyline through the tweaks of the words and use both Stickylines to re-style the text.",-1),Kt={id:"narationBox",style:{display:"table-cell"}};function qt(t,e,i,s,n,o){const r=(0,a.up)("DiscoverabilityDemo"),h=(0,a.up)("AppropriabilityDemo"),l=(0,a.up)("ExpressivityDemo"),c=(0,a.up)("DiscoverabilitySubstrateDemo"),d=(0,a.up)("AppropriabilitySubstrateDemo"),g=(0,a.up)("ExpressivitySubstrateDemo"),p=(0,a.up)("NarativeBox");return(0,a.wg)(),(0,a.iD)("div",Xt,[(0,a._)("div",Ct,[(0,a._)("table",null,[vt,(0,a._)("tr",null,[kt,(0,a._)("td",null,[(0,a._)("div",Yt,[(0,a.Wm)(r,{height:t.height,width:t.width,onExplain:o.addExplanation},null,8,["height","width","onExplain"])]),Nt]),(0,a._)("td",null,[(0,a._)("div",Bt,[(0,a.Wm)(h,{height:t.height,width:t.width,onExplain:o.addExplanation},null,8,["height","width","onExplain"])]),Ot]),(0,a._)("td",null,[(0,a._)("div",Gt,[(0,a.Wm)(l,{height:t.height,width:t.width,onExplain:o.addExplanation},null,8,["height","width","onExplain"])]),At])]),(0,a._)("tr",null,[Lt,(0,a._)("td",null,[(0,a._)("div",Ft,[(0,a.Wm)(c,{height:t.height,width:t.width,onExplain:o.addExplanation},null,8,["height","width","onExplain"])]),Rt]),(0,a._)("td",null,[(0,a._)("div",Et,[(0,a.Wm)(d,{height:t.height,width:t.width,onExplain:o.addExplanation},null,8,["height","width","onExplain"])]),Ht]),(0,a._)("td",null,[(0,a._)("div",jt,[(0,a.Wm)(g,{height:t.height,width:t.width,onExplain:o.addExplanation},null,8,["height","width","onExplain"])]),Wt])])])]),(0,a._)("div",Kt,[(0,a.Wm)(p,{class:"narativeBox","texts-for-naration":n.naration},null,8,["texts-for-naration"])])])}function zt(t,e,i,n,o,r){const h=(0,a.up)("ToolBar"),l=(0,a.up)("v-rect"),c=(0,a.up)("v-circle"),d=(0,a.up)("v-image"),g=(0,a.up)("v-text"),p=(0,a.up)("v-regular-polygon"),u=(0,a.up)("v-line"),f=(0,a.up)("v-group"),M=(0,a.up)("v-transformer"),x=(0,a.up)("v-layer"),y=(0,a.up)("v-stage");return(0,a.wg)(),(0,a.iD)("div",{onClick:e[1]||(e[1]=(...e)=>t.HideContextMenu&&t.HideContextMenu(...e)),id:"AppropriabilityDemo",onMousedown:e[2]||(e[2]=t=>r.updateNaration(this.groups[0]))},[(0,a.Wm)(h,{height:100,width:400,onNeed_new_shape:r.createNewShape,onEraser_is_selected:r.switchEraseMode},null,8,["onNeed_new_shape","onEraser_is_selected"]),(0,a.Wm)(y,{ref:"stage",id:"stage",config:o.stageSize,onDragmove:r.update,onMousedown:r.handleTransformation,onTouchstart:r.handleTransformation,onFusion:r.makeGroup,onContextMenu:t.DisplayContextMenu},{default:(0,a.w5)((()=>[(0,a.Wm)(x,{ref:"layer"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.groups,(t=>((0,a.wg)(),(0,a.j4)(f,{ref_for:!0,ref:"groups",key:t.id,config:t},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Rect"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(l,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Circle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(c,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Image"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(d,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Text"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(g,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape,onDblclick:r.editText},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout","onDblclick"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Triangle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(p,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(),(0,a.j4)(u,{key:t.line.id,config:t.line,onTransformend:r.updateTransformedShape,onDragmove:e=>r.updateGrp(e,t.id),onMouseout:r.unshowSelectedShape,onMouseenter:r.showSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseout","onMouseenter"])),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.line.positionPoints,(t=>((0,a.wg)(),(0,a.j4)(c,{key:t.id,config:t,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onMouseenter","onMouseout"])))),128))])),_:2},1032,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Rect"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(l,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Circle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(c,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Triangle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(p,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.transformers,(t=>((0,a.wg)(),(0,a.j4)(M,{key:t.id,config:t},null,8,["config"])))),128)),((0,a.wg)(),(0,a.j4)(c,{key:o.center.id,config:o.center,onDragend:r.ChangeCenter,onClick:t.DisplayCenterMenu},null,8,["config","onDragend","onClick"]))])),_:1},512)])),_:1},8,["config","onDragmove","onMousedown","onTouchstart","onFusion","onContextMenu"]),(0,a._)("input",{type:"text",id:"input",size:"10",value:"a text",onKeyup:e[0]||(e[0]=(0,s.D2)(((...t)=>r.updateText&&r.updateText(...t)),["enter"]))},null,32)],32)}const $t=function(t){let e=this.getStage().width(),i=this.getStage().height(),s=10;return t.x>e-s&&t.y>i-s?{x:e-s,y:i-s}:t.x>e-s&&t.y<s?{x:e-s,y:s}:t.y>i-s&&t.x<s?{x:s,y:i-s}:t.x<s&&t.y<s?{x:s,y:s}:t.x<s?{x:s,y:t.y}:t.y<s?{x:t.x,y:s}:t.x>e-s?{x:e-s,y:t.y}:t.y>i-s?{x:t.x,y:i-s}:{x:t.x,y:t.y}};var Zt={props:{width:{type:Number,default:window.innerWidth},height:{type:Number,default:window.innerHeight}},components:{},data(){return{stageSize:{width:this.width,height:this.height},lengthToCapture:10,lengthToDetach:15,editedText:null,eraseMode:0,selectedShapeAlignment:"",needMenu:"initial",isALineSelected:!1,isAGroupedShapeSelected:!1,isStageOnlySelected:!1,keepDistanceButtonText:"Liberate Distribution",max_id_figures:6,groups:[{name:"group",className:"Group",id:"6",x:0,y:0,offsetX:0,offsetY:0,rotation:0,draggable:!1,shapes_g:[],aShapeHasBeenDetach:0,line:{x:150,y:250,points:[0,0,0,0,100,0],positionPoints:[],strokeWidth:10,rotation:0,tension:0,closed:!0,draggable:!0,scaleX:1,scaleY:1,opacity:.5,offset:{x:50,y:0},name:"ligne",className:"Line",stroke:"red",id:"6",keepDistribution:!1,freeDistances:[],occupiedDistances:[],keepDistanceButtonText:"Liberate Distribution",defaultAlignment:"Bottom",dragBoundFunc:$t}}],transformers:[{id:"lineTransformer",enabledAnchors:["middle-left","middle-right"],flipEnabled:!1,nodes:[]},{id:"shapeTransformer",nodes:[]}],shapes:[{rotation:0,id:"2",x:150,y:210,width:70,height:70,scaleX:1,scaleY:1,strokeWidth:0,stroke:"black",fill:"green",name:"rect2",draggable:!0,className:"Rect",isGrouped:0,dragBoundFunc:$t,offsetX:35,offsetY:70,personalRotation:0,centerPosition:"Bottom"},{rotation:0,x:50,y:100,scaleX:1,scaleY:1,offsetX:0,offsetY:40,radius:40,fill:"orange",strokeWidth:0,stroke:"black",draggable:!0,isGrouped:0,className:"Circle",personalRotation:0,id:"3",dragBoundFunc:$t,centerPosition:"Bottom"},{rotation:0,id:"8",x:250,y:100,sides:3,radius:45,width:90,height:90,scaleX:1,scaleY:1,strokeWidth:0,stroke:"black",fill:"purple",name:"triangle1",draggable:!0,className:"Triangle",isGrouped:0,dragBoundFunc:$t,offsetX:0,offsetY:22.5,personalRotation:0,centerPosition:"Bottom"}],center:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:4,fill:"black",opacity:1,draggable:!0,isGrouped:0,className:"Circle",id:"center",dragBoundFunc:$t},positionPoint:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint",distance_to_line_center:void 0},selectedShapeId:""}},mounted(){let t=this.$refs.stage.getStage().getChildren()[0].getChildren().filter((t=>"Text"==t.attrs.className));for(let e=0;e<t.length;e++)t[e].attrs.length_x=t[e].width(),t[e].attrs.length_y=t[e].height(),t[e].offsetX(t[e].attrs.length_x/2)},created(){this.max_id_figures=this.shapes.length+this.groups.length},methods:{switchEraseMode(){0==this.eraseMode?(this.eraseMode=1,document.getElementById("playground").style.cursor="url("+i(843)+"),default",this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer")):(this.eraseMode=0,document.getElementById("playground").style.cursor="default")},checkIfShapesOnLine(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;let a=0;while(a<s.length)this.isCoordinateOnLine(s[a].x,s[a].y,i.id)?a+=1:(console.log("a shape is not on a line"),s[a].dragBoundFunc=$t,s[a].isGrouped=0,i.positionPoints.splice(a,1),this.shapes.push(s[a]),i.freeDistances.push(i.occupiedDistances[a]),i.occupiedDistances.splice(a,1),s.splice(a,1),this.updateNaration(e))},isCoordinateOnLine(t,e,i){const s=this.groups.find((t=>t.id===i)),a=s.line;let n=!0,o=a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),r=a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),h=a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),l=a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),c=(o-h)/(l-r),d=a.y-c*a.x;return n=Math.abs(r-l)>1?Math.abs(c*t+d-e)>1:Math.abs(t-a.x)>1,!(n||(a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0||!n&&Math.sqrt((a.x-t)**2+(a.y-e)**2)>a.points[4]*a.scaleX/2)},updateGrp(t,e){const i=this.groups.find((t=>t.id===e)),s=i.line;i.offsetX=s.offsetX,i.offsetY=s.offsetY,s.x=t.target.x(),s.y=t.target.y(),this.center.x=s.x,this.center.y=s.y,this.updateAllPosInGrp(s.id),this.checkIfShapesOnLine(s.id)},updateAllPosInGrp(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;for(let n=0;n<s.length;n++)i.keepDistribution,s[n].x=i.x+i.occupiedDistances[n]*Math.cos(i.rotation*(Math.PI/180)),s[n].y=i.y+i.occupiedDistances[n]*Math.sin(i.rotation*(Math.PI/180)),s[n].distance_to_line_center=i.occupiedDistances[n],s[n].rotation=s[n].personalRotation+i.rotation,i.positionPoints[n].x=s[n].x,i.positionPoints[n].y=s[n].y,i.positionPoints[n].distance_to_line_center=s[n].distance_to_line_center;let a=s.length;while(a<i.positionPoints.length)i.keepDistribution?i.positionPoints.splice(a,1):(i.positionPoints[a].x=i.x+i.freeDistances[a-s.length]*Math.cos(i.rotation*(Math.PI/180)),i.positionPoints[a].y=i.y+i.freeDistances[a-s.length]*Math.sin(i.rotation*(Math.PI/180)),i.positionPoints[a].distance_to_line_center=i.freeDistances[a-s.length],a++)},isOutsideTheLine(t,e){let i=e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180)),s=e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180)),a=e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180)),n=e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180)),o=(i-a)/(n-s),r=e.y-o*e.x,h=!1;return h=Math.abs(s-n)>=1?Math.abs(o*t.x+r-t.y)<1:Math.abs(t.x-e.x)<1,!h||(e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=0&&e.rotation*(Math.PI/180)>-Math.PI/2||(e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=0&&e.rotation*(Math.PI/180)>-Math.PI/2||(e.y+.5*e.points[4]*e.scaleX*Math.sin(Math.PI+e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(Math.PI+e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=-Math.PI/2&&e.rotation*(Math.PI/180)>-Math.PI||(e.x+.5*e.points[4]*e.scaleX*Math.cos(Math.PI+e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(Math.PI+e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=-Math.PI/2&&e.rotation*(Math.PI/180)>-Math.PI||(e.y+.5*e.points[4]*e.scaleX*Math.sin(Math.PI-e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(Math.PI-e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=Math.PI&&e.rotation*(Math.PI/180)>Math.PI/2||(e.x+.5*e.points[4]*e.scaleX*Math.cos(Math.PI-e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(Math.PI-e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=Math.PI&&e.rotation*(Math.PI/180)>Math.PI/2||(e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=Math.PI/2&&e.rotation*(Math.PI/180)>=0||(e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=Math.PI/2&&e.rotation*(Math.PI/180)>=0},update(){const t=this.shapes;let e=!1;for(let i=0;i<t.length;i++){let s=t[i].x,a=t[i].y;for(let n=0;n<this.groups.length;n++){let o=this.groups[n].line,r=o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),h=o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),l=o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),c=o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),d=(r-l)/(c-h),g=o.y-d*o.x;e=Math.abs(h-c)>1?Math.abs(d*s+g-a)<=this.lengthToCapture:Math.abs(s-o.x)<=this.lengthToCapture,(e&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=0&&o.rotation*(Math.PI/180)>-Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=-Math.PI/2&&o.rotation*(Math.PI/180)>=-Math.PI||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI&&o.rotation*(Math.PI/180)>Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI/2&&o.rotation*(Math.PI/180)>=0)&&(t[i].isGrouped=1,this.makeGroup(o.id))}}},CheckIfNeedToDetach(t){let e=this.groups.find((e=>e.id===t.target.getParent().attrs.id)),i=e.shapes_g.find((e=>e.id==t.target.id())),s=Math.sqrt((t.target.getStage().getPointerPosition().y-t.target.y())**2+(t.target.getStage().getPointerPosition().x-t.target.x())**2);"Rect"==t.target.className?s-=t.target.attrs.height*t.target.attrs.scaleY:"Circle"==t.target.className?s-=2*t.target.attrs.radius*t.target.attrs.scaleY:"Text"==t.target.className?s-=t.target.attrs.length_y*t.target.attrs.scaleY:("Image"==t.target.className||"Triangle"==t.target.attrs.className)&&(s-=t.target.height()*t.target.scaleY()),s>50&&(this.groups.find((e=>e.id===t.target.getParent().attrs.id)).aShapeHasBeenDetach=1,this.DetachShape(i,t.target.getStage().getPointerPosition().x,t.target.getStage().getPointerPosition().y))},GiveSignOfDistance(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(a)<=this.lengthToCapture&&-90==e.rotation?-Math.sign(n):Math.abs(a)<=this.lengthToCapture&&90==e.rotation?Math.sign(n):Math.sign(a),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},GiveSignOfDistanceBtwCenterAndShape(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(n)<=this.lengthToCapture&&-90==e.rotation?Math.sign(a):Math.abs(n)<=this.lengthToCapture&&90==e.rotation?-Math.sign(a):Math.sign(n),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},makeGroup(t){this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer");const e=this.groups.find((e=>e.id===t)),i=e.line,s=this.shapes;i.freeDistances.sort(this.isSmaller),s.sort(this.isBeforeRegardingX);for(let a=0;a<s.length;a++)if(1==s[a].isGrouped){const n=Object.assign({},this.positionPoint);let o=s[a].x-i.x,r=s[a].y-i.y;s[a].personalRotation=0,s[a].distance_to_line_center=this.GiveSignOfDistance(s[a],i)*Math.sqrt(o**2+r**2),Math.abs(s[a].distance_to_line_center)>=i.points[4]*i.scaleX/2&&(s[a].distance_to_line_center=Math.sign(s[a].distance_to_line_center)*i.points[4]*i.scaleX/2),this.ChangeCenterRegardingCommand(s[a].id,e.line.defaultAlignment),this.updateDragFunc(s[a],i),e.shapes_g.push(s[a]),e.line.occupiedDistances.push(s[a].distance_to_line_center),n.id="positionPoint"+e.id+e.line.positionPoints.length,e.line.positionPoints.push(n),console.log("A new shape has been added with a distance"+s[a].distance_to_line_center),this.updateOccupiedDistance(i.id),this.updateAllPosInGrp(t),this.updateNaration(e),s.splice(a,1)}this.center.x=i.x,this.center.y=i.y},updateOccupiedDistance(t){const e=this.groups.find((e=>e.id===t));if(this.sortByDistToLineCenter(e),e.line.keepDistribution){let t=e.line.points[4],i=e.shapes_g.length,s=t/(i-1)*e.line.scaleX;if(i%2==0){for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[t-1]=-(i/2-1-t+1)*s-s/2;for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[i/2+t]=t*s+s/2;e.line.occupiedDistances[i/2-1]=-s/2,e.line.occupiedDistances[i/2]=s/2}else{for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[t-1]=-s*((i-1)/2-t+1);for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[(i-1)/2+t]=s*t;e.line.occupiedDistances[(i-1)/2]=0}for(let a=0;a<e.shapes_g.length;a++)e.shapes_g[a].distance_to_line_center=e.line.occupiedDistances[a]}else e.line.occupiedDistances.sort(this.isSmaller)},isSmaller(t,e){return t<e?-1:1},isBeforeRegardingX(t,e){return t.x<e.x?-1:1},updateOccDist(t,e){let i=this.isNearest(t.line,e);if(i.isFree){e.distance_to_line_center=t.line.freeDistances[i.indice],t.line.freeDistances.splice(i.indice,1),this.sortByDistToLineCenter(t);for(let e=0;e<t.shapes_g.length;e++)t.line.occupiedDistances.length==e?t.line.occupiedDistances.push(t.shapes_g[e].distance_to_line_center):t.line.occupiedDistances[e]=t.shapes_g[e].distance_to_line_center}else t.shapes_g.find((t=>t.id==e.id)).distance_to_line_center=t.line.occupiedDistances[i.indice],t.line.occupiedDistances.splice(i.indice,1),this.updateOccDist(t,t.shapes_g[i.indice])},isNearest(t,e){let i,s=t.x+t.freeDistances[0]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[0]*Math.sin(t.rotation*(Math.PI/180)),n=Math.sqrt((s-e.x)**2+(a-e.y)**2),o=0;for(let r=1;r<t.freeDistances.length;r++)s=t.x+t.freeDistances[r]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[r]*Math.sin(t.rotation*(Math.PI/180)),i=Math.sqrt((s-e.x)**2+(a-e.y)**2),i<n&&(n=i,o=r);return o},sortByDistToLineCenter(t){if(t.line.keepDistribution)for(let e=0;e<t.shapes_g.length;e++){let i=t.shapes_g[e].x-t.line.x,s=t.shapes_g[e].y-t.line.y;t.shapes_g[e].distance_to_line_center=this.GiveSignOfDistance(t.shapes_g[e],t.line)*Math.sqrt(i**2+s**2)}for(let e=1;e<t.shapes_g.length;e++){let i=t.shapes_g[e],s=e;while(s>0&&t.shapes_g[s-1].distance_to_line_center>i.distance_to_line_center)t.shapes_g[s]=t.shapes_g[s-1],s-=1;t.shapes_g[s]=i}},sortAnyShapesByDistToLineCenter(t,e){for(let i=0;i<t.length;i++){let s=t[i].x-e.x,a=t[i].y-e.y;t.distance_to_line_center=this.GiveSignOfDistance(t,e)*Math.sqrt(s**2+a**2)}for(let i=1;i<t.length;i++){let e=t[i],s=i;while(s>0&&t[s-1].distance_to_line_center>e.distance_to_line_center)t[s]=t[s-1],s-=1;t[s]=e}},updateDragFunc(t,e){let i=e.rotation*(Math.PI/180);i<=0&&i>=-Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.y-e.y)*Math.cos(i),y:e.y-(t.y-e.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.x-e.x)*Math.cos(i),y:e.y-(t.x-e.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.y-e.y)*Math.cos(i),y:e.y+(t.y-e.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}})},updatePos(t){const e=this.shapes.find((e=>e.id===t.target.id()));e.x=t.target.x(),e.y=t.target.y(),this.center.x=t.target.x(),this.center.y=t.target.y();let i={x:e.x,y:e.y};t.target.position(i),t.target.getLayer().batchDraw()},updatePosInGrp(t,e){let i,s,a;const n=this.groups.find((t=>t.id===e));if(1==n.aShapeHasBeenDetach)return void(n.aShapeHasBeenDetach=0);const o=n.line,r=n.shapes_g.find((e=>e.id===t.target.id())),h=n.shapes_g;if(1==r.needToBeDetach&&(r.needToBeDetach=0,this.DetachShape(r),this.updateAllPosInGrp(t.target.getParent().attrs.id)),o.keepDistribution){if(this.isCoordinateOnLine(t.target.x(),t.target.y(),o.id)){i=r.x-t.target.x(),s=r.y-t.target.y();let e=n.line.points[4],a=n.shapes_g.length,l=e/(a-1)*n.line.scaleX,c=Math.sqrt(i**2+s**2);c>=l?(r.x=t.target.x(),r.y=t.target.y(),this.updateOccupiedDistance(o.id),r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation,this.updateAllPosInGrp(o.id)):(r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation)}else r.x=t.target.x(),r.y=t.target.y();o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center}else o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,r.x=t.target.x(),r.y=t.target.y(),0==Math.sin(o.rotation*(Math.PI/180))?a=r.x-o.x:(a=0!=Math.sign(r.x-o.x)?Math.sign(-r.rotation)*Math.sign(r.x-o.x)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2):Math.sign(-r.rotation)*Math.sign(r.y-o.y)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2),(r.rotation*(Math.PI/180)<=-Math.PI/2||r.rotation*(Math.PI/180)<=Math.PI/2&&r.rotation*(Math.PI/180)>=0)&&(a=-a)),o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center;let l={x:r.x,y:r.y};if(this.center.x=r.x,this.center.y=r.y,t.target.position(l),t.target.getLayer().batchDraw(),this.isCoordinateOnLine(r.x,r.y,o.id))o.keepDistribution?n.line.occupiedDistances[h.indexOf(r)]=r.distance_to_line_center:n.line.occupiedDistances[h.indexOf(r)]=a,o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center;else{r.dragBoundFunc=$t,r.isGrouped=0,this.shapes.push(r);for(let t=0;t<h.length;t++)h[t].id==r.id&&(o.freeDistances.push(o.occupiedDistances[t]),o.occupiedDistances.splice(t,1),o.positionPoints.splice(t,1),h.splice(t,1),console.log("a shape has been removed from the line"))}o.keepDistribution&&this.updateOccupiedDistance(o.id),this.updateAllPosInGrp(o.id)},updateTransformedShape(t){let e,i;if("Line"==t.target.className)i=this.groups.find((t=>t.id===this.selectedShapeId)).line;else if(e=this.findShape(this.selectedShapeId),i=e.shape_data,void 0==i)return;let s=i.x,a=i.y;i.x=t.target.x(),i.y=t.target.y(),i.rotation=t.target.rotation();let n=i.scaleX;if(i.scaleX=t.target.scaleX(),i.scaleY=t.target.scaleY(),"Line"==t.target.className){const e=this.groups.find((t=>t.id===i.id));if(i.keepDistribution){for(let t=0;t<i.occupiedDistances.length;t++)i.occupiedDistances[t]=i.occupiedDistances[t]/n*i.scaleX;this.update(),this.updateGrp(t,this.selectedShapeId),this.checkIfShapesOnLine(this.selectedShapeId)}else{if(n!=i.scaleX){for(let t=0;t<e.shapes_g.length;t++){let n=e.shapes_g[t].x-i.x,o=e.shapes_g[t].y-i.y;0==Math.sign(e.line.occupiedDistances[t])?e.line.occupiedDistances[t]=this.GiveSignOfDistance(e.shapes_g[t],i)*Math.sqrt(n**2+o**2):e.line.occupiedDistances[t]=Math.sign(e.line.occupiedDistances[t])*Math.sqrt(n**2+o**2),Math.sign(e.shapes_g[t].x-s)!=Math.sign(n)&&0!=Math.sign(e.shapes_g[t].x-s)&&90!=e.line.rotation&&-90!=e.line.rotation&&(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t]),Math.sign(e.shapes_g[t].y-a)==Math.sign(o)||0==Math.sign(e.shapes_g[t].y-a)||90!=e.line.rotation&&-90!=e.line.rotation||(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t])}for(let t=0;t<i.freeDistances.length;t++){let e=s-i.x,n=a-i.y,o=Math.sqrt(e**2+n**2);i.rotation<-90||i.rotation>90?i.freeDistances[t]=i.freeDistances[t]-Math.sign(s-i.x)*o:90==i.rotation||-90==i.rotation?i.freeDistances[t]=i.freeDistances[t]-n:i.freeDistances[t]=i.freeDistances[t]+Math.sign(s-i.x)*o}}this.update(),this.updateGrp(t,this.selectedShapeId),this.checkIfShapesOnLine(this.selectedShapeId)}for(let t=0;t<e.shapes_g.length;t++)this.updateDragFunc(e.shapes_g[t],i)}else"-1"!=e.grp_id?(this.updateAllPosInGrp(e.grp_id),this.updateOccupiedDistance(e.grp_id),t.target.x(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).x),t.target.y(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).y),this.groups.find((t=>t.id===e.grp_id)).shapes_g.find((e=>e.id===t.target.id())).personalRotation=t.target.rotation()-t.target.getParent().attrs.line.rotation,this.updateAllPosInGrp(e.grp_id),this.checkIfShapesOnLine(e.grp_id),this.updateDragFuncOfCenter()):(this.update(),this.updateDragFuncOfCenter());this.center.x=t.target.attrs.x,this.center.y=t.target.attrs.y,this.updateNaration(this.groups.find((t=>t.id===this.selectedShapeId)))},handleTransformation(t){if(document.getElementById("input").style.display="none",void 0==t.evt)return;if(1==this.eraseMode)return void this.eraserAction(t);if(t.target===t.target.getStage())return this.selectedShapeId="NoId",this.eraseNodefromTransformer("lineTransformer"),this.eraseNodefromTransformer("shapeTransformer"),void(this.center.opacity=0);const e="Transformer"===t.target.getParent().className;if(e)return;const i=t.target.id();let s,a=this.findShape(i).shape_data;"center"!=t.target.attrs.id&&("Line"==t.target.className?(s="lineTransformer",a=this.groups.find((t=>t.id===i)).line,this.center.draggable=!1,this.selectedShapeAlignment=a.defaultAlignment,this.eraseNodefromTransformer("shapeTransformer")):(s="shapeTransformer",this.center.draggable=!0,this.selectedShapeAlignment=a.centerPosition,this.eraseNodefromTransformer("lineTransformer")),void 0!=a?(this.selectedShapeId=i,this.center.opacity=1,this.updateTransformer(s)):this.selectedShapeId="NoId",this.updateDragFuncOfCenter())},eraseNodefromTransformer(t){let e=this.$refs.stage.getStage();const i=e.find("#"+t)[0];i.nodes([])},updateTransformer(t){let e=this.$refs.stage.getStage();const i=e.find("#"+t)[0];let s;if("lineTransformer"==t)s=e.children[0].getChildren().filter((t=>"Group"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0].getChildren().filter((t=>"Line"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];else{s=e.children[0].getChildren().filter((t=>"Group"!=t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];let t=!0;void 0==s&&(t=!1);let i=0;while(!t)i<this.groups.length?(s=e.children[0].getChildren().filter((t=>"Group"==t.attrs.className))[i].getChildren().find((t=>t.attrs.id==this.selectedShapeId&&"Line"!=t.attrs.className)),t=void 0!=s,i++):t=!0}s!==i.node()&&(void 0!=s?i.nodes([s]):i.nodes([]),this.center.x=s.attrs.x,this.center.y=s.attrs.y)},ChangeCenter(t){let e,i,s=this.findShape(this.selectedShapeId),a=s.shape_data,n=this.GiveSignOfDistanceBtwCenterAndShape(t.target.attrs,a)*Math.sqrt((t.target.y()-a.y)**2+(t.target.x()-a.x)**2)+a.offsetY*a.scaleY,o=a.offsetY;void 0==a?a=this.groups.find((t=>t.id==this.selectedShapeId)).line:("Rect"==a.className?(e=a.height*a.scaleY/3,i=a.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.width/2,a.offsetY=a.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.width/2,a.offsetY=a.height,a.centerPosition="Bottom"):(a.offsetX=a.width/2,a.offsetY=0,a.centerPosition="Top")):"Circle"==a.className?(n+=a.radius*a.scaleY,e=a.radius*a.scaleY*2/3,i=a.radius*a.scaleY*4/3,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0,a.centerPosition="Middle"):n>i?(a.offsetX=0,a.offsetY=a.radius,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")):"Image"==a.className?(e=a.image.height*a.scaleY/3,i=a.image.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height,a.centerPosition="Bottom"):(a.offsetX=a.image.width/2,a.offsetY=0,a.centerPosition="Top")):"Text"==a.className?(e=a.length_y*a.scaleY/3,i=a.length_y*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y,a.centerPosition="Bottom"):(a.offsetX=a.length_x/2,a.offsetY=0,a.centerPosition="Top")):"Triangle"==a.className&&(n+=a.radius*a.scaleY,e=a.radius*a.scaleY/2,i=a.radius*a.scaleY*5/4,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0):n>i?(a.offsetX=0,a.offsetY=a.radius/2,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")),a.y=a.y-(o-a.offsetY)*a.scaleY*Math.cos(a.rotation*(Math.PI/180)),a.x=a.x+(o-a.offsetY)*a.scaleY*Math.sin(a.rotation*(Math.PI/180)),this.selectedShapeAlignment=a.centerPosition,"-1"!=s.grp_id&&this.updateAllPosInGrp(s.grp_id),t.target.x(a.x),t.target.y(a.y))},ChangeCenterRegardingCommand(t,e){let i=this.findShape(t),s=i.shape_data,a=s.offsetY;"Rect"==s.className?"Top"==e?(s.offsetY=0,s.offsetX=s.width/2):"Middle"==e?(s.offsetX=s.width/2,s.offsetY=s.height/2):"Bottom"==e&&(s.offsetX=s.width/2,s.offsetY=s.height):"Circle"==s.className?"Top"==e?(s.offsetX=0,s.offsetY=-s.radius):"Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e&&(s.offsetX=0,s.offsetY=s.radius):"Image"==s.className?"Middle"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height/2):"Bottom"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height):"Top"==e&&(s.offsetX=s.image.width/2,s.offsetY=0):"Text"==s.className?"Middle"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y/2):"Bottom"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y):"Top"==e&&(s.offsetX=s.length_x/2,s.offsetY=0):"Triangle"==s.className&&("Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e?(s.offsetX=0,s.offsetY=s.radius/2):"Top"==e&&(s.offsetX=0,s.offsetY=-s.radius)),s.centerPosition=e,s.y=s.y-(a-s.offsetY)*s.scaleY*Math.cos(s.rotation*(Math.PI/180)),s.x=s.x+(a-s.offsetY)*s.scaleY*Math.sin(s.rotation*(Math.PI/180)),"-1"!=i.grp_id&&this.updateAllPosInGrp(i.grp_id)},updateDragFuncOfCenter(){let t=this.findShape(this.selectedShapeId).shape_data;if(void 0==t)return;let e=this.center,i=t.rotation*(Math.PI/180);i>=-Math.PI/2&&i<=0?i-=Math.PI/180*90:i<-Math.PI/2?(i+=Math.PI/2,i=Math.PI+i):i<=Math.PI&&i>0&&(i-=Math.PI/180*90),i<=0&&i>=-Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.y-t.y)*Math.cos(i),y:t.y-(e.y-t.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.x-t.x)*Math.cos(i),y:t.y-(e.x-t.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.y-t.y)*Math.cos(i),y:t.y+(e.y-t.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}})},MovingCenter(){},findShape(t){let e=this.shapes.find((e=>e.id===t)),i="-1",s=!0;void 0==e&&(s=!1);let a=0;while(!s)a<this.groups.length?(e=this.groups[a].shapes_g.find((e=>e.id===t)),void 0==e?s=!1:(i=this.groups[a].id,s=!0),a++):s=!0;return{shape_data:e,grp_id:i}},DetachShape(t,e,i){const s=this.lengthToCapture+5;let a=this.groups.find((e=>-1!=e.shapes_g.indexOf(t))),n=a.shapes_g.indexOf(t);t.dragBoundFunc=$t;let o=a.line.y-.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),r=a.line.x+.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),h=a.line.y+.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),l=a.line.x-.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),c=(h-o)/(r-l),d=t.x*(1/c)+t.y;a.line.rotation<0&&a.line.rotation>-45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-45&&a.line.rotation>-90||a.line.rotation<-90&&a.line.rotation>-135?(t.x=t.x+Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-135&&a.line.rotation>-180||a.line.rotation>135&&a.line.rotation<180?(t.x=t.x-Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>90&&a.line.rotation<=135||a.line.rotation>45&&a.line.rotation<=90?(t.x=t.x-Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>0&&a.line.rotation<=45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):-90==a.line.rotation?t.x=t.x-Math.sign(t.x-e)*s:90==a.line.rotation?t.x=t.x+Math.sign(t.x-e)*s:(180==a.line.rotation||-180==a.line.rotation||0==a.line.rotation)&&(t.y=t.y-Math.sign(t.y-i)*s),t.isGrouped=0,this.shapes.push(t),this.center.x=t.x,this.center.y=t.y,a.line.freeDistances.push(a.line.occupiedDistances[n]),a.line.occupiedDistances.splice(n,1),a.shapes_g.splice(n,1),a.line.positionPoints.splice(n,1),this.updateOccupiedDistance(a.id),this.updateAllPosInGrp(a.id),this.updateNaration(a),this.eraseNodefromTransformer("shapeTransformer")},createNewShape(t){if("Line"==t.attrs.className){this.max_id_figures=this.max_id_figures+1;let e=t.getParent().clone({id:""+this.max_id_figures,name:"group"+this.max_id_figures,shapes_g:[]});e.attrs.line.id=""+this.max_id_figures,e.attrs.line.x=t.getStage().getPointerPosition().x,e.attrs.line.y=t.getStage().getPointerPosition().y,e.attrs.line.draggable=!0,this.groups.push(e.attrs)}else{this.max_id_figures=this.max_id_figures+1;let e=t.clone({id:""+this.max_id_figures,draggable:!0});e.attrs.isGrouped=0,this.shapes.push(e.attrs)}},eraserAction(t){this.Remove(t.target)},unshowSelectedShape(t){"Line"==t.target.attrs.className&&0==this.eraseMode?t.target.opacity(.5):"Line"==t.target.attrs.className&&1==this.eraseMode?1==t.target.attrs.keepDistribution?t.target.stroke("black"):t.target.stroke("blue"):"positionPoint"==t.target.attrs.className&&1==this.eraseMode?1!=t.target.getParent().attrs.line.keepDistribution&&t.target.strokeWidth(0):1==this.eraseMode&&t.target.strokeWidth(0)},showSelectedShape(t){if("Line"==t.target.attrs.className&&0==this.eraseMode)t.target.opacity(1);else if("Line"==t.target.attrs.className&&1==this.eraseMode)t.target.stroke("rgb(200, 59, 218)");else if("positionPoint"==t.target.attrs.className&&1==this.eraseMode){let e=t.target.getParent().attrs.line;-1!=e.freeDistances.indexOf(t.target.attrs.distance_to_line_center)&&1!=e.keepDistribution&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))}else 1==this.eraseMode&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))},editText(t){let e=t.target.getStage().attrs.container.getBoundingClientRect();document.getElementById("input").style.top=e.y+t.target.getAbsolutePosition().y+"px",document.getElementById("input").style.left=e.x+t.target.getAbsolutePosition().x-5*document.getElementById("input").size+"px",document.getElementById("input").style.display="initial",this.editedText=t.target},updateText(t){let e=this.shapes.find((t=>t.id===this.editedText.attrs.id)),i=!0;void 0==e&&(i=!1);let s=0;while(!i)s<this.groups.length?(e=this.groups[s].shapes_g.find((t=>t.id===this.editedText.attrs.id)),i=void 0!=e,s++):i=!0;if(void 0!=e){let i,s,a,n;i=this.editedText.width(),s=this.editedText.height(),e.text=t.target.value,this.editedText.text(t.target.value),a=this.editedText.width()-i,n=this.editedText.height()-s,e.offsetX=e.offsetX+a/2,e.offsetY=e.offsetY+n/2,e.length_x=this.editedText.width(),e.length_y=this.editedText.height(),document.getElementById("input").style.display="none"}},updateNaration(t){let e="<strong>Substrate:</strong><br>";e=e+"- <mark class='red'> StickyLine </mark> with size="+t.line.points[4]*t.line.scaleX.toFixed(2)+"<br> and rotation="+t.line.rotation.toFixed(1)+"<br>",e+="Relation: <i>alignement with</i>:";for(let i=0;i<t.shapes_g.length;i++)e=e+"<br>- "+t.shapes_g[i].className;this.$emit("explain",{origin:"Instrument - Appropriability<br><mark class='red'> The Stickyline supports user customization to be better adapted to the task. </mark>",text:e})}}};const Ut=(0,f.Z)(Zt,[["render",zt]]);var Qt=Ut;const Vt={id:"activeReuseSubstrate"},Jt={id:"center_menu"};function te(t,e,i,n,o,r){const h=(0,a.up)("v-rect"),l=(0,a.up)("v-circle"),c=(0,a.up)("v-image"),d=(0,a.up)("v-text"),g=(0,a.up)("v-regular-polygon"),p=(0,a.up)("v-line"),u=(0,a.up)("v-group"),f=(0,a.up)("v-transformer"),M=(0,a.up)("v-layer"),x=(0,a.up)("v-stage"),y=(0,a.up)("ContextMenu"),P=(0,a.up)("CenterMenu");return(0,a.wg)(),(0,a.iD)("div",{onClick:e[2]||(e[2]=(...t)=>r.HideContextMenu&&r.HideContextMenu(...t)),id:"AppropriabilitySubstrateDemo",onMousedown:e[3]||(e[3]=t=>r.updateNaration(this.groups[0]))},[(0,a.Wm)(x,{ref:"stage",id:"stage",config:o.stageSize,onDragmove:r.update,onMousedown:r.handleTransformation,onTouchstart:r.handleTransformation,onFusion:r.makeGroup,onContextMenu:r.DisplayContextMenu},{default:(0,a.w5)((()=>[(0,a.Wm)(M,{ref:"layer"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.groups,(t=>((0,a.wg)(),(0,a.j4)(u,{ref_for:!0,ref:"groups",key:t.id,config:t},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Rect"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(h,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Circle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(l,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Image"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(c,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Text"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(d,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape,onDblclick:r.editText},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout","onDblclick"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Triangle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(g,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(),(0,a.j4)(p,{key:t.line.id,config:t.line,onTransformend:r.updateTransformedShape,onDragmove:e[0]||(e[0]=t=>r.updateGrp(t)),onMouseout:r.unshowSelectedShape,onMouseenter:r.showSelectedShape},null,8,["config","onTransformend","onMouseout","onMouseenter"])),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.line.positionPoints,(t=>((0,a.wg)(),(0,a.j4)(l,{key:t.id,config:t,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onMouseenter","onMouseout"])))),128))])),_:2},1032,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Rect"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(h,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Circle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(l,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Triangle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(g,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.transformers,(t=>((0,a.wg)(),(0,a.j4)(f,{key:t.id,config:t},null,8,["config"])))),128)),((0,a.wg)(),(0,a.j4)(l,{key:o.center.id,config:o.center,onDragend:r.ChangeCenter,onClick:r.DisplayCenterMenu},null,8,["config","onDragend","onClick"]))])),_:1},512)])),_:1},8,["config","onDragmove","onMousedown","onTouchstart","onFusion","onContextMenu"]),(0,a._)("div",Vt,[(0,a.Wm)(y,{"menu-of-stage":o.isStageOnlySelected,"menu-of-line":o.isALineSelected,"menu-of-grouped-shape":o.isAGroupedShapeSelected,"keep-distance-button-text":this.keepDistanceButtonText,"need-copy-button":!1,"need-switch-distribution-mode-button":!0,"need-copy-all-button":!1,onChangecenterButton:t.ChangeCenterButtonAction,onDetachshapeButton:r.DetachShapeButtonAction,onKeepdistanceButton:r.KeepDistribution,onCopyButton:t.Copy,onCopyAllButton:t.CopyAll,onPastButton:t.Past,onRemoveButton:t.Remove,onRemoveAllButton:t.RemoveAll,"need-past-button":!1},null,8,["menu-of-stage","menu-of-line","menu-of-grouped-shape","keep-distance-button-text","onChangecenterButton","onDetachshapeButton","onKeepdistanceButton","onCopyButton","onCopyAllButton","onPastButton","onRemoveButton","onRemoveAllButton"])]),(0,a._)("div",Jt,[(0,a.Wm)(P,{defaultAlignment:this.selectedShapeAlignment,onCenterButton:r.ChangeAlignCenter},null,8,["defaultAlignment","onCenterButton"])]),(0,a._)("input",{type:"text",id:"input",size:"10",value:"a text",onKeyup:e[1]||(e[1]=(0,s.D2)(((...t)=>r.updateText&&r.updateText(...t)),["enter"]))},null,32)],32)}const ee={id:"menu"};function ie(t,e,i,s,o,r){return(0,a.wg)(),(0,a.iD)("div",ee,[(0,a._)("button",{id:"Top",style:(0,n.j5)(o.style),onClick:e[0]||(e[0]=(...t)=>r.GenerateButtonEvent&&r.GenerateButtonEvent(...t)),onMouseover:e[1]||(e[1]=(...e)=>t.onHover&&t.onHover(...e))},"Top",36),(0,a._)("button",{id:"Middle",style:(0,n.j5)(o.style),onClick:e[2]||(e[2]=(...t)=>r.GenerateButtonEvent&&r.GenerateButtonEvent(...t))},"Middle",4),(0,a._)("button",{id:"Bottom",style:(0,n.j5)(o.style),onClick:e[3]||(e[3]=(...t)=>r.GenerateButtonEvent&&r.GenerateButtonEvent(...t))},"Bottom",4)])}var se={props:{displayMenu:String,ConcernedShape:Object,defaultAlignment:String,color:{type:String,default:"white"}},data(){return{style:{"--top_button_color":"white","--middle_button_color":"grey","--bottom_button_color":"white"}}},watch:{defaultAlignment:function(t,e){t!=e&&this.update()}},methods:{update(){"Middle"==this.defaultAlignment?this.style={"--top_button_color":"white","--middle_button_color":"grey","--bottom_button_color":"white"}:"Top"==this.defaultAlignment?this.style={"--top_button_color":"grey","--middle_button_color":"white","--bottom_button_color":"white"}:"Bottom"==this.defaultAlignment?this.style={"--top_button_color":"white","--middle_button_color":"white","--bottom_button_color":"grey"}:this.style={"--top_button_color":"white","--middle_button_color":"white","--bottom_button_color":"white"}},GenerateButtonEvent(t){"Top"==t.target.id&&this.$emit("center-button","Top"),"Middle"==t.target.id&&this.$emit("center-button","Middle"),"Bottom"==t.target.id&&this.$emit("center-button","Bottom")}}};const ae=(0,f.Z)(se,[["render",ie],["__scopeId","data-v-5bb90ca6"]]);var ne=ae;const oe=function(t){let e=this.getStage().width(),i=this.getStage().height(),s=10;return t.x>e-s&&t.y>i-s?{x:e-s,y:i-s}:t.x>e-s&&t.y<s?{x:e-s,y:s}:t.y>i-s&&t.x<s?{x:s,y:i-s}:t.x<s&&t.y<s?{x:s,y:s}:t.x<s?{x:s,y:t.y}:t.y<s?{x:t.x,y:s}:t.x>e-s?{x:e-s,y:t.y}:t.y>i-s?{x:t.x,y:i-s}:{x:t.x,y:t.y}};var re={props:{width:{type:Number,default:window.innerWidth},height:{type:Number,default:window.innerHeight}},components:{ContextMenu:$,CenterMenu:ne},data(){return{stageSize:{width:this.width,height:this.height},lengthToCapture:10,lengthToDetach:15,editedText:null,eraseMode:0,selectedShapeAlignment:"",needMenu:"initial",isALineSelected:!1,isAGroupedShapeSelected:!1,isStageOnlySelected:!1,keepDistanceButtonText:"Keep Distribution",max_id_figures:6,groups:[{name:"group",className:"Group",id:"1",x:0,y:0,offsetX:0,offsetY:0,rotation:0,draggable:!1,shapes_g:[{rotation:0,x:30,y:220,scaleX:1,scaleY:1,offsetX:0,offsetY:40,radius:40,fill:"orange",strokeWidth:0,stroke:"black",draggable:!0,isGrouped:1,className:"Circle",personalRotation:0,id:"6",dragBoundFunc:oe,centerPosition:"Bottom"},{rotation:0,id:"8",x:150,y:220,width:70,height:70,scaleX:1,scaleY:1,strokeWidth:0,stroke:"black",fill:"green",name:"rect2",draggable:!0,className:"Rect",isGrouped:0,dragBoundFunc:oe,offsetX:35,offsetY:70,personalRotation:0,centerPosition:"Bottom"},{rotation:0,id:"7",x:250,y:220,sides:3,radius:45,width:90,height:90,scaleX:1,scaleY:1,strokeWidth:0,stroke:"black",fill:"purple",name:"triangle1",draggable:!0,className:"Triangle",isGrouped:0,dragBoundFunc:oe,offsetX:0,offsetY:22.5,personalRotation:0,centerPosition:"Bottom"}],aShapeHasBeenDetach:0,line:{x:150,y:220,points:[0,0,0,0,250,0],positionPoints:[{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint1",distance_to_line_center:void 0},{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint2",distance_to_line_center:void 0},{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint3",distance_to_line_center:void 0}],strokeWidth:10,rotation:0,tension:0,closed:!0,draggable:!0,scaleX:1,scaleY:1,opacity:.5,offset:{x:125,y:0},name:"ligne",className:"Line",stroke:"blue",id:"1",keepDistribution:!1,freeDistances:[],occupiedDistances:[-95,-15,100],keepDistanceButtonText:"Keep Distribution",defaultAlignment:"Bottom",dragBoundFunc:oe}}],transformers:[{id:"lineTransformer",enabledAnchors:["middle-left","middle-right"],flipEnabled:!1,nodes:[]},{id:"shapeTransformer",nodes:[]}],shapes:[],center:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:4,fill:"black",opacity:1,draggable:!0,isGrouped:0,className:"Circle",id:"center",dragBoundFunc:oe},positionPoint:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint",distance_to_line_center:void 0},selectedShapeId:""}},mounted(){let t=this.$refs.stage.getStage().getChildren()[0].getChildren().filter((t=>"Text"==t.attrs.className));for(let a=0;a<t.length;a++)t[a].attrs.length_x=t[a].width(),t[a].attrs.length_y=t[a].height(),t[a].offsetX(t[a].attrs.length_x/2);let e=this.groups[0],i=e.line,s=e.shapes_g;for(let a=0;a<s.length;a++)this.updateDragFunc(s[a],i),this.updateAllPosInGrp(e.id)},created(){this.max_id_figures=this.shapes.length+this.groups.length},methods:{switchEraseMode(){0==this.eraseMode?(this.eraseMode=1,document.getElementById("playground").style.cursor="url("+i(843)+"),default",this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer")):(this.eraseMode=0,document.getElementById("playground").style.cursor="default")},checkIfShapesOnLine(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;let a=0;while(a<s.length)this.isCoordinateOnLine(s[a].x,s[a].y,i.id)?a+=1:(console.log("a shape is not on a line"),s[a].dragBoundFunc=oe,s[a].isGrouped=0,this.shapes.push(s[a]),i.freeDistances.push(i.occupiedDistances[a]),i.occupiedDistances.splice(a,1),s.splice(a,1),this.updateNaration(e))},isCoordinateOnLine(t,e,i){const s=this.groups.find((t=>t.id===i)),a=s.line;let n=!0,o=a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),r=a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),h=a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),l=a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),c=(o-h)/(l-r),d=a.y-c*a.x;return n=Math.abs(r-l)>1?Math.abs(c*t+d-e)>1:Math.abs(t-a.x)>1,!(n||(a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0||!n&&Math.sqrt((a.x-t)**2+(a.y-e)**2)>a.points[4]*a.scaleX/2)},updateGrp(t){let e=t.target.attrs.id;const i=this.groups.find((t=>t.id===e)),s=i.line;i.offsetX=s.offsetX,i.offsetY=s.offsetY,s.x=t.target.x(),s.y=t.target.y(),this.center.x=s.x,this.center.y=s.y,this.updateAllPosInGrp(s.id),this.checkIfShapesOnLine(s.id)},updateAllPosInGrp(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;for(let n=0;n<s.length;n++)i.keepDistribution,s[n].x=i.x+i.occupiedDistances[n]*Math.cos(i.rotation*(Math.PI/180)),s[n].y=i.y+i.occupiedDistances[n]*Math.sin(i.rotation*(Math.PI/180)),s[n].distance_to_line_center=i.occupiedDistances[n],s[n].rotation=s[n].personalRotation+i.rotation,i.positionPoints[n].x=s[n].x,i.positionPoints[n].y=s[n].y,i.positionPoints[n].distance_to_line_center=s[n].distance_to_line_center;let a=s.length;while(a<i.positionPoints.length)i.keepDistribution?i.positionPoints.splice(a,1):(i.positionPoints[a].x=i.x+i.freeDistances[a-s.length]*Math.cos(i.rotation*(Math.PI/180)),i.positionPoints[a].y=i.y+i.freeDistances[a-s.length]*Math.sin(i.rotation*(Math.PI/180)),i.positionPoints[a].distance_to_line_center=i.freeDistances[a-s.length],a++)},isOutsideTheLine(t,e){let i=e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180)),s=e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180)),a=e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180)),n=e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180)),o=(i-a)/(n-s),r=e.y-o*e.x,h=!1;return h=Math.abs(s-n)>=1?Math.abs(o*t.x+r-t.y)<1:Math.abs(t.x-e.x)<1,!h||(e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=0&&e.rotation*(Math.PI/180)>-Math.PI/2||(e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=0&&e.rotation*(Math.PI/180)>-Math.PI/2||(e.y+.5*e.points[4]*e.scaleX*Math.sin(Math.PI+e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(Math.PI+e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=-Math.PI/2&&e.rotation*(Math.PI/180)>-Math.PI||(e.x+.5*e.points[4]*e.scaleX*Math.cos(Math.PI+e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(Math.PI+e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=-Math.PI/2&&e.rotation*(Math.PI/180)>-Math.PI||(e.y+.5*e.points[4]*e.scaleX*Math.sin(Math.PI-e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(Math.PI-e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=Math.PI&&e.rotation*(Math.PI/180)>Math.PI/2||(e.x+.5*e.points[4]*e.scaleX*Math.cos(Math.PI-e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(Math.PI-e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=Math.PI&&e.rotation*(Math.PI/180)>Math.PI/2||(e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=Math.PI/2&&e.rotation*(Math.PI/180)>=0||(e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=Math.PI/2&&e.rotation*(Math.PI/180)>=0},update(){const t=this.shapes;let e=!1;for(let i=0;i<t.length;i++){let s=t[i].x,a=t[i].y;for(let n=0;n<this.groups.length;n++){let o=this.groups[n].line,r=o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),h=o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),l=o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),c=o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),d=(r-l)/(c-h),g=o.y-d*o.x;e=Math.abs(h-c)>1?Math.abs(d*s+g-a)<=this.lengthToCapture:Math.abs(s-o.x)<=this.lengthToCapture,(e&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=0&&o.rotation*(Math.PI/180)>-Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=-Math.PI/2&&o.rotation*(Math.PI/180)>=-Math.PI||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI&&o.rotation*(Math.PI/180)>Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI/2&&o.rotation*(Math.PI/180)>=0)&&(t[i].isGrouped=1,this.makeGroup(o.id))}}},CheckIfNeedToDetach(t){let e=this.groups.find((e=>e.id===t.target.getParent().attrs.id)),i=e.shapes_g.find((e=>e.id==t.target.id())),s=Math.sqrt((t.target.getStage().getPointerPosition().y-t.target.y())**2+(t.target.getStage().getPointerPosition().x-t.target.x())**2);"Rect"==t.target.className?s-=t.target.attrs.height*t.target.attrs.scaleY:"Circle"==t.target.className?s-=2*t.target.attrs.radius*t.target.attrs.scaleY:"Text"==t.target.className?s-=t.target.attrs.length_y*t.target.attrs.scaleY:("Image"==t.target.className||"Triangle"==t.target.attrs.className)&&(s-=t.target.height()*t.target.scaleY()),s>50&&(this.groups.find((e=>e.id===t.target.getParent().attrs.id)).aShapeHasBeenDetach=1,this.DetachShape(i,t.target.getStage().getPointerPosition().x,t.target.getStage().getPointerPosition().y))},GiveSignOfDistance(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(a)<=this.lengthToCapture&&-90==e.rotation?-Math.sign(n):Math.abs(a)<=this.lengthToCapture&&90==e.rotation?Math.sign(n):Math.sign(a),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},GiveSignOfDistanceBtwCenterAndShape(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(n)<=this.lengthToCapture&&-90==e.rotation?Math.sign(a):Math.abs(n)<=this.lengthToCapture&&90==e.rotation?-Math.sign(a):Math.sign(n),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},makeGroup(t){this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer");const e=this.groups.find((e=>e.id===t)),i=e.line,s=this.shapes;i.freeDistances.sort(this.isSmaller),s.sort(this.isBeforeRegardingX);for(let a=0;a<s.length;a++)if(1==s[a].isGrouped){const n=Object.assign({},this.positionPoint);let o=s[a].x-i.x,r=s[a].y-i.y;if(s[a].personalRotation=0,s[a].distance_to_line_center=this.GiveSignOfDistance(s[a],i)*Math.sqrt(o**2+r**2),Math.abs(s[a].distance_to_line_center)>=i.points[4]*i.scaleX/2&&(s[a].distance_to_line_center=Math.sign(s[a].distance_to_line_center)*i.points[4]*i.scaleX/2),this.ChangeCenterRegardingCommand(s[a].id,e.line.defaultAlignment),!i.keepDistribution&&i.freeDistances.length>0){let t=this.isNearest(i,s[a]);this.updateDragFunc(s[a],i),e.shapes_g.push(s[a]),e.line.occupiedDistances.push(e.line.freeDistances[t]),e.line.freeDistances.splice(t,1)}else this.updateDragFunc(s[a],i),e.shapes_g.push(s[a]),console.log("no 'free distance' anymore"),e.line.occupiedDistances.push(s[a].distance_to_line_center),n.id="positionPoint"+e.id+e.line.positionPoints.length,e.line.positionPoints.push(n);console.log("A new shape has been added with a distance"+s[a].distance_to_line_center),this.updateOccupiedDistance(i.id),this.updateAllPosInGrp(t),s.splice(a,1)}this.center.x=i.x,this.center.y=i.y},updateOccupiedDistance(t){const e=this.groups.find((e=>e.id===t));if(this.sortByDistToLineCenter(e),e.line.keepDistribution){let t=e.line.points[4],i=e.shapes_g.length,s=t/(i-1)*e.line.scaleX;if(i%2==0){for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[t-1]=-(i/2-1-t+1)*s-s/2;for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[i/2+t]=t*s+s/2;e.line.occupiedDistances[i/2-1]=-s/2,e.line.occupiedDistances[i/2]=s/2}else{for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[t-1]=-s*((i-1)/2-t+1);for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[(i-1)/2+t]=s*t;e.line.occupiedDistances[(i-1)/2]=0}for(let a=0;a<e.shapes_g.length;a++)e.shapes_g[a].distance_to_line_center=e.line.occupiedDistances[a]}else e.line.occupiedDistances.sort(this.isSmaller)},isSmaller(t,e){return t<e?-1:1},isBeforeRegardingX(t,e){return t.x<e.x?-1:1},updateOccDist(t,e){let i=this.isNearest(t.line,e);if(i.isFree){e.distance_to_line_center=t.line.freeDistances[i.indice],t.line.freeDistances.splice(i.indice,1),this.sortByDistToLineCenter(t);for(let e=0;e<t.shapes_g.length;e++)t.line.occupiedDistances.length==e?t.line.occupiedDistances.push(t.shapes_g[e].distance_to_line_center):t.line.occupiedDistances[e]=t.shapes_g[e].distance_to_line_center}else t.shapes_g.find((t=>t.id==e.id)).distance_to_line_center=t.line.occupiedDistances[i.indice],t.line.occupiedDistances.splice(i.indice,1),this.updateOccDist(t,t.shapes_g[i.indice])},isNearest(t,e){let i,s=t.x+t.freeDistances[0]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[0]*Math.sin(t.rotation*(Math.PI/180)),n=Math.sqrt((s-e.x)**2+(a-e.y)**2),o=0;for(let r=1;r<t.freeDistances.length;r++)s=t.x+t.freeDistances[r]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[r]*Math.sin(t.rotation*(Math.PI/180)),i=Math.sqrt((s-e.x)**2+(a-e.y)**2),i<n&&(n=i,o=r);return o},sortByDistToLineCenter(t){if(t.line.keepDistribution)for(let e=0;e<t.shapes_g.length;e++){let i=t.shapes_g[e].x-t.line.x,s=t.shapes_g[e].y-t.line.y;t.shapes_g[e].distance_to_line_center=this.GiveSignOfDistance(t.shapes_g[e],t.line)*Math.sqrt(i**2+s**2)}for(let e=1;e<t.shapes_g.length;e++){let i=t.shapes_g[e],s=e;while(s>0&&t.shapes_g[s-1].distance_to_line_center>i.distance_to_line_center)t.shapes_g[s]=t.shapes_g[s-1],s-=1;t.shapes_g[s]=i}},sortAnyShapesByDistToLineCenter(t,e){for(let i=0;i<t.length;i++){let s=t[i].x-e.x,a=t[i].y-e.y;t.distance_to_line_center=this.GiveSignOfDistance(t,e)*Math.sqrt(s**2+a**2)}for(let i=1;i<t.length;i++){let e=t[i],s=i;while(s>0&&t[s-1].distance_to_line_center>e.distance_to_line_center)t[s]=t[s-1],s-=1;t[s]=e}},updateDragFunc(t,e){let i=e.rotation*(Math.PI/180);i<=0&&i>=-Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.y-e.y)*Math.cos(i),y:e.y-(t.y-e.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.x-e.x)*Math.cos(i),y:e.y-(t.x-e.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.y-e.y)*Math.cos(i),y:e.y+(t.y-e.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}})},updatePos(t){const e=this.shapes.find((e=>e.id===t.target.id()));e.x=t.target.x(),e.y=t.target.y(),this.center.x=t.target.x(),this.center.y=t.target.y();let i={x:e.x,y:e.y};t.target.position(i),t.target.getLayer().batchDraw()},updatePosInGrp(t,e){let i,s,a;const n=this.groups.find((t=>t.id===e));if(1==n.aShapeHasBeenDetach)return void(n.aShapeHasBeenDetach=0);const o=n.line,r=n.shapes_g.find((e=>e.id===t.target.id())),h=n.shapes_g;if(1==r.needToBeDetach&&(r.needToBeDetach=0,this.DetachShape(r),this.updateAllPosInGrp(t.target.getParent().attrs.id)),o.keepDistribution){if(this.isCoordinateOnLine(t.target.x(),t.target.y(),o.id)){i=r.x-t.target.x(),s=r.y-t.target.y();let e=n.line.points[4],a=n.shapes_g.length,l=e/(a-1)*n.line.scaleX,c=Math.sqrt(i**2+s**2);c>=l?(r.x=t.target.x(),r.y=t.target.y(),this.updateOccupiedDistance(o.id),r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation,this.updateAllPosInGrp(o.id)):(r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation)}else r.x=t.target.x(),r.y=t.target.y();o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center}else o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,r.x=t.target.x(),r.y=t.target.y(),0==Math.sin(o.rotation*(Math.PI/180))?a=r.x-o.x:(a=0!=Math.sign(r.x-o.x)?Math.sign(-r.rotation)*Math.sign(r.x-o.x)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2):Math.sign(-r.rotation)*Math.sign(r.y-o.y)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2),(r.rotation*(Math.PI/180)<=-Math.PI/2||r.rotation*(Math.PI/180)<=Math.PI/2&&r.rotation*(Math.PI/180)>=0)&&(a=-a)),o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center;let l={x:r.x,y:r.y};if(this.center.x=r.x,this.center.y=r.y,t.target.position(l),t.target.getLayer().batchDraw(),this.isCoordinateOnLine(r.x,r.y,o.id))o.keepDistribution?n.line.occupiedDistances[h.indexOf(r)]=r.distance_to_line_center:n.line.occupiedDistances[h.indexOf(r)]=a,o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center;else{r.dragBoundFunc=oe,r.isGrouped=0,this.shapes.push(r);for(let t=0;t<h.length;t++)h[t].id==r.id&&(o.freeDistances.push(o.occupiedDistances[t]),o.occupiedDistances.splice(t,1),h.splice(t,1),console.log("a shape has been removed from the line"))}o.keepDistribution&&this.updateOccupiedDistance(o.id),this.updateAllPosInGrp(o.id)},updateTransformedShape(t){let e,i;if("Line"==t.target.className)i=this.groups.find((t=>t.id===this.selectedShapeId)).line;else if(e=this.findShape(this.selectedShapeId),i=e.shape_data,void 0==i)return;let s=i.x,a=i.y;i.x=t.target.x(),i.y=t.target.y(),i.rotation=t.target.rotation();let n=i.scaleX;if(i.scaleX=t.target.scaleX(),i.scaleY=t.target.scaleY(),"Line"==t.target.className){const e=this.groups.find((t=>t.id===i.id));if(i.keepDistribution){for(let t=0;t<i.occupiedDistances.length;t++)i.occupiedDistances[t]=i.occupiedDistances[t]/n*i.scaleX;this.update(),this.updateGrp(t),this.checkIfShapesOnLine(this.selectedShapeId)}else{if(n!=i.scaleX){for(let t=0;t<e.shapes_g.length;t++){let n=e.shapes_g[t].x-i.x,o=e.shapes_g[t].y-i.y;0==Math.sign(e.line.occupiedDistances[t])?e.line.occupiedDistances[t]=this.GiveSignOfDistance(e.shapes_g[t],i)*Math.sqrt(n**2+o**2):e.line.occupiedDistances[t]=Math.sign(e.line.occupiedDistances[t])*Math.sqrt(n**2+o**2),Math.sign(e.shapes_g[t].x-s)!=Math.sign(n)&&0!=Math.sign(e.shapes_g[t].x-s)&&90!=e.line.rotation&&-90!=e.line.rotation&&(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t]),Math.sign(e.shapes_g[t].y-a)==Math.sign(o)||0==Math.sign(e.shapes_g[t].y-a)||90!=e.line.rotation&&-90!=e.line.rotation||(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t])}for(let t=0;t<i.freeDistances.length;t++){let e=s-i.x,n=a-i.y,o=Math.sqrt(e**2+n**2);i.rotation<-90||i.rotation>90?i.freeDistances[t]=i.freeDistances[t]-Math.sign(s-i.x)*o:90==i.rotation||-90==i.rotation?i.freeDistances[t]=i.freeDistances[t]-n:i.freeDistances[t]=i.freeDistances[t]+Math.sign(s-i.x)*o}}this.update(),this.updateGrp(t),this.checkIfShapesOnLine(this.selectedShapeId);let o=0;while(o<i.freeDistances.length)if(i.points[4]*i.scaleX*.5+10<Math.abs(i.freeDistances[o])){let t=i.positionPoints.find((t=>t.distance_to_line_center==i.freeDistances[o])),e=i.positionPoints.indexOf(t);i.positionPoints.splice(e,1),i.freeDistances.splice(o,1)}else o+=1}for(let t=0;t<e.shapes_g.length;t++)this.updateDragFunc(e.shapes_g[t],i)}else"-1"!=e.grp_id?(this.updateAllPosInGrp(e.grp_id),this.updateOccupiedDistance(e.grp_id),t.target.x(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).x),t.target.y(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).y),this.groups.find((t=>t.id===e.grp_id)).shapes_g.find((e=>e.id===t.target.id())).personalRotation=t.target.rotation()-t.target.getParent().attrs.line.rotation,this.updateAllPosInGrp(e.grp_id),this.checkIfShapesOnLine(e.grp_id),this.updateDragFuncOfCenter()):(this.update(),this.updateDragFuncOfCenter());this.center.x=t.target.attrs.x,this.center.y=t.target.attrs.y,this.updateNaration(this.groups.find((t=>t.id===this.selectedShapeId)))},handleTransformation(t){if(document.getElementById("input").style.display="none",void 0==t.evt)return;if(1==this.eraseMode)return void this.eraserAction(t);if(t.target===t.target.getStage())return this.selectedShapeId="NoId",this.eraseNodefromTransformer("lineTransformer"),this.eraseNodefromTransformer("shapeTransformer"),void(this.center.opacity=0);const e="Transformer"===t.target.getParent().className;if(e)return;const i=t.target.id();let s,a=this.findShape(i).shape_data;"center"!=t.target.attrs.id&&("Line"==t.target.className?(s="lineTransformer",a=this.groups.find((t=>t.id===i)).line,this.center.draggable=!1,this.selectedShapeAlignment=a.defaultAlignment,this.eraseNodefromTransformer("shapeTransformer")):(s="shapeTransformer",this.center.draggable=!0,this.selectedShapeAlignment=a.centerPosition,this.eraseNodefromTransformer("lineTransformer")),void 0!=a?(this.selectedShapeId=i,this.center.opacity=1,this.updateTransformer(s)):this.selectedShapeId="NoId",this.updateDragFuncOfCenter())},eraseNodefromTransformer(t){let e=this.$refs.stage.getStage();const i=e.find("#"+t)[0];i.nodes([])},updateTransformer(t){let e=this.$refs.stage.getStage();const i=e.find("#"+t)[0];let s;if("lineTransformer"==t)s=e.children[0].getChildren().filter((t=>"Group"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0].getChildren().filter((t=>"Line"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];else{s=e.children[0].getChildren().filter((t=>"Group"!=t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];let t=!0;void 0==s&&(t=!1);let i=0;while(!t)i<this.groups.length?(s=e.children[0].getChildren().filter((t=>"Group"==t.attrs.className))[i].getChildren().find((t=>t.attrs.id==this.selectedShapeId&&"Line"!=t.attrs.className)),t=void 0!=s,i++):t=!0}s!==i.node()&&(void 0!=s?i.nodes([s]):i.nodes([]),this.center.x=s.attrs.x,this.center.y=s.attrs.y)},DisplayCenterMenu(t){ne.props.ConcernedShape=t.target,document.getElementById("center_menu").style.display="initial",document.getElementById("center_menu").style.top=document.getElementById("AppropriabilitySubstrateDemo").getBoundingClientRect().top+document.documentElement.scrollTop+t.target.getStage().getPointerPosition().y+"px",document.getElementById("center_menu").style.left=document.getElementById("AppropriabilitySubstrateDemo").getBoundingClientRect().left+document.documentElement.scrollLeft+t.target.getStage().getPointerPosition().x+"px"},DisplayContextMenu(t){t.evt.preventDefault(),void 0!=t.target.className&&"center"!=t.target.attrs.id&&(this.isStageOnlySelected=!1,$.data().dM="initial",this.$emit("needmenu"),this.needMenu=!0,$.props.ConcernedShape=t.target,"Line"==t.target.attrs.className?(this.isALineSelected=!0,this.isAGroupedShapeSelected=!0,this.keepDistanceButtonText=t.target.attrs.keepDistanceButtonText):"Group"==t.target.getParent().attrs.className?this.isAGroupedShapeSelected=!0:(this.isALineSelected=!1,this.isAGroupedShapeSelected=!1),document.getElementById("activeReuseSubstrate").style.display="initial",document.getElementById("activeReuseSubstrate").style.top=document.getElementById("AppropriabilitySubstrateDemo").getBoundingClientRect().top+document.documentElement.scrollTop+t.target.getStage().getPointerPosition().y+"px",document.getElementById("activeReuseSubstrate").style.left=document.getElementById("AppropriabilitySubstrateDemo").getBoundingClientRect().left+document.documentElement.scrollLeft+t.target.getStage().getPointerPosition().x+"px"),t.target===t.target.getStage()&&(this.needMenu=!0,this.isALineSelected=!1,this.isAGroupedShapeSelected=!1,this.isStageOnlySelected=!0,document.getElementById("activeReuseSubstrate").style.display="initial",document.getElementById("activeReuseSubstrate").style.top=document.getElementById("AppropriabilitySubstrateDemo").getBoundingClientRect().top+document.documentElement.scrollTop+t.target.getStage().getPointerPosition().y+"px",document.getElementById("activeReuseSubstrate").style.left=document.getElementById("AppropriabilitySubstrateDemo").getBoundingClientRect().left+document.documentElement.scrollLeft+t.target.getStage().getPointerPosition().x+"px")},HideContextMenu(){this.needMenu=!1,document.getElementById("activeReuseSubstrate").style.display="none",document.getElementById("center_menu").style.display="none"},ChangeCenter(t){let e,i,s=this.findShape(this.selectedShapeId),a=s.shape_data,n=this.GiveSignOfDistanceBtwCenterAndShape(t.target.attrs,a)*Math.sqrt((t.target.y()-a.y)**2+(t.target.x()-a.x)**2)+a.offsetY*a.scaleY,o=a.offsetY;void 0==a?a=this.groups.find((t=>t.id==this.selectedShapeId)).line:("Rect"==a.className?(e=a.height*a.scaleY/3,i=a.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.width/2,a.offsetY=a.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.width/2,a.offsetY=a.height,a.centerPosition="Bottom"):(a.offsetX=a.width/2,a.offsetY=0,a.centerPosition="Top")):"Circle"==a.className?(n+=a.radius*a.scaleY,e=a.radius*a.scaleY*2/3,i=a.radius*a.scaleY*4/3,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0,a.centerPosition="Middle"):n>i?(a.offsetX=0,a.offsetY=a.radius,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")):"Image"==a.className?(e=a.image.height*a.scaleY/3,i=a.image.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height,a.centerPosition="Bottom"):(a.offsetX=a.image.width/2,a.offsetY=0,a.centerPosition="Top")):"Text"==a.className?(e=a.length_y*a.scaleY/3,i=a.length_y*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y,a.centerPosition="Bottom"):(a.offsetX=a.length_x/2,a.offsetY=0,a.centerPosition="Top")):"Triangle"==a.className&&(n+=a.radius*a.scaleY,e=a.radius*a.scaleY/2,i=a.radius*a.scaleY*5/4,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0):n>i?(a.offsetX=0,a.offsetY=a.radius/2,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")),a.y=a.y-(o-a.offsetY)*a.scaleY*Math.cos(a.rotation*(Math.PI/180)),a.x=a.x+(o-a.offsetY)*a.scaleY*Math.sin(a.rotation*(Math.PI/180)),this.selectedShapeAlignment=a.centerPosition,"-1"!=s.grp_id&&this.updateAllPosInGrp(s.grp_id),t.target.x(a.x),t.target.y(a.y))},ChangeAlignCenter(t){let e,i=ne.props.ConcernedShape,s=this.groups.find((t=>t.id===this.selectedShapeId));if(void 0!=s){for(let e=0;e<s.shapes_g.length;e++)this.ChangeCenterRegardingCommand(s.shapes_g[e].id,t);i.x(s.line.x),i.y(s.line.y),s.line.defaultAlignment==t?s.line.defaultAlignment="":s.line.defaultAlignment=t,this.selectedShapeAlignment=s.line.defaultAlignment,this.updateNaration(s)}else e=this.findShape(this.selectedShapeId).shape_data,this.ChangeCenterRegardingCommand(e.id,t),this.selectedShapeAlignment=e.centerPosition,i.x(e.x),i.y(e.y)},ChangeCenterRegardingCommand(t,e){let i=this.findShape(t),s=i.shape_data,a=s.offsetY;"Rect"==s.className?"Top"==e?(s.offsetY=0,s.offsetX=s.width/2):"Middle"==e?(s.offsetX=s.width/2,s.offsetY=s.height/2):"Bottom"==e&&(s.offsetX=s.width/2,s.offsetY=s.height):"Circle"==s.className?"Top"==e?(s.offsetX=0,s.offsetY=-s.radius):"Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e&&(s.offsetX=0,s.offsetY=s.radius):"Image"==s.className?"Middle"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height/2):"Bottom"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height):"Top"==e&&(s.offsetX=s.image.width/2,s.offsetY=0):"Text"==s.className?"Middle"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y/2):"Bottom"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y):"Top"==e&&(s.offsetX=s.length_x/2,s.offsetY=0):"Triangle"==s.className&&("Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e?(s.offsetX=0,s.offsetY=s.radius/2):"Top"==e&&(s.offsetX=0,s.offsetY=-s.radius)),s.centerPosition=e,s.y=s.y-(a-s.offsetY)*s.scaleY*Math.cos(s.rotation*(Math.PI/180)),s.x=s.x+(a-s.offsetY)*s.scaleY*Math.sin(s.rotation*(Math.PI/180)),"-1"!=i.grp_id&&this.updateAllPosInGrp(i.grp_id)},updateDragFuncOfCenter(){let t=this.findShape(this.selectedShapeId).shape_data;if(void 0==t)return;let e=this.center,i=t.rotation*(Math.PI/180);i>=-Math.PI/2&&i<=0?i-=Math.PI/180*90:i<-Math.PI/2?(i+=Math.PI/2,i=Math.PI+i):i<=Math.PI&&i>0&&(i-=Math.PI/180*90),i<=0&&i>=-Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.y-t.y)*Math.cos(i),y:t.y-(e.y-t.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.x-t.x)*Math.cos(i),y:t.y-(e.x-t.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.y-t.y)*Math.cos(i),y:t.y+(e.y-t.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}})},findShape(t){let e=this.shapes.find((e=>e.id===t)),i="-1",s=!0;void 0==e&&(s=!1);let a=0;while(!s)a<this.groups.length?(e=this.groups[a].shapes_g.find((e=>e.id===t)),void 0==e?s=!1:(i=this.groups[a].id,s=!0),a++):s=!0;return{shape_data:e,grp_id:i}},DetachShape(t,e,i){const s=this.lengthToCapture+5;let a=this.groups.find((e=>-1!=e.shapes_g.indexOf(t))),n=a.shapes_g.indexOf(t);t.dragBoundFunc=oe;let o=a.line.y-.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),r=a.line.x+.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),h=a.line.y+.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),l=a.line.x-.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),c=(h-o)/(r-l),d=t.x*(1/c)+t.y;a.line.rotation<0&&a.line.rotation>-45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-45&&a.line.rotation>-90||a.line.rotation<-90&&a.line.rotation>-135?(t.x=t.x+Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-135&&a.line.rotation>-180||a.line.rotation>135&&a.line.rotation<180?(t.x=t.x-Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>90&&a.line.rotation<=135||a.line.rotation>45&&a.line.rotation<=90?(t.x=t.x-Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>0&&a.line.rotation<=45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):-90==a.line.rotation?t.x=t.x-Math.sign(t.x-e)*s:90==a.line.rotation?t.x=t.x+Math.sign(t.x-e)*s:(180==a.line.rotation||-180==a.line.rotation||0==a.line.rotation)&&(t.y=t.y-Math.sign(t.y-i)*s),t.isGrouped=0,this.shapes.push(t),this.center.x=t.x,this.center.y=t.y,a.line.freeDistances.push(a.line.occupiedDistances[n]),a.line.occupiedDistances.splice(n,1),a.shapes_g.splice(n,1),a.line.keepDistribution&&a.line.positionPoints.splice(n,1),this.updateOccupiedDistance(a.id),this.updateAllPosInGrp(a.id),this.updateNaration(a),this.eraseNodefromTransformer("shapeTransformer")},DetachShapeButtonAction(){let t=$.props.ConcernedShape;if("Line"==t.attrs.className){let e=t.getParent().attrs.shapes_g;while(0!=e.length)this.DetachShape(e[0])}else{let e=this.shapes.find((e=>e.id===t.attrs.id)),i=!0;void 0==e&&(i=!1);let s=0;while(!i)s<this.groups.length?(e=this.groups[s].shapes_g.find((e=>e.id===t.attrs.id)),i=void 0!=e,s++):i=!0;this.DetachShape(e)}},KeepDistribution(){let t=this.groups.find((t=>t.id===$.props.ConcernedShape.attrs.id)),e=t.line;if(void 0!=e){if(e.keepDistribution){e.keepDistribution=!1;for(let i=0;i<t.shapes_g.length;i++)t.shapes_g[i].distance_to_line_center=e.occupiedDistances[i];e.freeDistances=[],e.stroke="blue",t.line.keepDistanceButtonText="Keep Distribution"}else{e.keepDistribution=!0;for(let i=0;i<t.shapes_g.length;i++)e.occupiedDistances[i]=t.shapes_g[i].distance_to_line_center;e.stroke="rgb(48,48,48)",t.line.keepDistanceButtonText="Liberate Distribution",this.updateOccupiedDistance(e.id),this.updateAllPosInGrp(e.id)}this.updateNaration(t)}},createNewShape(t){if("Line"==t.attrs.className){this.max_id_figures=this.max_id_figures+1;let e=t.getParent().clone({id:""+this.max_id_figures,name:"group"+this.max_id_figures,shapes_g:[]});e.attrs.line.id=""+this.max_id_figures,e.attrs.line.x=t.getStage().getPointerPosition().x,e.attrs.line.y=t.getStage().getPointerPosition().y,e.attrs.line.draggable=!0,this.groups.push(e.attrs)}else{this.max_id_figures=this.max_id_figures+1;let e=t.clone({id:""+this.max_id_figures,draggable:!0});e.attrs.isGrouped=0,this.shapes.push(e.attrs)}},eraserAction(t){this.Remove(t.target)},unshowSelectedShape(t){"Line"==t.target.attrs.className&&0==this.eraseMode?t.target.opacity(.5):"Line"==t.target.attrs.className&&1==this.eraseMode?1==t.target.attrs.keepDistribution?t.target.stroke("rgb(48,48,48)"):t.target.stroke("blue"):"positionPoint"==t.target.attrs.className&&1==this.eraseMode?1!=t.target.getParent().attrs.line.keepDistribution&&t.target.strokeWidth(0):1==this.eraseMode&&t.target.strokeWidth(0)},showSelectedShape(t){if("Line"==t.target.attrs.className&&0==this.eraseMode)t.target.opacity(1);else if("Line"==t.target.attrs.className&&1==this.eraseMode)t.target.stroke("rgb(200, 59, 218)");else if("positionPoint"==t.target.attrs.className&&1==this.eraseMode){let e=t.target.getParent().attrs.line;-1!=e.freeDistances.indexOf(t.target.attrs.distance_to_line_center)&&1!=e.keepDistribution&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))}else 1==this.eraseMode&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))},editText(t){let e=t.target.getStage().attrs.container.getBoundingClientRect();document.getElementById("input").style.top=e.y+t.target.getAbsolutePosition().y+"px",document.getElementById("input").style.left=e.x+t.target.getAbsolutePosition().x-5*document.getElementById("input").size+"px",document.getElementById("input").style.display="initial",this.editedText=t.target},updateText(t){let e=this.shapes.find((t=>t.id===this.editedText.attrs.id)),i=!0;void 0==e&&(i=!1);let s=0;while(!i)s<this.groups.length?(e=this.groups[s].shapes_g.find((t=>t.id===this.editedText.attrs.id)),i=void 0!=e,s++):i=!0;if(void 0!=e){let i,s,a,n;i=this.editedText.width(),s=this.editedText.height(),e.text=t.target.value,this.editedText.text(t.target.value),a=this.editedText.width()-i,n=this.editedText.height()-s,e.offsetX=e.offsetX+a/2,e.offsetY=e.offsetY+n/2,e.length_x=this.editedText.width(),e.length_y=this.editedText.height(),document.getElementById("input").style.display="none"}},updateNaration(t){let e;e=1==t.line.keepDistribution?"<mark class='black'> The Stickyline preserves alignment and distribution.</mark><br>":"<mark class='blue'> The Stickyline only preserves alignment. </mark><br>",e+="<strong>Substrate :</strong><br>",e=e+"- <mark class='blue'> StickyLine </mark> with size="+t.line.points[4]*t.line.scaleX.toFixed(2)+"<br> and rotation="+t.line.rotation.toFixed(1)+"<br>",e=1==t.line.keepDistribution?e+"Relation: "+t.line.defaultAlignment+" <i>alignement and distribution with</i>:":e+"Relation: "+t.line.defaultAlignment+" <i>alignement with</i>:";for(let i=0;i<t.shapes_g.length;i++)e=e+"<br>- "+t.shapes_g[i].className;this.$emit("explain",{origin:"Substrate - Appropriability<br><mark class='blue'> The substrate supports user customization and updates itself. </mark>",text:e})}}};const he=(0,f.Z)(re,[["render",te]]);var le=he;function ce(t,e,i,n,o,r){const h=(0,a.up)("v-rect"),l=(0,a.up)("v-circle"),c=(0,a.up)("v-image"),d=(0,a.up)("v-text"),g=(0,a.up)("v-regular-polygon"),p=(0,a.up)("v-line"),u=(0,a.up)("v-group"),f=(0,a.up)("v-transformer"),M=(0,a.up)("v-layer"),x=(0,a.up)("v-stage");return(0,a.wg)(),(0,a.iD)("div",{onClick:e[1]||(e[1]=(...e)=>t.HideContextMenu&&t.HideContextMenu(...e)),id:"DiscoverabilitySubstrateDemo",onMousedown:e[2]||(e[2]=t=>r.updateNaration(this.groups[0]))},[(0,a.Wm)(x,{ref:"stage",id:"stage",config:o.stageSize,onDragmove:r.update,onMousedown:r.handleTransformation,onTouchstart:r.handleTransformation,onFusion:r.makeGroup,onContextMenu:t.DisplayContextMenu},{default:(0,a.w5)((()=>[(0,a.Wm)(M,{ref:"layer"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.groups,(t=>((0,a.wg)(),(0,a.j4)(u,{ref_for:!0,ref:"groups",key:t.id,config:t},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Rect"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(h,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.onDragging,onDragstart:r.initializeDragging,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onDragstart","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Circle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(l,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.onDragging,onDragstart:r.initializeDragging,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onDragstart","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Image"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(c,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.onDragging,onDragstart:r.initializeDragging,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onDragstart","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Text"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(d,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.onDragging,onDragstart:r.initializeDragging,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape,onDblclick:r.editText},null,8,["config","onTransformend","onDragend","onDragmove","onDragstart","onMouseenter","onMouseout","onDblclick"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Triangle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(g,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.onDragging,onDragstart:r.initializeDragging,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onDragstart","onMouseenter","onMouseout"])))),128)),((0,a.wg)(),(0,a.j4)(p,{key:t.line.id,config:t.line,onTransformend:r.updateTransformedShape,onDragmove:e=>r.updateGrp(e,t.id),onMouseout:r.unshowSelectedShape,onMouseenter:r.showSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseout","onMouseenter"])),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.ghosts.filter((t=>"Rect"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(h,{key:t.id,config:t},null,8,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.ghosts.filter((t=>"Circle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(l,{key:t.id,config:t},null,8,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.ghosts.filter((t=>"Image"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(c,{key:t.id,config:t},null,8,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.ghosts.filter((t=>"Text"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(d,{key:t.id,config:t},null,8,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.ghosts.filter((t=>"Triangle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(g,{key:t.id,config:t},null,8,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.line.positionPoints,(t=>((0,a.wg)(),(0,a.j4)(l,{key:t.id,config:t,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onMouseenter","onMouseout"])))),128))])),_:2},1032,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Rect"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(h,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Circle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(l,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Triangle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(g,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.transformers,(t=>((0,a.wg)(),(0,a.j4)(f,{key:t.id,config:t},null,8,["config"])))),128)),((0,a.wg)(),(0,a.j4)(l,{key:o.center.id,config:o.center,onDragend:r.ChangeCenter,onClick:t.DisplayCenterMenu},null,8,["config","onDragend","onClick"]))])),_:1},512)])),_:1},8,["config","onDragmove","onMousedown","onTouchstart","onFusion","onContextMenu"]),(0,a._)("input",{type:"text",id:"input",size:"10",value:"a text",onKeyup:e[0]||(e[0]=(0,s.D2)(((...t)=>r.updateText&&r.updateText(...t)),["enter"]))},null,32)],32)}const de=function(t){let e=this.getStage().width(),i=this.getStage().height(),s=10;return t.x>e-s&&t.y>i-s?{x:e-s,y:i-s}:t.x>e-s&&t.y<s?{x:e-s,y:s}:t.y>i-s&&t.x<s?{x:s,y:i-s}:t.x<s&&t.y<s?{x:s,y:s}:t.x<s?{x:s,y:t.y}:t.y<s?{x:t.x,y:s}:t.x>e-s?{x:e-s,y:t.y}:t.y>i-s?{x:t.x,y:i-s}:{x:t.x,y:t.y}};var ge={props:{width:{type:Number,default:window.innerWidth},height:{type:Number,default:window.innerHeight}},components:{},data(){return{stageSize:{width:this.width,height:this.height},lengthToCapture:10,lengthToDetach:15,editedText:null,eraseMode:0,selectedShapeAlignment:"",neighbour:[],dist_with_neighbour:null,needMenu:"initial",isALineSelected:!1,isAGroupedShapeSelected:!1,isStageOnlySelected:!1,keepDistanceButtonText:"Liberate Distribution",max_id_figures:6,groups:[{name:"group",className:"Group",id:"1",x:0,y:0,offsetX:0,offsetY:0,rotation:0,draggable:!1,ghosts:[],shapes_g:[{rotation:0,x:30,y:220,scaleX:1,scaleY:1,offsetX:0,offsetY:40,radius:40,fill:"orange",strokeWidth:0,stroke:"black",draggable:!0,isGrouped:1,className:"Circle",personalRotation:0,id:"6",dragBoundFunc:de,centerPosition:"Bottom"},{rotation:0,id:"8",x:150,y:220,width:70,height:70,scaleX:1,scaleY:1,strokeWidth:0,stroke:"black",opacity:1,fill:"green",name:"rect2",draggable:!0,className:"Rect",isGrouped:0,dragBoundFunc:de,offsetX:35,offsetY:70,personalRotation:0,centerPosition:"Bottom"},{rotation:0,id:"7",x:250,y:220,sides:3,radius:45,width:90,height:90,scaleX:1,scaleY:1,opacity:1,strokeWidth:0,stroke:"black",fill:"purple",name:"triangle1",draggable:!0,className:"Triangle",isGrouped:0,dragBoundFunc:de,offsetX:0,offsetY:22.5,personalRotation:0,centerPosition:"Bottom"}],aShapeHasBeenDetach:0,line:{x:150,y:220,points:[0,0,0,0,250,0],positionPoints:[{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,opacity:1,fill:"yellow",draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint1",distance_to_line_center:void 0},{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint2",distance_to_line_center:void 0},{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint3",distance_to_line_center:void 0}],strokeWidth:10,rotation:0,tension:0,closed:!0,draggable:!0,scaleX:1,scaleY:1,opacity:.5,offset:{x:125,y:0},name:"ligne",className:"Line",stroke:"rgb(48,48,48)",id:"1",keepDistribution:!0,freeDistances:[],occupiedDistances:[-125,0,125],keepDistanceButtonText:"Liberate Distribution",defaultAlignment:"Bottom",dragBoundFunc:de}}],transformers:[{id:"lineTransformer",enabledAnchors:[],rotateEnabled:!1,borderEnabled:!1,flipEnabled:!1,nodes:[]},{id:"shapeTransformer",nodes:[]}],shapes:[],center:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:4,fill:"black",opacity:1,draggable:!0,isGrouped:0,className:"Circle",id:"center",dragBoundFunc:de},positionPoint:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint",distance_to_line_center:void 0},selectedShapeId:""}},mounted(){let t=this.$refs.stage.getStage().getChildren()[0].getChildren().filter((t=>"Text"==t.attrs.className));for(let a=0;a<t.length;a++)t[a].attrs.length_x=t[a].width(),t[a].attrs.length_y=t[a].height(),t[a].offsetX(t[a].attrs.length_x/2);let e=this.groups[0],i=e.line,s=e.shapes_g;for(let a=0;a<s.length;a++)this.updateDragFunc(s[a],i),this.updateAllPosInGrp(e.id)},created(){this.max_id_figures=this.shapes.length+this.groups.length},methods:{switchEraseMode(){0==this.eraseMode?(this.eraseMode=1,this.eraser.opacity=.4,document.getElementById("DiscoverabilityDemo").style.cursor="url("+i(843)+"),default",this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer")):(this.eraseMode=0,this.eraser.opacity=1,document.getElementById("DiscoverabilityDemo").style.cursor="default")},checkIfShapesOnLine(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;let a=0;while(a<s.length)if(this.isCoordinateOnLine(s[a].x,s[a].y,i.id))a+=1;else{console.log("a shape is not on a line"),s[a].dragBoundFunc=de,s[a].isGrouped=0,i.positionPoints.splice(a,1),this.shapes.push(s[a]),i.freeDistances.push(i.occupiedDistances[a]),i.occupiedDistances.splice(a,1),s.splice(a,1),e.ghosts.splice(0,e.ghosts.length);for(let t=0;t<s.length;t++)s[t].opacity=1;this.updateNaration(e)}},isCoordinateOnLine(t,e,i){const s=this.groups.find((t=>t.id===i)),a=s.line;let n=!0,o=a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),r=a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),h=a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),l=a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),c=(o-h)/(l-r),d=a.y-c*a.x;return n=Math.abs(r-l)>1?Math.abs(c*t+d-e)>1:Math.abs(t-a.x)>1,!(n||(a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0)},updateGrp(t,e){const i=this.groups.find((t=>t.id===e)),s=i.line;i.offsetX=s.offsetX,i.offsetY=s.offsetY,s.x=t.target.x(),s.y=t.target.y(),this.center.x=s.x,this.center.y=s.y,this.updateAllPosInGrp(s.id),this.checkIfShapesOnLine(s.id)},updateAllPosInGrp(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;for(let n=0;n<s.length;n++)i.keepDistribution,s[n].x=i.x+i.occupiedDistances[n]*Math.cos(i.rotation*(Math.PI/180)),s[n].y=i.y+i.occupiedDistances[n]*Math.sin(i.rotation*(Math.PI/180)),s[n].distance_to_line_center=i.occupiedDistances[n],s[n].rotation=s[n].personalRotation+i.rotation,i.positionPoints[n].x=s[n].x,i.positionPoints[n].y=s[n].y,i.positionPoints[n].distance_to_line_center=s[n].distance_to_line_center;let a=s.length;while(a<i.positionPoints.length)i.keepDistribution?i.positionPoints.splice(a,1):(i.positionPoints[a].x=i.x+i.freeDistances[a-s.length]*Math.cos(i.rotation*(Math.PI/180)),i.positionPoints[a].y=i.y+i.freeDistances[a-s.length]*Math.sin(i.rotation*(Math.PI/180)),i.positionPoints[a].distance_to_line_center=i.freeDistances[a-s.length],a++)},isOutsideTheLine(t,e){let i=e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180)),s=e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180)),a=e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180)),n=e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180)),o=(i-a)/(n-s),r=e.y-o*e.x,h=!1;return h=Math.abs(s-n)>=1?Math.abs(o*t.x+r-t.y)<1:Math.abs(t.x-e.x)<1,!h||(e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=0&&e.rotation*(Math.PI/180)>-Math.PI/2||(e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=0&&e.rotation*(Math.PI/180)>-Math.PI/2||(e.y+.5*e.points[4]*e.scaleX*Math.sin(Math.PI+e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(Math.PI+e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=-Math.PI/2&&e.rotation*(Math.PI/180)>-Math.PI||(e.x+.5*e.points[4]*e.scaleX*Math.cos(Math.PI+e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(Math.PI+e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=-Math.PI/2&&e.rotation*(Math.PI/180)>-Math.PI||(e.y+.5*e.points[4]*e.scaleX*Math.sin(Math.PI-e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(Math.PI-e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=Math.PI&&e.rotation*(Math.PI/180)>Math.PI/2||(e.x+.5*e.points[4]*e.scaleX*Math.cos(Math.PI-e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(Math.PI-e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=Math.PI&&e.rotation*(Math.PI/180)>Math.PI/2||(e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=Math.PI/2&&e.rotation*(Math.PI/180)>=0||(e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=Math.PI/2&&e.rotation*(Math.PI/180)>=0},update(){const t=this.shapes;let e=!1;for(let i=0;i<t.length;i++){let s=t[i].x,a=t[i].y;for(let n=0;n<this.groups.length;n++){let o=this.groups[n].line,r=o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),h=o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),l=o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),c=o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),d=(r-l)/(c-h),g=o.y-d*o.x;e=Math.abs(h-c)>1?Math.abs(d*s+g-a)<=this.lengthToCapture:Math.abs(s-o.x)<=this.lengthToCapture,(e&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=0&&o.rotation*(Math.PI/180)>-Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=-Math.PI/2&&o.rotation*(Math.PI/180)>=-Math.PI||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI&&o.rotation*(Math.PI/180)>Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI/2&&o.rotation*(Math.PI/180)>=0)&&(t[i].isGrouped=1,this.makeGroup(o.id))}}},initializeDragging(t){let e=this.groups.find((e=>e.id==t.target.getParent().attrs.id));if(e.shapes_g.length>1&&1==e.line.keepDistribution){let i=this.closestGroupedShape(e,t);this.neighbour.push(t.target.getParent().getChildren().find((t=>t.attrs.id==i.id)));let s={x:t.target.x(),y:t.target.y()};this.createGhost(e,s,this.neighbour[this.neighbour.length-1]),this.dist_with_neighbour=this.distBtwShapes(t.target.attrs,this.neighbour[this.neighbour.length-1].attrs)}},closestGroupedShape(t,e){let i=t.shapes_g.find((t=>t.id!=e.target.attrs.id&&0!=t.opacity));for(let s=0;s<t.shapes_g.length;s++)this.distBtwShapes(t.shapes_g[s],e.target.attrs),this.distBtwShapes(t.shapes_g[s],e.target.attrs)<this.distBtwShapes(i,e.target.attrs)&&t.shapes_g[s].id!=e.target.attrs.id&&0!=t.shapes_g[s].opacity&&(i=t.shapes_g[s]);return i},createGhost(t,e,i){if(1==t.line.keepDistribution){let s=i.clone({id:"clone"+i.attrs.id,x:e.x,y:e.y,opacity:0,draggable:!1});t.ghosts.push(s.attrs)}},distBtwShapes(t,e){return Math.sqrt((e.y-t.y)**2+(e.x-t.x)**2)},distFromStartPoint(t,e){return Math.sqrt((t.y-e.target.y())**2+(t.x-e.target.x())**2)},targetNeighbour(t){let e=this.groups.find((e=>e.id===t.target.getParent().attrs.id)),i=e.shapes_g.find((e=>e.id==t.target.attrs.id)),s=e.shapes_g.indexOf(i);if(0==s)return e.shapes_g[1];if(s==e.shapes_g.length-1)return e.shapes_g[s-1];{let i=this.distBtwShapes(t.target.attrs,e.shapes_g[s+1]),a=this.distBtwShapes(t.target.attrs,e.shapes_g[s-1]);return i>a?e.shapes_g[s-1]:e.shapes_g[s+1]}},onDragging(t){let e=this.groups.find((e=>e.id===t.target.getParent().attrs.id)),i=e.shapes_g.find((e=>e.id==t.target.id())),s=Math.sqrt((t.target.getStage().getPointerPosition().y-t.target.y())**2+(t.target.getStage().getPointerPosition().x-t.target.x())**2);if(1==e.line.keepDistribution&&e.shapes_g.length>1){let s=e.ghosts.find((t=>t.id=="clone"+this.neighbour[this.neighbour.length-1].attrs.id));if(e.shapes_g.length>1&&this.isCoordinateOnLine(t.target.x(),t.target.y(),e.id)){let a=e.shapes_g.find((t=>t.id===this.neighbour[this.neighbour.length-1].attrs.id)),n=this.distFromStartPoint(i,t),o=e.line.points[4]*e.line.scaleX/(e.shapes_g.length-1);if(this.closestGroupedShape(e,t).id!=this.neighbour[this.neighbour.length-1].attrs.id){let o;console.log("a change"),o=0==this.neighbour[this.neighbour.length-1].attrs.opacity?{x:a.x,y:a.y}:{x:i.x,y:i.y},s.opacity<=.5&&n<=e.line.points[4]*e.line.scaleX/2?(console.log("ghost erase"),e.ghosts.splice(e.ghosts.indexOf(s),1)):(i.x=a.x,i.y=a.y,a.x=s.x,a.y=s.y,a.opacity=1,e.ghosts.splice(e.ghosts.indexOf(s),1),this.sortByDistToLineCenter(e)),this.neighbour.push(t.target.getParent().getChildren().find((i=>i.attrs.id==this.closestGroupedShape(e,t).id))),this.createGhost(e,o,this.neighbour[this.neighbour.length-1]),s=e.ghosts.find((t=>t.id=="clone"+this.neighbour[this.neighbour.length-1].attrs.id))}n=this.distFromStartPoint(i,t),this.dist_with_neighbour=this.distBtwShapes(t.target.attrs,this.neighbour[this.neighbour.length-1].attrs);let r=n/o,h=r;r>=.3&&(h=.3),r>=1&&(h=1),s.opacity=h,this.neighbour[this.neighbour.length-1].opacity(1-1*h),a=e.shapes_g.find((t=>t.id===this.neighbour[this.neighbour.length-1].attrs.id)),a.opacity=1-1*h}else{for(let t=0;t<e.shapes_g.length;t++)e.shapes_g[t].opacity=1;s.opacity=0}}"Rect"==t.target.className?s-=t.target.attrs.height*t.target.attrs.scaleY:"Circle"==t.target.className?s-=2*t.target.attrs.radius*t.target.attrs.scaleY:"Text"==t.target.className?s-=t.target.attrs.length_y*t.target.attrs.scaleY:("Image"==t.target.className||"Triangle"==t.target.attrs.className)&&(s-=t.target.height()*t.target.scaleY()),s>50&&(this.groups.find((e=>e.id===t.target.getParent().attrs.id)).aShapeHasBeenDetach=1,this.DetachShape(i,t.target.getStage().getPointerPosition().x,t.target.getStage().getPointerPosition().y))},GiveSignOfDistance(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(a)<=this.lengthToCapture&&-90==e.rotation?-Math.sign(n):Math.abs(a)<=this.lengthToCapture&&90==e.rotation?Math.sign(n):Math.sign(a),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},GiveSignOfDistanceBtwCenterAndShape(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(n)<=this.lengthToCapture&&-90==e.rotation?Math.sign(a):Math.abs(n)<=this.lengthToCapture&&90==e.rotation?-Math.sign(a):Math.sign(n),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},makeGroup(t){this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer");const e=this.groups.find((e=>e.id===t)),i=e.line,s=this.shapes;i.freeDistances.sort(this.isSmaller),s.sort(this.isBeforeRegardingX);for(let a=0;a<s.length;a++)if(1==s[a].isGrouped){const n=Object.assign({},this.positionPoint);let o=s[a].x-i.x,r=s[a].y-i.y;s[a].personalRotation=0,s[a].distance_to_line_center=this.GiveSignOfDistance(s[a],i)*Math.sqrt(o**2+r**2),Math.abs(s[a].distance_to_line_center)>=i.points[4]*i.scaleX/2&&(s[a].distance_to_line_center=Math.sign(s[a].distance_to_line_center)*i.points[4]*i.scaleX/2),this.ChangeCenterRegardingCommand(s[a].id,e.line.defaultAlignment),this.updateDragFunc(s[a],i),e.shapes_g.push(s[a]),console.log("no 'free distance' anymore"),e.line.occupiedDistances.push(s[a].distance_to_line_center),n.id="positionPoint"+e.id+e.line.positionPoints.length,e.line.positionPoints.push(n),console.log("A new shape has been added with a distance"+s[a].distance_to_line_center),this.updateOccupiedDistance(i.id),this.updateAllPosInGrp(t),s.splice(a,1),this.updateNaration(e)}this.center.x=i.x,this.center.y=i.y},updateOccupiedDistance(t){const e=this.groups.find((e=>e.id===t));if(this.sortByDistToLineCenter(e),e.line.keepDistribution){let t=e.line.points[4],i=e.shapes_g.length,s=t/(i-1)*e.line.scaleX;if(i%2==0){for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[t-1]=-(i/2-1-t+1)*s-s/2;for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[i/2+t]=t*s+s/2;e.line.occupiedDistances[i/2-1]=-s/2,e.line.occupiedDistances[i/2]=s/2}else{for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[t-1]=-s*((i-1)/2-t+1);for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[(i-1)/2+t]=s*t;e.line.occupiedDistances[(i-1)/2]=0}for(let a=0;a<e.shapes_g.length;a++)e.shapes_g[a].distance_to_line_center=e.line.occupiedDistances[a]}else e.line.occupiedDistances.sort(this.isSmaller)},isSmaller(t,e){return t<e?-1:1},isBeforeRegardingX(t,e){return t.x<e.x?-1:1},updateOccDist(t,e){let i=this.isNearest(t.line,e);if(i.isFree){e.distance_to_line_center=t.line.freeDistances[i.indice],t.line.freeDistances.splice(i.indice,1),this.sortByDistToLineCenter(t);for(let e=0;e<t.shapes_g.length;e++)t.line.occupiedDistances.length==e?t.line.occupiedDistances.push(t.shapes_g[e].distance_to_line_center):t.line.occupiedDistances[e]=t.shapes_g[e].distance_to_line_center}else t.shapes_g.find((t=>t.id==e.id)).distance_to_line_center=t.line.occupiedDistances[i.indice],t.line.occupiedDistances.splice(i.indice,1),this.updateOccDist(t,t.shapes_g[i.indice])},isNearest(t,e){let i,s=t.x+t.freeDistances[0]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[0]*Math.sin(t.rotation*(Math.PI/180)),n=Math.sqrt((s-e.x)**2+(a-e.y)**2),o=0;for(let r=1;r<t.freeDistances.length;r++)s=t.x+t.freeDistances[r]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[r]*Math.sin(t.rotation*(Math.PI/180)),i=Math.sqrt((s-e.x)**2+(a-e.y)**2),i<n&&(n=i,o=r);return o},sortByDistToLineCenter(t){if(t.line.keepDistribution)for(let e=0;e<t.shapes_g.length;e++){let i=t.shapes_g[e].x-t.line.x,s=t.shapes_g[e].y-t.line.y;t.shapes_g[e].distance_to_line_center=this.GiveSignOfDistance(t.shapes_g[e],t.line)*Math.sqrt(i**2+s**2)}for(let e=1;e<t.shapes_g.length;e++){let i=t.shapes_g[e],s=e;while(s>0&&t.shapes_g[s-1].distance_to_line_center>i.distance_to_line_center)t.shapes_g[s]=t.shapes_g[s-1],s-=1;t.shapes_g[s]=i}},sortAnyShapesByDistToLineCenter(t,e){for(let i=0;i<t.length;i++){let s=t[i].x-e.x,a=t[i].y-e.y;t.distance_to_line_center=this.GiveSignOfDistance(t,e)*Math.sqrt(s**2+a**2)}for(let i=1;i<t.length;i++){let e=t[i],s=i;while(s>0&&t[s-1].distance_to_line_center>e.distance_to_line_center)t[s]=t[s-1],s-=1;t[s]=e}},updateDragFunc(t,e){let i=e.rotation*(Math.PI/180);i<=0&&i>=-Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.y-e.y)*Math.cos(i),y:e.y-(t.y-e.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.x-e.x)*Math.cos(i),y:e.y-(t.x-e.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.y-e.y)*Math.cos(i),y:e.y+(t.y-e.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}})},updatePos(t){const e=this.shapes.find((e=>e.id===t.target.id()));e.x=t.target.x(),e.y=t.target.y(),this.center.x=t.target.x(),this.center.y=t.target.y();let i={x:e.x,y:e.y};t.target.position(i),t.target.getLayer().batchDraw()},updatePosInGrp(t,e){let i,s,a;const n=this.groups.find((t=>t.id===e));if(1==n.aShapeHasBeenDetach)return void(n.aShapeHasBeenDetach=0);const o=n.line,r=n.shapes_g.find((e=>e.id===t.target.id())),h=n.shapes_g;if(o.keepDistribution){n.ghosts.splice(0,n.ghosts.length);for(let t=0;t<h.length;t++)h[t].opacity=1;if(this.neighbour.splice(0,this.neighbour.length),this.isCoordinateOnLine(t.target.x(),t.target.y(),o.id)){i=r.x-t.target.x(),s=r.y-t.target.y();let e=n.line.points[4],a=n.shapes_g.length,l=e/(a-1)*n.line.scaleX,c=Math.sqrt(i**2+s**2);c>=l?(r.x=t.target.x(),r.y=t.target.y(),this.updateOccupiedDistance(o.id),r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation,this.updateAllPosInGrp(o.id)):(r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation)}else r.x=t.target.x(),r.y=t.target.y();o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center}else o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,r.x=t.target.x(),r.y=t.target.y(),0==Math.sin(o.rotation*(Math.PI/180))?a=r.x-o.x:(a=0!=Math.sign(r.x-o.x)?Math.sign(-r.rotation)*Math.sign(r.x-o.x)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2):Math.sign(-r.rotation)*Math.sign(r.y-o.y)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2),(r.rotation*(Math.PI/180)<=-Math.PI/2||r.rotation*(Math.PI/180)<=Math.PI/2&&r.rotation*(Math.PI/180)>=0)&&(a=-a)),o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center;let l={x:r.x,y:r.y};if(this.center.x=r.x,this.center.y=r.y,t.target.position(l),t.target.getLayer().batchDraw(),this.isCoordinateOnLine(r.x,r.y,o.id))o.keepDistribution?n.line.occupiedDistances[h.indexOf(r)]=r.distance_to_line_center:n.line.occupiedDistances[h.indexOf(r)]=a,o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center;else{r.dragBoundFunc=de,r.isGrouped=0,this.shapes.push(r);for(let t=0;t<h.length;t++)h[t].id==r.id&&(o.freeDistances.push(o.occupiedDistances[t]),o.occupiedDistances.splice(t,1),h.splice(t,1),console.log("a shape has been removed from the line"))}o.keepDistribution&&this.updateOccupiedDistance(o.id),this.updateAllPosInGrp(o.id),this.updateNaration(n)},updateTransformedShape(t){let e,i;if("Line"==t.target.className)i=this.groups.find((t=>t.id===this.selectedShapeId)).line;else if(e=this.findShape(this.selectedShapeId),i=e.shape_data,void 0==i)return;let s=i.x,a=i.y;i.x=t.target.x(),i.y=t.target.y(),i.rotation=t.target.rotation();let n=i.scaleX;if(i.scaleX=t.target.scaleX(),i.scaleY=t.target.scaleY(),"Line"==t.target.className){const e=this.groups.find((t=>t.id===i.id));if(i.keepDistribution){for(let t=0;t<i.occupiedDistances.length;t++)i.occupiedDistances[t]=i.occupiedDistances[t]/n*i.scaleX;this.update(),this.updateGrp(t,this.selectedShapeId),this.checkIfShapesOnLine(this.selectedShapeId)}else{if(n!=i.scaleX){for(let t=0;t<e.shapes_g.length;t++){let n=e.shapes_g[t].x-i.x,o=e.shapes_g[t].y-i.y;0==Math.sign(e.line.occupiedDistances[t])?e.line.occupiedDistances[t]=this.GiveSignOfDistance(e.shapes_g[t],i)*Math.sqrt(n**2+o**2):e.line.occupiedDistances[t]=Math.sign(e.line.occupiedDistances[t])*Math.sqrt(n**2+o**2),Math.sign(e.shapes_g[t].x-s)!=Math.sign(n)&&0!=Math.sign(e.shapes_g[t].x-s)&&90!=e.line.rotation&&-90!=e.line.rotation&&(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t]),Math.sign(e.shapes_g[t].y-a)==Math.sign(o)||0==Math.sign(e.shapes_g[t].y-a)||90!=e.line.rotation&&-90!=e.line.rotation||(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t])}for(let t=0;t<i.freeDistances.length;t++){let e=s-i.x,n=a-i.y,o=Math.sqrt(e**2+n**2);i.rotation<-90||i.rotation>90?i.freeDistances[t]=i.freeDistances[t]-Math.sign(s-i.x)*o:90==i.rotation||-90==i.rotation?i.freeDistances[t]=i.freeDistances[t]-n:i.freeDistances[t]=i.freeDistances[t]+Math.sign(s-i.x)*o}}this.update(),this.updateGrp(t,this.selectedShapeId),this.checkIfShapesOnLine(this.selectedShapeId)}for(let t=0;t<e.shapes_g.length;t++)this.updateDragFunc(e.shapes_g[t],i)}else"-1"!=e.grp_id?(this.updateAllPosInGrp(e.grp_id),this.updateOccupiedDistance(e.grp_id),t.target.x(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).x),t.target.y(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).y),this.groups.find((t=>t.id===e.grp_id)).shapes_g.find((e=>e.id===t.target.id())).personalRotation=t.target.rotation()-t.target.getParent().attrs.line.rotation,this.updateAllPosInGrp(e.grp_id),this.checkIfShapesOnLine(e.grp_id),this.updateDragFuncOfCenter()):(this.update(),this.updateDragFuncOfCenter());this.center.x=t.target.attrs.x,this.center.y=t.target.attrs.y},handleTransformation(t){if(void 0==t.evt)return;if(1==this.eraseMode)return void this.eraserAction(t);if(t.target===t.target.getStage())return this.selectedShapeId="NoId",this.eraseNodefromTransformer("lineTransformer"),this.eraseNodefromTransformer("shapeTransformer"),void(this.center.opacity=0);const e="Transformer"===t.target.getParent().className;if(e)return;const i=t.target.id();let s,a=this.findShape(i).shape_data;"center"!=t.target.attrs.id&&("Line"==t.target.className?(s="lineTransformer",a=this.groups.find((t=>t.id===i)).line,this.center.draggable=!1,this.selectedShapeAlignment=a.defaultAlignment,this.eraseNodefromTransformer("shapeTransformer")):(s="shapeTransformer",this.center.draggable=!0,this.selectedShapeAlignment=a.centerPosition,this.eraseNodefromTransformer("lineTransformer")),void 0!=a?(this.selectedShapeId=i,this.center.opacity=1,this.updateTransformer(s)):this.selectedShapeId="NoId",this.updateDragFuncOfCenter())},eraseNodefromTransformer(t){let e=this.$refs.stage.getStage();const i=e.find("#"+t)[0];i.nodes([])},updateTransformer(t){let e=this.$refs.stage.getStage();const i=e.find("#"+t)[0];let s;if("lineTransformer"==t)s=e.children[0].getChildren().filter((t=>"Group"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0].getChildren().filter((t=>"Line"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];else{s=e.children[0].getChildren().filter((t=>"Group"!=t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];let t=!0;void 0==s&&(t=!1);let i=0;while(!t)i<this.groups.length?(s=e.children[0].getChildren().filter((t=>"Group"==t.attrs.className))[i].getChildren().find((t=>t.attrs.id==this.selectedShapeId&&"Line"!=t.attrs.className)),t=void 0!=s,i++):t=!0}s!==i.node()&&(void 0!=s?i.nodes([s]):i.nodes([]),this.center.x=s.attrs.x,this.center.y=s.attrs.y)},ChangeCenter(t){let e,i,s=this.findShape(this.selectedShapeId),a=s.shape_data,n=this.GiveSignOfDistanceBtwCenterAndShape(t.target.attrs,a)*Math.sqrt((t.target.y()-a.y)**2+(t.target.x()-a.x)**2)+a.offsetY*a.scaleY,o=a.offsetY;void 0==a?a=this.groups.find((t=>t.id==this.selectedShapeId)).line:("Rect"==a.className?(e=a.height*a.scaleY/3,i=a.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.width/2,a.offsetY=a.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.width/2,a.offsetY=a.height,a.centerPosition="Bottom"):(a.offsetX=a.width/2,a.offsetY=0,a.centerPosition="Top")):"Circle"==a.className?(n+=a.radius*a.scaleY,e=a.radius*a.scaleY*2/3,i=a.radius*a.scaleY*4/3,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0,a.centerPosition="Middle"):n>i?(a.offsetX=0,a.offsetY=a.radius,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")):"Image"==a.className?(e=a.image.height*a.scaleY/3,i=a.image.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height,a.centerPosition="Bottom"):(a.offsetX=a.image.width/2,a.offsetY=0,a.centerPosition="Top")):"Text"==a.className?(e=a.length_y*a.scaleY/3,i=a.length_y*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y,a.centerPosition="Bottom"):(a.offsetX=a.length_x/2,a.offsetY=0,a.centerPosition="Top")):"Triangle"==a.className&&(n+=a.radius*a.scaleY,e=a.radius*a.scaleY/2,i=a.radius*a.scaleY*5/4,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0):n>i?(a.offsetX=0,a.offsetY=a.radius/2,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")),a.y=a.y-(o-a.offsetY)*a.scaleY*Math.cos(a.rotation*(Math.PI/180)),a.x=a.x+(o-a.offsetY)*a.scaleY*Math.sin(a.rotation*(Math.PI/180)),this.selectedShapeAlignment=a.centerPosition,"-1"!=s.grp_id&&this.updateAllPosInGrp(s.grp_id),t.target.x(a.x),t.target.y(a.y))},ChangeCenterRegardingCommand(t,e){let i=this.findShape(t),s=i.shape_data,a=s.offsetY;"Rect"==s.className?"Top"==e?(s.offsetY=0,s.offsetX=s.width/2):"Middle"==e?(s.offsetX=s.width/2,s.offsetY=s.height/2):"Bottom"==e&&(s.offsetX=s.width/2,s.offsetY=s.height):"Circle"==s.className?"Top"==e?(s.offsetX=0,s.offsetY=-s.radius):"Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e&&(s.offsetX=0,s.offsetY=s.radius):"Image"==s.className?"Middle"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height/2):"Bottom"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height):"Top"==e&&(s.offsetX=s.image.width/2,s.offsetY=0):"Text"==s.className?"Middle"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y/2):"Bottom"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y):"Top"==e&&(s.offsetX=s.length_x/2,s.offsetY=0):"Triangle"==s.className&&("Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e?(s.offsetX=0,s.offsetY=s.radius/2):"Top"==e&&(s.offsetX=0,s.offsetY=-s.radius)),s.centerPosition=e,s.y=s.y-(a-s.offsetY)*s.scaleY*Math.cos(s.rotation*(Math.PI/180)),s.x=s.x+(a-s.offsetY)*s.scaleY*Math.sin(s.rotation*(Math.PI/180)),"-1"!=i.grp_id&&this.updateAllPosInGrp(i.grp_id)},updateDragFuncOfCenter(){let t=this.findShape(this.selectedShapeId).shape_data;if(void 0==t)return;let e=this.center,i=t.rotation*(Math.PI/180);i>=-Math.PI/2&&i<=0?i-=Math.PI/180*90:i<-Math.PI/2?(i+=Math.PI/2,i=Math.PI+i):i<=Math.PI&&i>0&&(i-=Math.PI/180*90),i<=0&&i>=-Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.y-t.y)*Math.cos(i),y:t.y-(e.y-t.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.x-t.x)*Math.cos(i),y:t.y-(e.x-t.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.y-t.y)*Math.cos(i),y:t.y+(e.y-t.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}})},MovingCenter(){},findShape(t){let e=this.shapes.find((e=>e.id===t)),i="-1",s=!0;void 0==e&&(s=!1);let a=0;while(!s)a<this.groups.length?(e=this.groups[a].shapes_g.find((e=>e.id===t)),void 0==e?s=!1:(i=this.groups[a].id,s=!0),a++):s=!0;return{shape_data:e,grp_id:i}},DetachShape(t,e,i){const s=this.lengthToCapture+5;let a=this.groups.find((e=>-1!=e.shapes_g.indexOf(t))),n=a.shapes_g.indexOf(t);t.dragBoundFunc=de;let o=a.line.y-.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),r=a.line.x+.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),h=a.line.y+.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),l=a.line.x-.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),c=(h-o)/(r-l),d=t.x*(1/c)+t.y;a.line.rotation<0&&a.line.rotation>-45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-45&&a.line.rotation>-90||a.line.rotation<-90&&a.line.rotation>-135?(t.x=t.x+Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-135&&a.line.rotation>-180||a.line.rotation>135&&a.line.rotation<180?(t.x=t.x-Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>90&&a.line.rotation<=135||a.line.rotation>45&&a.line.rotation<=90?(t.x=t.x-Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>0&&a.line.rotation<=45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):-90==a.line.rotation?t.x=t.x-Math.sign(t.x-e)*s:90==a.line.rotation?t.x=t.x+Math.sign(t.x-e)*s:(180==a.line.rotation||-180==a.line.rotation||0==a.line.rotation)&&(t.y=t.y-Math.sign(t.y-i)*s),t.isGrouped=0,this.shapes.push(t),this.center.x=t.x,this.center.y=t.y,a.line.freeDistances.push(a.line.occupiedDistances[n]),a.line.occupiedDistances.splice(n,1),a.shapes_g.splice(n,1),a.line.positionPoints.splice(n,1),this.updateOccupiedDistance(a.id),this.updateAllPosInGrp(a.id),this.updateNaration(a),this.eraseNodefromTransformer("shapeTransformer"),a.ghosts.splice(0,a.ghosts.length);for(let g=0;g<a.shapes_g.length;g++)a.shapes_g[g].opacity=1},createNewShape(t){if("Line"==t.attrs.className){this.max_id_figures=this.max_id_figures+1;let e=t.getParent().clone({id:""+this.max_id_figures,name:"group"+this.max_id_figures,shapes_g:[]});e.attrs.line.id=""+this.max_id_figures,e.attrs.line.x=t.getStage().getPointerPosition().x,e.attrs.line.y=t.getStage().getPointerPosition().y,e.attrs.line.draggable=!0,this.groups.push(e.attrs)}else{this.max_id_figures=this.max_id_figures+1;let e=t.clone({id:""+this.max_id_figures,draggable:!0});e.attrs.isGrouped=0,this.shapes.push(e.attrs)}},eraserAction(t){this.Remove(t.target)},unshowSelectedShape(t){"Line"==t.target.attrs.className&&0==this.eraseMode?t.target.opacity(.5):"Line"==t.target.attrs.className&&1==this.eraseMode?1==t.target.attrs.keepDistribution?t.target.stroke("rgb(48,48,48)"):t.target.stroke("blue"):"positionPoint"==t.target.attrs.className&&1==this.eraseMode?1!=t.target.getParent().attrs.line.keepDistribution&&t.target.strokeWidth(0):1==this.eraseMode&&t.target.strokeWidth(0)},showSelectedShape(t){if("Line"==t.target.attrs.className&&0==this.eraseMode)t.target.opacity(1);else if("Line"==t.target.attrs.className&&1==this.eraseMode)t.target.stroke("rgb(200, 59, 218)");else if("positionPoint"==t.target.attrs.className&&1==this.eraseMode){let e=t.target.getParent().attrs.line;-1!=e.freeDistances.indexOf(t.target.attrs.distance_to_line_center)&&1!=e.keepDistribution&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))}else 1==this.eraseMode&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))},editText(t){let e=t.target.getStage().attrs.container.getBoundingClientRect();document.getElementById("input").style.top=e.y+t.target.getAbsolutePosition().y+"px",document.getElementById("input").style.left=e.x+t.target.getAbsolutePosition().x-5*document.getElementById("input").size+"px",document.getElementById("input").style.display="initial",this.editedText=t.target},updateText(t){let e=this.shapes.find((t=>t.id===this.editedText.attrs.id)),i=!0;void 0==e&&(i=!1);let s=0;while(!i)s<this.groups.length?(e=this.groups[s].shapes_g.find((t=>t.id===this.editedText.attrs.id)),i=void 0!=e,s++):i=!0;if(void 0!=e){let i,s,a,n;i=this.editedText.width(),s=this.editedText.height(),e.text=t.target.value,this.editedText.text(t.target.value),a=this.editedText.width()-i,n=this.editedText.height()-s,e.offsetX=e.offsetX+a/2,e.offsetY=e.offsetY+n/2,e.length_x=this.editedText.width(),e.length_y=this.editedText.height(),document.getElementById("input").style.display="none"}},updateNaration(t){let e="<strong>Substrate :</strong><br>";e+="- <mark class='grey'> StickyLine </mark><br>",e+="Relation: <i>alignement and distribution with</i>:";for(let i=0;i<t.shapes_g.length;i++)e=e+"<br>- "+t.shapes_g[i].className;this.$emit("explain",{origin:"Substrate - Discoverability<br><mark class='grey'> The instrument should reveal the possible action that are available to the user. </mark>",text:e})}}};const pe=(0,f.Z)(ge,[["render",ce]]);var ue=pe;const fe={id:"eraser"};function Me(t,e,i,n,o,r){const h=(0,a.up)("v-rect"),l=(0,a.up)("v-circle"),c=(0,a.up)("v-image"),d=(0,a.up)("v-text"),g=(0,a.up)("v-regular-polygon"),p=(0,a.up)("v-line"),u=(0,a.up)("v-group"),f=(0,a.up)("v-transformer"),M=(0,a.up)("v-layer"),x=(0,a.up)("v-stage");return(0,a.wg)(),(0,a.iD)("div",{onClick:e[3]||(e[3]=(...e)=>t.HideContextMenu&&t.HideContextMenu(...e)),id:"DiscoverabilityDemo",onMousedown:e[4]||(e[4]=t=>r.updateNaration(this.groups[0]))},[(0,a.Wm)(x,{ref:"stage",id:"stage",config:o.stageSize,onDragmove:r.update,onMousedown:r.handleTransformation,onTouchstart:r.handleTransformation,onFusion:r.makeGroup,onContextMenu:t.DisplayContextMenu},{default:(0,a.w5)((()=>[(0,a.Wm)(M,{ref:"layer"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.groups,(t=>((0,a.wg)(),(0,a.j4)(u,{ref_for:!0,ref:"groups",key:t.id,config:t},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Rect"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(h,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Circle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(l,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Image"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(c,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Text"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(d,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape,onDblclick:r.editText},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout","onDblclick"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Triangle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(g,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.CheckIfNeedToDetach,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(),(0,a.j4)(p,{key:t.line.id,config:t.line,onTransformend:r.updateTransformedShape,onDragmove:e=>r.updateGrp(e,t.id),onMouseout:r.unshowSelectedShape,onMouseenter:r.showSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseout","onMouseenter"])),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.line.positionPoints,(t=>((0,a.wg)(),(0,a.j4)(l,{key:t.id,config:t,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onMouseenter","onMouseout"])))),128))])),_:2},1032,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Rect"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(h,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Circle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(l,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Triangle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(g,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.transformers,(t=>((0,a.wg)(),(0,a.j4)(f,{key:t.id,config:t},null,8,["config"])))),128)),((0,a.wg)(),(0,a.j4)(l,{key:o.center.id,config:o.center,onDragend:r.ChangeCenter,onClick:t.DisplayCenterMenu},null,8,["config","onDragend","onClick"])),(0,a._)("div",fe,[(0,a.Wm)(d,{config:{text:"eraser",y:5,x:10,fill:"rgb(200, 59, 218)"}},null,8,["config"]),((0,a.wg)(),(0,a.j4)(c,{key:o.eraser.id,config:o.eraser,onMousedown:r.switchEraseMode,onMouseenter:e[0]||(e[0]=t=>r.changeCursor("pointer")),onMouseout:e[1]||(e[1]=t=>r.changeCursor("default"))},null,8,["config","onMousedown"]))])])),_:1},512)])),_:1},8,["config","onDragmove","onMousedown","onTouchstart","onFusion","onContextMenu"]),(0,a._)("input",{type:"text",id:"input",size:"10",value:"a text",onKeyup:e[2]||(e[2]=(0,s.D2)(((...t)=>r.updateText&&r.updateText(...t)),["enter"]))},null,32)],32)}const xe=function(t){let e=this.getStage().width(),i=this.getStage().height(),s=10;return t.x>e-s&&t.y>i-s?{x:e-s,y:i-s}:t.x>e-s&&t.y<s?{x:e-s,y:s}:t.y>i-s&&t.x<s?{x:s,y:i-s}:t.x<s&&t.y<s?{x:s,y:s}:t.x<s?{x:s,y:t.y}:t.y<s?{x:t.x,y:s}:t.x>e-s?{x:e-s,y:t.y}:t.y>i-s?{x:t.x,y:i-s}:{x:t.x,y:t.y}};var ye={props:{width:{type:Number,default:window.innerWidth},height:{type:Number,default:window.innerHeight}},components:{},data(){return{stageSize:{width:this.width,height:this.height},lengthToCapture:10,lengthToDetach:15,editedText:null,eraseMode:0,selectedShapeAlignment:"",needMenu:"initial",isALineSelected:!1,isAGroupedShapeSelected:!1,isStageOnlySelected:!1,keepDistanceButtonText:"Liberate Distribution",max_id_figures:6,eraser:{isActivated:0,rotation:0,x:17,y:20,scaleX:1,scaleY:1,offsetY:0,offsetX:0,opacity:1,image:null,isGrouped:0,className:"eraser",fontSize:30,id:"5"},groups:[{name:"group",className:"Group",id:"1",x:0,y:0,offsetX:0,offsetY:0,rotation:0,draggable:!1,shapes_g:[{rotation:0,id:"8",x:150,y:220,width:70,height:70,scaleX:1,scaleY:1,strokeWidth:0,stroke:"black",fill:"green",name:"rect2",draggable:!0,className:"Rect",isGrouped:0,dragBoundFunc:xe,offsetX:35,offsetY:70,personalRotation:0,centerPosition:"Bottom"},{rotation:0,id:"7",x:250,y:220,sides:3,radius:45,width:90,height:90,scaleX:1,scaleY:1,strokeWidth:0,stroke:"black",fill:"purple",name:"triangle1",draggable:!0,className:"Triangle",isGrouped:0,dragBoundFunc:xe,offsetX:0,offsetY:22.5,personalRotation:0,centerPosition:"Bottom"}],aShapeHasBeenDetach:0,line:{x:150,y:220,points:[0,0,0,0,250,0],positionPoints:[{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint1",distance_to_line_center:void 0},{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint2",distance_to_line_center:void 0},{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint3",distance_to_line_center:void 0}],strokeWidth:10,rotation:0,tension:0,closed:!0,draggable:!0,scaleX:1,scaleY:1,opacity:.5,offset:{x:125,y:0},name:"ligne",className:"Line",stroke:"blue",id:"1",keepDistribution:!1,freeDistances:[-95],occupiedDistances:[-15,100],keepDistanceButtonText:"Liberate Distribution",defaultAlignment:"Bottom",dragBoundFunc:xe}}],transformers:[{id:"lineTransformer",enabledAnchors:[],rotateEnabled:!1,borderEnabled:!1,flipEnabled:!1,nodes:[]},{id:"shapeTransformer",nodes:[]}],shapes:[{rotation:0,x:130,y:80,scaleX:1,scaleY:1,offsetX:0,offsetY:40,radius:40,fill:"orange",strokeWidth:0,stroke:"black",draggable:!0,isGrouped:0,className:"Circle",personalRotation:0,id:"6",dragBoundFunc:xe,centerPosition:"Bottom"}],center:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:4,fill:"black",opacity:1,draggable:!0,isGrouped:0,className:"Circle",id:"center",dragBoundFunc:xe},positionPoint:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint",distance_to_line_center:void 0},selectedShapeId:""}},mounted(){let t=this.$refs.stage.getStage().getChildren()[0].getChildren().filter((t=>"Text"==t.attrs.className));for(let a=0;a<t.length;a++)t[a].attrs.length_x=t[a].width(),t[a].attrs.length_y=t[a].height(),t[a].offsetX(t[a].attrs.length_x/2);let e=this.groups[0],i=e.line,s=e.shapes_g;for(let a=0;a<s.length;a++)this.updateDragFunc(s[a],i),this.updateAllPosInGrp(e.id)},created(){this.max_id_figures=this.shapes.length+this.groups.length;const t=new window.Image;t.src=i(843),t.onload=()=>{this.eraser.image=t,this.eraser.offsetY=0}},methods:{changeCursor(t){1!=this.eraseMode&&(document.getElementById("DiscoverabilityDemo").style.cursor=t)},switchEraseMode(){0==this.eraseMode?(this.eraseMode=1,this.eraser.opacity=.4,document.getElementById("DiscoverabilityDemo").style.cursor="url("+i(843)+"),default",this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer")):(this.eraseMode=0,this.eraser.opacity=1,document.getElementById("DiscoverabilityDemo").style.cursor="default")},checkIfShapesOnLine(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;let a=0;while(a<s.length)this.isCoordinateOnLine(s[a].x,s[a].y,i.id)?a+=1:(console.log("a shape is not on a line"),s[a].dragBoundFunc=xe,s[a].isGrouped=0,this.shapes.push(s[a]),i.freeDistances.push(i.occupiedDistances[a]),i.occupiedDistances.splice(a,1),s.splice(a,1),this.updateNaration(e))},isCoordinateOnLine(t,e,i){const s=this.groups.find((t=>t.id===i)),a=s.line;let n=!0,o=a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),r=a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),h=a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),l=a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),c=(o-h)/(l-r),d=a.y-c*a.x;return n=Math.abs(r-l)>1?Math.abs(c*t+d-e)>1:Math.abs(t-a.x)>1,!(n||(a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0||!n&&Math.sqrt((a.x-t)**2+(a.y-e)**2)>a.points[4]*a.scaleX/2)},updateGrp(t,e){const i=this.groups.find((t=>t.id===e)),s=i.line;i.offsetX=s.offsetX,i.offsetY=s.offsetY,s.x=t.target.x(),s.y=t.target.y(),this.center.x=s.x,this.center.y=s.y,this.updateAllPosInGrp(s.id),this.checkIfShapesOnLine(s.id)},updateAllPosInGrp(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;for(let n=0;n<s.length;n++)i.keepDistribution,s[n].x=i.x+i.occupiedDistances[n]*Math.cos(i.rotation*(Math.PI/180)),s[n].y=i.y+i.occupiedDistances[n]*Math.sin(i.rotation*(Math.PI/180)),s[n].distance_to_line_center=i.occupiedDistances[n],s[n].rotation=s[n].personalRotation+i.rotation,i.positionPoints[n].x=s[n].x,i.positionPoints[n].y=s[n].y,i.positionPoints[n].distance_to_line_center=s[n].distance_to_line_center;let a=s.length;while(a<i.positionPoints.length)i.keepDistribution?i.positionPoints.splice(a,1):(i.positionPoints[a].x=i.x+i.freeDistances[a-s.length]*Math.cos(i.rotation*(Math.PI/180)),i.positionPoints[a].y=i.y+i.freeDistances[a-s.length]*Math.sin(i.rotation*(Math.PI/180)),i.positionPoints[a].distance_to_line_center=i.freeDistances[a-s.length],a++)},isOutsideTheLine(t,e){let i=e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180)),s=e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180)),a=e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180)),n=e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180)),o=(i-a)/(n-s),r=e.y-o*e.x,h=!1;return h=Math.abs(s-n)>=1?Math.abs(o*t.x+r-t.y)<1:Math.abs(t.x-e.x)<1,!h||(e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=0&&e.rotation*(Math.PI/180)>-Math.PI/2||(e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=0&&e.rotation*(Math.PI/180)>-Math.PI/2||(e.y+.5*e.points[4]*e.scaleX*Math.sin(Math.PI+e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(Math.PI+e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=-Math.PI/2&&e.rotation*(Math.PI/180)>-Math.PI||(e.x+.5*e.points[4]*e.scaleX*Math.cos(Math.PI+e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(Math.PI+e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=-Math.PI/2&&e.rotation*(Math.PI/180)>-Math.PI||(e.y+.5*e.points[4]*e.scaleX*Math.sin(Math.PI-e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(Math.PI-e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=Math.PI&&e.rotation*(Math.PI/180)>Math.PI/2||(e.x+.5*e.points[4]*e.scaleX*Math.cos(Math.PI-e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(Math.PI-e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=Math.PI&&e.rotation*(Math.PI/180)>Math.PI/2||(e.y+.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))+this.lengthToDetach<t.y||e.y-.5*e.points[4]*e.scaleX*Math.sin(e.rotation*(Math.PI/180))-this.lengthToDetach>t.y)&&e.rotation*(Math.PI/180)<=Math.PI/2&&e.rotation*(Math.PI/180)>=0||(e.x+.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))+this.lengthToDetach<t.x||e.x-.5*e.points[4]*e.scaleX*Math.cos(e.rotation*(Math.PI/180))-this.lengthToDetach>t.x)&&e.rotation*(Math.PI/180)<=Math.PI/2&&e.rotation*(Math.PI/180)>=0},update(){const t=this.shapes;let e=!1;for(let i=0;i<t.length;i++){let s=t[i].x,a=t[i].y;for(let n=0;n<this.groups.length;n++){let o=this.groups[n].line,r=o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),h=o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),l=o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),c=o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),d=(r-l)/(c-h),g=o.y-d*o.x;e=Math.abs(h-c)>1?Math.abs(d*s+g-a)<=this.lengthToCapture:Math.abs(s-o.x)<=this.lengthToCapture,(e&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=0&&o.rotation*(Math.PI/180)>-Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=-Math.PI/2&&o.rotation*(Math.PI/180)>=-Math.PI||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI&&o.rotation*(Math.PI/180)>Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI/2&&o.rotation*(Math.PI/180)>=0)&&(t[i].isGrouped=1,this.makeGroup(o.id))}}},CheckIfNeedToDetach(t){let e=this.groups.find((e=>e.id===t.target.getParent().attrs.id)),i=e.shapes_g.find((e=>e.id==t.target.id())),s=Math.sqrt((t.target.getStage().getPointerPosition().y-t.target.y())**2+(t.target.getStage().getPointerPosition().x-t.target.x())**2);"Rect"==t.target.className?s-=t.target.attrs.height*t.target.attrs.scaleY:"Circle"==t.target.className?s-=2*t.target.attrs.radius*t.target.attrs.scaleY:"Text"==t.target.className?s-=t.target.attrs.length_y*t.target.attrs.scaleY:("Image"==t.target.className||"Triangle"==t.target.attrs.className)&&(s-=t.target.height()*t.target.scaleY()),s>50&&(this.groups.find((e=>e.id===t.target.getParent().attrs.id)).aShapeHasBeenDetach=1,this.DetachShape(i,t.target.getStage().getPointerPosition().x,t.target.getStage().getPointerPosition().y))},GiveSignOfDistance(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(a)<=this.lengthToCapture&&-90==e.rotation?-Math.sign(n):Math.abs(a)<=this.lengthToCapture&&90==e.rotation?Math.sign(n):Math.sign(a),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},GiveSignOfDistanceBtwCenterAndShape(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(n)<=this.lengthToCapture&&-90==e.rotation?Math.sign(a):Math.abs(n)<=this.lengthToCapture&&90==e.rotation?-Math.sign(a):Math.sign(n),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},makeGroup(t){this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer");const e=this.groups.find((e=>e.id===t)),i=e.line,s=this.shapes;i.freeDistances.sort(this.isSmaller),s.sort(this.isBeforeRegardingX);for(let a=0;a<s.length;a++)if(1==s[a].isGrouped){const n=Object.assign({},this.positionPoint);let o=s[a].x-i.x,r=s[a].y-i.y;if(s[a].personalRotation=0,s[a].distance_to_line_center=this.GiveSignOfDistance(s[a],i)*Math.sqrt(o**2+r**2),Math.abs(s[a].distance_to_line_center)>=i.points[4]*i.scaleX/2&&(s[a].distance_to_line_center=Math.sign(s[a].distance_to_line_center)*i.points[4]*i.scaleX/2),this.ChangeCenterRegardingCommand(s[a].id,e.line.defaultAlignment),!i.keepDistribution&&i.freeDistances.length>0){let t=this.isNearest(i,s[a]);console.log(e.line.freeDistances),console.log(t),this.updateDragFunc(s[a],i),e.shapes_g.push(s[a]),e.line.occupiedDistances.push(e.line.freeDistances[t]),e.line.freeDistances.splice(t,1)}else this.updateDragFunc(s[a],i),e.shapes_g.push(s[a]),console.log("no 'free distance' anymore"),e.line.occupiedDistances.push(s[a].distance_to_line_center),n.id="positionPoint"+e.id+e.line.positionPoints.length,e.line.positionPoints.push(n);console.log("A new shape has been added with a distance"+s[a].distance_to_line_center),this.updateOccupiedDistance(i.id),this.updateAllPosInGrp(t),s.splice(a,1)}this.updateNaration(e),this.center.x=i.x,this.center.y=i.y},updateOccupiedDistance(t){const e=this.groups.find((e=>e.id===t));if(this.sortByDistToLineCenter(e),e.line.keepDistribution){let t=e.line.points[4],i=e.shapes_g.length,s=t/(i-1)*e.line.scaleX;if(i%2==0){for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[t-1]=-(i/2-1-t+1)*s-s/2;for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[i/2+t]=t*s+s/2;e.line.occupiedDistances[i/2-1]=-s/2,e.line.occupiedDistances[i/2]=s/2}else{for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[t-1]=-s*((i-1)/2-t+1);for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[(i-1)/2+t]=s*t;e.line.occupiedDistances[(i-1)/2]=0}for(let a=0;a<e.shapes_g.length;a++)e.shapes_g[a].distance_to_line_center=e.line.occupiedDistances[a]}else e.line.occupiedDistances.sort(this.isSmaller)},isSmaller(t,e){return t<e?-1:1},isBeforeRegardingX(t,e){return t.x<e.x?-1:1},updateOccDist(t,e){let i=this.isNearest(t.line,e);if(i.isFree){e.distance_to_line_center=t.line.freeDistances[i.indice],t.line.freeDistances.splice(i.indice,1),this.sortByDistToLineCenter(t);for(let e=0;e<t.shapes_g.length;e++)t.line.occupiedDistances.length==e?t.line.occupiedDistances.push(t.shapes_g[e].distance_to_line_center):t.line.occupiedDistances[e]=t.shapes_g[e].distance_to_line_center}else t.shapes_g.find((t=>t.id==e.id)).distance_to_line_center=t.line.occupiedDistances[i.indice],t.line.occupiedDistances.splice(i.indice,1),this.updateOccDist(t,t.shapes_g[i.indice])},isNearest(t,e){let i,s=t.x+t.freeDistances[0]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[0]*Math.sin(t.rotation*(Math.PI/180)),n=Math.sqrt((s-e.x)**2+(a-e.y)**2),o=0;for(let r=1;r<t.freeDistances.length;r++)s=t.x+t.freeDistances[r]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[r]*Math.sin(t.rotation*(Math.PI/180)),i=Math.sqrt((s-e.x)**2+(a-e.y)**2),i<n&&(n=i,o=r);return o},sortByDistToLineCenter(t){if(t.line.keepDistribution)for(let e=0;e<t.shapes_g.length;e++){let i=t.shapes_g[e].x-t.line.x,s=t.shapes_g[e].y-t.line.y;t.shapes_g[e].distance_to_line_center=this.GiveSignOfDistance(t.shapes_g[e],t.line)*Math.sqrt(i**2+s**2)}for(let e=1;e<t.shapes_g.length;e++){let i=t.shapes_g[e],s=e;while(s>0&&t.shapes_g[s-1].distance_to_line_center>i.distance_to_line_center)t.shapes_g[s]=t.shapes_g[s-1],s-=1;t.shapes_g[s]=i}},sortAnyShapesByDistToLineCenter(t,e){for(let i=0;i<t.length;i++){let s=t[i].x-e.x,a=t[i].y-e.y;t.distance_to_line_center=this.GiveSignOfDistance(t,e)*Math.sqrt(s**2+a**2)}for(let i=1;i<t.length;i++){let e=t[i],s=i;while(s>0&&t[s-1].distance_to_line_center>e.distance_to_line_center)t[s]=t[s-1],s-=1;t[s]=e}},updateDragFunc(t,e){let i=e.rotation*(Math.PI/180);i<=0&&i>=-Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.y-e.y)*Math.cos(i),y:e.y-(t.y-e.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.x-e.x)*Math.cos(i),y:e.y-(t.x-e.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.y-e.y)*Math.cos(i),y:e.y+(t.y-e.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}})},updatePos(t){const e=this.shapes.find((e=>e.id===t.target.id()));e.x=t.target.x(),e.y=t.target.y(),this.center.x=t.target.x(),this.center.y=t.target.y();let i={x:e.x,y:e.y};t.target.position(i),t.target.getLayer().batchDraw()},updatePosInGrp(t,e){let i,s,a;const n=this.groups.find((t=>t.id===e));if(1==n.aShapeHasBeenDetach)return void(n.aShapeHasBeenDetach=0);const o=n.line,r=n.shapes_g.find((e=>e.id===t.target.id())),h=n.shapes_g;if(1==r.needToBeDetach&&(r.needToBeDetach=0,this.DetachShape(r),this.updateAllPosInGrp(t.target.getParent().attrs.id)),o.keepDistribution){if(this.isCoordinateOnLine(t.target.x(),t.target.y(),o.id)){i=r.x-t.target.x(),s=r.y-t.target.y();let e=n.line.points[4],a=n.shapes_g.length,l=e/(a-1)*n.line.scaleX,c=Math.sqrt(i**2+s**2);c>=l?(r.x=t.target.x(),r.y=t.target.y(),this.updateOccupiedDistance(o.id),r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation,this.updateAllPosInGrp(o.id)):(r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation)}else r.x=t.target.x(),r.y=t.target.y();o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center}else o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,r.x=t.target.x(),r.y=t.target.y(),0==Math.sin(o.rotation*(Math.PI/180))?a=r.x-o.x:(a=0!=Math.sign(r.x-o.x)?Math.sign(-r.rotation)*Math.sign(r.x-o.x)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2):Math.sign(-r.rotation)*Math.sign(r.y-o.y)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2),(r.rotation*(Math.PI/180)<=-Math.PI/2||r.rotation*(Math.PI/180)<=Math.PI/2&&r.rotation*(Math.PI/180)>=0)&&(a=-a)),o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center;let l={x:r.x,y:r.y};if(this.center.x=r.x,this.center.y=r.y,t.target.position(l),t.target.getLayer().batchDraw(),this.isCoordinateOnLine(r.x,r.y,o.id))o.keepDistribution?n.line.occupiedDistances[h.indexOf(r)]=r.distance_to_line_center:n.line.occupiedDistances[h.indexOf(r)]=a,o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center;else{r.dragBoundFunc=xe,r.isGrouped=0,this.shapes.push(r);for(let t=0;t<h.length;t++)h[t].id==r.id&&(o.freeDistances.push(o.occupiedDistances[t]),o.occupiedDistances.splice(t,1),h.splice(t,1),console.log("a shape has been removed from the line"))}o.keepDistribution&&this.updateOccupiedDistance(o.id),this.updateAllPosInGrp(o.id)},updateTransformedShape(t){let e,i;if("Line"==t.target.className)i=this.groups.find((t=>t.id===this.selectedShapeId)).line;else if(e=this.findShape(this.selectedShapeId),i=e.shape_data,void 0==i)return;let s=i.x,a=i.y;i.x=t.target.x(),i.y=t.target.y(),i.rotation=t.target.rotation();let n=i.scaleX;if(i.scaleX=t.target.scaleX(),i.scaleY=t.target.scaleY(),"Line"==t.target.className){const e=this.groups.find((t=>t.id===i.id));if(i.keepDistribution){for(let t=0;t<i.occupiedDistances.length;t++)i.occupiedDistances[t]=i.occupiedDistances[t]/n*i.scaleX;this.update(),this.updateGrp(t,this.selectedShapeId),this.checkIfShapesOnLine(this.selectedShapeId)}else{if(n!=i.scaleX){for(let t=0;t<e.shapes_g.length;t++){let n=e.shapes_g[t].x-i.x,o=e.shapes_g[t].y-i.y;0==Math.sign(e.line.occupiedDistances[t])?e.line.occupiedDistances[t]=this.GiveSignOfDistance(e.shapes_g[t],i)*Math.sqrt(n**2+o**2):e.line.occupiedDistances[t]=Math.sign(e.line.occupiedDistances[t])*Math.sqrt(n**2+o**2),Math.sign(e.shapes_g[t].x-s)!=Math.sign(n)&&0!=Math.sign(e.shapes_g[t].x-s)&&90!=e.line.rotation&&-90!=e.line.rotation&&(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t]),Math.sign(e.shapes_g[t].y-a)==Math.sign(o)||0==Math.sign(e.shapes_g[t].y-a)||90!=e.line.rotation&&-90!=e.line.rotation||(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t])}for(let t=0;t<i.freeDistances.length;t++){let e=s-i.x,n=a-i.y,o=Math.sqrt(e**2+n**2);i.rotation<-90||i.rotation>90?i.freeDistances[t]=i.freeDistances[t]-Math.sign(s-i.x)*o:90==i.rotation||-90==i.rotation?i.freeDistances[t]=i.freeDistances[t]-n:i.freeDistances[t]=i.freeDistances[t]+Math.sign(s-i.x)*o}}this.update(),this.updateGrp(t,this.selectedShapeId),this.checkIfShapesOnLine(this.selectedShapeId)}for(let t=0;t<e.shapes_g.length;t++)this.updateDragFunc(e.shapes_g[t],i)}else"-1"!=e.grp_id?(this.updateAllPosInGrp(e.grp_id),this.updateOccupiedDistance(e.grp_id),t.target.x(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).x),t.target.y(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).y),this.groups.find((t=>t.id===e.grp_id)).shapes_g.find((e=>e.id===t.target.id())).personalRotation=t.target.rotation()-t.target.getParent().attrs.line.rotation,this.updateAllPosInGrp(e.grp_id),this.checkIfShapesOnLine(e.grp_id),this.updateDragFuncOfCenter()):(this.update(),this.updateDragFuncOfCenter());this.center.x=t.target.attrs.x,this.center.y=t.target.attrs.y},handleTransformation(t){if(void 0==t.evt)return;if(1==this.eraseMode)return void this.eraserAction(t);if(t.target===t.target.getStage())return this.selectedShapeId="NoId",this.eraseNodefromTransformer("lineTransformer"),this.eraseNodefromTransformer("shapeTransformer"),void(this.center.opacity=0);const e="Transformer"===t.target.getParent().className;if(e)return;const i=t.target.id();let s,a=this.findShape(i).shape_data;"center"!=t.target.attrs.id&&("Line"==t.target.className?(s="lineTransformer",a=this.groups.find((t=>t.id===i)).line,this.center.draggable=!1,this.selectedShapeAlignment=a.defaultAlignment,this.eraseNodefromTransformer("shapeTransformer")):(s="shapeTransformer",this.center.draggable=!0,this.selectedShapeAlignment=a.centerPosition,this.eraseNodefromTransformer("lineTransformer")),void 0!=a?(this.selectedShapeId=i,this.center.opacity=1,this.updateTransformer(s)):this.selectedShapeId="NoId",this.updateDragFuncOfCenter())},eraseNodefromTransformer(t){let e=this.$refs.stage.getStage();const i=e.find("#"+t)[0];i.nodes([])},updateTransformer(t){let e=this.$refs.stage.getStage();const i=e.find("#"+t)[0];let s;if("lineTransformer"==t)s=e.children[0].getChildren().filter((t=>"Group"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0].getChildren().filter((t=>"Line"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];else{s=e.children[0].getChildren().filter((t=>"Group"!=t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];let t=!0;void 0==s&&(t=!1);let i=0;while(!t)i<this.groups.length?(s=e.children[0].getChildren().filter((t=>"Group"==t.attrs.className))[i].getChildren().find((t=>t.attrs.id==this.selectedShapeId&&"Line"!=t.attrs.className)),t=void 0!=s,i++):t=!0}s!==i.node()&&(void 0!=s?i.nodes([s]):i.nodes([]),this.center.x=s.attrs.x,this.center.y=s.attrs.y)},ChangeCenter(t){let e,i,s=this.findShape(this.selectedShapeId),a=s.shape_data,n=this.GiveSignOfDistanceBtwCenterAndShape(t.target.attrs,a)*Math.sqrt((t.target.y()-a.y)**2+(t.target.x()-a.x)**2)+a.offsetY*a.scaleY,o=a.offsetY;void 0==a?a=this.groups.find((t=>t.id==this.selectedShapeId)).line:("Rect"==a.className?(e=a.height*a.scaleY/3,i=a.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.width/2,a.offsetY=a.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.width/2,a.offsetY=a.height,a.centerPosition="Bottom"):(a.offsetX=a.width/2,a.offsetY=0,a.centerPosition="Top")):"Circle"==a.className?(n+=a.radius*a.scaleY,e=a.radius*a.scaleY*2/3,i=a.radius*a.scaleY*4/3,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0,a.centerPosition="Middle"):n>i?(a.offsetX=0,a.offsetY=a.radius,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")):"Image"==a.className?(e=a.image.height*a.scaleY/3,i=a.image.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height,a.centerPosition="Bottom"):(a.offsetX=a.image.width/2,a.offsetY=0,a.centerPosition="Top")):"Text"==a.className?(e=a.length_y*a.scaleY/3,i=a.length_y*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y,a.centerPosition="Bottom"):(a.offsetX=a.length_x/2,a.offsetY=0,a.centerPosition="Top")):"Triangle"==a.className&&(n+=a.radius*a.scaleY,e=a.radius*a.scaleY/2,i=a.radius*a.scaleY*5/4,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0):n>i?(a.offsetX=0,a.offsetY=a.radius/2,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")),a.y=a.y-(o-a.offsetY)*a.scaleY*Math.cos(a.rotation*(Math.PI/180)),a.x=a.x+(o-a.offsetY)*a.scaleY*Math.sin(a.rotation*(Math.PI/180)),this.selectedShapeAlignment=a.centerPosition,"-1"!=s.grp_id&&this.updateAllPosInGrp(s.grp_id),t.target.x(a.x),t.target.y(a.y))},ChangeCenterRegardingCommand(t,e){let i=this.findShape(t),s=i.shape_data,a=s.offsetY;"Rect"==s.className?"Top"==e?(s.offsetY=0,s.offsetX=s.width/2):"Middle"==e?(s.offsetX=s.width/2,s.offsetY=s.height/2):"Bottom"==e&&(s.offsetX=s.width/2,s.offsetY=s.height):"Circle"==s.className?"Top"==e?(s.offsetX=0,s.offsetY=-s.radius):"Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e&&(s.offsetX=0,s.offsetY=s.radius):"Image"==s.className?"Middle"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height/2):"Bottom"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height):"Top"==e&&(s.offsetX=s.image.width/2,s.offsetY=0):"Text"==s.className?"Middle"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y/2):"Bottom"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y):"Top"==e&&(s.offsetX=s.length_x/2,s.offsetY=0):"Triangle"==s.className&&("Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e?(s.offsetX=0,s.offsetY=s.radius/2):"Top"==e&&(s.offsetX=0,s.offsetY=-s.radius)),s.centerPosition=e,s.y=s.y-(a-s.offsetY)*s.scaleY*Math.cos(s.rotation*(Math.PI/180)),s.x=s.x+(a-s.offsetY)*s.scaleY*Math.sin(s.rotation*(Math.PI/180)),"-1"!=i.grp_id&&this.updateAllPosInGrp(i.grp_id)},updateDragFuncOfCenter(){let t=this.findShape(this.selectedShapeId).shape_data;if(void 0==t)return;let e=this.center,i=t.rotation*(Math.PI/180);i>=-Math.PI/2&&i<=0?i-=Math.PI/180*90:i<-Math.PI/2?(i+=Math.PI/2,i=Math.PI+i):i<=Math.PI&&i>0&&(i-=Math.PI/180*90),i<=0&&i>=-Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.y-t.y)*Math.cos(i),y:t.y-(e.y-t.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.x-t.x)*Math.cos(i),y:t.y-(e.x-t.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.y-t.y)*Math.cos(i),y:t.y+(e.y-t.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}})},MovingCenter(){},Remove(t){if("Line"==t.attrs.className){let e=this.groups.find((e=>e.id===t.attrs.id));const i=e.shapes_g.length;for(let t=0;t<i;t++)e.shapes_g[t].dragBoundFunc=xe,e.shapes_g[t].isGrouped=0,this.shapes.push(e.shapes_g[t]);this.eraseNodefromTransformer("lineTransformer"),this.groups.splice(this.groups.indexOf(e),1),t.getParent().destroy(),void 0!=this.groups[0]?(this.center.x=this.groups[0].line.x,this.center.y=this.groups[0].line.y):void 0!=this.shapes[0]&&(this.center.x=this.shapes[0].x,this.center.y=this.shapes[0].y),this.center.opacity=0}else if("positionPoint"==t.attrs.className){let e=t.getParent().attrs.line,i=e.positionPoints.find((e=>e.id===t.attrs.id)),s=e.freeDistances.indexOf(t.attrs.distance_to_line_center);console.log(e.positionPoints),1!=e.keepDistribution&&-1!=s&&(e.freeDistances.splice(s,1),e.positionPoints.splice(e.positionPoints.indexOf(i),1))}else{let e=this.findShape(t.attrs.id),i=e.shape_data,s=e.grp_id;if(void 0!=i){if("-1"!=s){let t=this.groups.find((t=>t.id===s));t.line.freeDistances.push(t.line.occupiedDistances[t.shapes_g.indexOf(i)]),t.line.occupiedDistances.splice(t.shapes_g.indexOf(i),1),t.shapes_g.splice(t.shapes_g.indexOf(i),1),this.updateOccupiedDistance(t.id),this.updateAllPosInGrp(t.id),console.log(t.line.positionPoints)}else this.eraseNodefromTransformer("shapeTransformer"),this.shapes.splice(this.shapes.indexOf(i),1),void 0!=this.groups[0]?(this.center.x=this.groups[0].line.x,this.center.y=this.groups[0].line.y):void 0!=this.shapes[0]&&(this.center.x=this.shapes[0].x,this.center.y=this.shapes[0].y),this.center.opacity=0;t.destroy()}}},findShape(t){let e=this.shapes.find((e=>e.id===t)),i="-1",s=!0;void 0==e&&(s=!1);let a=0;while(!s)a<this.groups.length?(e=this.groups[a].shapes_g.find((e=>e.id===t)),void 0==e?s=!1:(i=this.groups[a].id,s=!0),a++):s=!0;return{shape_data:e,grp_id:i}},DetachShape(t,e,i){const s=this.lengthToCapture+5;let a=this.groups.find((e=>-1!=e.shapes_g.indexOf(t))),n=a.shapes_g.indexOf(t);t.dragBoundFunc=xe;let o=a.line.y-.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),r=a.line.x+.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),h=a.line.y+.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),l=a.line.x-.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),c=(h-o)/(r-l),d=t.x*(1/c)+t.y;a.line.rotation<0&&a.line.rotation>-45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-45&&a.line.rotation>-90||a.line.rotation<-90&&a.line.rotation>-135?(t.x=t.x+Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-135&&a.line.rotation>-180||a.line.rotation>135&&a.line.rotation<180?(t.x=t.x-Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>90&&a.line.rotation<=135||a.line.rotation>45&&a.line.rotation<=90?(t.x=t.x-Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>0&&a.line.rotation<=45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):-90==a.line.rotation?t.x=t.x-Math.sign(t.x-e)*s:90==a.line.rotation?t.x=t.x+Math.sign(t.x-e)*s:(180==a.line.rotation||-180==a.line.rotation||0==a.line.rotation)&&(t.y=t.y-Math.sign(t.y-i)*s),t.isGrouped=0,this.shapes.push(t),this.center.x=t.x,this.center.y=t.y,a.line.freeDistances.push(a.line.occupiedDistances[n]),a.line.occupiedDistances.splice(n,1),a.shapes_g.splice(n,1),this.updateOccupiedDistance(a.id),this.updateAllPosInGrp(a.id),this.updateNaration(a),this.eraseNodefromTransformer("shapeTransformer")},createNewShape(t){if("Line"==t.attrs.className){this.max_id_figures=this.max_id_figures+1;let e=t.getParent().clone({id:""+this.max_id_figures,name:"group"+this.max_id_figures,shapes_g:[]});e.attrs.line.id=""+this.max_id_figures,e.attrs.line.x=t.getStage().getPointerPosition().x,e.attrs.line.y=t.getStage().getPointerPosition().y,e.attrs.line.draggable=!0,this.groups.push(e.attrs)}else{this.max_id_figures=this.max_id_figures+1;let e=t.clone({id:""+this.max_id_figures,draggable:!0});e.attrs.isGrouped=0,this.shapes.push(e.attrs)}},eraserAction(t){this.Remove(t.target)},unshowSelectedShape(t){"Line"==t.target.attrs.className&&0==this.eraseMode?t.target.opacity(.5):"Line"==t.target.attrs.className&&1==this.eraseMode?1==t.target.attrs.keepDistribution?t.target.stroke("rgb(48,48,48)"):t.target.stroke("blue"):"positionPoint"==t.target.attrs.className&&1==this.eraseMode?1!=t.target.getParent().attrs.line.keepDistribution&&t.target.strokeWidth(0):1==this.eraseMode&&t.target.strokeWidth(0)},showSelectedShape(t){if("Line"==t.target.attrs.className&&0==this.eraseMode)t.target.opacity(1);else if("Line"==t.target.attrs.className&&1==this.eraseMode)t.target.stroke("rgb(200, 59, 218)");else if("positionPoint"==t.target.attrs.className&&1==this.eraseMode){let e=t.target.getParent().attrs.line;-1!=e.freeDistances.indexOf(t.target.attrs.distance_to_line_center)&&1!=e.keepDistribution&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))}else 1==this.eraseMode&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))},editText(t){let e=t.target.getStage().attrs.container.getBoundingClientRect();document.getElementById("input").style.top=e.y+t.target.getAbsolutePosition().y+"px",document.getElementById("input").style.left=e.x+t.target.getAbsolutePosition().x-5*document.getElementById("input").size+"px",document.getElementById("input").style.display="initial",this.editedText=t.target},updateText(t){let e=this.shapes.find((t=>t.id===this.editedText.attrs.id)),i=!0;void 0==e&&(i=!1);let s=0;while(!i)s<this.groups.length?(e=this.groups[s].shapes_g.find((t=>t.id===this.editedText.attrs.id)),i=void 0!=e,s++):i=!0;if(void 0!=e){let i,s,a,n;i=this.editedText.width(),s=this.editedText.height(),e.text=t.target.value,this.editedText.text(t.target.value),a=this.editedText.width()-i,n=this.editedText.height()-s,e.offsetX=e.offsetX+a/2,e.offsetY=e.offsetY+n/2,e.length_x=this.editedText.width(),e.length_y=this.editedText.height(),document.getElementById("input").style.display="none"}},updateNaration(t){let e="<strong>Substrate</strong> ";e+="- <mark class='blue'> StickyLine </mark><br>",e+="Relation: <i>alignement and distance with</i>:";for(let i=0;i<t.shapes_g.length;i++)e=e+"<br>- "+t.shapes_g[i].className;e+="<br>Distance kept in memory:";for(let i=0;i<t.line.occupiedDistances.length;i++)e=e+t.line.occupiedDistances[i].toFixed(1)+",";e+="<mark class='green'>";for(let i=0;i<t.line.freeDistances.length-1;i++)e=e+t.line.freeDistances[i].toFixed(1)+",";t.line.freeDistances.length>0&&(e+=t.line.freeDistances[t.line.freeDistances.length-1].toFixed(1)),e+="</mark>",this.$emit("explain",{origin:"Instrument - Discoverability<br><mark class='pink'> The instrument should reveal the possible action that are available to the user. </mark>",text:e})}}};const Pe=(0,f.Z)(ye,[["render",Me]]);var me=Pe,Ie=i.p+"media/express-ins.726c3e44.mp4";const _e=(0,a._)("div",{id:"app"},[(0,a._)("div",{class:"container"},[(0,a._)("video",{width:"260",controls:"",src:Ie})])],-1);function De(t,e,i,s,n,o){return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",{onMousedown:e[0]||(e[0]=t=>o.updateNaration())},null,32),_e],64)}var Te={name:"ExpressivityDemo",methods:{updateNaration(){this.$emit("explain",{origin:"Instrument - Expressivity<br><mark class='blue'> The substrate supports user customization and updates itself. </mark>"})}}};const Se=(0,f.Z)(Te,[["render",De]]);var we=Se,be=i.p+"media/express-sub.1caef86e.mp4";const Xe={id:"app"},Ce=(0,a._)("div",{class:"container"},[(0,a._)("video",{width:"300",controls:"",src:be})],-1),ve=[Ce];function ke(t,e,i,s,n,o){return(0,a.wg)(),(0,a.iD)("div",Xe,ve)}var Ye={name:"ExpressivitySubstrateDemo"};const Ne=(0,f.Z)(Ye,[["render",ke]]);var Be=Ne,Oe={name:"HCPartnershipsTableView",components:{AppropriabilitySubstrateDemo:le,AppropriabilityDemo:Qt,DiscoverabilitySubstrateDemo:ue,DiscoverabilityDemo:me,ExpressivityDemo:we,ExpressivitySubstrateDemo:Be,NarativeBox:Tt},created(){this.width=300,this.height=260},updated(){let t=document.getElementsByClassName("narativeBox")[0];t.scrollTop=t.scrollHeight},data(){return{naration:[],last_origin:"",last_text:""}},methods:{addExplanation(t){let e=t.text;t.origin!=this.last_origin?(this.last_origin=t.origin,this.last_text=e,this.naration.splice(0,this.naration.length),this.naration.push(t.origin+" :<br>"),this.naration.push(e)):e!=this.last_text&&(this.naration.push("***"),this.naration.push(e),this.last_text=e);let i=document.getElementsByClassName("narativeBox")[0];i.scrollTop=i.scrollHeight}}};const Ge=(0,f.Z)(Oe,[["render",qt]]);var Ae=Ge;const Le={id:"active"},Fe={id:"center_menu"};function Re(t,e,i,n,o,r){const h=(0,a.up)("ToolBar"),l=(0,a.up)("v-rect"),c=(0,a.up)("v-circle"),d=(0,a.up)("v-image"),g=(0,a.up)("v-text"),p=(0,a.up)("v-regular-polygon"),u=(0,a.up)("v-line"),f=(0,a.up)("v-group"),M=(0,a.up)("v-transformer"),x=(0,a.up)("v-layer"),y=(0,a.up)("v-stage"),P=(0,a.up)("ContextMenu"),m=(0,a.up)("CenterMenu");return(0,a.wg)(),(0,a.iD)("div",{onClick:e[2]||(e[2]=(...t)=>r.HideContextMenu&&r.HideContextMenu(...t)),id:"playground"},[(0,a.Wm)(h,{id:"toolbar",height:100,width:400,onNeed_new_shape:r.createNewShape,onEraser_is_selected:r.switchEraseMode},null,8,["onNeed_new_shape","onEraser_is_selected"]),(0,a.Wm)(y,{ref:"stage",id:"stage",config:o.stageSize,onDragmove:r.update,onMousedown:r.handleTransformation,onTouchstart:r.handleTransformation,onFusion:r.makeGroup,onContextMenu:r.DisplayContextMenu},{default:(0,a.w5)((()=>[(0,a.Wm)(x,{ref:"layer"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.groups,(t=>((0,a.wg)(),(0,a.j4)(f,{ref_for:!0,ref:"groups",key:t.id,config:t},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Rect"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(l,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.onDragging,onDragstart:r.initializeDragging,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onDragstart","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Circle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(c,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.onDragging,onDragstart:r.initializeDragging,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onDragstart","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Image"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(d,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.onDragging,onDragstart:r.initializeDragging,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onDragstart","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Text"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(g,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.onDragging,onDragstart:r.initializeDragging,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape,onDblclick:r.editText},null,8,["config","onTransformend","onDragend","onDragmove","onDragstart","onMouseenter","onMouseout","onDblclick"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.shapes_g.filter((t=>"Triangle"==t.className)),(e=>((0,a.wg)(),(0,a.j4)(p,{key:e.id,config:e,onTransformend:r.updateTransformedShape,onDragend:e=>r.updatePosInGrp(e,t.id),onDragmove:r.onDragging,onDragstart:r.initializeDragging,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragend","onDragmove","onDragstart","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.ghosts.filter((t=>"Rect"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(l,{key:t.id,config:t},null,8,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.ghosts.filter((t=>"Circle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(c,{key:t.id,config:t},null,8,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.ghosts.filter((t=>"Image"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(d,{key:t.id,config:t},null,8,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.ghosts.filter((t=>"Text"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(g,{key:t.id,config:t},null,8,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.ghosts.filter((t=>"Triangle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(p,{key:t.id,config:t},null,8,["config"])))),128)),((0,a.wg)(),(0,a.j4)(u,{key:t.line.id,config:t.line,onTransformend:r.updateTransformedShape,onDragmove:e[0]||(e[0]=t=>r.updateGrp(t)),onMouseout:r.unshowSelectedShape,onMouseenter:r.showSelectedShape},null,8,["config","onTransformend","onMouseout","onMouseenter"])),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.line.positionPoints,(e=>((0,a.wg)(),(0,a.j4)(c,{key:e.id,config:e,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape,onDragend:e=>r.updateFreePositionInGrp(e,t.id)},null,8,["config","onMouseenter","onMouseout","onDragend"])))),128))])),_:2},1032,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Rect"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(l,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Circle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(c,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Image"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(d,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Text"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(g,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape,onDblclick:r.editText},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout","onDblclick"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.shapes.filter((t=>"Triangle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(p,{key:t.id,config:t,onTransformend:r.updateTransformedShape,onDragmove:r.updatePos,onMouseenter:r.showSelectedShape,onMouseout:r.unshowSelectedShape},null,8,["config","onTransformend","onDragmove","onMouseenter","onMouseout"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.transformers,(t=>((0,a.wg)(),(0,a.j4)(M,{key:t.id,config:t},null,8,["config"])))),128)),((0,a.wg)(),(0,a.j4)(c,{key:o.center.id,config:o.center,onDragend:r.ChangeCenter,onClick:r.DisplayCenterMenu},null,8,["config","onDragend","onClick"]))])),_:1},512)])),_:1},8,["config","onDragmove","onMousedown","onTouchstart","onFusion","onContextMenu"]),(0,a._)("div",Le,[(0,a.Wm)(P,{"menu-of-stage":o.isStageOnlySelected,"menu-of-line":o.isALineSelected,"menu-of-grouped-shape":o.isAGroupedShapeSelected,"keep-distance-button-text":this.keepDistanceButtonText,onKeepdistanceButton:r.switchStickylineMode,onCopyButton:r.Copy,onCopyAllButton:r.CopyAll,onPastButton:r.Past},null,8,["menu-of-stage","menu-of-line","menu-of-grouped-shape","keep-distance-button-text","onKeepdistanceButton","onCopyButton","onCopyAllButton","onPastButton"])]),(0,a._)("div",Fe,[(0,a.Wm)(m,{defaultAlignment:this.selectedShapeAlignment,onCenterButton:r.ChangeAlignCenter},null,8,["defaultAlignment","onCenterButton"])]),(0,a._)("input",{type:"text",id:"input",size:"10",value:"a text",onKeyup:e[1]||(e[1]=(0,s.D2)(((...t)=>r.updateText&&r.updateText(...t)),["enter"]))},null,32)])}function Ee(t,e,i,s,n,o){const r=(0,a.up)("v-rect"),h=(0,a.up)("v-circle"),l=(0,a.up)("v-regular-polygon"),c=(0,a.up)("v-text"),d=(0,a.up)("v-line"),g=(0,a.up)("v-group"),p=(0,a.up)("v-image"),u=(0,a.up)("v-layer"),f=(0,a.up)("v-stage");return(0,a.wg)(),(0,a.j4)(f,{ref:"toolbar",id:"toolbar",config:n.stageConfig},{default:(0,a.w5)((()=>[(0,a.Wm)(u,{ref:"layer"},{default:(0,a.w5)((()=>[((0,a.wg)(),(0,a.j4)(r,{key:n.shapes.rectangle.id,config:n.shapes.rectangle,onMousedown:o.Copy},null,8,["config","onMousedown"])),((0,a.wg)(),(0,a.j4)(h,{key:n.shapes.circle.id,config:n.shapes.circle,onMousedown:o.Copy},null,8,["config","onMousedown"])),((0,a.wg)(),(0,a.j4)(l,{key:n.shapes.triangle.id,config:n.shapes.triangle,onMousedown:o.Copy},null,8,["config","onMousedown"])),((0,a.wg)(),(0,a.j4)(c,{key:n.shapes.text.id,config:n.shapes.text,onMousedown:o.Copy},null,8,["config","onMousedown"])),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.texts,(t=>((0,a.wg)(),(0,a.j4)(c,{key:t.text,config:t},null,8,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.borders,(t=>((0,a.wg)(),(0,a.j4)(d,{key:t.x,config:t},null,8,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.boxes,(t=>((0,a.wg)(),(0,a.j4)(r,{key:t.x,config:t},null,8,["config"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.groups,(t=>((0,a.wg)(),(0,a.j4)(g,{ref_for:!0,ref:"groups",key:t.id,config:t},{default:(0,a.w5)((()=>[((0,a.wg)(),(0,a.j4)(d,{key:t.line.id,config:t.line,onMousedown:o.Copy},null,8,["config","onMousedown"]))])),_:2},1032,["config"])))),128)),((0,a.wg)(),(0,a.j4)(p,{key:n.tools.eraser.id,config:n.tools.eraser,onMousedown:o.activateTool},null,8,["config","onMousedown"]))])),_:1},512)])),_:1},8,["config"])}const He=window.innerWidth;var je={props:{CopiedShape:Object,pastOneObject:{type:Boolean,default:!0}},data(){return{stageConfig:{width:He,height:100},shapes:{rectangle:{rotation:0,id:"o1",x:46,y:20,opacity:1,width:75,height:50,scaleX:1,scaleY:1,strokeWidth:0,stroke:"black",fill:"red",name:"rect1",draggable:!1,className:"Rect",isGrouped:0,offsetX:37.5,offsetY:0,personalRotation:0,centerPosition:"Top"},circle:{rotation:0,x:116,y:20,scaleX:1,scaleY:1,opacity:1,offsetX:0,offsetY:-25,radius:25,fill:"orange",strokeWidth:0,stroke:"black",draggable:!1,isGrouped:0,className:"Circle",id:"o3",personalRotation:0,centerPosition:"Top"},triangle:{rotation:0,id:"8",x:170,y:51,sides:3,opacity:1,radius:30,width:60,height:60,scaleX:1,scaleY:1,strokeWidth:0,stroke:"black",fill:"purple",name:"triangle1",draggable:!1,className:"Triangle",isGrouped:0,offsetX:0,offsetY:0,personalRotation:0,centerPosition:"Middle"},text:{text:"A text",rotation:0,opacity:1,x:216,y:40,scaleX:1,scaleY:1,offsetY:0,offsetX:18,length_x:36,length_y:15,isGrouped:0,className:"Text",fontSize:15,fontFamily:"Calibri",id:"4",personalRotation:0,centerPosition:"Top"}},groups:[{name:"group",className:"Group",id:"1",x:0,y:0,offsetX:0,offsetY:0,rotation:0,draggable:!1,ghosts:[],shapes_g:[],line:{x:316,y:50,points:[0,0,0,0,300,0],positionPoints:[],strokeWidth:10,rotation:0,tension:0,closed:!0,draggable:!1,scaleX:.2,scaleY:1,opacity:.5,offset:{x:150,y:0},name:"ligne",className:"Line",stroke:"rgb(48,48,48)",id:"1",keepDistribution:!0,freeDistances:[],occupiedDistances:[],defaultAlignment:"Middle",keepDistanceButtonText:"Liberate Distribution"}},{name:"group",className:"Group",id:"2",x:0,y:0,offsetX:0,offsetY:0,rotation:0,draggable:!1,ghosts:[],shapes_g:[],line:{x:366,y:50,points:[0,0,0,0,300,0],positionPoints:[],strokeWidth:10,rotation:-90,tension:0,closed:!0,draggable:!1,scaleX:.2,scaleY:1,opacity:.5,offset:{x:150,y:0},name:"ligne",className:"Line",stroke:"rgb(48,48,48)",id:"2",keepDistribution:!0,freeDistances:[],occupiedDistances:[],defaultAlignment:"Middle",keepDistanceButtonText:"Liberate Distribution"}},{name:"group",className:"Group",id:"3",x:0,y:0,offsetX:0,offsetY:0,rotation:0,draggable:!1,ghosts:[],shapes_g:[],line:{x:476,y:50,points:[0,0,0,0,300,0],positionPoints:[],strokeWidth:10,rotation:0,tension:0,closed:!0,draggable:!1,scaleX:.2,scaleY:1,opacity:.5,offset:{x:150,y:0},name:"ligne",className:"Line",stroke:"blue",id:"3",keepDistribution:!1,freeDistances:[],occupiedDistances:[],defaultAlignment:"Middle",keepDistanceButtonText:"Keep Distribution"}},{name:"group",className:"Group",id:"4",x:0,y:0,offsetX:0,offsetY:0,rotation:0,draggable:!1,ghosts:[],shapes_g:[],line:{x:526,y:50,points:[0,0,0,0,300,0],positionPoints:[],strokeWidth:10,rotation:-90,tension:0,closed:!0,draggable:!1,scaleX:.2,scaleY:1,opacity:.5,offset:{x:150,y:0},name:"ligne",className:"Line",stroke:"blue",id:"4",keepDistribution:!1,freeDistances:[],occupiedDistances:[],defaultAlignment:"Middle",keepDistanceButtonText:"Keep Distribution"}}],tools:{eraser:{isActivated:0,rotation:0,x:606,y:40,scaleX:1,scaleY:1,offsetY:0,offsetX:0,opacity:1,image:null,isGrouped:0,className:"eraser",fontSize:30,id:"5"}},borders:[{x:246,y:0,points:[0,0,0,0,100,0],strokeWidth:3,rotation:90,opacity:1,stroke:"black"}],texts:[{text:"Shapes",y:5,x:6},{text:"Tools",y:5,x:250},{text:"eraser",y:25,x:588,fill:"rgb(200, 59, 218)"},{text:"StickyLines",y:19,x:260},{text:"(Keep Distribution)",y:29,x:260},{text:"StickyLines",y:19,x:420,fill:"blue"},{text:"(Keep Distance)",y:29,x:420,fill:"blue"}],boxes:[{rotation:0,id:"box1",x:296,y:17,width:145,height:70,scaleX:1,scaleY:1,strokeWidth:1,stroke:"black",draggable:!1,offsetX:37.5,offsetY:0},{rotation:0,id:"box2",x:456,y:17,width:145,height:70,scaleX:1,scaleY:1,strokeWidth:1,stroke:"blue",draggable:!1,offsetX:37.5,offsetY:0}]}},created(){const t=new window.Image;t.src=i(843),t.onload=()=>{this.tools.eraser.image=t,this.tools.eraser.offsetX=t.width/2,this.tools.eraser.offsetY=0}},methods:{Copy(t){this.$emit("need_new_shape",t.target)},activateTool(t){let e;"eraser"===t.target.attrs.className&&(e=this.tools.eraser,1==e.opacity?e.opacity=.4:e.opacity=1,this.$emit("eraser_is_selected"))}}};const We=(0,f.Z)(je,[["render",Ee]]);var Ke=We;const qe=function(t){let e=this.getStage().width(),i=this.getStage().height(),s=10;return t.x>e-s&&t.y>i-s?{x:e-s,y:i-s}:t.x>e-s&&t.y<s?{x:e-s,y:s}:t.y>i-s&&t.x<s?{x:s,y:i-s}:t.x<s&&t.y<s?{x:s,y:s}:t.x<s?{x:s,y:t.y}:t.y<s?{x:t.x,y:s}:t.x>e-s?{x:e-s,y:t.y}:t.y>i-s?{x:t.x,y:i-s}:{x:t.x,y:t.y}};var ze={props:{width:{type:Number,default:window.innerWidth},height:{type:Number,default:window.innerHeight}},components:{ContextMenu:$,CenterMenu:ne,ToolBar:Ke},data(){return{stageSize:{width:this.width,height:this.height},lengthToCapture:10,lengthToDetach:15,editedText:null,eraseMode:0,selectedShapeAlignment:"",neighbour:null,dist_with_neighbour:null,needMenu:"initial",isALineSelected:!1,isAGroupedShapeSelected:!1,isStageOnlySelected:!1,keepDistanceButtonText:"Liberate Distribution",max_id_figures:6,groups:[{name:"group",className:"Group",id:"6",x:0,y:0,offsetX:0,offsetY:0,rotation:0,draggable:!1,shapes_g:[],ghosts:[],aShapeHasBeenDetach:0,line:{x:200,y:200,points:[0,0,0,0,300,0],positionPoints:[],strokeWidth:10,rotation:0,tension:0,closed:!0,draggable:!0,scaleX:1,scaleY:1,opacity:.5,offset:{x:150,y:0},name:"ligne",className:"Line",stroke:"rgb(48,48,48)",id:"6",keepDistribution:!0,freeDistances:[],occupiedDistances:[],keepDistanceButtonText:"Liberate Distribution",defaultAlignment:"Middle",dragBoundFunc:qe}},{name:"group2",className:"Group",id:"7",x:0,y:0,offsetX:0,offsetY:0,rotation:0,draggable:!1,shapes_g:[],ghosts:[],line:{x:500,y:300,points:[0,0,0,0,300,0],positionPoints:[],strokeWidth:10,rotation:0,tension:0,closed:!0,draggable:!0,scaleX:1,scaleY:1,opacity:.5,offset:{x:150,y:0},name:"ligne",className:"Line",stroke:"rgb(48,48,48)",id:"7",distShapesToCenter:[],keepDistribution:!0,freeDistances:[],occupiedDistances:[],keepDistanceButtonText:"Liberate Distribution",defaultAlignment:"Middle",dragBoundFunc:qe}}],transformers:[{id:"lineTransformer",enabledAnchors:["middle-left","middle-right"],flipEnabled:!1,nodes:[]},{id:"shapeTransformer",nodes:[]}],shapes:[{rotation:0,id:"1",x:100,y:10,width:130,height:100,scaleX:1,scaleY:1,opacity:1,strokeWidth:0,stroke:"black",fill:"red",name:"rect1",draggable:!0,className:"Rect",isGrouped:0,offsetX:65,offsetY:0,personalRotation:0,centerPosition:"Top",dragBoundFunc:qe},{rotation:0,id:"2",x:150,y:150,width:100,height:100,scaleX:1,scaleY:1,opacity:1,strokeWidth:0,stroke:"black",fill:"green",name:"rect2",draggable:!0,className:"Rect",isGrouped:0,dragBoundFunc:qe,offsetX:50,offsetY:0,personalRotation:0,centerPosition:"Top"},{rotation:0,x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:-50,radius:50,opacity:1,fill:"orange",strokeWidth:0,stroke:"black",draggable:!0,isGrouped:0,className:"Circle",personalRotation:0,id:"3",dragBoundFunc:qe,centerPosition:"Top"},{text:"A text",rotation:0,x:400,y:200,scaleX:1,scaleY:1,offsetY:0,offsetX:36,opacity:1,length_x:72,length_y:30,draggable:!0,isGrouped:0,className:"Text",fontSize:30,fontFamily:"Calibri",personalRotation:0,id:"4",dragBoundFunc:qe,centerPosition:"Top"},{rotation:0,x:700,y:400,scaleX:1,scaleY:1,offsetY:0,offsetX:0,opacity:1,image:null,draggable:!0,isGrouped:0,className:"Image",fontSize:30,personalRotation:0,id:"5",dragBoundFunc:qe,centerPosition:"Top"},{rotation:0,id:"8",x:300,y:150,sides:3,radius:60,width:120,height:120,opacity:1,scaleX:1,scaleY:1,strokeWidth:0,stroke:"black",fill:"purple",name:"triangle1",draggable:!0,className:"Triangle",isGrouped:0,dragBoundFunc:qe,offsetX:0,offsetY:0,personalRotation:0,centerPosition:"Middle"},{text:"Try applying the 3 lenses \n to improve the playground :-) :\n analytical, critical and constructive",rotation:0,x:1250,y:200,scaleX:1,scaleY:1,offsetY:0,offsetX:36,opacity:1,length_x:72,length_y:30,draggable:!0,isGrouped:0,className:"Text",fontSize:20,fontFamily:"Calibri",personalRotation:0,id:"9",dragBoundFunc:qe,centerPosition:"Top"}],center:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:4,fill:"black",opacity:1,draggable:!0,isGrouped:0,className:"Circle",id:"center",dragBoundFunc:qe,visible:!1},positionPoint:{x:300,y:500,scaleX:1,scaleY:1,offsetX:0,offsetY:0,radius:3,fill:"yellow",opacity:1,draggable:!1,isGrouped:0,className:"positionPoint",id:"positionPoint",distance_to_line_center:void 0,dragBoundFunc:qe},selectedShapeId:""}},mounted(){let t=this.$refs.stage.getStage().getChildren()[0].getChildren().filter((t=>"Text"==t.attrs.className)),e=this.shapes.filter((t=>"Text"==t.className));for(let i=0;i<e.length;i++)e[i].length_x=t[i].width(),e[i].length_y=t[i].height(),t[i].offsetX(e[i].length_x/2),e[i].offsetX=e[i].length_x/2},created(){this.max_id_figures=this.shapes.length+this.groups.length;for(let e=0;e<this.groups.length;e++)this.max_id_figures=this.max_id_figures+this.groups[e].shapes_g.length;const t=new window.Image;t.src=i(471),t.height=150,t.width=150,t.onload=()=>{this.shapes.find((t=>"Image"===t.className)).image=t,this.shapes.find((t=>"Image"===t.className)).offsetX=t.width/2,this.shapes.find((t=>"Image"===t.className)).offsetY=0}},methods:{switchEraseMode(){0==this.eraseMode?(this.eraseMode=1,document.getElementById("playground").style.cursor="url("+i(843)+"),default",this.center.visible=!1,this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer")):(this.eraseMode=0,document.getElementById("playground").style.cursor="default")},checkIfShapesOnLine(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;let a=0;while(a<s.length)if(this.isCoordinateOnLine(s[a].x,s[a].y,i.id))a+=1;else{e.ghosts.splice(0,e.ghosts.length);for(let t=0;t<s.length;t++)s[t].opacity=1;if(console.log("a shape is not on a line"),s[a].dragBoundFunc=qe,s[a].isGrouped=0,i.keepDistribution&&i.positionPoints.splice(a,1),this.shapes.push(s[a]),i.freeDistances.push(i.occupiedDistances[a]),i.occupiedDistances.splice(a,1),s.splice(a,1),!i.keepDistribution){this.updateAllPosInGrp(t);let e=i.positionPoints.find((t=>t.distance_to_line_center==i.freeDistances[i.freeDistances.length-1]));e.draggable=!0,this.updateDragFunc(e,i)}}},isCoordinateOnLine(t,e,i){const s=this.groups.find((t=>t.id===i)),a=s.line;let n=!0,o=a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),r=a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),h=a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180)),l=a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180)),c=(o-h)/(l-r),d=a.y-c*a.x;return n=Math.abs(r-l)>1?Math.abs(c*t+d-e)>1:Math.abs(t-a.x)>1,!(n||(a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=0&&a.rotation*(Math.PI/180)>-Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI+a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=-Math.PI/2&&a.rotation*(Math.PI/180)>-Math.PI||(a.y+.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.x+.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(Math.PI-a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI&&a.rotation*(Math.PI/180)>Math.PI/2||(a.y+.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))+this.lengthToDetach<e||a.y-.5*a.points[4]*a.scaleX*Math.sin(a.rotation*(Math.PI/180))-this.lengthToDetach>e)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0||(a.x+.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))+this.lengthToDetach<t||a.x-.5*a.points[4]*a.scaleX*Math.cos(a.rotation*(Math.PI/180))-this.lengthToDetach>t)&&a.rotation*(Math.PI/180)<=Math.PI/2&&a.rotation*(Math.PI/180)>=0)},updateGrp(t){let e=t.target.id();const i=this.groups.find((t=>t.id===e)),s=i.line;i.offsetX=s.offsetX,i.offsetY=s.offsetY,s.x=t.target.x(),s.y=t.target.y(),this.center.x=s.x,this.center.y=s.y,this.updateAllPosInGrp(s.id),this.checkIfShapesOnLine(s.id)},updateAllPosInGrp(t){const e=this.groups.find((e=>e.id===t)),i=e.line,s=e.shapes_g;for(let n=0;n<s.length;n++)i.keepDistribution,s[n].x=i.x+i.occupiedDistances[n]*Math.cos(i.rotation*(Math.PI/180)),s[n].y=i.y+i.occupiedDistances[n]*Math.sin(i.rotation*(Math.PI/180)),s[n].distance_to_line_center=i.occupiedDistances[n],s[n].rotation=s[n].personalRotation+i.rotation,i.positionPoints[n].x=s[n].x,i.positionPoints[n].y=s[n].y,i.positionPoints[n].distance_to_line_center=s[n].distance_to_line_center;let a=s.length;while(a<i.positionPoints.length)i.keepDistribution?i.positionPoints.splice(i.positionPoints.length-1,1):(i.positionPoints[a].x=i.x+i.freeDistances[a-s.length]*Math.cos(i.rotation*(Math.PI/180)),i.positionPoints[a].y=i.y+i.freeDistances[a-s.length]*Math.sin(i.rotation*(Math.PI/180)),i.positionPoints[a].distance_to_line_center=i.freeDistances[a-s.length],a++)},update(){const t=this.shapes;let e=!1;for(let i=0;i<t.length;i++){let s=t[i].x,a=t[i].y;for(let n=0;n<this.groups.length;n++){let o=this.groups[n].line,r=o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),h=o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),l=o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180)),c=o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180)),d=(r-l)/(c-h),g=o.y-d*o.x;e=Math.abs(h-c)>1?Math.abs(d*s+g-a)<=this.lengthToCapture:Math.abs(s-o.x)<=this.lengthToCapture,(e&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=0&&o.rotation*(Math.PI/180)>-Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI+o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=-Math.PI/2&&o.rotation*(Math.PI/180)>=-Math.PI||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(Math.PI-o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI&&o.rotation*(Math.PI/180)>Math.PI/2||e&&o.y+.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))+this.lengthToCapture>=a&&o.y-.5*o.points[4]*o.scaleX*Math.sin(o.rotation*(Math.PI/180))-this.lengthToCapture<=a&&o.x+.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))+this.lengthToCapture>=s&&o.x-.5*o.points[4]*o.scaleX*Math.cos(o.rotation*(Math.PI/180))-this.lengthToCapture<=s&&o.rotation*(Math.PI/180)<=Math.PI/2&&o.rotation*(Math.PI/180)>=0)&&(t[i].isGrouped=1,this.makeGroup(o.id))}}},initializeDragging(t){let e=this.groups.find((e=>e.id==t.target.getParent().attrs.id));if(e.shapes_g.length>1&&1==e.line.keepDistribution){let i=this.closestGroupedShape(e,t);this.neighbour=t.target.getParent().getChildren().find((t=>t.attrs.id==i.id));let s={x:t.target.x(),y:t.target.y()};this.createGhost(e,s,this.neighbour),this.dist_with_neighbour=this.distBtwShapes(t.target.attrs,this.neighbour.attrs)}},closestGroupedShape(t,e){let i=t.shapes_g.find((t=>t.id!=e.target.attrs.id&&0!=t.opacity));for(let s=0;s<t.shapes_g.length;s++)this.distBtwShapes(t.shapes_g[s],e.target.attrs),this.distBtwShapes(t.shapes_g[s],e.target.attrs)<this.distBtwShapes(i,e.target.attrs)&&t.shapes_g[s].id!=e.target.attrs.id&&0!=t.shapes_g[s].opacity&&(i=t.shapes_g[s]);return i},createGhost(t,e,i){if(1==t.line.keepDistribution){let s=i.clone({id:"clone"+i.attrs.id,x:e.x,y:e.y,opacity:0,draggable:!1});t.ghosts.push(s.attrs)}},distBtwShapes(t,e){return Math.sqrt((e.y-t.y)**2+(e.x-t.x)**2)},distFromStartPoint(t,e){return Math.sqrt((t.y-e.target.y())**2+(t.x-e.target.x())**2)},onDragging(t){let e=this.groups.find((e=>e.id===t.target.getParent().attrs.id)),i=e.shapes_g.find((e=>e.id==t.target.id()));if(1==e.line.keepDistribution&&e.shapes_g.length>1){let s=e.ghosts.find((t=>t.id=="clone"+this.neighbour.attrs.id)),a=e.shapes_g.find((t=>t.id===this.neighbour.attrs.id));if(e.shapes_g.length>1&&this.isCoordinateOnLine(t.target.x(),t.target.y(),e.id)){let n=e.line.points[4]*e.line.scaleX/(e.shapes_g.length-1);if(this.closestGroupedShape(e,t).id!=this.neighbour.attrs.id){let n;n=0==this.neighbour.attrs.opacity?{x:a.x,y:a.y}:{x:i.x,y:i.y},s.opacity<1?e.ghosts.splice(e.ghosts.indexOf(s),1):(i.x=a.x,i.y=a.y,a.x=s.x,a.y=s.y,a.opacity=1,e.ghosts.splice(e.ghosts.indexOf(s),1),this.sortByDistToLineCenter(e)),this.neighbour=t.target.getParent().getChildren().find((i=>i.attrs.id==this.closestGroupedShape(e,t).id)),this.createGhost(e,n,this.neighbour),s=e.ghosts.find((t=>t.id=="clone"+this.neighbour.attrs.id))}let o=this.distFromStartPoint(i,t);this.dist_with_neighbour=this.distBtwShapes(t.target.attrs,this.neighbour.attrs);let r=o/n,h=r;r>=.3&&(h=.3),r>=1&&(h=1),s.opacity=h,this.neighbour.opacity(1-1*h),a=e.shapes_g.find((t=>t.id===this.neighbour.attrs.id)),a.opacity=1-1*h}else{for(let t=0;t<e.shapes_g.length;t++)e.shapes_g[t].opacity=1;s.opacity=0}}let s=Math.sqrt((t.target.getStage().getPointerPosition().y-t.target.y())**2+(t.target.getStage().getPointerPosition().x-t.target.x())**2);"Rect"==t.target.className?s-=t.target.attrs.height*t.target.attrs.scaleY:"Circle"==t.target.className?s-=2*t.target.attrs.radius*t.target.attrs.scaleY:"Text"==t.target.className?s-=t.target.attrs.length_y*t.target.attrs.scaleY:("Image"==t.target.className||"Triangle"==t.target.attrs.className)&&(s-=t.target.height()*t.target.scaleY()),s>50&&(this.groups.find((e=>e.id===t.target.getParent().attrs.id)).aShapeHasBeenDetach=1,this.DetachShape(i,t.target.getStage().getPointerPosition().x,t.target.getStage().getPointerPosition().y))},GiveSignOfDistance(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(a)<=this.lengthToCapture&&-90==e.rotation?-Math.sign(n):Math.abs(a)<=this.lengthToCapture&&90==e.rotation?Math.sign(n):Math.sign(a),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},GiveSignOfDistanceBtwCenterAndShape(t,e){let i,s=e.rotation*(Math.PI/180),a=t.x-e.x,n=t.y-e.y;return i=Math.abs(n)<=this.lengthToCapture&&-90==e.rotation?Math.sign(a):Math.abs(n)<=this.lengthToCapture&&90==e.rotation?-Math.sign(a):Math.sign(n),(s<-Math.PI/2||s>Math.PI/2)&&(i=-i),i},makeGroup(t){this.eraseNodefromTransformer("shapeTransformer"),this.eraseNodefromTransformer("lineTransformer");const e=this.groups.find((e=>e.id===t)),i=e.line,s=this.shapes;i.freeDistances.sort(this.isSmaller),s.sort(this.isBeforeRegardingX);for(let a=0;a<s.length;a++)if(1==s[a].isGrouped){const n=Object.assign({},this.positionPoint);let o=s[a].x-i.x,r=s[a].y-i.y;if(s[a].personalRotation=0,s[a].distance_to_line_center=this.GiveSignOfDistance(s[a],i)*Math.sqrt(o**2+r**2),Math.abs(s[a].distance_to_line_center)>=i.points[4]*i.scaleX/2&&(s[a].distance_to_line_center=Math.sign(s[a].distance_to_line_center)*i.points[4]*i.scaleX/2),this.ChangeCenterRegardingCommand(s[a].id,e.line.defaultAlignment),!i.keepDistribution&&i.freeDistances.length>0){let t=this.isNearest(i,s[a]);this.updateDragFunc(s[a],i),e.shapes_g.push(s[a]),e.line.occupiedDistances.push(e.line.freeDistances[t]),e.line.positionPoints.find((i=>i.distance_to_line_center==e.line.freeDistances[t])).draggable=!1,e.line.freeDistances.splice(t,1)}else this.updateDragFunc(s[a],i),e.shapes_g.push(s[a]),e.line.occupiedDistances.push(s[a].distance_to_line_center),n.id="positionPoint"+e.id+e.line.positionPoints.length,e.line.positionPoints.push(n);console.log("A new shape has been added with a distance"+s[a].distance_to_line_center),this.updateOccupiedDistance(i.id),this.updateAllPosInGrp(t),s.splice(a,1)}this.center.x=i.x,this.center.y=i.y},updateOccupiedDistance(t){const e=this.groups.find((e=>e.id===t));if(this.sortByDistToLineCenter(e),e.line.keepDistribution){let t=e.line.points[4],i=e.shapes_g.length,s=t/(i-1)*e.line.scaleX;if(i%2==0){for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[t-1]=-(i/2-1-t+1)*s-s/2;for(let t=1;t<=i/2-1;t++)e.line.occupiedDistances[i/2+t]=t*s+s/2;e.line.occupiedDistances[i/2-1]=-s/2,e.line.occupiedDistances[i/2]=s/2}else{for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[t-1]=-s*((i-1)/2-t+1);for(let t=1;t<=(i-1)/2;t++)e.line.occupiedDistances[(i-1)/2+t]=s*t;e.line.occupiedDistances[(i-1)/2]=0}for(let a=0;a<e.shapes_g.length;a++)e.shapes_g[a].distance_to_line_center=e.line.occupiedDistances[a]}else e.line.occupiedDistances.sort(this.isSmaller)},isSmaller(t,e){return t<e?-1:1},isBeforeRegardingX(t,e){return t.x<e.x?-1:1},isNearest(t,e){let i,s=t.x+t.freeDistances[0]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[0]*Math.sin(t.rotation*(Math.PI/180)),n=Math.sqrt((s-e.x)**2+(a-e.y)**2),o=0;for(let r=1;r<t.freeDistances.length;r++)s=t.x+t.freeDistances[r]*Math.cos(t.rotation*(Math.PI/180)),a=t.y+t.freeDistances[r]*Math.sin(t.rotation*(Math.PI/180)),i=Math.sqrt((s-e.x)**2+(a-e.y)**2),i<n&&(n=i,o=r);return o},sortByDistToLineCenter(t){if(t.line.keepDistribution)for(let e=0;e<t.shapes_g.length;e++){let i=t.shapes_g[e].x-t.line.x,s=t.shapes_g[e].y-t.line.y;t.shapes_g[e].distance_to_line_center=this.GiveSignOfDistance(t.shapes_g[e],t.line)*Math.sqrt(i**2+s**2)}for(let e=1;e<t.shapes_g.length;e++){let i=t.shapes_g[e],s=e;while(s>0&&t.shapes_g[s-1].distance_to_line_center>i.distance_to_line_center)t.shapes_g[s]=t.shapes_g[s-1],s-=1;t.shapes_g[s]=i}},updateDragFunc(t,e){let i=e.rotation*(Math.PI/180);i<=0&&i>=-Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.y-e.y)*Math.cos(i),y:e.y-(t.y-e.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x-(t.x-e.x)*Math.cos(i),y:e.y-(t.x-e.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?t.dragBoundFunc=function(t){return{x:e.x+(t.y-e.y)*Math.cos(i),y:e.y+(t.y-e.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(t.dragBoundFunc=function(t){return{x:e.x+(t.x-e.x)*Math.cos(i),y:e.y+(t.x-e.x)*Math.sin(i)}})},updatePos(t){const e=this.shapes.find((e=>e.id===t.target.id()));e.x=t.target.x(),e.y=t.target.y(),this.center.x=t.target.x(),this.center.y=t.target.y()},updatePosInGrp(t,e){let i,s,a;const n=this.groups.find((t=>t.id===e));if(1==n.aShapeHasBeenDetach)return void(n.aShapeHasBeenDetach=0);const o=n.line,r=n.shapes_g.find((e=>e.id===t.target.id())),h=n.shapes_g;if(o.keepDistribution){n.ghosts.splice(0,n.ghosts.length);for(let t=0;t<h.length;t++)h[t].opacity=1;if(this.neighbour=null,this.isCoordinateOnLine(t.target.x(),t.target.y(),o.id)){i=r.x-t.target.x(),s=r.y-t.target.y();let e=n.line.points[4],a=n.shapes_g.length,l=e/(a-1)*n.line.scaleX,c=Math.sqrt(i**2+s**2);c>=l?(r.x=t.target.x(),r.y=t.target.y(),this.updateOccupiedDistance(o.id),r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation,this.updateAllPosInGrp(o.id)):(r.x=o.x+o.occupiedDistances[h.indexOf(r)]*Math.cos(o.rotation*(Math.PI/180)),r.y=o.y+o.occupiedDistances[h.indexOf(r)]*Math.sin(o.rotation*(Math.PI/180)),r.distance_to_line_center=o.occupiedDistances[h.indexOf(r)],r.rotation=o.rotation)}else r.x=t.target.x(),r.y=t.target.y();o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center}else o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,r.x=t.target.x(),r.y=t.target.y(),0==Math.sin(o.rotation*(Math.PI/180))?a=r.x-o.x:(a=0!=Math.sign(r.x-o.x)?Math.sign(-r.rotation)*Math.sign(r.x-o.x)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2):Math.sign(-r.rotation)*Math.sign(r.y-o.y)*Math.sqrt((r.x-o.x)**2+(r.y-o.y)**2),(r.rotation*(Math.PI/180)<=-Math.PI/2||r.rotation*(Math.PI/180)<=Math.PI/2&&r.rotation*(Math.PI/180)>=0)&&(a=-a)),o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center;let l={x:r.x,y:r.y};if(this.center.x=r.x,this.center.y=r.y,t.target.position(l),t.target.getLayer().batchDraw(),this.isCoordinateOnLine(r.x,r.y,o.id))o.keepDistribution?n.line.occupiedDistances[h.indexOf(r)]=r.distance_to_line_center:n.line.occupiedDistances[h.indexOf(r)]=a,o.positionPoints[n.shapes_g.indexOf(r)].x=r.x,o.positionPoints[n.shapes_g.indexOf(r)].y=r.y,o.positionPoints[n.shapes_g.indexOf(r)].distance_to_line_center=r.distance_to_line_center;else{r.dragBoundFunc=qe,r.isGrouped=0,this.shapes.push(r);for(let t=0;t<h.length;t++)h[t].id==r.id&&(o.freeDistances.push(o.occupiedDistances[t]),o.occupiedDistances.splice(t,1),h.splice(t,1),console.log("a shape has been removed from the line"))}if(o.keepDistribution&&this.updateOccupiedDistance(o.id),this.updateAllPosInGrp(o.id),!o.keepDistribution&&o.freeDistances.length>0){let t=o.positionPoints.find((t=>t.distance_to_line_center==o.freeDistances[o.freeDistances.length-1]));0==t.draggable&&(t.draggable=!0,this.updateDragFunc(t,o))}},updateFreePositionInGrp(t,e){let i=this.groups.find((t=>t.id==e)),s=i.line.positionPoints.find((e=>e.id==t.target.attrs.id)),a=i.line.freeDistances.indexOf(s.distance_to_line_center),n=this.GiveSignOfDistance({x:t.target.x(),y:t.target.y()},i.line)*this.distBtwShapes({x:t.target.x(),y:t.target.y()},i.line);n!=i.line.freeDistances[a]&&(Math.abs(n)>i.line.points[4]*i.line.scaleX/2&&(n=Math.sign(n)*i.line.points[4]*i.line.scaleX/2),i.line.freeDistances[a]=n,this.updateAllPosInGrp(e))},updateTransformedShape(t){let e,i;if("Line"==t.target.className)i=this.groups.find((t=>t.id===this.selectedShapeId)).line;else if(e=this.findShape(this.selectedShapeId),i=e.shape_data,void 0==i)return;let s=i.x,a=i.y;i.x=t.target.x(),i.y=t.target.y(),i.rotation=t.target.rotation();let n=i.scaleX;if(i.scaleX=t.target.scaleX(),i.scaleY=t.target.scaleY(),"Line"==t.target.className){const e=this.groups.find((t=>t.id===i.id));if(i.keepDistribution){for(let t=0;t<i.occupiedDistances.length;t++)i.occupiedDistances[t]=i.occupiedDistances[t]/n*i.scaleX;this.update(),this.updateGrp(t),this.checkIfShapesOnLine(this.selectedShapeId)}else{if(n!=i.scaleX){for(let t=0;t<e.shapes_g.length;t++){let n=e.shapes_g[t].x-i.x,o=e.shapes_g[t].y-i.y;0==Math.sign(e.line.occupiedDistances[t])?e.line.occupiedDistances[t]=this.GiveSignOfDistance(e.shapes_g[t],i)*Math.sqrt(n**2+o**2):e.line.occupiedDistances[t]=Math.sign(e.line.occupiedDistances[t])*Math.sqrt(n**2+o**2),Math.sign(e.shapes_g[t].x-s)!=Math.sign(n)&&0!=Math.sign(e.shapes_g[t].x-s)&&90!=e.line.rotation&&-90!=e.line.rotation&&(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t]),Math.sign(e.shapes_g[t].y-a)==Math.sign(o)||0==Math.sign(e.shapes_g[t].y-a)||90!=e.line.rotation&&-90!=e.line.rotation||(e.line.occupiedDistances[t]=-e.line.occupiedDistances[t])}for(let t=0;t<i.freeDistances.length;t++){let e=s-i.x,n=a-i.y,o=Math.sqrt(e**2+n**2);i.rotation<-90||i.rotation>90?i.freeDistances[t]=i.freeDistances[t]-Math.sign(s-i.x)*o:90==i.rotation||-90==i.rotation?i.freeDistances[t]=i.freeDistances[t]-n:i.freeDistances[t]=i.freeDistances[t]+Math.sign(s-i.x)*o}}this.update(),this.updateGrp(t),this.checkIfShapesOnLine(this.selectedShapeId);let o=0;while(o<i.freeDistances.length)if(i.points[4]*i.scaleX*.5+2<Math.abs(i.freeDistances[o])){let t=i.positionPoints.find((t=>t.distance_to_line_center==i.freeDistances[o])),e=i.positionPoints.indexOf(t);i.positionPoints.splice(e,1),i.freeDistances.splice(o,1)}else o+=1}for(let t=0;t<e.shapes_g.length;t++)this.updateDragFunc(e.shapes_g[t],i);for(let t=0;t<e.line.positionPoints.length;t++)this.updateDragFunc(e.line.positionPoints[t],i)}else"-1"!=e.grp_id?(this.groups.find((t=>t.id===e.grp_id)).shapes_g.find((e=>e.id===t.target.id())).personalRotation=t.target.rotation()-t.target.getParent().attrs.line.rotation,this.updateAllPosInGrp(e.grp_id),this.updateOccupiedDistance(e.grp_id),t.target.x(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).x),t.target.y(t.target.getParent().attrs.shapes_g.find((e=>e.id===t.target.id())).y),this.checkIfShapesOnLine(e.grp_id),this.updateDragFuncOfCenter()):(this.update(),this.updateDragFuncOfCenter());this.center.x=t.target.attrs.x,this.center.y=t.target.attrs.y},handleTransformation(t){if(document.getElementById("input").style.display="none",void 0==t.evt)return;if(1==this.eraseMode)return void this.eraserAction(t);if(t.target===t.target.getStage())return this.selectedShapeId="NoId",this.eraseNodefromTransformer("lineTransformer"),this.eraseNodefromTransformer("shapeTransformer"),void(this.center.visible=!1);const e="Transformer"===t.target.getParent().className;if(e)return;const i=t.target.id();let s,a=this.findShape(i).shape_data;"center"!=t.target.attrs.id&&"positionPoint"!=t.target.attrs.className&&("Line"==t.target.className?(s="lineTransformer",a=this.groups.find((t=>t.id===i)).line,this.center.draggable=!1,this.selectedShapeAlignment=a.defaultAlignment,this.eraseNodefromTransformer("shapeTransformer")):(s="shapeTransformer",this.center.draggable=!0,this.selectedShapeAlignment=a.centerPosition,this.eraseNodefromTransformer("lineTransformer")),void 0!=a?(this.selectedShapeId=i,this.center.visible=!0,this.updateTransformer(s)):this.selectedShapeId="NoId",this.updateDragFuncOfCenter())},eraseNodefromTransformer(t){let e=this.$refs.stage.getStage();const i=e.find("#"+t)[0];i.nodes([])},updateTransformer(t){let e,i=this.$refs.stage.getStage(),s=i.find("#"+t)[0];if("lineTransformer"==t)e=i.children[0].getChildren().filter((t=>"Group"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0].getChildren().filter((t=>"Line"==t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];else{e=i.children[0].getChildren().filter((t=>"Group"!=t.attrs.className&&t.attrs.id==this.selectedShapeId))[0];let t=!0;void 0==e&&(t=!1);let s=0;while(!t)s<this.groups.length?(e=i.children[0].getChildren().filter((t=>"Group"==t.attrs.className))[s].getChildren().find((t=>t.attrs.id==this.selectedShapeId&&"Line"!=t.attrs.className)),t=void 0!=e,s++):t=!0}e!==s.node()&&(void 0!=e?s.nodes([e]):s.nodes([]),this.center.x=e.attrs.x,this.center.y=e.attrs.y)},DisplayCenterMenu(t){ne.props.ConcernedShape=t.target,document.getElementById("center_menu").style.display="initial",document.getElementById("center_menu").style.top=document.getElementById("playground").getBoundingClientRect().top+document.documentElement.scrollTop+t.target.getStage().getPointerPosition().y+"px",document.getElementById("center_menu").style.left=document.getElementById("playground").getBoundingClientRect().left+document.documentElement.scrollLeft+t.target.getStage().getPointerPosition().x+"px"},DisplayContextMenu(t){t.evt.preventDefault(),void 0!=t.target.className&&"center"!=t.target.attrs.id&&(this.isStageOnlySelected=!1,$.data().dM="initial",this.$emit("needmenu"),this.needMenu=!0,$.props.ConcernedShape=t.target,"Line"==t.target.attrs.className?(this.isALineSelected=!0,this.isAGroupedShapeSelected=!0,this.keepDistanceButtonText=t.target.attrs.keepDistanceButtonText):"Group"==t.target.getParent().attrs.className?this.isAGroupedShapeSelected=!0:(this.isALineSelected=!1,this.isAGroupedShapeSelected=!1),document.getElementById("active").style.display="initial",document.getElementById("active").style.top=document.getElementById("playground").getBoundingClientRect().top+document.documentElement.scrollTop+t.target.getStage().getPointerPosition().y+70+"px",document.getElementById("active").style.left=document.getElementById("playground").getBoundingClientRect().left+document.documentElement.scrollLeft+t.target.getStage().getPointerPosition().x-50+"px"),t.target===t.target.getStage()&&(this.needMenu=!0,this.isALineSelected=!1,this.isAGroupedShapeSelected=!1,this.isStageOnlySelected=!0,document.getElementById("active").style.display="initial",document.getElementById("active").style.top=document.getElementById("playground").getBoundingClientRect().top+document.documentElement.scrollTop+t.target.getStage().getPointerPosition().y+70+"px",document.getElementById("active").style.left=document.getElementById("playground").getBoundingClientRect().left+document.documentElement.scrollLeft+t.target.getStage().getPointerPosition().x-50+"px")},HideContextMenu(){this.needMenu=!1,document.getElementById("active").style.display="none",document.getElementById("center_menu").style.display="none"},ChangeCenter(t){let e,i,s=this.findShape(this.selectedShapeId),a=s.shape_data,n=this.GiveSignOfDistanceBtwCenterAndShape(t.target.attrs,a)*Math.sqrt((t.target.y()-a.y)**2+(t.target.x()-a.x)**2)+a.offsetY*a.scaleY,o=a.offsetY;void 0==a?a=this.groups.find((t=>t.id==this.selectedShapeId)).line:("Rect"==a.className?(e=a.height*a.scaleY/3,i=a.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.width/2,a.offsetY=a.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.width/2,a.offsetY=a.height,a.centerPosition="Bottom"):(a.offsetX=a.width/2,a.offsetY=0,a.centerPosition="Top")):"Circle"==a.className?(n+=a.radius*a.scaleY,e=a.radius*a.scaleY*2/3,i=a.radius*a.scaleY*4/3,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0,a.centerPosition="Middle"):n>i?(a.offsetX=0,a.offsetY=a.radius,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")):"Image"==a.className?(e=a.image.height*a.scaleY/3,i=a.image.height*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.image.width/2,a.offsetY=a.image.height,a.centerPosition="Bottom"):(a.offsetX=a.image.width/2,a.offsetY=0,a.centerPosition="Top")):"Text"==a.className?(e=a.length_y*a.scaleY/3,i=a.length_y*a.scaleY*2/3,n>=e&&n<=i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y/2,a.centerPosition="Middle"):n>i?(a.offsetX=a.length_x/2,a.offsetY=a.length_y,a.centerPosition="Bottom"):(a.offsetX=a.length_x/2,a.offsetY=0,a.centerPosition="Top")):"Triangle"==a.className&&(n+=a.radius*a.scaleY,e=a.radius*a.scaleY/2,i=a.radius*a.scaleY*5/4,n>=e&&n<=i?(a.offsetX=0,a.offsetY=0):n>i?(a.offsetX=0,a.offsetY=a.radius/2,a.centerPosition="Bottom"):(a.offsetX=0,a.offsetY=-a.radius,a.centerPosition="Top")),a.y=a.y-(o-a.offsetY)*a.scaleY*Math.cos(a.rotation*(Math.PI/180)),a.x=a.x+(o-a.offsetY)*a.scaleY*Math.sin(a.rotation*(Math.PI/180)),this.selectedShapeAlignment=a.centerPosition,"-1"!=s.grp_id&&this.updateAllPosInGrp(s.grp_id),t.target.x(a.x),t.target.y(a.y))},ChangeAlignCenter(t){let e,i=ne.props.ConcernedShape,s=this.groups.find((t=>t.id===this.selectedShapeId));if(void 0!=s){for(let e=0;e<s.shapes_g.length;e++)this.ChangeCenterRegardingCommand(s.shapes_g[e].id,t);i.x(s.line.x),i.y(s.line.y),s.line.defaultAlignment==t?s.line.defaultAlignment="":s.line.defaultAlignment=t,this.selectedShapeAlignment=s.line.defaultAlignment}else e=this.findShape(this.selectedShapeId).shape_data,this.ChangeCenterRegardingCommand(e.id,t),this.selectedShapeAlignment=e.centerPosition,i.x(e.x),i.y(e.y)},ChangeCenterRegardingCommand(t,e){let i=this.findShape(t),s=i.shape_data,a=s.offsetY;"Rect"==s.className?"Top"==e?(s.offsetY=0,s.offsetX=s.width/2):"Middle"==e?(s.offsetX=s.width/2,s.offsetY=s.height/2):"Bottom"==e&&(s.offsetX=s.width/2,s.offsetY=s.height):"Circle"==s.className?"Top"==e?(s.offsetX=0,s.offsetY=-s.radius):"Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e&&(s.offsetX=0,s.offsetY=s.radius):"Image"==s.className?"Middle"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height/2):"Bottom"==e?(s.offsetX=s.image.width/2,s.offsetY=s.image.height):"Top"==e&&(s.offsetX=s.image.width/2,s.offsetY=0):"Text"==s.className?"Middle"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y/2):"Bottom"==e?(s.offsetX=s.length_x/2,s.offsetY=s.length_y):"Top"==e&&(s.offsetX=s.length_x/2,s.offsetY=0):"Triangle"==s.className&&("Middle"==e?(s.offsetX=0,s.offsetY=0):"Bottom"==e?(s.offsetX=0,s.offsetY=s.radius/2):"Top"==e&&(s.offsetX=0,s.offsetY=-s.radius)),s.centerPosition=e,s.y=s.y-(a-s.offsetY)*s.scaleY*Math.cos(s.rotation*(Math.PI/180)),s.x=s.x+(a-s.offsetY)*s.scaleY*Math.sin(s.rotation*(Math.PI/180)),"-1"!=i.grp_id&&this.updateAllPosInGrp(i.grp_id)},updateDragFuncOfCenter(){let t=this.findShape(this.selectedShapeId).shape_data;if(void 0==t)return;let e=this.center,i=t.rotation*(Math.PI/180);i>=-Math.PI/2&&i<=0?i-=Math.PI/180*90:i<-Math.PI/2?(i+=Math.PI/2,i=Math.PI+i):i<=Math.PI&&i>0&&(i-=Math.PI/180*90),i<=0&&i>=-Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}}:i<-Math.PI/4&&i>=-Math.PI/2||i<-Math.PI/2&&i>=-3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.y-t.y)*Math.cos(i),y:t.y-(e.y-t.y)*Math.sin(i)}}:i<-3*Math.PI/4&&i>=-Math.PI||i<=Math.PI&&i>=3*Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x-(e.x-t.x)*Math.cos(i),y:t.y-(e.x-t.x)*Math.sin(i)}}:i<3*Math.PI/4&&i>=Math.PI/2||i<Math.PI/2&&i>=Math.PI/4?e.dragBoundFunc=function(e){return{x:t.x+(e.y-t.y)*Math.cos(i),y:t.y+(e.y-t.y)*Math.sin(i)}}:i<Math.PI/4&&i>=0&&(e.dragBoundFunc=function(e){return{x:t.x+(e.x-t.x)*Math.cos(i),y:t.y+(e.x-t.x)*Math.sin(i)}})},ChangeCenterButtonAction(){let t=$.props.ConcernedShape;if("Line"==t.attrs.className){let e=t.getParent().attrs.shapes_g;for(let t=0;t<e.length;t++)this.ChangeCenter(e[t])}else{let e=this.shapes.find((e=>e.id===t.attrs.id)),i=!0;void 0==e&&(i=!1);let s=0;while(!i)s<this.groups.length?(e=this.groups[s].shapes_g.find((e=>e.id===t.attrs.id)),i=void 0!=e,s++):i=!0;this.ChangeCenter(e)}},Copy(){$.props.CopiedShape=$.props.ConcernedShape,$.props.pastOneObject=!0},CopyAll(){$.props.CopiedShape=$.props.ConcernedShape,$.props.pastOneObject=!1},Past(){if(void 0==$.props.CopiedShape.attrs)return;let t=$.props.CopiedShape.clone({id:""+this.max_id_figures}),e=this.groups.length;if("Line"==$.props.CopiedShape.attrs.className){if(this.max_id_figures=this.max_id_figures+1,$.props.pastOneObject){t=$.props.CopiedShape.getParent().clone({id:""+this.max_id_figures,name:"group"+this.max_id_figures,shapes_g:[]}),t.attrs.line.id=""+this.max_id_figures,t.attrs.line.x=$.props.ConcernedShape.getStage().getPointerPosition().x,t.attrs.line.y=$.props.ConcernedShape.getStage().getPointerPosition().y;for(let e=0;e<t.attrs.line.occupiedDistances.length;e++)t.attrs.line.freeDistances.push(t.attrs.line.occupiedDistances[e]);if(t.attrs.line.occupiedDistances=[],1!=t.attrs.line.keepDistribution){let e=Object.assign([],t.attrs.line.positionPoints),i=e.length;t.attrs.line.positionPoints=[];for(let s=0;s<i.valueOf();s++){let i=$.props.CopiedShape.getParent().getChildren().find((t=>t.attrs.id===e[s].id)).clone({id:"positionPoint"+t.attrs.line.id+s});t.attrs.line.positionPoints.push(i.attrs)}}this.groups.push(t.attrs)}else{t=$.props.CopiedShape.getParent().clone({id:""+this.max_id_figures,name:"group"+this.max_id_figures,shapes_g:[]}),t.attrs.line.id=""+this.max_id_figures,t.attrs.line.x=$.props.ConcernedShape.getStage().getPointerPosition().x,t.attrs.line.y=$.props.ConcernedShape.getStage().getPointerPosition().y;let i=Object.assign([],t.attrs.line.positionPoints),s=i.length;t.attrs.line.positionPoints=[];for(let e=0;e<s.valueOf();e++){let s=$.props.CopiedShape.getParent().getChildren().find((t=>t.attrs.id===i[e].id)).clone({id:"positionPoint"+t.attrs.line.id+e});t.attrs.line.positionPoints.push(s.attrs)}this.groups.push(t.attrs);let a=this.groups[this.groups.indexOf(this.groups.find((t=>t.id==$.props.CopiedShape.getParent().attrs.id)))].shapes_g,n=a.length;for(let t=0;t<n;t++){this.max_id_figures=this.max_id_figures+1;let i=$.props.CopiedShape.getParent().getChildren().find((e=>e.attrs.id===a[t].id)).clone({id:""+this.max_id_figures});this.groups[e].shapes_g.push(i.attrs),this.updateDragFunc(this.groups[e].shapes_g[this.groups[e].shapes_g.length-1],this.groups[e].line)}this.updateAllPosInGrp(t.attrs.id)}this.updateAllPosInGrp(t.attrs.id)}else this.max_id_figures=this.max_id_figures+1,t=$.props.CopiedShape.clone({id:""+this.max_id_figures,x:$.props.ConcernedShape.getStage().getPointerPosition().x,y:$.props.ConcernedShape.getStage().getPointerPosition().y}),t.attrs.dragBoundFunc=function(t){return{x:t.x,y:t.y}},t.attrs.isGrouped=0,this.shapes.push(t.attrs)},Remove(t){if("Line"==t.attrs.className){let e=this.groups.find((e=>e.id===t.attrs.id));const i=e.shapes_g.length;for(let t=0;t<i;t++)e.shapes_g[t].dragBoundFunc=qe,e.shapes_g[t].isGrouped=0,this.shapes.push(e.shapes_g[t]);this.eraseNodefromTransformer("lineTransformer"),this.groups.splice(this.groups.indexOf(e),1),t.getParent().destroy(),void 0!=this.groups[0]?(this.center.x=this.groups[0].line.x,this.center.y=this.groups[0].line.y):void 0!=this.shapes[0]&&(this.center.x=this.shapes[0].x,this.center.y=this.shapes[0].y),this.center.visible=!1}else if("positionPoint"==t.attrs.className){let e=t.getParent().attrs.line,i=e.positionPoints.find((e=>e.id===t.attrs.id)),s=e.freeDistances.indexOf(t.attrs.distance_to_line_center);1!=e.keepDistribution&&-1!=s&&(e.freeDistances.splice(s,1),e.positionPoints.splice(e.positionPoints.indexOf(i),1))}else{let e=this.findShape(t.attrs.id),i=e.shape_data,s=e.grp_id;if(void 0!=i){if("-1"!=s){let t=this.groups.find((t=>t.id===s));t.line.freeDistances.push(t.line.occupiedDistances[t.shapes_g.indexOf(i)]),t.line.occupiedDistances.splice(t.shapes_g.indexOf(i),1),t.shapes_g.splice(t.shapes_g.indexOf(i),1),this.updateOccupiedDistance(t.id),this.updateAllPosInGrp(t.id);let e=t.line.positionPoints.find((e=>e.distance_to_line_center==t.line.freeDistances[t.line.freeDistances.length-1]));e.draggable=!0,this.updateDragFunc(e,t.line)}else this.eraseNodefromTransformer("shapeTransformer"),this.shapes.splice(this.shapes.indexOf(i),1),void 0!=this.groups[0]?(this.center.x=this.groups[0].line.x,this.center.y=this.groups[0].line.y):void 0!=this.shapes[0]&&(this.center.x=this.shapes[0].x,this.center.y=this.shapes[0].y),this.center.visible=!1;t.destroy()}}},RemoveAll(){let t=$.props.ConcernedShape;if("Line"==t.className){let e=this.groups.find((e=>e.id===t.attrs.id));while(0!=e.shapes_g.length)e.shapes_g[0].dragBoundFunc=qe,e.shapes_g.splice(0,1);this.eraseNodefromTransformer("lineTransformer"),this.groups.splice(this.groups.indexOf(e),1),t.getParent().destroy(),void 0!=this.groups[0]?(this.center.x=this.groups[0].line.x,this.center.y=this.groups[0].line.y):void 0!=this.shapes[0]&&(this.center.x=this.shapes[0].x,this.center.y=this.shapes[0].y)}},findShape(t){let e=this.shapes.find((e=>e.id===t)),i="-1",s=!0;void 0==e&&(s=!1);let a=0;while(!s)a<this.groups.length?(e=this.groups[a].shapes_g.find((e=>e.id===t)),void 0==e?s=!1:(i=this.groups[a].id,s=!0),a++):s=!0;return{shape_data:e,grp_id:i}},DetachShape(t,e,i){const s=this.lengthToCapture+10;let a=this.groups.find((e=>-1!=e.shapes_g.indexOf(t))),n=a.shapes_g.indexOf(t);t.dragBoundFunc=qe;let o=a.line.y-.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),r=a.line.x+.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),h=a.line.y+.5*a.line.points[4]*a.line.scaleX*Math.sin(a.line.rotation*(Math.PI/180)),l=a.line.x-.5*a.line.points[4]*a.line.scaleX*Math.cos(a.line.rotation*(Math.PI/180)),c=(h-o)/(r-l),d=t.x*(1/c)+t.y;if(a.line.rotation<0&&a.line.rotation>-45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-45&&a.line.rotation>-90||a.line.rotation<-90&&a.line.rotation>-135?(t.x=t.x+Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation<=-135&&a.line.rotation>-180||a.line.rotation>135&&a.line.rotation<180?(t.x=t.x-Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>90&&a.line.rotation<=135||a.line.rotation>45&&a.line.rotation<=90?(t.x=t.x-Math.sign(t.x-e)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):a.line.rotation>0&&a.line.rotation<=45?(t.x=t.x+Math.sign(t.y-i)*s*Math.sin(a.line.rotation*(Math.PI/180)),t.y=-1/c*t.x+d):-90==a.line.rotation?t.x=t.x-Math.sign(t.x-e)*s:90==a.line.rotation?t.x=t.x+Math.sign(t.x-e)*s:(180==a.line.rotation||-180==a.line.rotation||0==a.line.rotation)&&(t.y=t.y-Math.sign(t.y-i)*s),t.isGrouped=0,this.shapes.push(t),this.center.x=t.x,this.center.y=t.y,a.line.freeDistances.push(a.line.occupiedDistances[n]),a.line.occupiedDistances.splice(n,1),a.shapes_g.splice(n,1),a.line.keepDistribution&&(console.log("a position point is delete"),a.line.positionPoints.splice(a.line.positionPoints.length-1,1)),this.updateOccupiedDistance(a.id),this.updateAllPosInGrp(a.id),!a.line.keepDistribution){let t=a.line.positionPoints.find((t=>t.distance_to_line_center==a.line.freeDistances[a.line.freeDistances.length-1]));t.draggable=!0,this.updateDragFunc(t,a.line)}this.eraseNodefromTransformer("shapeTransformer"),a.ghosts.splice(0,a.ghosts.length);for(let g=0;g<a.shapes_g.length;g++)a.shapes_g[g].opacity=1},DetachShapeButtonAction(){let t=$.props.ConcernedShape;if("Line"==t.attrs.className){let e=t.getParent().attrs.shapes_g;while(0!=e.length)this.DetachShape(e[0])}else{let e=this.shapes.find((e=>e.id===t.attrs.id)),i=!0;void 0==e&&(i=!1);let s=0;while(!i)s<this.groups.length?(e=this.groups[s].shapes_g.find((e=>e.id===t.attrs.id)),i=void 0!=e,s++):i=!0;this.DetachShape(e)}},switchStickylineMode(){let t=this.groups.find((t=>t.id===$.props.ConcernedShape.attrs.id)),e=t.line;if(void 0!=e)if(e.keepDistribution){e.keepDistribution=!1;for(let i=0;i<t.shapes_g.length;i++)t.shapes_g[i].distance_to_line_center=e.occupiedDistances[i];e.freeDistances=[],e.stroke="blue",t.line.keepDistanceButtonText="Keep Distribution"}else{e.keepDistribution=!0;for(let i=0;i<t.shapes_g.length;i++)e.occupiedDistances[i]=t.shapes_g[i].distance_to_line_center;e.stroke="rgb(48,48,48)",t.line.keepDistanceButtonText="Liberate Distribution",this.updateOccupiedDistance(e.id),this.updateAllPosInGrp(e.id)}},createNewShape(t){if("Line"==t.attrs.className){this.max_id_figures=this.max_id_figures+1;let e=t.getParent().clone({id:""+this.max_id_figures,name:"group"+this.max_id_figures,shapes_g:[]});e.attrs.line.id=""+this.max_id_figures,e.attrs.line.x=t.getStage().getPointerPosition().x,e.attrs.line.y=t.getStage().getPointerPosition().y,e.attrs.line.draggable=!0,this.groups.push(e.attrs)}else{this.max_id_figures=this.max_id_figures+1;let e=t.clone({id:""+this.max_id_figures,draggable:!0});e.attrs.isGrouped=0,this.shapes.push(e.attrs)}},eraserAction(t){this.Remove(t.target)},unshowSelectedShape(t){"Line"==t.target.attrs.className&&0==this.eraseMode?t.target.opacity(.5):"Line"==t.target.attrs.className&&1==this.eraseMode?1==t.target.attrs.keepDistribution?t.target.stroke("rgb(48,48,48)"):t.target.stroke("blue"):"positionPoint"==t.target.attrs.className&&1==this.eraseMode?1!=t.target.getParent().attrs.line.keepDistribution&&t.target.strokeWidth(0):1==this.eraseMode&&t.target.strokeWidth(0)},showSelectedShape(t){if("Line"==t.target.attrs.className&&0==this.eraseMode)t.target.opacity(1);else if("Line"==t.target.attrs.className&&1==this.eraseMode)t.target.stroke("rgb(200, 59, 218)");else if("positionPoint"==t.target.attrs.className&&1==this.eraseMode){let e=t.target.getParent().attrs.line;-1!=e.freeDistances.indexOf(t.target.attrs.distance_to_line_center)&&1!=e.keepDistribution&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))}else 1==this.eraseMode&&(t.target.stroke("rgb(200, 59, 218)"),t.target.strokeWidth(3))},editText(t){let e=t.target.getStage().attrs.container.getBoundingClientRect();document.getElementById("input").style.top=e.y+t.target.getAbsolutePosition().y+"px",document.getElementById("input").style.left=e.x+t.target.getAbsolutePosition().x-5*document.getElementById("input").size+"px",document.getElementById("input").style.display="initial",this.editedText=t.target},updateText(t){let e=this.shapes.find((t=>t.id===this.editedText.attrs.id)),i=!0;void 0==e&&(i=!1);let s=0;while(!i)s<this.groups.length?(e=this.groups[s].shapes_g.find((t=>t.id===this.editedText.attrs.id)),i=void 0!=e,s++):i=!0;if(void 0!=e){let i,s,a,n;i=this.editedText.width(),s=this.editedText.height(),e.text=t.target.value,this.editedText.text(t.target.value),a=this.editedText.width()-i,n=this.editedText.height()-s,e.offsetX=e.offsetX+a/2,e.offsetY=e.offsetY+n/2,e.length_x=this.editedText.width(),e.length_y=this.editedText.height(),document.getElementById("input").style.display="none"}}}};const $e=(0,f.Z)(ze,[["render",Re]]);var Ze=$e,Ue=i.p+"img/genTheoImg.91e81d50.png";const Qe={class:"introduction"},Ve=(0,a._)("h1",null,"Introduction",-1),Je=(0,a._)("p",{class:"text_for_introduction"},"The goal of this app is to help you discover two generative theories of interaction: Instrumental Interaction and Human-Computer Partnerships. Even if the interactive part is more focused on the first theory, this app should help you understanding the concepts and principles of these theories and how to apply them. ",-1),ti=(0,a._)("p",{class:"text_for_introduction"},"We will first begin with an observation. Take a look at the following interactive situation:",-1),ei=(0,a._)("p",{class:"text_for_introduction"},[(0,a._)("strong",null,"You can drag shapes, select them by clicking on them and align the selected shapes through a button that appears when you right click on the blank.")],-1),ii={id:"basic-demo"},si=(0,a.uE)('<p class="text_for_introduction">We can see that there is a <strong>lack of persistence and control</strong>. These problems related to alignement is something that can be seen in some graphic design softwares. How to improve this command? We will try to apply &#39;Instrumental Interaction&#39; and &#39;Human-Computer Partnerships&#39;, two &#39;Generative Theories of Interaction&#39; in order to answer this question. </p><p class="text_for_introduction"><strong>We tried to apply the principles of these theories in order to illustrate them: See the tab &quot;Instrumental Interaction Overview&quot; and &quot;Human-Computer Partnerships Overview&quot;. In these interactive illustrations, alignement is now a digital tool called &quot;stickyline&quot;. <br>The playground is a combination of these applications. <br>This work is inspired by the software of the &#39;ex-situ&#39; team called &quot;StickyLine&quot;. See references [2] and [5] in &quot;About&quot; tab for more information</strong></p><h2>Generative Theory of Interaction</h2><p class="text_for_introduction">A “Generative theory of interaction” can be seen as a theory which makes a link between the HCI knowledge, scientific theories and those about human behaviour/activity with the design of interactive artifacts. A generative theory allows to apply three &quot;lenses&quot; based on its concepts and principles in order analyse,critize and construct new artifacts</p><img width="500" src="'+Ue+'"><p class="legend">Taken from reference [1]</p><h2>Instrumental Interaction</h2><h3>Concept:</h3><p class="text_for_introduction">An &#39;instrumental interaction&#39; is based on using digital tools to manipulate objects. These tools, also considered as objects, should be flexible and, as for physical tools, have clear technial properties in order to help the user to appropiate it and allow him to use it for different kind of purposes beyond its primitive goal. </p><h3>Principles:</h3><table><tr class="title_row"><th colspan="3">Principles</th></tr><tr><th><span class="principle"> Reification</span></th><th><span class="principle"> Polymorphism</span></th><th><span class="principle"> Reuse</span></th></tr><tr><th> Reify a command in a first-class object for the interface, in a digital tool that the user can manipulate directly </th><th> Digital instrument should have the possibility to be used on different types of object. It could also reify further commands. </th><th> Possibility for the user to use again a previous process (Input Reuse) or its result (Output Reuse) </th></tr></table><h3>Methodology:</h3><table><tr class="title_row"><th>Instrumental Interaction</th><th>Analytical</th><th>Critical</th><th>Constructive</th></tr><tr class="subtitle_row"><th colspan="4">Concepts</th></tr><tr><th class="row_name">Object of Interest</th><th>What are the objects visible and directly manipulable by the user?</th><th>Do these objects match those of the users’ mental models?</th><th>Are there other objects of interest, e.g. styles in a text editor? Should some objects of interest turned into instruments?</th></tr><tr><th class="row_name">Instrumental / Tool</th><th>What functions are available as tools, e.g. in tool palettes, as opposed to commands, e.g. menu items?</th><th>Do the tools actually work as such i.e. by extending users capabilities? Do the tools enable technical reasoning?</th><th>Which commands can be turned into tools? Are they related with physical tools?</th></tr><tr class="subtitle_row"><th colspan="4">Principles</th></tr><tr><th class="row_name">Reification</th><th>Which concepts/commands are reified into interactive objects/tools? How can these objects be manipulated?</th><th>Are the reified concepts effective? Are the objects directly manipulable?</th><th>Which concepts/commands should be reified? Into which objects/tools? What manipulations should be available?</th></tr><tr><th class="row_name">Polymorphism</th><th>Which commands/tools apply to objects of different types? Do they apply to collection of heterogeneous objects?</th><th>Should commands/tools apply to multiple object types? Which types?</th><th>How to make each instrument (more) polymorphic? How to create groups of heterogeneous objects?</th></tr><tr><th class="row_name">Reuse</th><th>Which commands/objects can be reused?</th><th>Which commands/objects should be reusable?</th><th>How to make commands reusable (input reuse)? How to make objects reusable (output reuse)?</th></tr></table><p class="legend">Taken from reference [1]</p><h2>Human-Computer Partnerships</h2><h3>Concept:</h3><p class="text_for_introduction"> This theory is based on the concepts of co-adaptation. In HCI, co-adaptation means that the user tames the system by getting used to it but also by adapting the systems to its needs. There is also the concepts of &quot;Reciprocal co-adaptation&quot; related to intelligent systems, but we will not talk of that here. If you want to know more see the reference [1] in the &quot;About&quot; page. </p><h3>Principles:</h3><table><tr class="title_row"><th colspan="3">Principles</th></tr><tr><th><span class="principle"> Discoverability</span></th><th><span class="principle"> Appropriability</span></th><th><span class="principle"> Expressivity</span></th></tr><tr><th> Reveal how the system interprets the user’s recent behavior (feedback) and which commands are now possible (feedforward) </th><th> Modify the system’s behavior by customizing its characteristics for new purposes </th><th> Create rich, personalized output generated from individual user-controlled input variation. </th></tr></table><p class="legend">Taken from reference [1]</p><h3>Methodology:</h3><table><tr class="title_row"><th>Human-Computer Partnerships</th><th>Analytical</th><th>Critical</th><th>Constructive</th></tr><tr class="subtitle_row"><th colspan="4">Concepts</th></tr><tr><th class="row_name">Co-adaptation</th><th>Can users reveal, interpret or modify the system’s behavior?</th><th>Which aspects of the system are discoverable, appropriable and expressive?</th><th>How can we help users to both adapt to the system, and adapt it for new tasks and creative expression?</th></tr><tr class="subtitle_row"><th colspan="4">Principles</th></tr><tr><th class="row_name">Discoverability</th><th>Does the system reveal how it interpreted user behavior and show what options are currently available? </th><th>Can users discover and understand the system? Can the system interpret aspects of the user’s behavior?</th><th>How can we present the system’s interpretation of users’ actions and reveal user-relevant features?</th></tr><tr><th class="row_name">Appropriability</th><th>Does the system permit customization of the system or its features?</th><th>Can users create or modify the commands and features they need?</th><th>How can we help users personalize or redefine the system or its features?</th></tr><tr><th class="row_name">Expressivity</th><th>Does the system transform individual input variation into expressive output?</th><th>Can users control how the system interprets their actions so as to generate rich or expressive output?</th><th>How can we help users dynamically control their expressive output?</th></tr></table><p class="legend">Taken from reference [1]</p>',23);function ai(t,e,i,s,n,o){const r=(0,a.up)("BasicAlignmentDemo");return(0,a.wg)(),(0,a.iD)("div",Qe,[Ve,Je,ti,ei,(0,a._)("div",ii,[(0,a.Wm)(r,{height:300,width:500})]),si])}const ni={id:"align_button"};function oi(t,e,i,s,n,o){const r=(0,a.up)("v-rect"),h=(0,a.up)("v-circle"),l=(0,a.up)("v-regular-polygon"),c=(0,a.up)("v-layer"),d=(0,a.up)("v-stage");return(0,a.wg)(),(0,a.iD)("div",{id:"basicAlignmentDemo",onClick:e[1]||(e[1]=(...t)=>o.hideButton&&o.hideButton(...t))},[(0,a.Wm)(d,{ref:"stage",id:"stage",config:n.stageSize,onContextMenu:o.displayButton},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{ref:"layer"},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.shapes.filter((t=>"Rect"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(r,{key:t.id,config:t,onClick:o.selectShape},null,8,["config","onClick"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.shapes.filter((t=>"Circle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(h,{key:t.id,config:t,onClick:o.selectShape},null,8,["config","onClick"])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.shapes.filter((t=>"Triangle"==t.className)),(t=>((0,a.wg)(),(0,a.j4)(l,{key:t.id,config:t,onClick:o.selectShape},null,8,["config","onClick"])))),128))])),_:1},512)])),_:1},8,["config","onContextMenu"]),(0,a._)("div",ni,[(0,a._)("button",{onClick:e[0]||(e[0]=(...t)=>o.alignSelectedShapes&&o.alignSelectedShapes(...t))},"Align")])])}const ri=function(t){let e=this.getStage().width(),i=this.getStage().height(),s=10;return t.x>e-s&&t.y>i-s?{x:e-s,y:i-s}:t.x>e-s&&t.y<s?{x:e-s,y:s}:t.y>i-s&&t.x<s?{x:s,y:i-s}:t.x<s&&t.y<s?{x:s,y:s}:t.x<s?{x:s,y:t.y}:t.y<s?{x:t.x,y:s}:t.x>e-s?{x:e-s,y:t.y}:t.y>i-s?{x:t.x,y:i-s}:{x:t.x,y:t.y}};var hi={props:{width:{type:Number,default:window.innerWidth},height:{type:Number,default:window.innerHeight}},data(){return{align_pos:null,stageSize:{width:this.width,height:this.height},shapes:[{rotation:0,id:"2",x:220,y:250,width:70,height:70,scaleX:1,scaleY:1,strokeWidth:0,stroke:"red",fill:"green",name:"rect2",draggable:!0,className:"Rect",isGrouped:0,dragBoundFunc:ri,offsetX:35,offsetY:70,personalRotation:0,centerPosition:"Bottom"},{rotation:0,x:50,y:100,scaleX:1,scaleY:1,offsetX:0,offsetY:40,radius:40,fill:"orange",strokeWidth:0,stroke:"red",draggable:!0,isGrouped:0,className:"Circle",personalRotation:0,id:"3",dragBoundFunc:ri,centerPosition:"Bottom"},{rotation:0,id:"8",x:400,y:130,sides:3,radius:45,width:90,height:90,scaleX:1,scaleY:1,strokeWidth:0,stroke:"red",fill:"purple",name:"triangle1",draggable:!0,className:"Triangle",isGrouped:0,dragBoundFunc:ri,offsetX:0,offsetY:22.5,personalRotation:0,centerPosition:"Bottum"}]}},methods:{selectShape(t){0==t.target.strokeWidth()?this.shapes.find((e=>e.id==t.target.attrs.id)).strokeWidth=3:this.shapes.find((e=>e.id==t.target.attrs.id)).strokeWidth=0},alignSelectedShapes(){for(let t=0;t<this.shapes.length;t++)this.shapes[t].strokeWidth>0&&(this.shapes[t].strokeWidth=0,this.shapes[t].y=this.align_pos)},displayButton(t){t.evt.preventDefault(),"stage"===t.target.attrs.id&&(this.align_pos=t.target.getStage().getPointerPosition().y,document.getElementById("align_button").style.display="initial",document.getElementById("align_button").style.top=document.getElementById("basicAlignmentDemo").getBoundingClientRect().top+document.documentElement.scrollTop+t.target.getStage().getPointerPosition().y+"px",document.getElementById("align_button").style.left=document.getElementById("basicAlignmentDemo").getBoundingClientRect().left+document.documentElement.scrollLeft+t.target.getStage().getPointerPosition().x+"px")},hideButton(){document.getElementById("align_button").style.display="none"}}};const li=(0,f.Z)(hi,[["render",oi]]);var ci=li,di={name:"IntroductionView",components:{BasicAlignmentDemo:ci}};const gi=(0,f.Z)(di,[["render",ai]]);var pi=gi;const ui=[{path:"/",name:"introduction",component:pi},{path:"/about",name:"about",component:()=>i.e(443).then(i.bind(i,45))},{path:"/instrumentalinteractiontable",name:"Instrumental Interaction Overview",component:bt},{path:"/hc-partnerships-table",name:"Humane-Computer Partnerships Overview",component:Ae},{path:"/playground",name:"Playground",component:Ze}],fi=(0,y.p7)({history:(0,y.r5)(),routes:ui});var Mi=fi,xi=i(168),yi=i.n(xi);(0,s.ri)(x).use(Mi).use(yi()).mount("#app")},392:function(t,e,i){t.exports=i.p+"img/exsitu-minus.b23dc328.png"},983:function(t,e,i){t.exports=i.p+"img/exsitu-plus.ff57f6b0.png"},471:function(t,e,i){t.exports=i.p+"img/exsitu.22e33945.png"},843:function(t){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAAgCAYAAAGHuXNZAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAE6ADAAQAAAABAAAAIAAAAADG7pLwAAABRUlEQVRIDWM43jN////bz/8zAAHT4xt3HBguP2L4v+7kfyaQCAygcBhh6pm1v3M0aPNLMMCl4QzGVSnV/2U1VA5Y+Hs4wExhATFAdlgoPYKJIfTCRYAMprA5rYzIAiA23F6oRCOjqmQD0+rOKcgK64GOawBbBPIIEqiHuw1JEIftyCpgbOK1Y/U7zBgoDXY7WCFMItTLD8bEoLHajaEKKDAUFMLjFZRE8PkaPb5RPAyMe7BB6PGPogiWUMHBgpZQMBRCEg1IGDXhoCgkKoBHFRGXEIkLJ0YmxkaUOMDCYQqd1dJASCEx+RKL2XAhcJ6F8VDyLnpBB1NEBI1ZEMA04csaMDXYaKJCFZtGbGKjhmELFfxio2GGP3ywyVI3zAiVBNhcgEsMXl2tTqtp+P/vfz1IIbl5E24YzDaQoSEevmBDYWLE0gAmrGY3QIUZagAAAABJRU5ErkJggg=="}},e={};function i(s){var a=e[s];if(void 0!==a)return a.exports;var n=e[s]={exports:{}};return t[s].call(n.exports,n,n.exports,i),n.exports}i.m=t,function(){var t=[];i.O=function(e,s,a,n){if(!s){var o=1/0;for(c=0;c<t.length;c++){s=t[c][0],a=t[c][1],n=t[c][2];for(var r=!0,h=0;h<s.length;h++)(!1&n||o>=n)&&Object.keys(i.O).every((function(t){return i.O[t](s[h])}))?s.splice(h--,1):(r=!1,n<o&&(o=n));if(r){t.splice(c--,1);var l=a();void 0!==l&&(e=l)}}return e}n=n||0;for(var c=t.length;c>0&&t[c-1][2]>n;c--)t[c]=t[c-1];t[c]=[s,a,n]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){i.f={},i.e=function(t){return Promise.all(Object.keys(i.f).reduce((function(e,s){return i.f[s](t,e),e}),[]))}}(),function(){i.u=function(t){return"js/about.caa6fa42.js"}}(),function(){i.miniCssF=function(t){return"css/about.acfe18a1.css"}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={},e="teaching_web_app:";i.l=function(s,a,n,o){if(t[s])t[s].push(a);else{var r,h;if(void 0!==n)for(var l=document.getElementsByTagName("script"),c=0;c<l.length;c++){var d=l[c];if(d.getAttribute("src")==s||d.getAttribute("data-webpack")==e+n){r=d;break}}r||(h=!0,r=document.createElement("script"),r.charset="utf-8",r.timeout=120,i.nc&&r.setAttribute("nonce",i.nc),r.setAttribute("data-webpack",e+n),r.src=s),t[s]=[a];var g=function(e,i){r.onerror=r.onload=null,clearTimeout(p);var a=t[s];if(delete t[s],r.parentNode&&r.parentNode.removeChild(r),a&&a.forEach((function(t){return t(i)})),e)return e(i)},p=setTimeout(g.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=g.bind(null,r.onerror),r.onload=g.bind(null,r.onload),h&&document.head.appendChild(r)}}}(),function(){i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){i.p="/teachingApp/"}(),function(){var t=function(t,e,i,s){var a=document.createElement("link");a.rel="stylesheet",a.type="text/css";var n=function(n){if(a.onerror=a.onload=null,"load"===n.type)i();else{var o=n&&("load"===n.type?"missing":n.type),r=n&&n.target&&n.target.href||e,h=new Error("Loading CSS chunk "+t+" failed.\n("+r+")");h.code="CSS_CHUNK_LOAD_FAILED",h.type=o,h.request=r,a.parentNode.removeChild(a),s(h)}};return a.onerror=a.onload=n,a.href=e,document.head.appendChild(a),a},e=function(t,e){for(var i=document.getElementsByTagName("link"),s=0;s<i.length;s++){var a=i[s],n=a.getAttribute("data-href")||a.getAttribute("href");if("stylesheet"===a.rel&&(n===t||n===e))return a}var o=document.getElementsByTagName("style");for(s=0;s<o.length;s++){a=o[s],n=a.getAttribute("data-href");if(n===t||n===e)return a}},s=function(s){return new Promise((function(a,n){var o=i.miniCssF(s),r=i.p+o;if(e(o,r))return a();t(s,r,a,n)}))},a={143:0};i.f.miniCss=function(t,e){var i={443:1};a[t]?e.push(a[t]):0!==a[t]&&i[t]&&e.push(a[t]=s(t).then((function(){a[t]=0}),(function(e){throw delete a[t],e})))}}(),function(){var t={143:0};i.f.j=function(e,s){var a=i.o(t,e)?t[e]:void 0;if(0!==a)if(a)s.push(a[2]);else{var n=new Promise((function(i,s){a=t[e]=[i,s]}));s.push(a[2]=n);var o=i.p+i.u(e),r=new Error,h=function(s){if(i.o(t,e)&&(a=t[e],0!==a&&(t[e]=void 0),a)){var n=s&&("load"===s.type?"missing":s.type),o=s&&s.target&&s.target.src;r.message="Loading chunk "+e+" failed.\n("+n+": "+o+")",r.name="ChunkLoadError",r.type=n,r.request=o,a[1](r)}};i.l(o,h,"chunk-"+e,e)}},i.O.j=function(e){return 0===t[e]};var e=function(e,s){var a,n,o=s[0],r=s[1],h=s[2],l=0;if(o.some((function(e){return 0!==t[e]}))){for(a in r)i.o(r,a)&&(i.m[a]=r[a]);if(h)var c=h(i)}for(e&&e(s);l<o.length;l++)n=o[l],i.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return i.O(c)},s=self["webpackChunkteaching_web_app"]=self["webpackChunkteaching_web_app"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=i.O(void 0,[998],(function(){return i(776)}));s=i.O(s)})();
//# sourceMappingURL=app.ddeb7678.js.map